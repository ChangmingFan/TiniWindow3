Public Class Form1

    'Dim databeinginternallymanipulated As Boolean = False
    Public USERMANUELFILE As String = IO.Directory.GetCurrentDirectory & "\1.pdf"

    Public Property linelength() As Integer
        'the pupose of this popetyy is to create an allias that is easier to remember and type in
        Get

            Return settings(settingsindex.linelength)
        End Get
        Set(ByVal value As Integer)
            settings(settingsindex.linelength) = value
        End Set
    End Property
    Dim mycomportmanger As ComportManager = New ComportManager

    Enum signconnectionindex
        none = -1
        USB = 0
        wireless = 1
        TCPsocket_via_server = 2 'jp changed from internet april/3/2010
        'TCPsocket_direct_to_sign = 3 'not currently used
        FTP = 3
    End Enum
    Dim selectedConnectionindex As signconnectionindex = -1

    'jp jan3,2011 simply replaced XB object with atmel object
    'Dim mysignconnections As SignConnection_Base() = {New SignConnection_OneSign_USB(mycomportmanger), New SignConnection_OneSign_Wireless_XB(mycomportmanger)}

    'jp jan/21/2010: added internet conncetion typ to list
    Dim mysignconnections As SignConnection_Base() = {New SignConnection_OneSign_USB(mycomportmanger), New SignConnection_OneSign_Wireless_Atmel(mycomportmanger), New SignConnection_Internet_Via_Server(mycomportmanger), New SignConnection_FTP()}
    
   
    Dim _databeinginternallymanipulated As Boolean = False
    Dim _timedataflagset As Double = -1
    Const _dataflagtimeout As Double = 1
    'Dim disabledataflagtimeout As Boolean = False
    Property databeinginternallymanipulated() As Boolean
        Get
            Return _databeinginternallymanipulated
        End Get
        Set(ByVal value As Boolean)

            _timedataflagset = DateAndTime.Timer() 'returns seconds since midnight
            _databeinginternallymanipulated = value
            If value = True Then
                Timer_flagwatchdog.Start()
            Else
                Timer_flagwatchdog.Stop()
            End If

        End Set
    End Property
    'Dim radiobuttontext As String = ""
    Dim jpstringsfunctions As jpstringfunctions = New jpstringfunctions
    Public formloaded As Boolean = False ' set true at end of formload to avoid selection change problems
    Dim defaultfilename As String = IO.Directory.GetCurrentDirectory + "/Test-Alpha-Num.text"
    Public updatetinidisk As Boolean = False 'passed to update process!jp_dragonbone1/bin/Debug/TiniWindowUpdate*
    Dim commandline As String = Command()
    Const ApplicationName = "TiniWindow-3.01.exe"
    Public backgroundworkerdebugvalue As String = "none"

    Dim TiniWindowVersionStandard As Int16 = 1 'first used with version 1.01.005 its abscence warns the update process of inconsistencies in other value

    Public Const TiniWindowMajorVersion As Int16 = 3
    Public Const TiniWindowMinorVersion As String = "01.001"

    Dim TiniWindoCompileDate As String = "20130723"
    'remoteSignsForm works well enough to work on subsequbt parts
    '(delete sign and advanced options not yet implimentd)
    'this version succesfully converts list of FTP signs into clickable icons and connects/disconnects 
    'correctly when they are clicked

    Dim TiniWindowVersion As String = TiniWindowMajorVersion.ToString() + "." + TiniWindowMinorVersion.ToString()

    Public TiniWindowVersion_display_string As String = TiniWindowVersion + "." + TiniWindoCompileDate.ToString + " (Tini-Pi-Lite supported) " ' not used in update process

    'Dim versiondateext As Char = "" 'A,B,C etc used when multiple changes are made in one day
    'Dim versiondate_displaystring = zerofillinteger(versiondate.Month, 2) + zerofillinteger(versiondate.Day, 2) + versiondate.Year.ToString + versiondateext
    'Dim versiondate_updatestring = versiondate.Year.ToString + 

    Dim clock_stringtowriteback As String
    Dim clock_stringused As Int16 = New Random().Next(0, 10)
    Dim clock_activestringtoreturnto As Int16
    Dim send_CB_monitor_active_trick_SelectedIndexChanged_todevice As Boolean = False
    Dim deviceandmemorymatch As Boolean = False
    Public InMonitorMode As Boolean = False 'this mode disabled when multiple tabs created because this mode is only practical in linebyline tab

    'Dim showtooltipppppp As Boolean = False 'set to true when comport is selected and when edit mode is selected. 

    'set false when edit mode is selected and after tooltip is shown
    Dim tooltipmessage As String = "You are in edit mode." + Constants.vbCrLf + "To send your changes to the sign" + Constants.vbCrLf + "select 'send data to sign' or 'monitor mode'" + Constants.vbCrLf + " from the sign menue"
    Dim selectcomportclicked As Boolean = False 'set true when menue item clicked

    Enum settingsindex
        keepuserdata
        'sendtodeviceastype
        askforname
        showwelcomeform
        opentrickfileaction 'what to do when user attempts to open a trick file
        '                    opening is not same as import/export
        openfilewithtoomanycharsaction  'what to do when lines have more characters then the version of tiniwindow supports
        '                               0 prompt
        '                               1 truncate extra chars
        '                               2 cancel opening file
        showbeginnershelp
        linelength


    End Enum
    Enum opentrickfileaction_value
        showdialog
        import
        openasdatafile
        pickanotherfile
        cancel
    End Enum

    Enum openfilewithtoomanycharsaction_value
        showdialog = 0
        truncate = 1
        cancel = 2
    End Enum

    Dim settingscount As Integer = 7
    Dim userdatacount As Integer = 10
    Enum userdataindex
        name
        dataFileExtentions
        trickFileExtentions
        OpenFilePath
        SaveFilePath
        OpenTrickPath
        SaveTrickPath
        defaultfile
        displayPatternPath
        PictureUpLoadPath
        ColorPatternPath
    End Enum

    'Changming 122912 w/ JP change 16 to 20

    Const MAX_LINELENGTH = 20  '  here !!!
    Const MIN_LINELENGTH = 4 'this constant was added latter and may not change everything it should

    Public settings(settingscount) As Integer
    Public userdata(userdatacount) As String

    Const TRICKCODINGVERSION_LINESONLY_PRE_20110310 = 2.1 'this vesion stores trick data as chars with any asc value 0-255
    '                                                     'it was replaced because of problems sending file with 
    '                                                     'non printable chars to server

    Const TRICKCODINGVERSION_LINESONLY_CURRENT = 2.2

    Const TRICKCODINGVERSION_COMBOKEYWORDS_1_08_01 = 3.1 'this was used on version 1.09.01 support can likely be removed because only distributed version was to pitabite
    Const TRICKCODINGVERSION_COMBOKEYWORDS_PRE_20110310 = 3.2
    Const TRICKCODINGVERSION_COMBOKEYWORDS_CURRENT = 3.3

    'version 1.1 and 1.2 pertain to EEprom memory scheam 255 limited to 10 line of 20 chars
    'version 2.1 pertains to EEprom scheem 0

    Public currenttrickcodingversion As Decimal = TRICKCODINGVERSION_COMBOKEYWORDS_CURRENT
    '-1 -> unrecognised coding version, preserve data to write back to file 0->no tricks 1->the current version. in the future 2,3 or other number will be current and 1 will be older
    Dim unrecognisedtrickdata As String
    Dim tricktypenames() As String = {"One Line", "Multiple Lines"}
    Dim tricktypecount As Integer = tricktypenames.Length  'fixed pertaining to the # of trick typed we offer



    Dim trickcodingleftlables As ArrayList = New ArrayList 'of labels 
    Dim trickcodingrightlables As ArrayList = New ArrayList 'of labels 

    Dim trickcodingcontrolls As ArrayList = New ArrayList 'of combobox or text box
    Dim trickcodingdecimals As ArrayList = New ArrayList 'decimal display of the controll

    Enum tricks_2nd_demention_index
        'no longer used for anything

        'trick_parameters is an 2 dementional array of arraylists


        description 'arraylist contains strings that describe parameter to user 
        minimumvalue 'arraylist contains integer giving the lowest valid interger value for parameter
        maximumvalue 'arraylist contains integers givning the highers valid integer value for parameter  
        address 'arraylist of integers noting the address on EEProm the parameter is sent to
        actualvalue 'arraylist contaning the actualvalues of the user selects
        valueoffset 'integer that is added to the value the user sees. 0 means the user sees the value recorde
        '            1 means user sees base 1 but the actual value is 0
        decimals '1 means the value 25 would be displayed 2.5
        controlltype
        editfieldhighlite 'curently there are two supportedformats "n" and "n-m" n and m are bothe numeric indexes
        'if there is one number the value of that controll pertains to the single highlighted line
        'for 2 numbers all aline between the value of the first controll and the value of the second controll (inclusively) will be highlited

    End Enum

    Enum controlltype
        none 'default value is stored in memory, saved to file and sent to sign but user can not modify
        dropdown
        textbox
        boxes 'sidebyside boxes (panels) that user clicks on
    End Enum


    Public tricks(tricktypecount - 1, 8)  'initialized in initializesignpatterns

    Dim defaulttricks(tricktypecount - 1, 8) 'this is defined in initialize sign patterns and used several places in program
    Dim defaultactivetrick As Integer = 0 '0 is show one line 
    Public activetrick As Integer = defaultactivetrick

    Dim footertextcount As Integer = 2
    Public footertext(footertextcount) As String



    Public mySerialPort As System.IO.Ports.SerialPort
    Public TiniDiskMajorVersion As ArrayList
    Public TiniDiskMinorVersion As ArrayList
    'set when comport is selected



    Const TIME_TOPROCESS_ADDRESSCOMMAND As Double = 0.06 'in seconds 
    'in timming test max was 0.579999999972642

    'old caluclating notes
    'the actual time depends on how longs it takes for dougs code to set the memory send response
    'nothing to look up in data sheet
    'for now guessing

    Const TIME_TOPROCESS_WRITECOMMAND As Double = 0.055 'in seconds 
    'in test maxtime was .0500000000029104

    'old caluclating notes
    ''''''''''overview''''''''''''
    'there are 4 factors in determing the time to process write command
    '1time to send write command  : 0.042   second
    '2time to write to eeprom     : 0.0085  second
    '3time to transmit echo       : 0.042 
    '4misc processing time        

    ''''1 time to send write command''''''
    'xbee speed is 250,000bits per second (zigbe in general is 20,000-250,000
    'however our baudrate is 9,600. since we transmit one bit/symbol over comport 
    'net datarate is 9600 bits/second which is 1200 bytes/second or .0008333333333 seconds/bit
    'The W command has the following format “W XX<CR>”
    '5 bytes take 0.0041666666   (round to .042) seconds to transmit


    ''''1 time to send write command''''''
    'datasheet says 8.5 ms for EEPROM write 
    '1 millisecond = 0.001 seconds
    'results in 0.0085 seconds


    ''''3 time to transmit echo''''''
    'even though we ignore we have to allow to completer before ATMEGA 16 is ready for next write command
    'the same comand is echoed back so the time is the same

    ''''''''4 misc processing time''''''''
    'this has to be estimated. 
    'due to the looping to take turns doing different processes.


    Const READCOMMAND As String = "R" + Constants.vbCrLf
    Const VERSIONCOMMAND As String = "V" + Constants.vbCrLf

    Dim pollingactivestring As Boolean


    Const WRITERESPONSELENGTH = 6
    Const READRESPONSELENGTH = 6
    Const VERSIONRESPONSELENGTH = 8

    Const ADDRESS_LINECOUNT = 0
    Const ADDRESS_LINELENGTH = 1

    Dim ADDRESS_STARTOFTEXTDATA As Integer
    Dim address_startoftrickdata As Integer = 2

    Const ADDRESS_EEPROM_MAP_TYPE = 510

    'these addreses no longer used
    Const ADDRESS0 As Integer = 0
    Const ADDRESS1 As Integer = 20
    Const ADDRESS2 As Integer = 40
    Const ADDRESS3 As Integer = 60
    Const ADDRESS4 As Integer = 80
    Const ADDRESS5 As Integer = 100
    Const ADDRESS6 As Integer = 120
    Const ADDRESS7 As Integer = 140
    Const ADDRESS8 As Integer = 160
    Const ADDRESS9 As Integer = 180
    Dim addresses() As Integer = {ADDRESS0, ADDRESS1, ADDRESS2, ADDRESS3, ADDRESS4, ADDRESS5, ADDRESS6, ADDRESS7, ADDRESS8, ADDRESS9}

    'old addres values pertaining to old memory map
    Const ADDRESS_ACTIVE_STRING As Integer = 201
    Const ADDRESS_PARAM1_TRICK_TYPE1 = 203 'subsequent parameters increment by one
    Const ADDRESS_ACTIVETRICK = 202
    Const MAXIMUMECHOLENGTH As Integer = 100
    Const NOFILE As String = "(no file open)"

    Dim readdevice_readlinelength As Int16 = 0

    '''''''''''''''''''''''''''''''''''''''''
    ''''''''new trick data variables'''''''''
    '''''''''''''''''''''''''''''''''''''''''

    Public trickdata As ArrayList = New ArrayList
    Dim tolineboxes As ArrayList = New ArrayList 'contains dynamically created boxes (panels) used in pan_morelines to select linecount (to line)


    ''progress form variable

    Public progresform_status As String = "" 'set by read/write another tread,  timer in main thread then updates progress form
    Public progresform_process As String = "" 'should be 'read' or 'write' 
    Public progresform_updatestatus As Boolean = False 'set by read/write another thread,  timer in main thread then updates progress form
    Public progresform_complete As Boolean = False 'set by read/write  thread,  timer in main thread then updates progress form
    Public progresform_successful As Boolean = False 'set by read/write  thread,  timer in main thread then updates progress form
    Public progresform_cancel As Boolean = False
    Public progresform_AutoCloseAtCompletion As Boolean = False
    Public progresform_StepCount As Integer = 100
    Dim backgroundworker_showfileerror As Boolean = False

    ''''''''''''''''''''''''''''''''
    ''''''demo variables''''''''''''
    ''''''''''''''''''''''''''''''''
    Dim demo_stringstocyclethrough As ArrayList
    Dim demo_timetablelables As ArrayList
    Dim demo_refreshindexintimer As Boolean = False
    Dim demo_mulitlinescreen As Int16 = 0
    Public oneline_simulator_ratio As Single
    'Public Demo_CardColor As Color = Color.Transparent 'would be a constant if the designers of the compiler were not retarded
    Public Demo_CardColor As Color = Color.White
    '
    Public demo_textcolor As Color = Color.Red

    'Dim my_simulator_form As simulator_form = New simulator_form


    ''''''''''''''''''''''''''''''''
    ''''''file variables''''''''''''
    ''''''''''''''''''''''''''''''''
    Const DEFAULT_DATA_FILE_EXTENTIONS = "*.text; *.txt; *.dat; *.bat;"
    Const DEFAULT_TRICK_FILE_EXTENTIONS = "*.trk; *.trick;"
    Dim filter As String = "Data files|*.text; *.txt; *.dat; *.bat;|All Files| *.*"
    Dim trickfilter As String = "Trick files|*.trk; *.trick;|Data files|*.text; *.txt; *.dat; *.bat;|All Files| *.*"

    '''''''''''''''''''''''''''''''''''''''''
    '''''''''video variables''''''''''''''''
    ''''''''''''''''''''''''''''''''''''''

    'Dim categoryindex As Int16 = 0
    Dim selected_Category As Int16 = 0
    Dim videos As ArrayList
    Enum vidoes_index
        category_name
        category_Directory
        Video_Names
        Video_files
    End Enum



    Private FileName As String = "" 'should do something fancier than simply making public
    Const settingsfilename As String = "settings_108.set"
    Const userdatafilename As String = "userdata_108.udat"

    Dim oldsettingsfilenames As String() = {"settings.text"}
    Dim olduserdatafilenames As String() = {"userdata.text"}


    '''''''''''''''''''''''''''''
    ''''''''textdata variables'''''''
    '''''''''''''''''''''''''''''''
    Const MAXLINES As Int16 = 10
    'Const MAXLINES As Int16 =   before 052713
    'Public linelength = 6
    Public linecount As Integer = 1
    Public textdata As ArrayList = New ArrayList

    Public totallines As Int16
    Public usedlines As Int16
    Public availablelines As Int16



    Public currentlychanginglinelength As Boolean = False
    Public currentlychanginglinecount As Boolean = False
    Private _change As Boolean = False
    Public Property change() As Boolean
        Get
            Return _change


        End Get
        Set(ByVal value As Boolean)
            _change = value

            If value And formloaded Then
                promptbeforedisablingstandadtab = True
                If Me.currenttrickcodingversion = TRICKCODINGVERSION_COMBOKEYWORDS_PRE_20110310 Then
                    'if the data is changed while it is possile to view in lines tab, save current data
                    dialog_unable_to_display_combo_tab.backupfile(dialog_unable_to_display_combo_tab.backupfileflags.saveCurrentState)
                End If
            End If


        End Set
    End Property
    'set when text changes used to propt fore saving
    'promptbeforedisablingstandadtab



    Dim lastkeypressed As Char = "" 'set in keypress used in textchange when in live edit mode

    'Dim monitormode As Boolean = True
    Public comportselected As Boolean = False
    Dim pathofopenfile As String
    'Dim default_welcome_Text As String


    Dim labletext As String = "TiniWindow"
    Public echoerror As Integer = 0 '0-no error 1-time out 2-line not terminated 3-unexpected line 4-error echo 5-wrong address echoed back 6-wrong character echoed back 7-comunication exception

    '''''easy tab variables
    'speeds are in .1 second units
    Dim speed_blinkfast = 1
    Dim speed_blinkslow = 20
    Dim speed_easydisplaypatterns = 10


    ''''''combo tab variables



    Dim keywordallignment As ArrayList = New ArrayList 'of integers refering to enum mod_textboxfunctions.allignementype

    Dim keywordexceedlinelength As ArrayList = New ArrayList ' of booleans, false by default


    Public promptbeforedisablingstandadtab As Boolean = False
    Enum combotab_patterns

        '''''notes pertaining to version 1.09.002 
        'these names are used internally and in files 
        'the order of these are listed in may be changed in order to change the order patterns are diaplayed in combo box
        'the names typed below may NOT be changed with out breaking multiple thing.
        'to change what displays in the combo box modify the functions 
        'combotabpatterns_displayname_to_dataname and combotabpatterns_dataname_to_displayname
        'both functions must be modified simultaniously to avoid breaking things




        ''''''old notes (out of date)
        'convention is that for enum index, all letter must be lowercase and spaces replaced with underscore

        'if conversion not followed, conversions between file, combobox contents, etc may break

        'conversion displaying in combobox makes first letter of each word capitol


        still
        scroll_left
        scroll_right
        split_out
        join_in
        zoom_in_and_out
        zoom_out_and_in
        add_on
        subtract_off
        add_and_subtract
        subtract_and_add
        blink_slow
        blink_fast

    End Enum

    Private Function combotabpatterns_dataname_to_legaydisplayname(ByVal pattern As String) As String
        'this function was added to avoid changing multiple other functions
        'eventually clean up will have to be done
        Return pattern.Replace("_", " ")


    End Function

    Private Function combotabpatterns_dataname_to_displayname(ByVal pattern As String) As String

        If pattern = "still" Then
            Return "Still"
        ElseIf pattern = "still" Then
            Return "Still"

        ElseIf pattern = "scroll_left" Then
            Return "< Flow"
        ElseIf pattern = "scroll_right" Then
            Return "Flow >"
        ElseIf pattern = "split_out" Then
            Return "Split"
        ElseIf pattern = "join_in" Then
            Return "Join"
        ElseIf pattern = "zoom_in_and_out" Then
            Return "In"
        ElseIf pattern = "zoom_out_and_in" Then
            Return "Out"
        ElseIf pattern = "add_on" Then
            Return "Adding"
        ElseIf pattern = "subtract_off" Then
            Return "Removing"
        ElseIf pattern = "add_and_subtract" Then
            Return "Add-Remv"
        ElseIf pattern = "subtract_and_add" Then
            Return "Remv-Add"


        ElseIf pattern = "blink_slow" Then
            Return "Flash Sl"
        ElseIf pattern = "blink_fast" Then
            Return "Flash Fa"

        Else
            MsgBox("bad value '" & pattern & "' sent to combotabpatterns_dataname_to_displayname()")

        End If


    End Function

    Private Function combotabpatterns_displayname_to_dataname(ByVal pattern As String) As String

        'so far this function is not called because we can get these values from the index of the dropdown menu
        If pattern = "Still" Then
            Return "still"

        ElseIf pattern = "Flow ->" Then
            Return "scroll_left"
        ElseIf pattern = "<- Flow" Then
            Return "scroll_right"
        ElseIf pattern = "Split" Then
            Return "split_out"
        ElseIf pattern = "Join" Then
            Return "join_in"
        ElseIf pattern = "In & Out" Then
            Return "zoom_in_and_out"
        ElseIf pattern = "Out + In" Then
            Return "zoom_out_and_in"
        ElseIf pattern = "Adding" Then
            Return "add_on"
        ElseIf pattern = "Removing" Then
            Return "subtract_off"
        ElseIf pattern = "Add & Rem" Then
            Return "add_and_subtract"
        ElseIf pattern = "Rem & Add" Then
            Return "subtract_and_add"


        ElseIf pattern = "Flash S" Then
            Return "blink_slow"
        ElseIf pattern = "Flash F" Then
            Return "subtract_and_add"
        Else
            MsgBox("bad value '" & pattern & "' sent to combotabpatterns_displayname_to_dataname()")

        End If


    End Function

    Enum combotab_patterns_legacy
        'convention is that for enum index, all letter must be lowercase and spaces replaced with underscore

        'if conversion not followed, conversions between file, combobox contents, etc may break

        'conversion displaying in combobox makes first letter of each word capitol
        still_108001
        scroll_left_108001
        scroll_right_108001
        split_out_108001
        add_on_108001
        subtract_off_108001
        add_and_subtract_108001
        'Join_In
        'Zoom_In_and_Out
        'Zoom_Out_and_In
        'Subtract_and_Add
    End Enum
    Enum legacysettingsindex
        showreps

    End Enum
    Dim legacypatternsettings As ArrayList = New ArrayList
    '0 -> don't show
    '1 -> show while file open
    '2 -> always show

    Dim legacysettings As ArrayList = New ArrayList
    '0 -> no
    '1 -> yes while file open
    '2 -> yes always



    Dim combo_patterns As ArrayList = New ArrayList








    Private Function zerofillinteger(ByVal number As String, ByVal digits As Int16) As String


        Return zerofillinteger(Convert.ToInt16(number), digits)


    End Function
    Private Function zerofillinteger(ByVal number As Integer, ByVal digits As Integer) As String

        Dim returnvalue As String = number.ToString

        While (digits < returnvalue.Length)
            returnvalue = "0" + returnvalue
        End While
        Return returnvalue

    End Function


    Private Sub set_default_userdata()
        userdata(userdataindex.name) = ""
        userdata(userdataindex.dataFileExtentions) = DEFAULT_DATA_FILE_EXTENTIONS
        userdata(userdataindex.trickFileExtentions) = DEFAULT_TRICK_FILE_EXTENTIONS
        userdata(userdataindex.OpenFilePath) = IO.Directory.GetCurrentDirectory
        userdata(userdataindex.SaveFilePath) = IO.Directory.GetCurrentDirectory
        userdata(userdataindex.OpenTrickPath) = IO.Directory.GetCurrentDirectory
        userdata(userdataindex.SaveTrickPath) = IO.Directory.GetCurrentDirectory

        userdata(userdataindex.displayPatternPath) = IO.Directory.GetCurrentDirectory

        userdata(userdataindex.PictureUpLoadPath) = IO.Directory.GetCurrentDirectory
        userdata(userdataindex.ColorPatternPath) = IO.Directory.GetCurrentDirectory

        'ColorPatternPath()

        If (IO.File.Exists(defaultfilename)) Then
            userdata(userdataindex.defaultfile) = defaultfilename
        Else
            userdata(userdataindex.defaultfile) = ""
        End If


    End Sub
    Private Sub set_default_settings()
        'Enum settingsindex
        'keepuserdata()
        'sendtodeviceastype()
        'askforname()
        'End Enum


        initialize_legacysettings()
        'makes the arraylist have the correct number of elements and sets them all to default value


        settings(settingsindex.keepuserdata) = True
        'settings(settingsindex.sendtodeviceastype) = False
        settings(settingsindex.askforname) = True
        settings(settingsindex.showwelcomeform) = True
        settings(settingsindex.opentrickfileaction) = opentrickfileaction_value.showdialog

        settings(settingsindex.openfilewithtoomanycharsaction) = 0
        settings(settingsindex.showbeginnershelp) = True
        settings(settingsindex.linelength) = 6


    End Sub
    Private Function convert_boolean_to_string(ByVal bool As Boolean) As String
        If (bool = True) Then
            Return "TRUE"
        Else
            Return "FALS"
        End If

    End Function

    Private Sub writesettingfile()
        'format of settingfile is 
        '[settingname]integer


        'and may be used to make aditional notes 
        'notes are for bennifit of people (users or future programmers)
        'who may view the settings file


        'settings
        Dim SW As IO.StreamWriter = IO.File.CreateText(settingsfilename)
        Dim outputstring As String
        outputstring = "This is the settings file for TiniWindow" + Constants.vbCrLf
        outputstring += "Manually changinging the value in this file is not recomended" + Constants.vbCrLf
        outputstring += "This file is overwritten each time the program is run" + Constants.vbCrLf
        outputstring += "therefore any notes you make will be erased" + Constants.vbCrLf
        outputstring += Constants.vbCrLf
        'Enum settingsindex
        'keepuserdata()
        'sendtodeviceastype()
        'askforname()
        'End Enum

        outputstring += "[keepuserdata]" + settings(settingsindex.keepuserdata).ToString + " " + Constants.vbCrLf
        'outputstring += "[sendtodeviceastype]" + settings(settingsindex.sendtodeviceastype).ToString + " " + Constants.vbCrLf
        outputstring += "[askforname]" + settings(settingsindex.askforname).ToString + " " + Constants.vbCrLf
        outputstring += "[showwelcomeform]" + settings(settingsindex.showwelcomeform).ToString + " " + Constants.vbCrLf
        outputstring += "[opentrickfileaction]" + settings(settingsindex.opentrickfileaction).ToString + " " + Constants.vbCrLf
        outputstring += "[openfilewithtoomanycharsaction]" + settings(settingsindex.openfilewithtoomanycharsaction).ToString + " " + Constants.vbCrLf
        outputstring += "[showbeginnershelp]" + settings(settingsindex.showbeginnershelp).ToString + " " + Constants.vbCrLf
        outputstring += "[linelength]" + settings(settingsindex.linelength).ToString + " " + Constants.vbCrLf

        'Dim default_welcome_Text As String
        SW.Write(outputstring)
        SW.Close()
    End Sub


    Private Sub writeuserdatafile()
        'format of userdatfile is 
        '[start datamembername]datastring[end datamembername] 
        'datastring may be multiline
        'characters outside start and end tag are ignored 
        'and may be used as notes




        Dim SW As IO.StreamWriter = IO.File.CreateText(userdatafilename)
        Dim outputstring As String
        outputstring = "This is the data file for Tini window" + Constants.vbCrLf
        outputstring += "Manually editing this file is not recomended " + Constants.vbCrLf
        outputstring += "If you do, be careful to correctly close opening tags" + Constants.vbCrLf
        outputstring += "This file is overwritten each time the program is run" + Constants.vbCrLf
        outputstring += "Therefore any notes you make will be erased" + Constants.vbCrLf
        outputstring += Constants.vbCrLf
        '    Enum userdataindex
        '       Name
        '  End Enum

        outputstring += "[start Name]" + userdata(userdataindex.name) + "[end Name]" + Constants.vbCrLf
        outputstring += "[start DataFileExtentions]" + userdata(userdataindex.dataFileExtentions) + "[end DataFileExtentions]" + Constants.vbCrLf
        outputstring += "[start TrickFileExtentions]" + userdata(userdataindex.trickFileExtentions) + "[end TrickFileExtentions]" + Constants.vbCrLf
        outputstring += "[start OpenFilePath]" + userdata(userdataindex.OpenFilePath) + "[end OpenFilePath]" + Constants.vbCrLf
        outputstring += "[start SaveFilePath]" + userdata(userdataindex.SaveFilePath) + "[end SaveFilePath]" + Constants.vbCrLf
        outputstring += "[start OpenTrickPath]" + userdata(userdataindex.OpenTrickPath) + "[end OpenTrickPath]" + Constants.vbCrLf
        outputstring += "[start SaveTrickPath]" + userdata(userdataindex.SaveTrickPath) + "[end SaveTrickPath]" + Constants.vbCrLf
        outputstring += "[start defaultfile]" + userdata(userdataindex.defaultfile) + "[end defaultfile]" + Constants.vbCrLf


        outputstring += "[start PictureUpLoadPath]" + userdata(userdataindex.PictureUpLoadPath) + "[end PictureUpLoadPath]" + Constants.vbCrLf
        outputstring += "[start displayPatternPath]" + userdata(userdataindex.displayPatternPath) + "[end displayPatternPath]" + Constants.vbCrLf
        outputstring += "[start ColorPatternPath]" + userdata(userdataindex.ColorPatternPath) + "[end ColorPatternPath]" + Constants.vbCrLf


        SW.Write(outputstring)
        SW.Close()
    End Sub

    Public Function extentionlistvalid(ByVal extentionlist As String) As Boolean
        '*.text; *.txt; *.dat; *.bat;
        Dim cont As Boolean = True
        If (extentionlist.Trim().Length = 0) Then
            'if an empty string is passed
            Return False
        End If
        While (True)
            extentionlist = extentionlist.Trim()
            If (extentionlist.Length = 0) Then
                'if there is white space after the last ";" 
                Return True
            End If
            Dim index = 2
            Try
                If (extentionlist.Substring(0, 2) <> "*.") Then
                    Return False
                End If

                While (extentionlist.Substring(index, 1) <> ";")
                    If (extentionlist.Substring(index, 1) = "/") Then
                        Return False
                    ElseIf (extentionlist.Substring(index, 1) = "\") Then
                        Return False

                    ElseIf (extentionlist.Substring(index, 1) = "|") Then
                        Return False
                    ElseIf (extentionlist.Substring(index, 1) = "*") Then
                        Return False
                    ElseIf (extentionlist.Substring(index, 1) = ":") Then
                        Return False
                    ElseIf (extentionlist.Substring(index, 1) = "?") Then
                        Return False
                    ElseIf (extentionlist.Substring(index, 1) = "<") Then
                        Return False
                    ElseIf (extentionlist.Substring(index, 1) = ">") Then
                        Return False
                    ElseIf (extentionlist.Substring(index, 1) = Chr(34)) Then
                        Return False
                        'quotemark
                    Else
                        'valid character
                    End If
                    index += 1
                End While
            Catch ex As ArgumentOutOfRangeException
                'if the end of the string is reached with out finding a ";"
                Return False
            End Try

            Try
                extentionlist = extentionlist.Substring(index + 1)
            Catch ex As ArgumentOutOfRangeException
                'this occurs when ";" is the last character of the string 
                Return True


            End Try



        End While
    End Function

    Public Function setdatafilefilter(ByVal extentionlist As String) As Boolean

        If (extentionlistvalid(extentionlist)) Then

            filter = "Data files|" + extentionlist + "|All Files| *.*"
            Return True
        ElseIf (extentionlistvalid(userdata(userdataindex.dataFileExtentions))) Then

            filter = "Data files|" + userdata(userdataindex.dataFileExtentions) + "|All Files| *.*"
            Return False

        ElseIf (extentionlistvalid(DEFAULT_DATA_FILE_EXTENTIONS)) Then
            filter = "Data files|" + DEFAULT_DATA_FILE_EXTENTIONS + "|All Files| *.*"
            Return False

        Else
            MsgBox("program has a bugg! the default data file extentions are invalid!")
        End If


    End Function

    Public Function settrickfilefilter(ByVal trickextentionlist As String, ByVal dataextentionlist As String) As Boolean

        Dim returnvalue As Boolean

        If (extentionlistvalid(trickextentionlist)) Then

            returnvalue = True
        ElseIf (extentionlistvalid(userdata(userdataindex.trickFileExtentions))) Then

            trickextentionlist = userdata(userdataindex.trickFileExtentions)
            returnvalue = False

        ElseIf (extentionlistvalid(DEFAULT_TRICK_FILE_EXTENTIONS)) Then
            trickextentionlist = DEFAULT_TRICK_FILE_EXTENTIONS
            returnvalue = False

        Else
            MsgBox("program has a bugg! the default Trick file extentions are invalid!")
            Return (False)
        End If
        If (extentionlistvalid(dataextentionlist)) Then
            returnvalue = True
        ElseIf (extentionlistvalid(userdata(userdataindex.trickFileExtentions))) Then

            dataextentionlist = userdata(userdataindex.trickFileExtentions)
            returnvalue = False

        ElseIf (extentionlistvalid(DEFAULT_TRICK_FILE_EXTENTIONS)) Then
            dataextentionlist = DEFAULT_TRICK_FILE_EXTENTIONS
            returnvalue = False

        Else
            MsgBox("program has a bugg! the default Trick file extentions are invalid!")
            Return (False)
        End If
        trickfilter = "Trick files|" + trickextentionlist + "|Data files|" + dataextentionlist + "|All Files| *.*"
        Return returnvalue
    End Function
    Private Sub testjunk()


        Dim Fso
        Fso = CreateObject("Scripting.FileSystemObject")

        Dim TxtFile
        TxtFile = Fso.GetFile("E:\projects\Temp\permissions.txt") 'Gets 

        'command lines to execute permission
        'permission.txt contains following lines:
        '%systemroot%\system32\cacls.exe e:\projects\temp\analysis /t /e /g 
        'everyone:c
        '%systemroot%\system32\cacls.exe e:\projects\temp\documents /t /e /g 
        'everyone:c
        '%systemroot%\system32\cacls.exe e:\projects\temp\drawings /t /e /g
        'everyone:c

        Const ForReading = 1
        Dim Txt, Ts
        Txt = Fso.GetFile(TxtFile)
        Ts = Txt.OpenAsTextStream(ForReading)

        Dim ACLCommand
        ACLCommand = "cmd /c echo y| cacls"
        ACLCommand = ACLCommand & TxtFile

        Dim WshShell, Calcls
        WshShell = CreateObject("WScript.Shell")
        Calcls = WshShell.Run(ACLCommand, 0, True)

        Fso = Nothing
        WshShell = Nothing

        'Dim theShellClass As New IWshShell_Class()
        'Dim theShortCut As New IWshShortcut_Class()
        'theShortCut = theShellClass.CreateShortcut("MyApp.lnk")
        'theShortCut.Description = "Description here"
        'theShortCut.TargetPath = Application.StartupPath + "\MyFile.exe"
        'theShortCut.Save()

        '       Dim sShortcutPath As String
        '       Dim oShortcut As Object             ' Use late binding to accommodate both
        '       ' WshShortcut and WshURLShortcut objects
        'Dim oShell As New WshShell

        'sShortcutPath = < path and filename of link file >
        '       oSh = oScr.CreateShortcut(fn)
    End Sub
    Private Sub readuserdatafile()
        'format of userdatfile is 
        '[start datamembername]datastring[end datamembername] 
        'datastring may be multiline
        'characters outside start and end tag are ignored 
        'and may be used as notes



        set_default_userdata()
        If (IO.File.Exists(userdatafilename)) Then

            Dim SR As IO.StreamReader = IO.File.OpenText(userdatafilename)
            Dim filetext As String = ""

            filetext = SR.ReadToEnd

            Dim this_dataname As String = ""
            Dim this_datavalue As String = ""
            Dim this_dataindex As Integer

            While (filetext.IndexOf("]") >= 0)
                Try 'catches bad substring calls resulting from '[' and ']' being in wrong order
                    this_dataname = filetext.Substring(filetext.IndexOf("[") + 1, filetext.IndexOf("]") - filetext.IndexOf("[") - 1).Trim()
                    If (this_dataname.Substring(0, 5).ToLower <> "start") Then
                        filetext = filetext.Substring(filetext.IndexOf("]") + 1)
                        Continue While
                    End If

                    this_dataname = this_dataname.Substring(5).Trim


                    filetext = filetext.Substring(filetext.IndexOf("]") + 1)

                    Dim endtag As String = "[end " + this_dataname + "]"
                    Dim endtagindex As Integer = filetext.IndexOf(endtag)
                    'MsgBox(filetext + endtag)
                    'MsgBox(endtagindex)
                    this_datavalue = filetext.Substring(0, endtagindex)
                    filetext = filetext.Substring(filetext.IndexOf("[end " + this_dataname + "]") + 1)

                    '    Enum userdataindex
                    '       Name
                    '  End Enum


                    If (this_dataname = "Name") Then
                        this_dataindex = userdataindex.name

                    ElseIf (this_dataname = "DataFileExtentions") Then
                        this_dataindex = userdataindex.dataFileExtentions


                    ElseIf (this_dataname = "TrickFileExtentions") Then
                        this_dataindex = userdataindex.trickFileExtentions


                    ElseIf (this_dataname = "OpenFilePath") Then
                        this_dataindex = userdataindex.OpenFilePath
                        If Not (IO.Directory.Exists(this_datavalue)) Then
                            'Dim message As String = "The directory stored for " + this_datavalue + " in user data file does not exist!" + Constants.vbCrLf
                            'message += "The default value will be used"
                            'MsgBox(message)
                            Continue While
                        End If
                        'MsgBox(this_dataname + Constants.vbCrLf + this_datavalue)
                    ElseIf (this_dataname = "SaveFilePath") Then
                        this_dataindex = userdataindex.SaveFilePath
                        'MsgBox(this_dataname + Constants.vbCrLf + this_datavalue)
                        If Not (IO.Directory.Exists(this_datavalue)) Then
                            'Dim message As String = "The directory stored for " + this_datavalue + " in user data file does not exist!" + Constants.vbCrLf
                            'message += "The default value will be used"
                            'MsgBox(message)
                            Continue While
                        End If

                    ElseIf (this_dataname = "OpenTrickPath") Then
                        this_dataindex = userdataindex.OpenTrickPath
                        If Not (IO.Directory.Exists(this_datavalue)) Then
                            'Dim message As String = "The directory stored for " + this_datavalue + " in user data file does not exist!" + Constants.vbCrLf
                            'message += "The default value will be used"
                            'MsgBox(message)
                            Continue While
                        End If
                        'MsgBox(this_dataname + Constants.vbCrLf + this_datavalue)
                    ElseIf (this_dataname = "SaveTrickPath") Then
                        this_dataindex = userdataindex.SaveTrickPath
                        'MsgBox(this_dataname + Constants.vbCrLf + this_datavalue)
                        If Not (IO.Directory.Exists(this_datavalue)) Then
                            '//Dim message As String = "The directory stored for " + this_datavalue + " in user data file does not exist!" + Constants.vbCrLf
                            '//message += "The default value will be used"
                            '//MsgBox(message)
                            Continue While
                        End If


                    ElseIf (this_dataname = "displayPatternPath") Then
                        this_dataindex = userdataindex.displayPatternPath
                        'MsgBox(this_dataname + Constants.vbCrLf + this_datavalue)
                        If Not (IO.Directory.Exists(this_datavalue)) Then
                            '//Dim message As String = "The directory stored for " + this_datavalue + " in user data file does not exist!" + Constants.vbCrLf
                            '//message += "The default value will be used"
                            '//MsgBox(message)
                            Continue While
                        End If

                    ElseIf (this_dataname = "PictureUpLoadPath") Then
                        this_dataindex = userdataindex.PictureUpLoadPath
                        'MsgBox(this_dataname + Constants.vbCrLf + this_datavalue)
                        If Not (IO.Directory.Exists(this_datavalue)) Then
                            '//Dim message As String = "The directory stored for " + this_datavalue + " in user data file does not exist!" + Constants.vbCrLf
                            '//message += "The default value will be used"
                            '//MsgBox(message)
                            Continue While
                        End If

                    ElseIf (this_dataname = "ColorPatternPath") Then
                        this_dataindex = userdataindex.ColorPatternPath
                        'MsgBox(this_dataname + Constants.vbCrLf + this_datavalue)
                        If Not (IO.Directory.Exists(this_datavalue)) Then
                            'if the path does not exist,  leave the old value (should be default path)
                            Continue While
                        End If


                    ElseIf (this_dataname = "defaultfile") Then

                        this_dataindex = userdataindex.defaultfile

                        If Not (IO.File.Exists(this_datavalue)) Then
                            'leave the default value in place
                            Continue While
                        End If

                    Else


                        Continue While
                    End If
                    userdata(this_dataindex) = this_datavalue


                Catch ex As Exception
                    filetext = filetext.Substring(filetext.IndexOf("]") + 1)
                    Continue While
                End Try

            End While

            SR.Close()
            If (Not setdatafilefilter(userdata(userdataindex.dataFileExtentions))) Then

                Dim message As String = "Trick file extension list in userdata file is corrupt" + Constants.vbCrLf
                message += "Defaut extensions have been set" + Constants.vbCrLf
                message += "Extensions may be modified by going into settings" + Constants.vbCrLf

                MsgBox(message)
                userdata(userdataindex.dataFileExtentions) = DEFAULT_DATA_FILE_EXTENTIONS

            End If
            If (Not settrickfilefilter(userdata(userdataindex.trickFileExtentions), userdata(userdataindex.dataFileExtentions))) Then

                Dim message As String = "Trick file extension list in userdata file is corrupt" + Constants.vbCrLf
                message += "Defaut extensions have been set" + Constants.vbCrLf
                message += "Extensions may be modified by going into settings" + Constants.vbCrLf

                MsgBox(message)
                userdata(userdataindex.trickFileExtentions) = DEFAULT_TRICK_FILE_EXTENTIONS

            End If

        End If
    End Sub
    Private Sub readsettingfile()

        'the TRUe or FALS option is depricated since setting were modified to accept mulitple options
        'but are still read supported for backwards compatability
        'putting anything after integer does not work

        'format of settingfile is 
        '[settingname]TRUE notes
        'or
        '[settingname]FALS notes
        '0r
        '[settingname]integer 

        'notes are optional and ignored
        'FALSE may be uesd in place of FALS just as 
        'TRUESDSF may be used in place of TRUE
        'integer may be any base 10 number and must be terminated with a space 
        'lines that are not in this format will be ignored
        'and may be used to make aditional notes 
        'notes are for bennifit of people (users or future programmers)
        'who may view the settings file


        set_default_settings() 'default set first so that any setting that is 
        'missing from settings file will be default
        'or if file is missing all will be default



        Dim filefound As Boolean = False
        Dim SR As IO.StreamReader '= IO.File.OpenText("settings.text")
        Dim loopcounter As Int16 = -1
        While loopcounter < oldsettingsfilenames.Length

            If loopcounter = -1 Then

                If IO.File.Exists(settingsfilename) Then
                    'this has to be imbedded. 
                    'if not the compound condition fails and the next else if throws eeception with array index -1
                    SR = IO.File.OpenText(settingsfilename)

                    filefound = True
                    Exit While
                End If


            ElseIf IO.File.Exists(oldsettingsfilenames(loopcounter)) Then

                'use a settings file from an older version of tiniwindow if found
                'at close time the setting will be stored in a new setting file for this version of tiniwindow
                SR = IO.File.OpenText(oldsettingsfilenames(loopcounter))

                filefound = True
                Exit While


            End If

            loopcounter += 1

        End While

        If Not filefound Then
            Return

            'default values will be used
        End If



        Dim line As String = ""

        While (readline(SR, line))
            Dim this_settingname As String = ""
            Dim this_settingvalue As Integer
            Dim this_settingindex As Integer
            Try 'catches bad substring calls resulting from '[' and ']' being in wrong order
                this_settingname = line.Substring(line.IndexOf("[") + 1, line.IndexOf("]") - line.IndexOf("[") - 1)
                'MsgBox(this_settingname)
                If (this_settingname = "") Then
                    Continue While
                End If
                line = line.Substring(line.IndexOf("]") + 1).Trim()
                'MsgBox(line.Substring(0, 1))
                If (line.Substring(0, 1) = "-" Or (line.Substring(0, 1) >= "0" And line.Substring(0, 1) <= "9")) Then
                    line = line.Trim
                    'MsgBox("[" + line + "]")
                    this_settingvalue = Convert.ToInt32(line, 10)
                    'MsgBox(this_settingvalue)
                Else
                    line = line.Substring(0, 4).ToUpper
                    If (line = "TRUE") Then
                        this_settingvalue = True
                    ElseIf (line = "FALS") Then
                        this_settingvalue = False
                    Else
                        Continue While
                    End If
                End If
                'MsgBox(line)



                'Enum settingsindex
                'keepuserdata()
                'sendtodeviceastype()
                'askforname()
                'End Enum
                If (this_settingname = "keepuserdata") Then
                    this_settingindex = settingsindex.keepuserdata
                    'ElseIf (this_settingname = "sendtodeviceastype") Then
                    '   this_settingindex = settingsindex.sendtodeviceastype
                ElseIf (this_settingname = "askforname") Then
                    this_settingindex = settingsindex.askforname
                ElseIf (this_settingname = "showwelcomeform") Then
                    this_settingindex = settingsindex.showwelcomeform

                ElseIf (this_settingname = "opentrickfileaction") Then
                    this_settingindex = settingsindex.opentrickfileaction

                ElseIf (this_settingname = "openfilewithtoomanycharsaction") Then
                    this_settingindex = settingsindex.openfilewithtoomanycharsaction


                ElseIf (this_settingname = "showbeginnershelp") Then
                    this_settingindex = settingsindex.showbeginnershelp
                ElseIf (this_settingname = "linelength") Then
                    this_settingindex = settingsindex.linelength
                Else

                    Continue While
                End If
                settings(this_settingindex) = this_settingvalue



            Catch ex As Exception
                Continue While
            End Try



        End While

        SR.Close()

    End Sub



    Private Sub cancel_read_or_write()
        progresform_cancel = False
        If (BGW_read_device.IsBusy Or BGW_write_device.IsBusy) Then

            'for now Im being lazy using AppDomainUnloadedException instead of defining a cancel exception
            Throw New AppDomainUnloadedException

        Else
            Dim message As String = "the function for canceling getting or sending data to the controll devive" + Constants.vbCrLf
            message += "but no get or send operation is currently in progress" + Constants.vbCrLf
            message += "If this recurs please report the problem to us using the menue item found under tools"
            Dim restorevalue = databeinginternallymanipulated
            databeinginternallymanipulated = False 'prevent tripping watchdog timmer
            MsgBox(message)
            databeinginternallymanipulated = restorevalue

        End If




    End Sub

    Private Function addressValid(ByVal address As String) As Boolean
        If (address.Length <> 7) Then
            Return False
        End If
        If (address.Substring(0, 1) <> "A") Then
            Return False
        End If
        If (address.Substring(1, 1) <> " ") Then
            Return False
        End If

        If (address.Substring(2, 1) < "0" Or address.Substring(2, 1) > "9") Then
            Return False
        End If

        If (address.Substring(3, 1) < "0" Or address.Substring(2, 1) > "9") Then
            Return False
        End If

        If (address.Substring(4, 1) < "0" Or address.Substring(2, 1) > "9") Then
            Return False
        End If

        If (address.Substring(5, 1) <> Constants.vbCr) Then
            Return False
        End If
        If (address.Substring(6, 1) <> Constants.vbLf) Then
            Return False
        End If

        Return True
    End Function

    Private Function textValid(ByVal text As String) As Boolean
        If (text.Length > 20) Then
            Return False
        End If
        Dim i As Integer = 0
        While (i < 20)
            'test if printable character
            i = i + 1
        End While
        Return True

    End Function
    Private Function convertCharacterToWriteComand(ByVal character As Char) As String
        'this functions converts a single character to a command for writing it to the EEprom
        'It is nesseary to set the address pointer before sending the command generated by this function
        Dim hexvalue As String = Hex(Asc(character))
        If (hexvalue.Length = 1) Then
            hexvalue = "0" + hexvalue
        End If
        Dim commandstring As String = "W " + hexvalue + Constants.vbCrLf
        Return commandstring
    End Function
    Public Function sendcommand(ByVal command As String) As Boolean
        Dim cont As Boolean = True
        Dim attemps As Integer = 0
        While (attemps < 3)
            backgroundworkerdebugvalue = (attemps + 400).ToString + "a"
            With mySerialPort
                Try
                    backgroundworkerdebugvalue = (attemps + 410).ToString
                    'If (.IsOpen) Then
                    '.ReadExisting()
                    backgroundworkerdebugvalue = (attemps + 410).ToString + "b" + .WriteTimeout.ToString
                    '.Close()
                    backgroundworkerdebugvalue = (attemps + 410).ToString + "c" + .WriteTimeout.ToString
                    '.Open()
                    backgroundworkerdebugvalue = (attemps + 410).ToString + "d" + .WriteTimeout.ToString
                    .Write(command)

                    backgroundworkerdebugvalue = (attemps + 420).ToString
                    Return True
                    '    'Else

                    '    'Try
                    '    backgroundworkerdebugvalue = (attemps + 420).ToString + "a"
                    '    .Close()
                    '    backgroundworkerdebugvalue = (attemps + 420).ToString + "b"
                    'Catch ex2 As Exception
                    '    backgroundworkerdebugvalue = (attemps + 420).ToString + "c"
                    'End Try
                    'Try
                    '    backgroundworkerdebugvalue = (attemps + 420).ToString + "d"
                    '    .Open()
                    '    backgroundworkerdebugvalue = (attemps + 420).ToString + "e"
                    'Catch ex2 As Exception
                    '    backgroundworkerdebugvalue = (attemps + 420).ToString + "f"
                    'End Try

                    'backgroundworkerdebugvalue = (attemps + 420).ToString + "g"




                    '    End If


                Catch ex As Exception
                    backgroundworkerdebugvalue = (attemps + 430).ToString
                    deviceandmemorymatch = False
                    Try
                        backgroundworkerdebugvalue = (attemps + 440).ToString
                        .Close()
                        backgroundworkerdebugvalue = (attemps + 450).ToString
                    Catch ex2 As Exception
                        backgroundworkerdebugvalue = (attemps + 460).ToString
                    End Try
                    Try
                        backgroundworkerdebugvalue = (attemps + 470).ToString
                        .Open()
                        backgroundworkerdebugvalue = (attemps + 480).ToString
                    Catch ex2 As Exception
                        backgroundworkerdebugvalue = (attemps + 490).ToString
                    End Try
                    backgroundworkerdebugvalue = (attemps + 400).ToString + "a"
                End Try


            End With
            backgroundworkerdebugvalue = (attemps + 400).ToString + "b"
            attemps += 1
        End While
        backgroundworkerdebugvalue = (attemps + 400).ToString + "c"
        echoerror = 7
        Return False
    End Function


    Private Function readline(ByRef stringtoreadto As String) As Integer
        '  !!!
        'this function reads one line from the serial port. a line ends with <cr><lf>
        'returns true is complete line read false if times out or too many characters
        'Dim echoerror As Integer = 0 '0-no error 1-time out 2-string too long 3-unexpected string 
        'myserialport must be open before calling this function
        backgroundworkerdebugvalue = "50A"
        Dim starttime As Double = DateAndTime.Timer() 'returns seconds since midnight
        stringtoreadto = ""
        Dim timesthrouloop As Integer = 0
        While (True)
            backgroundworkerdebugvalue = (500 + timesthrouloop).ToString + "a"
            echoerror = 0
            If (progresform_cancel) Then
                backgroundworkerdebugvalue = (500 + timesthrouloop).ToString + "b"
                cancel_read_or_write() 'confirms cancle and throws argument exception
            End If

            backgroundworkerdebugvalue = (500 + timesthrouloop).ToString + "c"
            'If (DateAndTime.Timer() - starttime > 3 Or DateAndTime.Timer() - starttime < -86397) Then
            '    echoerror = 1
            '    backgroundworkerdebugvalue = (500 + timesthrouloop).ToString + "d"
            '    Return False
            'End If
            backgroundworkerdebugvalue = (500 + timesthrouloop).ToString + "e"
            Dim characterread As String
            Try
                backgroundworkerdebugvalue = (500 + timesthrouloop).ToString + "f"
                characterread = mySerialPort.ReadExisting()
                backgroundworkerdebugvalue = (500 + timesthrouloop).ToString + "g"
            Catch ex As UnauthorizedAccessException
                backgroundworkerdebugvalue = (500 + timesthrouloop).ToString + "h"
                deviceandmemorymatch = False
                Dim loopcounter As Integer = 0
                Dim ok As Boolean = False
                While (loopcounter < 3)
                    Try
                        backgroundworkerdebugvalue = (500 + timesthrouloop).ToString + "i" + loopcounter.ToString
                        mySerialPort.Close()
                        backgroundworkerdebugvalue = (500 + timesthrouloop).ToString + "j" + loopcounter.ToString
                        mySerialPort.Open()
                        backgroundworkerdebugvalue = (500 + timesthrouloop).ToString + "k" + loopcounter.ToString
                        characterread = mySerialPort.ReadExisting()
                        backgroundworkerdebugvalue = (500 + timesthrouloop).ToString + "l" + loopcounter.ToString

                    Catch ex2 As UnauthorizedAccessException
                        backgroundworkerdebugvalue = (500 + timesthrouloop).ToString + "m" + loopcounter.ToString
                        loopcounter += 1
                        Continue While
                    Catch ex3 As System.IO.IOException
                        backgroundworkerdebugvalue = (500 + timesthrouloop).ToString + "n" + loopcounter.ToString
                        loopcounter += 1
                        Continue While
                    End Try
                    backgroundworkerdebugvalue = (500 + timesthrouloop).ToString + "o" + loopcounter.ToString
                    ok = True
                    loopcounter = 5
                End While
                backgroundworkerdebugvalue = (500 + timesthrouloop).ToString + "p"
                If (Not ok) Then
                    backgroundworkerdebugvalue = (500 + timesthrouloop).ToString + "q"
                    echoerror = 7
                    Return False
                End If

                '''''''
            Catch ex_2 As System.IO.IOException
                backgroundworkerdebugvalue = (500 + timesthrouloop).ToString + "r"
                deviceandmemorymatch = False
                Dim loopcounter As Integer = 0
                Dim ok As Boolean = False
                While (loopcounter < 3)
                    backgroundworkerdebugvalue = (500 + timesthrouloop).ToString + "s" + loopcounter.ToString
                    Try
                        mySerialPort.Close()
                        backgroundworkerdebugvalue = (500 + timesthrouloop).ToString + "t" + loopcounter.ToString
                        mySerialPort.Open()
                        backgroundworkerdebugvalue = (500 + timesthrouloop).ToString + "v" + loopcounter.ToString
                        characterread = mySerialPort.ReadExisting()
                        backgroundworkerdebugvalue = (500 + timesthrouloop).ToString + "w" + loopcounter.ToString
                    Catch ex2 As UnauthorizedAccessException
                        backgroundworkerdebugvalue = (500 + timesthrouloop).ToString + "x" + loopcounter.ToString
                        loopcounter += 1
                        Continue While
                    Catch ex3 As System.IO.IOException
                        backgroundworkerdebugvalue = (500 + timesthrouloop).ToString + "y" + loopcounter.ToString
                        loopcounter += 1
                        Continue While
                    End Try
                    backgroundworkerdebugvalue = (500 + timesthrouloop).ToString + "z" + loopcounter.ToString
                    ok = True
                    loopcounter = 5
                End While
                backgroundworkerdebugvalue = (500 + timesthrouloop).ToString + "A"

                If (Not ok) Then
                    backgroundworkerdebugvalue = (500 + timesthrouloop).ToString + "B"
                    echoerror = 7
                    Return False
                End If



            End Try

            backgroundworkerdebugvalue = (500 + timesthrouloop).ToString + "C"

            If (characterread <> "") Then
                backgroundworkerdebugvalue = (500 + timesthrouloop).ToString + "D"
                starttime = DateAndTime.Timer()
            End If
            stringtoreadto = stringtoreadto + characterread
            If (stringtoreadto.Length() > MAXIMUMECHOLENGTH) Then
                backgroundworkerdebugvalue = (500 + timesthrouloop).ToString + "E"
                echoerror = 2
                Return False

            End If
            backgroundworkerdebugvalue = (500 + timesthrouloop).ToString + "F"

            If (stringtoreadto.Length() >= 2) Then
                backgroundworkerdebugvalue = (500 + timesthrouloop).ToString + "G"
                If (stringtoreadto.Substring(stringtoreadto.Length - 2, 2) = Constants.vbCrLf) Then
                    backgroundworkerdebugvalue = (500 + timesthrouloop).ToString + "H"
                    Return True
                End If
            End If
            backgroundworkerdebugvalue = (500 + timesthrouloop).ToString + "I"
        End While
        'Dim commandstring As String = "W " + Hex(AscW(character)) + Constants.vbCrLf
        'Return commandstring


        Dim restorevalue As Boolean = databeinginternallymanipulated
        databeinginternallymanipulated = False
        MsgBox("bugg")
        databeinginternallymanipulated = restorevalue




        '''''''''''''''''''''''''''''''''''''''
        '  !!!
        'this function reads one line from the serial port. a line ends with <cr><lf>
        'returns true is complete line read false if times out or too many characters
        'Dim echoerror As Integer = 0 '0-no error 1-time out 2-string too long 3-unexpected string 
        'myserialport must be open before calling this function
        ' Dim starttime As Double = DateAndTime.Timer() 'returns seconds since midnight
        stringtoreadto = ""
        While (True)

            If (progresform_cancel) Then
                cancel_read_or_write() 'confirms cancle and throws argument exception
            End If


            If (DateAndTime.Timer() - starttime > 2 Or DateAndTime.Timer() - starttime < -86398) Then
                echoerror = 1
                Return False
            End If
            Dim characterread As String = mySerialPort.ReadExisting()
            If (characterread <> "") Then
                starttime = DateAndTime.Timer()
            End If
            stringtoreadto = stringtoreadto + characterread
            If (stringtoreadto.Length() > MAXIMUMECHOLENGTH) Then
                echoerror = 2
                Return False

            End If


            If (stringtoreadto.Length() >= 2) Then
                If (stringtoreadto.Substring(stringtoreadto.Length - 2, 2) = Constants.vbCrLf) Then
                    Return True
                End If
            End If
        End While
        'Dim commandstring As String = "W " + Hex(AscW(character)) + Constants.vbCrLf
        'Return commandstring

    End Function
    Private Function checkecho(ByVal expectedecho As String) As Integer
        'true if string passed by device matches expected echo. false otherwise
        'Dim echoerror As Integer = 0 '0-no error 1-time out 2-line not terminated 3-unexpected echo 4-error echo 
        'myserialport must be open before calling this function
        Dim starttime As Double = DateAndTime.Timer() 'returns seconds since midnight
        Dim echostring As String = ""
        If (Not readline(echostring)) Then
            Return False
        End If
        If (expectedecho = echostring) Then
            Return True
        ElseIf (echostring = Constants.vbCrLf) Then
            echoerror = 4
            Return False
        Else
            echoerror = 3
            Return False

        End If

    End Function
    Private Function validwriteresponse(ByVal line As String) As Boolean
        If (line.Length() <> WRITERESPONSELENGTH) Then
            Return False
        End If
        If (line.Substring(0, 2) <> "W ") Then
            Return False
        End If

        'W xx<crlf>
        If (Not ((line.Substring(2, 1) >= "0" And line.Substring(2, 1) <= "9") Or (line.Substring(2, 1) >= "A" And line.Substring(2, 1) <= "F"))) Then
            Return False
        End If
        If (Not ((line.Substring(3, 1) >= "0" And line.Substring(3, 1) <= "9") Or (line.Substring(3, 1) >= "A" And line.Substring(3, 1) <= "F"))) Then
            Return False
        End If
        Return True
    End Function
    Private Function addresstostring(ByVal address As Integer) As String
        'converts the integer address to a string address that must be 3 digits long
        Dim returnstring As String = address
        While (returnstring.Length() < 3)
            returnstring = "0" + returnstring
        End While
        Return returnstring

    End Function

    Private Function writeToDevice(ByVal startaddress As Integer, ByVal text As String) As Boolean
        'this function write a string to the EEprom     
        backgroundworkerdebugvalue = "290"
        Dim i As Integer = 0
        Try
            backgroundworkerdebugvalue = "291"
            Dim responseline As String = ""

            While (i < settings(settingsindex.linelength))
                backgroundworkerdebugvalue = (i + 201).ToString

                If (i < text.Length()) Then
                    backgroundworkerdebugvalue = (i + 202).ToString
                    If (Not writecharactertodevice(text.Substring(i, 1), startaddress + i)) Then
                        backgroundworkerdebugvalue = (i + 203).ToString
                        Return False
                    End If
                    backgroundworkerdebugvalue = (i + 204).ToString
                Else
                    backgroundworkerdebugvalue = (i + 205).ToString
                    If (Not writecharactertodevice(" ", startaddress + i)) Then
                        backgroundworkerdebugvalue = (i + 206).ToString
                        Return False
                    End If
                    backgroundworkerdebugvalue = (i + 207).ToString
                End If
                backgroundworkerdebugvalue = (i + 208).ToString
                i = i + 1

            End While
            backgroundworkerdebugvalue = "292"
            Return True
        Catch ex As System.ObjectDisposedException
            backgroundworkerdebugvalue = (i + 209).ToString
            echoerror = 7
            Return False
        End Try
        backgroundworkerdebugvalue = "293"

    End Function

    Private Function splitversionresponses(ByVal line As String) As ArrayList

        'a valid version response starts with V and is so may characters long with a specific format
        Dim strarr As String() = line.Split("V")
        Dim returnvalue As ArrayList = New ArrayList

        For Each response As String In strarr
            If validversionresponse("V" & response) Then
                returnvalue.Add("V" & response)

            Else
                If validversionresponse("V" & response.Substring(0, VERSIONRESPONSELENGTH - 1)) Then
                    returnvalue.Add("V" & response)

                    ''for now assume this is only one invalid response
                    ''in reality there could be multiple invalid and it is difficult to seperate
                    returnvalue.Add(response.Substring(VERSIONRESPONSELENGTH - 1))

                End If
            End If

        Next


        Return returnvalue





    End Function

    Private Function validversionresponse(ByVal line As String) As Boolean
        If (line.Length() <> VERSIONRESPONSELENGTH) Then
            Return False
        End If




        If (line.Substring(0, 2) <> "V ") Then
            Return False
        End If


        If (Not ((line.Substring(2, 1) >= "0" And line.Substring(2, 1) <= "9") Or (line.Substring(2, 1) > "A" And line.Substring(2, 1) < "F"))) Then
            Return False
        End If
        If (Not ((line.Substring(3, 1) >= "0" And line.Substring(3, 1) <= "9") Or (line.Substring(3, 1) > "A" And line.Substring(3, 1) < "F"))) Then
            Return False
        End If
        If (Not ((line.Substring(4, 1) >= "0" And line.Substring(2, 1) <= "9") Or (line.Substring(2, 1) > "A" And line.Substring(2, 1) < "F"))) Then
            Return False
        End If
        If (Not ((line.Substring(5, 1) >= "0" And line.Substring(3, 1) <= "9") Or (line.Substring(3, 1) > "A" And line.Substring(3, 1) < "F"))) Then
            Return False
        End If

        line = line.Substring(VERSIONRESPONSELENGTH)


        Return True
    End Function

    Private Function validreadresponse(ByVal line As String) As Boolean
        If (line.Length() <> READRESPONSELENGTH) Then
            Return False
        End If
        If (line.Substring(0, 2) <> "R ") Then
            Return False
        End If


        If (Not ((line.Substring(2, 1) >= "0" And line.Substring(2, 1) <= "9") Or (line.Substring(2, 1) >= "A" And line.Substring(2, 1) <= "F"))) Then
            Return False
        End If
        If (Not ((line.Substring(3, 1) >= "0" And line.Substring(3, 1) <= "9") Or (line.Substring(3, 1) >= "A" And line.Substring(3, 1) <= "F"))) Then
            Return False
        End If
        Return True
    End Function
    Private Function writeparametertodevice(ByRef value As Integer, ByVal address As Integer) As Boolean
        'MsgBox("write parameter " + value.ToString)

        If (value > 255) Then
            Dim retorevalue As Boolean = databeinginternallymanipulated
            databeinginternallymanipulated = False 'prevent tripping watchdog timmer
            MsgBox("parameter value greater then 255 passed to writeparametertodevice")
            databeinginternallymanipulated = retorevalue
            Return False
        End If
        'MsgBox(value.ToString + "   " + address.ToString)
        'MsgBox(address.ToString + "," + Chr(value) + "," + value.ToString)
        Return writecharactertodevice(Chr(value), address)


        Return True

    End Function
    Private Function writecharactertodevice(ByRef character As Char, ByVal address As Integer) As Boolean
        'writes a single charater to the device 

        '0-no error 1-time out 2-line not terminated 3-unexpected line 4-error echo 5-wrong address echoed back 6-wrong character echoed back
        backgroundworkerdebugvalue = "304"
        Dim line As String = ""
        Dim addressasstring As String = addresstostring(address)
        backgroundworkerdebugvalue = "305"
        Dim myaddresscommand As String = "A " + addresstostring(address) + Constants.vbCrLf
        backgroundworkerdebugvalue = "306"
        Dim mywritecommand As String = "W "
        mywritecommand = convertCharacterToWriteComand(character)
        Dim attemps As Integer = 0
        With mySerialPort
            backgroundworkerdebugvalue = "307"
            While (True)
                backgroundworkerdebugvalue = (attemps + 310).ToString
                'If (progresform_cancle) Then
                'cancle_read_or_write() 'confirms cancle and throws argument exception
                'End If

                If (Not sendcommand(myaddresscommand)) Then
                    echoerror = 7
                    backgroundworkerdebugvalue = (attemps + 320).ToString
                    Return False
                End If


                'between these comments is temporary code inserted to bypass checking echo

                pause(TIME_TOPROCESS_ADDRESSCOMMAND)


                If (Not sendcommand(mywritecommand)) Then
                    backgroundworkerdebugvalue = (attemps + 300).ToString + "c"
                    echoerror = 7
                    Return False
                End If
                pause(TIME_TOPROCESS_WRITECOMMAND)


                Return True
                'between these comments is temporary code inserted to bypass checking echo





                backgroundworkerdebugvalue = (attemps + 330).ToString

                If (Not readline(line)) Then

                    If (attemps < 3) Then
                        backgroundworkerdebugvalue = (attemps + 340).ToString
                        attemps = attemps + 1
                    Else
                        backgroundworkerdebugvalue = (attemps + 350).ToString
                        Return False
                    End If
                ElseIf (line <> myaddresscommand) Then
                    backgroundworkerdebugvalue = (attemps + 360).ToString
                    If (addressValid(line) And attemps < 3) Then

                        backgroundworkerdebugvalue = (attemps + 370).ToString
                        attemps = attemps + 1

                    Else

                        If (line = Constants.vbCrLf) Then

                            If (attemps < 3) Then
                                backgroundworkerdebugvalue = (attemps + 380).ToString
                                attemps = attemps + 1
                            Else
                                backgroundworkerdebugvalue = (attemps + 390).ToString
                                echoerror = 4

                                Return False
                            End If
                        Else

                            If (attemps < 3) Then
                                backgroundworkerdebugvalue = (attemps + 380).ToString
                                attemps = attemps + 1
                            Else
                                backgroundworkerdebugvalue = (attemps + 300).ToString + "a"
                                echoerror = 5

                                Return False
                            End If

                        End If

                    End If

                Else
                    backgroundworkerdebugvalue = (attemps + 300).ToString + "b"
                    If (Not sendcommand(mywritecommand)) Then
                        backgroundworkerdebugvalue = (attemps + 300).ToString + "c"
                        echoerror = 7
                        Return False
                    End If

                    If (Not readline(line)) Then

                        If (attemps < 3) Then
                            backgroundworkerdebugvalue = (attemps + 300).ToString + "d"
                            attemps = attemps + 1
                        Else
                            backgroundworkerdebugvalue = (attemps + 300).ToString + "e"
                            Return False
                        End If
                    ElseIf (Not validwriteresponse(line)) Then
                        backgroundworkerdebugvalue = (attemps + 300).ToString + "f"
                        If (line = Constants.vbCrLf And attemps < 3) Then
                            If (attemps < 3) Then
                                backgroundworkerdebugvalue = (attemps + 300).ToString + "g"
                                attemps = attemps + 1
                            Else
                                backgroundworkerdebugvalue = (attemps + 300).ToString + "h"
                                echoerror = 4
                                Return False
                            End If

                        Else
                            backgroundworkerdebugvalue = (attemps + 300).ToString + "i"
                            'MsgBox("[" + line + "]")
                            echoerror = 3

                            Return False
                        End If
                    ElseIf (line <> mywritecommand) Then
                        backgroundworkerdebugvalue = (attemps + 300).ToString + "j"
                        'MsgBox("[" + line + "]" + "[" + mywritecommand + "]")
                        echoerror = 5

                        Return False
                    Else

                        backgroundworkerdebugvalue = (attemps + 300).ToString + "k"
                        'MsgBox("exit function")
                        Return True
                    End If

                End If
                'MsgBox(attemps)


            End While
            backgroundworkerdebugvalue = "308"
        End With   'With- End With is way to simplify the function as show below
        backgroundworkerdebugvalue = "309"
    End Function
    '''
    Public Function getversion(ByRef major_version As ArrayList, ByRef minor_version As ArrayList) As Integer


        Dim line As String = ""
        'Dim addressasstring As String = addresstostring(address)
        ' Dim myaddresscommand As String = "A " + addresstostring(address) + Constants.vbCrLf
        Dim attemps As Integer = 0
        With mySerialPort


            Try
                If (Not .IsOpen) Then
                    deviceandmemorymatch = False
                    .Open()
                End If

            Catch ex As Exception
                echoerror = 7
                Return False
            End Try

            While (True)

                If (Not sendcommand(VERSIONCOMMAND)) Then
                    echoerror = 7
                    Return False
                End If



                If (Not readline(line)) Then
                    If (echoerror = 1 And attemps < 3) Then
                        attemps = attemps + 1

                    Else
                        .Close()
                        Return False
                    End If



                    'ElseIf (Not validversionresponse(line)) Then
                    '    If (attemps < 3) Then
                    '        attemps = attemps + 1

                    '    Else
                    '        echoerror = 3
                    '        .Close()
                    '        Return False
                    '    End If




                Else
                    Dim splitline As ArrayList = splitversionresponses(line)


                    major_version.Clear()
                    minor_version.Clear()


                    For Each response As String In splitline
                        If validversionresponse(line) Then
                            major_version.Add(Convert.ToInt32(line.Substring(2, 2), 16))
                            minor_version.Add(Convert.ToInt32(line.Substring(4, 2), 16))
                        Else

                            major_version.Add(-1)
                            minor_version.Add(-1)

                        End If

                    Next

                    While line.Length <> 0
                        line = line.Substring(VERSIONRESPONSELENGTH)
                    End While

                    Return True

                End If

            End While

        End With

    End Function
    '''''''''

    Private Function readparameterfromdevice(ByRef parameter As Int16, ByVal address As Integer) As Boolean
        Dim line As String = ""
        Dim addressasstring As String = addresstostring(address)
        Dim myaddresscommand As String = "A " + addresstostring(address) + Constants.vbCrLf
        Dim attemps As Integer = 0
        With mySerialPort

            While (True)
                'If (progresform_cancle) Then
                'cancle_read_or_write() 'confirms cancle and throws argument exception
                'End If
                If (Not sendcommand(myaddresscommand)) Then
                    echoerror = 7
                    Return False
                End If


                If (Not readline(line)) Then
                    If (attemps < 3) Then
                        attemps = attemps + 1

                    Else

                        Return False
                    End If
                ElseIf (line <> myaddresscommand) Then
                    If (addressValid(line) And attemps < 3) Then
                        attemps = attemps + 1
                    Else
                        If (line = Constants.vbCrLf) Then
                            If (attemps < 3) Then
                                attemps = attemps + 1
                            Else
                                echoerror = 4

                                Return False



                            End If
                        Else
                            echoerror = 5

                            Return False

                        End If

                    End If
                Else
                    If (Not sendcommand(READCOMMAND)) Then
                        echoerror = 7
                        Return False
                    End If

                    If (Not readline(line)) Then
                        If (attemps < 3) Then
                            attemps = attemps + 1
                        Else

                            Return False
                        End If
                    ElseIf (Not validreadresponse(line)) Then
                        If (line = Constants.vbCrLf And attemps < 3) Then
                            If (attemps < 3) Then
                                attemps = attemps + 1
                            Else
                                echoerror = 4

                                Return False
                            End If

                        Else
                            echoerror = 3

                            Return False
                        End If

                    Else
                        parameter = Convert.ToInt32(line.Substring(2, 2), 16)
                        'MsgBox(address.ToString + "," + line + "," + parameter.ToString)
                        Return True
                    End If

                End If


            End While

        End With





        '''''''''''''''''
        'Dim tempchar As Char

        'If (Not readcharacterfromdevice(tempchar, address)) Then
        '    Return False
        'End If

        'If (tempchar = Constants.vbNullChar Or tempchar = Constants.vbNullString) Then
        '    MsgBox("null")
        'End If
        'If (tempchar = "") Then
        '    MsgBox("empty")
        'End If
        'parameter = Asc(tempchar)

        ''MsgBox(address.ToString + "," + tempchar + "," + parameter.ToString)
        'Return True
    End Function


    Private Function readcharacterfromdevice(ByRef text As String, ByVal address As Integer) As Boolean

        'this function reads a character from the device and appends it to the end of text


        Dim line As String = ""
        Dim addressasstring As String = addresstostring(address)
        Dim myaddresscommand As String = "A " + addresstostring(address) + Constants.vbCrLf
        Dim attemps As Integer = 0
        With mySerialPort

            While (True)
                'If (progresform_cancle) Then
                'cancle_read_or_write() 'confirms cancle and throws argument exception
                'End If
                If (Not sendcommand(myaddresscommand)) Then
                    echoerror = 7
                    Return False
                End If


                If (Not readline(line)) Then
                    If (attemps < 3) Then
                        attemps = attemps + 1

                    Else

                        Return False
                    End If
                ElseIf (line <> myaddresscommand) Then
                    'MsgBox(line + "," + attemps.ToString)
                    If (addressValid(line) And attemps < 3) Then
                        attemps = attemps + 1
                    Else
                        If (line = Constants.vbCrLf) Then
                            If (attemps < 3) Then
                                attemps = attemps + 1
                            Else
                                echoerror = 4

                                Return False



                            End If
                        Else
                            If (attemps < 3) Then
                                attemps = attemps + 1
                            Else
                                echoerror = 5

                                Return False


                            End If
                        End If

                    End If
                Else
                    If (Not sendcommand(READCOMMAND)) Then
                        echoerror = 7
                        Return False
                    End If

                    If (Not readline(line)) Then
                        If (attemps < 3) Then
                            attemps = attemps + 1
                        Else

                            Return False
                        End If
                    ElseIf (Not validreadresponse(line)) Then
                        If (line = Constants.vbCrLf And attemps < 3) Then
                            If (attemps < 3) Then
                                attemps = attemps + 1
                            Else
                                echoerror = 4

                                Return False
                            End If

                        Else
                            echoerror = 3

                            Return False
                        End If

                    Else
                        Dim intvalue As Integer = Convert.ToInt32(line.Substring(2, 2), 16)

                        Dim charvalue As Char = Chr(intvalue)
                        text += charvalue


                        Return True
                    End If

                End If


            End While

        End With
    End Function


    Private Function readLineFromDevice(ByVal startaddress As Integer, ByRef text As String) As Boolean
        'the value read from the device is loaded onto the string passed by reference
        'if operation is successfull, true is returned otherwise false is returned




        Dim i As Integer = 0
        text = ""
        While (i < settings(settingsindex.linelength))


            If (Not readcharacterfromdevice(text, startaddress + i)) Then
                Return False
            End If
            i = i + 1
        End While
        Return True

    End Function
    Private Function Attempt_reestablish_communication() As Boolean
        Dim my_reestablishform As reestablish_communication_form = New reestablish_communication_form
        my_reestablishform.ShowDialog()
        If (my_reestablishform.DialogResult = Windows.Forms.DialogResult.OK) Then
            Return True
        Else
            Return False
        End If
    End Function
    'Private Sub showtricks()
    '    InMonitorMode = False
    '    If (currenttrickcodingversion = -1) Then
    '        tricks_disabled_form.ShowDialog()
    '        If (tricks_disabled_form.DialogResult = Windows.Forms.DialogResult.OK) Then
    '            Return
    '        ElseIf (tricks_disabled_form.DialogResult = Windows.Forms.DialogResult.Yes) Then
    '            Dim result As DialogResult
    '            result = MsgBox("are you sure you want to perminently disgard the trick data currently stored in the open file", MsgBoxStyle.YesNo)
    '            If (result = Windows.Forms.DialogResult.No) Then
    '                Return
    '            ElseIf (result = Windows.Forms.DialogResult.Yes) Then
    '                currenttrickcodingversion = DEFAULTTRICKCODINGVERSION
    '                'continue sub to go into trick mode  
    '            End If

    '        End If

    '    End If
    '    footertext(0) = "You are in trick mode"
    '    Pan_tricks.Visible = True
    '    pan_maintrickoptions.Visible = True
    '    pan_maintrickoptions.Dock = DockStyle.Fill
    '    'Pan_select_trick_type.Visible = True
    '    '  TB_monitor_comm_error.Visible = False
    '    'Pan_welcome.Visible = False
    '    Pan_tb.Visible = False
    '    'Pan_active_string.Visible = False
    '    Pan_edit_and_monitor.Visible = False
    'End Sub
    Private Sub showEdit()

        'men_select_comport.Enabled = True
        'men_file.Enabled = True
        'men_monitormode.Checked = False
        'men_editmode.Checked = True
        'men_read_device.Enabled = True
        'men_write_device.Enabled = True
        'men_save.Enabled = True
        'men_saveas.Enabled = True
        'men_open.Enabled = True
        'men_new.Enabled = True



        Timer_pole_active_string.Stop()
        InMonitorMode = False

        Me.Text = labletext + " : "
        'footertext(0) = "You are in edit mode"

        If (FileName.IndexOf("\") > 0) Then
            Me.Text += FileName.Substring(FileName.LastIndexOf("\") + 1)
        Else
            Me.Text += FileName
        End If

        'Pan_tricks.Visible = False
        Pan_monitor_comm_error.Visible = False
        Pan_edit.Visible = True
        'Pan_welcome.Visible = False

        Pan_tb.Visible = True
        'Pan_active_string.Visible = False
        'Pan_monitor_active_trick.Visible = False
        Pan_tb.Enabled = True

        'monitormode = False

        If comportselected Then
            showtooltip()
        End If
        showmainhelp()

    End Sub

    Private Sub showmonitor()
        hidetooltip()
        men_monitormode.Checked = True
        men_editmode.Checked = False
        InMonitorMode = True
        men_select_comport.Enabled = False
        Me.Text = labletext + " - Monitor Mode"
        'footertext(0) = "You are in monitor mode"
        pathofopenfile = ""
        Pan_monitor_comm_error.Visible = False

        Pan_tb.Visible = True
        Pan_edit.Visible = True

        'Pan_monitor_active_trick.Enabled = True


        CB_monitor_active_trick.SelectedIndex = activetrick

        men_read_device.Enabled = False
        men_write_device.Enabled = False
        men_save.Enabled = False
        men_saveas.Enabled = True
        men_open.Enabled = True
        men_new.Enabled = False

        men_make_default.Enabled = False
        Timer_pole_active_string.Start()

    End Sub
    Public Sub hidemonitor_commerror()

        ' footertext(0) = "you are in monitor mode"


        Me.Text = labletext

        Timer_pole_active_string.Start()
        'MsgBox("there was a communication error" + Constants.vbCrLf + "monitor fuctionality is suspended")
        'Pan_monitor_active_trick.Enabled = True

        Pan_tb.Enabled = True
        Pan_monitor_comm_error.Visible = False
        'Pan_trick_parameters.Visible = True 'an old panel that was removed in 1.09.002 to reduce clutter
        Timer_pole_active_string.Start()
    End Sub
    Private Sub showmonitor_commerror()

        footertext(0) = "Monitor mode suspended due to communication error"


        Me.Text = labletext

        Timer_pole_active_string.Stop()
        'MsgBox("there was a communication error" + Constants.vbCrLf + "monitor fuctionality is suspended")
        'Pan_monitor_active_trick.Enabled = False

        Pan_tb.Enabled = False
        Pan_showclock.Visible = False
        'Pan_trick_parameters.Visible = False'an old panel that was removed in 1.09.002 to reduce clutter
        Pan_monitor_comm_error.Visible = True
    End Sub

    Public Sub showmainhelp()
        showmainhelp(True)

    End Sub
    Public Sub showmainhelp(ByVal clearfirst As Boolean)

        'this function temporarily left in when tb_beginner help removed
        'may latter be removed or modified to have text appear on chalk board
        If clearfirst Then
            'TB_beginners_help.Clear()
        End If

        If comportselected Then





            If InMonitorMode Then
                appendrichtext("You are in monitor mode" + Constants.vbCrLf, 12, FontStyle.Bold)
                appendrichtext("All changes are immediately sent to the sign" + Constants.vbCrLf + Constants.vbCrLf, 10)

            Else

                appendrichtext("You are in edit mode" + Constants.vbCrLf, 12, FontStyle.Bold)
                appendrichtext("If you want changes to be automatically sent ", 9)
                appendrichtext("to the sign as you type, change to monitor mode " + Constants.vbCrLf + Constants.vbCrLf, 9)

                appendrichtext("To send changes to sign" + Constants.vbCrLf, 12, FontStyle.Bold)
                appendrichtext("1.  Place the mouse pointer over the word 'Sign'" + Constants.vbCrLf, 9)
                appendrichtext("        at the top of TiniWindow" + Constants.vbCrLf, 9)
                appendrichtext("2.  Click and hold the mouse button down" + Constants.vbCrLf, 9)
                appendrichtext("3.  Move the mouse pointer over the words" + Constants.vbCrLf, 9)
                appendrichtext("3.      'Send data to sign'" + Constants.vbCrLf, 9)
                appendrichtext("4.  Release the mouse button" + Constants.vbCrLf + Constants.vbCrLf, 9)

                appendrichtext("To change to monitor mode" + Constants.vbCrLf, 12, FontStyle.Bold)
                appendrichtext("1.  Place the mouse pointer over the word 'Sign'" + Constants.vbCrLf, 9)
                appendrichtext("       at the top of TiniWindow" + Constants.vbCrLf, 9)
                appendrichtext("2.  Click and hold the mouse button down" + Constants.vbCrLf, 9)
                appendrichtext("3.  Move the mouse pointer over the words" + Constants.vbCrLf, 9)
                appendrichtext("        'Monitor Mode'" + Constants.vbCrLf, 9)
                appendrichtext("4.  Release the mouse button" + Constants.vbCrLf, 9)
                appendrichtext("5.  A form may pop up prompting you to send or get" + Constants.vbCrLf, 9)
                appendrichtext("        data(Data in the sign and on your computer " + Constants.vbCrLf, 9)
                appendrichtext("        must match before entering monitor mode" + Constants.vbCrLf + Constants.vbCrLf, 9)

            End If


        Else

            '    appendrichtext("No comport has been selected" + Constants.vbCrLf, 13.5, FontStyle.Bold)
            '    appendrichtext(Constants.vbCrLf + "Before you can change your sign, you must select a comport." + Constants.vbCrLf + Constants.vbCrLf, 9)
            '    appendrichtext("You can create, open, edit and save files at any time." + Constants.vbCrLf + Constants.vbCrLf, 9)

            '    appendrichtext("To Select Comport" + Constants.vbCrLf, 12, FontStyle.Bold)
            '    appendrichtext("1.  Plug the sign into the USB port" + Constants.vbCrLf, 9)
            '    appendrichtext("2.  Place the mouse pointer over the word 'Sign'" + Constants.vbCrLf, 9)
            '    appendrichtext("        at the top of TiniWindow" + Constants.vbCrLf, 9)
            '    appendrichtext("3.  Click and hold the mouse button down" + Constants.vbCrLf, 9)

            '    appendrichtext("4.  Move the mouse over the words 'select comport'" + Constants.vbCrLf, 9)
            '    'appendrichtext("        'select comport'" + Constants.vbCrLf, 9)
            '    appendrichtext("5.  Release the mouse button" + Constants.vbCrLf, 9)
            '    appendrichtext("6.  A form will pop up prompting you to select" + Constants.vbCrLf, 9)
            '    appendrichtext("        a comport" + Constants.vbCrLf, 9)
            '    appendrichtext("7.  Select a comport from the list" + Constants.vbCrLf, 9)
            '    appendrichtext("8.  Click the button labled 'open'" + Constants.vbCrLf, 9)
            '    appendrichtext("9.  Click the button labled 'continue'" + Constants.vbCrLf + Constants.vbCrLf, 9)
        End If



        If Not InMonitorMode Then
            'can not create new file
            appendrichtext("To create a new file" + Constants.vbCrLf, 12, FontStyle.Bold)
            appendrichtext("1.  Place the mouse pointer over the word 'File'" + Constants.vbCrLf, 9)
            appendrichtext("         at the top of TiniWindow" + Constants.vbCrLf, 9)
            appendrichtext("2.  Click and hold the mouse button down" + Constants.vbCrLf, 9)
            appendrichtext("3.  Move the mouse over the words 'New'" + Constants.vbCrLf, 9)

            appendrichtext("4.  Release the mouse button" + Constants.vbCrLf, 9)
            appendrichtext("5.  If a file is currently open, you may be prompted " + Constants.vbCrLf, 9)
            appendrichtext("         to save your changes" + Constants.vbCrLf, 9)

            appendrichtext("6.  Type in the desired data " + Constants.vbCrLf, 9)
            appendrichtext("7.  Save the file (see below) " + Constants.vbCrLf + Constants.vbCrLf, 9)

            appendrichtext("To edit an existing file" + Constants.vbCrLf, 12, FontStyle.Bold)
            appendrichtext("1.  Open the desired file(see below)" + Constants.vbCrLf, 9)
            appendrichtext("6.  Type in the desired changes " + Constants.vbCrLf, 9)
            appendrichtext("7.  Save the file (see below) " + Constants.vbCrLf + Constants.vbCrLf, 9)

        End If


        appendrichtext("To open a file" + Constants.vbCrLf, 12, FontStyle.Bold)
        appendrichtext("1.  Place the mouse pointer over the word 'File'" + Constants.vbCrLf, 9)
        appendrichtext("         at the top of TiniWindow" + Constants.vbCrLf, 9)
        appendrichtext("2.  Click and hold the mouse button down" + Constants.vbCrLf, 9)
        appendrichtext("3.  Move the mouse pointer over the words 'open'" + Constants.vbCrLf, 9)
        appendrichtext("4.  Release the mouse button" + Constants.vbCrLf, 9)
        appendrichtext("5.  Select the desired file" + Constants.vbCrLf, 9)
        appendrichtext("6.  Click button labled 'open'" + Constants.vbCrLf + Constants.vbCrLf, 9)

        If InMonitorMode Then

            appendrichtext("To save the data to a file" + Constants.vbCrLf, 12, FontStyle.Bold)
            appendrichtext("1.  Place the mouse pointer over the word 'File' " + Constants.vbCrLf, 9)
            appendrichtext("         at the top of TiniWindow" + Constants.vbCrLf, 9)
            appendrichtext("2.  Click and hold the mouse button down" + Constants.vbCrLf, 9)
            appendrichtext("3.  Move the mouse over the words 'Save As'" + Constants.vbCrLf, 9)
            appendrichtext("4.  Release the mouse button" + Constants.vbCrLf, 9)
            appendrichtext("5.  You will be prompted to choose a file " + Constants.vbCrLf, 9)
            appendrichtext("        name and location" + Constants.vbCrLf, 9)


        Else

            appendrichtext("To save a file" + Constants.vbCrLf, 12, FontStyle.Bold)
            appendrichtext("1.  Place the mouse pointer over the word 'File' " + Constants.vbCrLf, 9)
            appendrichtext("         at the top of TiniWindow" + Constants.vbCrLf, 9)
            appendrichtext("2.  Click and hold the mouse button down" + Constants.vbCrLf, 9)
            appendrichtext("3.  Move the mouse over the words 'save'" + Constants.vbCrLf, 9)
            appendrichtext("4.  Release the mouse button" + Constants.vbCrLf, 9)
            appendrichtext("5.  If this is the first time saving the file, you will" + Constants.vbCrLf, 9)
            appendrichtext("        be prompted to choose a name and location " + Constants.vbCrLf, 9)
            appendrichtext("        for the file" + Constants.vbCrLf + Constants.vbCrLf, 9)

        End If



    End Sub

    'Private Sub initializesignpatterns()

    '    'set trick parameter
    '    'Enum trick_parameter_2nd_demention_index
    '    'trick_parameter_info is an 2 dementional array of arraylists


    '    '       description() 'arraylist contains strings that describe parameter to user 
    '    '      minimumvalue() 'arraylist contains integer giving the lowest valid interger value for parameter
    '    '     maximumvalue() 'arraylist contains integers givning the highers valid integer value for parameter  

    '    'End Enum

    '    'Dim trickparametername(tricktypecount - 1, 2)

    '    ''''''''''''''''''''
    '    tricks(0, tricks_2nd_demention_index.description) = New ArrayList()
    '    tricks(0, tricks_2nd_demention_index.minimumvalue) = New ArrayList()
    '    tricks(0, tricks_2nd_demention_index.maximumvalue) = New ArrayList()
    '    tricks(0, tricks_2nd_demention_index.address) = New ArrayList()
    '    tricks(0, tricks_2nd_demention_index.actualvalue) = New ArrayList()
    '    tricks(0, tricks_2nd_demention_index.valueoffset) = New ArrayList()
    '    tricks(0, tricks_2nd_demention_index.decimals) = New ArrayList()
    '    tricks(0, tricks_2nd_demention_index.controlltype) = New ArrayList()
    '    tricks(0, tricks_2nd_demention_index.editfieldhighlite) = New String("0")


    '    tricks(0, tricks_2nd_demention_index.description).Add("line shown dummy")
    '    tricks(0, tricks_2nd_demention_index.minimumvalue).Add(0)
    '    tricks(0, tricks_2nd_demention_index.maximumvalue).Add(9)
    '    tricks(0, tricks_2nd_demention_index.address).Add(ADDRESS_ACTIVE_STRING)
    '    tricks(0, tricks_2nd_demention_index.actualvalue).Add(0)
    '    tricks(0, tricks_2nd_demention_index.valueoffset).Add(1)
    '    tricks(0, tricks_2nd_demention_index.decimals).Add(0)
    '    tricks(0, tricks_2nd_demention_index.controlltype).Add(controlltype.none)


    '    ''''''''''''''''''''
    '    tricks(1, tricks_2nd_demention_index.description) = New ArrayList()
    '    tricks(1, tricks_2nd_demention_index.minimumvalue) = New ArrayList()
    '    tricks(1, tricks_2nd_demention_index.maximumvalue) = New ArrayList()
    '    tricks(1, tricks_2nd_demention_index.address) = New ArrayList()
    '    tricks(1, tricks_2nd_demention_index.actualvalue) = New ArrayList()
    '    tricks(1, tricks_2nd_demention_index.valueoffset) = New ArrayList()
    '    tricks(1, tricks_2nd_demention_index.decimals) = New ArrayList()
    '    tricks(1, tricks_2nd_demention_index.controlltype) = New ArrayList()
    '    'tricks(1, tricks_2nd_demention_index.editfieldhighlite) = New ArrayList()
    '    tricks(1, tricks_2nd_demention_index.editfieldhighlite) = New String("0-1")


    '    tricks(1, tricks_2nd_demention_index.description).Add("start with dummy")
    '    tricks(1, tricks_2nd_demention_index.minimumvalue).Add(0)
    '    tricks(1, tricks_2nd_demention_index.maximumvalue).Add(9)
    '    tricks(1, tricks_2nd_demention_index.actualvalue).Add(0)
    '    tricks(1, tricks_2nd_demention_index.valueoffset).Add(1) 'dummy
    '    tricks(1, tricks_2nd_demention_index.decimals).Add(0) 'dummy
    '    tricks(1, tricks_2nd_demention_index.controlltype).Add(controlltype.none) 'dummy



    '    tricks(1, tricks_2nd_demention_index.description).Add("Start from first to line")
    '    tricks(1, tricks_2nd_demention_index.minimumvalue).Add(2)
    '    tricks(1, tricks_2nd_demention_index.maximumvalue).Add(10)
    '    tricks(1, tricks_2nd_demention_index.actualvalue).Add(10)
    '    tricks(1, tricks_2nd_demention_index.valueoffset).Add(0)
    '    tricks(1, tricks_2nd_demention_index.decimals).Add(0)
    '    tricks(1, tricks_2nd_demention_index.controlltype).Add(controlltype.boxes)

    '    'Dim ttt As New ArrayList
    '    'ttt.Add(New Panel)
    '    'MsgBox(ttt(0).GetType.Name)

    '    '    ''''''''''''
    '    '     Enum tricks_2nd_demention_index
    '    '    'trick_parameters is an 2 dementional array of arraylists


    '    '    description 'arraylist contains strings that describe parameter to user 
    '    '    minimumvalue 'arraylist contains integer giving the lowest valid interger value for parameter
    '    '    maximumvalue 'arraylist contains integers givning the highers valid integer value for parameter  
    '    '    address 'arraylist of integers noting the address on EEProm the parameter is sent to
    '    '    actualvalue 'arraylist contaning the actualvalues of the user selects
    '    '    valueoffset 'integer that is added to the value the user sees. 0 means the user sees the value recorde
    '    '    '            1 means user sees base 1 but the actual value is 0
    '    '    decimals '1 means the value 25 would be displayed 2.5
    '    '    controlltype
    '    'End Enum
    '    'Enum controlltype
    '    '    dropdown
    '    '    textbox
    '    'End Enum
    '    ''''''''''''''''''''''''''''''''''''''''''''
    '    Dim descriptionarraylist As ArrayList = New ArrayList
    '    '                         Start From  : 
    '    descriptionarraylist.Add("Speed    :")
    '    descriptionarraylist.Add("seconds per line.")


    '    tricks(1, tricks_2nd_demention_index.description).Add(descriptionarraylist)
    '    tricks(1, tricks_2nd_demention_index.minimumvalue).Add(1)
    '    tricks(1, tricks_2nd_demention_index.maximumvalue).Add(255)
    '    tricks(1, tricks_2nd_demention_index.actualvalue).Add(1)
    '    tricks(1, tricks_2nd_demention_index.valueoffset).Add(0)

    '    tricks(1, tricks_2nd_demention_index.decimals).Add(1)
    '    tricks(1, tricks_2nd_demention_index.controlltype).Add(controlltype.textbox)

    '    'MsgBox(tricks(1, tricks_2nd_demention_index.decimals)(2))
    '    'MsgBox(tricks(1, tricks_2nd_demention_index.description)(1).GetType.Name)
    '    Dim loopcounter = 0

    '    While (loopcounter <= 2)
    '        tricks(1, tricks_2nd_demention_index.address).Add(ADDRESS_PARAM1_TRICK_TYPE1 + loopcounter)
    '        loopcounter += 1
    '    End While



    '    'populate cb_select_trick_type
    '    loopcounter = 0
    '    'While (loopcounter < tricktypecount)
    '    '    CB_select_trick_type.Items.Add(tricktypenames(loopcounter))
    '    '    loopcounter += 1
    '    'End While

    '    'this dropdown menu is not visible on current version of TiniWindow 
    '    'howver the click boxes used to select display pattern reference it (shortcut taken)
    '    loopcounter = 0
    '    While (loopcounter < tricktypecount)
    '        Dim currenttrickname As String = tricktypenames(loopcounter)
    '        'CB_select_active_trick.Items.Add(currenttrickname)
    '        CB_monitor_active_trick.Items.Add(currenttrickname)
    '        loopcounter += 1
    '    End While
    '    'CB_select_trick_type.SelectedIndex = 0
    '    CB_monitor_active_trick.SelectedIndex = 1

    '    copytrickdata(tricks, defaulttricks)
    'End Sub

    Private Sub copytrickdata(ByVal original, ByRef copy)

        Array.Copy(original, copy, original.length) 'only the actualvalue feild differs 
        Dim firstdimension_walker As Integer = 0

        While (firstdimension_walker < tricktypecount)
            Dim actualvalue_walker = 0
            copy(firstdimension_walker, tricks_2nd_demention_index.actualvalue) = New ArrayList
            While (actualvalue_walker < original(firstdimension_walker, tricks_2nd_demention_index.actualvalue).count())
                Dim origninalvalue = original(firstdimension_walker, tricks_2nd_demention_index.actualvalue)(actualvalue_walker)
                'copy(firstdimension_walker, tricks_2nd_demention_index.actualvalue)(actualvalue_walker)
                copy(firstdimension_walker, tricks_2nd_demention_index.actualvalue).add(origninalvalue)
                Dim copyvalue = copy(firstdimension_walker, tricks_2nd_demention_index.actualvalue)(actualvalue_walker)
                actualvalue_walker += 1
            End While

            firstdimension_walker += 1
        End While


    End Sub
    Private Sub load_videoscreen()

        Dim cat1index As Int16 = Convert.ToInt16(Lbl_cat1.Tag)

        Dim cat2index As Int16 = Convert.ToInt16(Lbl_cat2.Tag)


        If cat1index = 0 Then
            LBL_catup.Visible = False
        Else
            LBL_catup.Visible = True
        End If

        If (cat2index = videos(vidoes_index.category_name).count - 1) Then

            Lbl_catdown.Visible = False
        Else
            Lbl_catdown.Visible = True
        End If
        Lbl_cat1.Text = videos(vidoes_index.category_name)(cat1index)
        Lbl_cat2.Text = videos(vidoes_index.category_name)(cat2index)
        If selected_Category = Convert.ToInt16(Lbl_cat1.Tag) Then


            mark_selected(Lbl_cat1)
            mark_selected(Pan_cat1)


            mark_unselected(Lbl_cat2)
            mark_unselected(pan_cat2)

        ElseIf selected_Category = Convert.ToInt16(Lbl_cat2.Tag) Then


            mark_selected(Lbl_cat2)
            mark_selected(pan_cat2)
            mark_unselected(Lbl_cat1)
            mark_unselected(Pan_cat1)
        Else
            mark_unselected(Lbl_cat1)
            mark_unselected(Pan_cat1)
            mark_unselected(Lbl_cat2)
            mark_unselected(pan_cat2)


        End If


    End Sub
    ''''''''''''''''''''''''''''''
    '''''''''Video functions''''''
    ''''''''''''''''''''''''''''''



    Private Sub load_CB_videolist(ByVal categoryindex As Int16)
        CB_videolist.Items.Clear()

        Dim filewalker As Int16 = 0

        'MsgBox(videos(0)(0))
        While (filewalker < videos(vidoes_index.Video_Names)(categoryindex).count)
            Dim thisfile As String = videos(vidoes_index.Video_Names)(categoryindex)(filewalker)
            CB_videolist.Items.Add(thisfile)
            filewalker += 1
        End While
        CB_videolist.SelectedIndex = 0

    End Sub
    Private Function getcategoryname(ByVal directory As String) As String
        Dim returnvalue As String = directory

        returnvalue = returnvalue.Trim

        'remove directories
        Dim slashindex As Int16 = returnvalue.IndexOf("/")

        While (slashindex >= 0)
            returnvalue = returnvalue.Substring(slashindex + 1)
            slashindex = returnvalue.IndexOf("/")
        End While

        slashindex = returnvalue.IndexOf("\")
        While (slashindex >= 0)
            returnvalue = returnvalue.Substring(slashindex + 1)
            slashindex = returnvalue.IndexOf("\")
        End While


        Return returnvalue


    End Function


    Private Function trimvideofilename(ByVal rawname As String) As String

        Dim returnvalue As String = rawname

        returnvalue = returnvalue.Trim
        'remove directories
        Dim slashindex As Int16 = returnvalue.IndexOf("/")

        While (slashindex >= 0)
            returnvalue = returnvalue.Substring(slashindex + 1)
            slashindex = returnvalue.IndexOf("/")
        End While

        slashindex = returnvalue.IndexOf("\")
        While (slashindex >= 0)
            returnvalue = returnvalue.Substring(slashindex + 1)
            slashindex = returnvalue.IndexOf("\")
        End While

        'remove extension
        If (returnvalue.EndsWith(".html")) Then
            returnvalue = returnvalue.Substring(0, returnvalue.Length - 5)
        End If
        Return returnvalue


    End Function


    Private Sub loadvideos()
        videos = New ArrayList

        videos.Add(New ArrayList)
        videos.Add(New ArrayList)
        videos.Add(New ArrayList)
        videos.Add(New ArrayList)

        If (IO.Directory.Exists("videos")) Then
            Dim categories As String() = IO.Directory.GetDirectories("videos")

            If categories.Length > 0 Then

                Dim catagorywalker As Int16 = 0
                While catagorywalker < categories.Length
                    Dim files As String() = IO.Directory.GetFiles(categories(catagorywalker))
                    Dim filewalker As Int16 = 0

                    videos(vidoes_index.category_name).add(getcategoryname(categories(catagorywalker)))
                    videos(vidoes_index.category_Directory).add((categories(catagorywalker)))

                    videos(vidoes_index.Video_Names).add(New ArrayList)
                    videos(vidoes_index.Video_files).add(New ArrayList)
                    While filewalker < files.Length
                        If files(filewalker).EndsWith(".html") Then
                            videos(vidoes_index.Video_Names)(catagorywalker).add(trimvideofilename(files(filewalker)))

                            videos(vidoes_index.Video_files)(catagorywalker).add(files(filewalker))

                        End If


                        filewalker += 1
                    End While


                    catagorywalker += 1
                End While

                'CB_videolist.SelectedIndex = 1

                load_CB_videolist(0)

                Lbl_cat1.Tag = 0
                Lbl_cat2.Tag = 1
                Pan_cat1.Tag = 0
                pan_cat2.Tag = 1

                load_videoscreen()

            Else
                MsgBox("no category directories")
            End If

        Else
            MsgBox("no vidoe directory")
        End If



    End Sub
    ''''''''''''''''''''''''''''''''''
    '''''''''text data functions''''''
    '''''''''''''''''''''''''''''
    Private Sub Lbl_textdatabottom_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        textdata_bottom()
    End Sub
    Private Sub lbl_textdatatop_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        textdata_top()
    End Sub

    Private Function refresh_testscreen() As Boolean

        Return move_textscreen_updown(0)
    End Function
    Private Function move_textscreen_updown(ByVal indexstep As Integer) As Boolean

        Dim restorevalue = databeinginternallymanipulated

        databeinginternallymanipulated = True

        Dim loopcounter As Integer = 0

        Dim tagvalue = Convert.ToInt32(TB0.Tag) + indexstep

        If tagvalue < 0 Or tagvalue > textdata.Count Then
            Return False
        End If


        If (tagvalue = 0) Then
            lbl_textdatatop.Visible = False
            Lbl_textdataup1.Visible = False
        Else
            lbl_textdatatop.Visible = True
            Lbl_textdataup1.Visible = True
        End If

        If (tagvalue < 10) Then
            Pic_textdataup10.Visible = False
        Else
            Pic_textdataup10.Visible = True
        End If


        While loopcounter < 10 And tagvalue < textdata.Count



            If loopcounter = 0 Then
                Label0.Tag = tagvalue
                TB0.Tag = tagvalue
                Label0.Text = tagvalue + 1

                TB0.Text = textdata(tagvalue)

                Label1.Visible = True

                TB1.Visible = True


            ElseIf loopcounter = 1 Then
                Label1.Tag = tagvalue
                TB1.Tag = tagvalue
                Label1.Text = tagvalue + 1
                TB1.Text = textdata(tagvalue)

                Label1.Visible = True

                TB1.Visible = True

            ElseIf loopcounter = 2 Then
                Label2.Visible = True

                TB2.Visible = True
                TB2.Tag = tagvalue
                Label2.Tag = tagvalue

                Label2.Text = tagvalue + 1
                TB2.Text = textdata(tagvalue)
            ElseIf loopcounter = 3 Then
                Label3.Visible = True

                TB3.Visible = True
                TB3.Tag = tagvalue
                Label3.Tag = tagvalue

                Label3.Text = tagvalue + 1
                TB3.Text = textdata(tagvalue)
            ElseIf loopcounter = 4 Then
                Label4.Visible = True

                TB4.Visible = True


                Label4.Tag = tagvalue
                TB4.Tag = tagvalue
                Label4.Text = tagvalue + 1
                TB4.Text = textdata(tagvalue)
            ElseIf loopcounter = 5 Then
                Label5.Visible = True

                TB5.Visible = True
                TB5.Tag = tagvalue
                Label5.Tag = tagvalue

                Label5.Text = tagvalue + 1
                TB5.Text = textdata(tagvalue)
            ElseIf loopcounter = 6 Then
                Label6.Visible = True

                TB6.Visible = True
                TB6.Tag = tagvalue
                Label6.Tag = tagvalue

                Label6.Text = tagvalue + 1
                TB6.Text = textdata(tagvalue)
            ElseIf loopcounter = 7 Then
                Label7.Visible = True

                TB7.Visible = True
                TB7.Tag = tagvalue
                Label7.Tag = tagvalue

                Label7.Text = tagvalue + 1
                TB7.Text = textdata(tagvalue)
            ElseIf loopcounter = 8 Then
                Label8.Visible = True

                TB8.Visible = True
                TB8.Tag = tagvalue
                Label8.Tag = tagvalue

                Label8.Text = tagvalue + 1
                TB8.Text = textdata(tagvalue)
            ElseIf loopcounter = 9 Then
                Label9.Visible = True

                TB9.Visible = True
                TB9.Tag = tagvalue

                Label9.Tag = tagvalue

                Label9.Text = tagvalue + 1
                TB9.Text = textdata(tagvalue)
            Else
                'loopcounter >= 10
                Exit While
            End If

            tagvalue += 1
            loopcounter += 1
        End While

        While loopcounter < 10

            If loopcounter = 1 Then
                Label1.Visible = False
                TB1.Visible = False
            ElseIf loopcounter = 2 Then
                Label2.Visible = False
                TB2.Visible = False
            ElseIf loopcounter = 3 Then
                Label3.Visible = False
                TB3.Visible = False
            ElseIf loopcounter = 4 Then
                Label4.Visible = False
                TB4.Visible = False
            ElseIf loopcounter = 5 Then
                Label5.Visible = False
                TB5.Visible = False
            ElseIf loopcounter = 6 Then
                Label6.Visible = False
                TB6.Visible = False
            ElseIf loopcounter = 7 Then
                Label7.Visible = False
                TB7.Visible = False
            ElseIf loopcounter = 8 Then
                Label8.Visible = False
                TB8.Visible = False
            ElseIf loopcounter = 9 Then
                Label9.Visible = False
                TB9.Visible = False


            End If
            loopcounter += 1
        End While


        If (tagvalue >= textdata.Count) Then
            Lbl_textdatabottom.Visible = False
            Lbl_textdatadown1.Visible = False
        Else
            Lbl_textdatabottom.Visible = True
            Lbl_textdatadown1.Visible = True
        End If

        If (tagvalue + 10 > textdata.Count) Then
            Pic_textdatadown10.Visible = False
        Else
            Pic_textdatadown10.Visible = True
        End If

        databeinginternallymanipulated = restorevalue
        Return True

    End Function

    Private Sub Lbl_textupdown_common_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Dim loopcounter As Integer = 0

        Dim indexstep As Integer
        If sender.name = "Lbl_textdatadown1" Then
            indexstep = 1
        ElseIf sender.name = "Pic_textdatadown10" Then
            indexstep = 10

        ElseIf sender.name = "Lbl_textdataup1" Then
            indexstep = -1
        ElseIf sender.name = "Pic_textdataup10" Then
            indexstep = -10
        Else
            Dim retorevalue As Boolean = databeinginternallymanipulated
            databeinginternallymanipulated = False
            MsgBox("error in lbl_textdownup_common_click")
            databeinginternallymanipulated = retorevalue

        End If

        If (Not move_textscreen_updown(indexstep)) Then
            Dim retorevalue As Boolean = databeinginternallymanipulated
            databeinginternallymanipulated = False
            MsgBox("2 error in lbl_textdownup_common_click")
            databeinginternallymanipulated = retorevalue

        End If
    End Sub


    Private Sub textdata_bottom()


        Dim restorevalue = databeinginternallymanipulated
        databeinginternallymanipulated = True

        Dim loopcounter As Integer = 9


        Dim tagvalue = textdata.Count - 1
        'MsgBox(tagvalue)

        Lbl_textdataup1.Visible = True
        lbl_textdatatop.Visible = True

        Lbl_textdatadown1.Visible = False
        Pic_textdatadown10.Visible = False
        Lbl_textdatabottom.Visible = False
        While loopcounter >= 0



            If loopcounter = 0 Then
                Label0.Tag = tagvalue
                TB0.Tag = tagvalue
                Label0.Text = tagvalue + 1

                TB0.Text = textdata(tagvalue)

                Label1.Visible = True

                TB1.Visible = True


            ElseIf loopcounter = 1 Then
                TB1.Tag = tagvalue
                Label1.Tag = tagvalue
                Label1.Text = tagvalue + 1
                TB1.Text = textdata(tagvalue)

                Label1.Visible = True

                TB1.Visible = True

            ElseIf loopcounter = 2 Then
                Label2.Visible = True

                TB2.Visible = True

                TB2.Tag = tagvalue
                Label2.Tag = tagvalue
                Label2.Text = tagvalue + 1
                TB2.Text = textdata(tagvalue)
            ElseIf loopcounter = 3 Then
                Label3.Visible = True

                TB3.Visible = True
                TB3.Tag = tagvalue
                Label3.Tag = tagvalue

                Label3.Text = tagvalue + 1
                TB3.Text = textdata(tagvalue)

            ElseIf loopcounter = 4 Then
                Label4.Visible = True
                TB4.Visible = True
                Label4.Tag = tagvalue
                TB4.Tag = tagvalue


                Label4.Text = tagvalue + 1

                TB4.Text = textdata(tagvalue)
            ElseIf loopcounter = 5 Then
                Label5.Visible = True

                TB5.Visible = True
                TB5.Tag = tagvalue
                Label5.Tag = tagvalue

                Label5.Text = tagvalue + 1

                TB5.Text = textdata(tagvalue)
            ElseIf loopcounter = 6 Then
                Label6.Visible = True

                TB6.Visible = True

                Label6.Tag = tagvalue
                TB6.Tag = tagvalue

                Label6.Text = tagvalue + 1

                TB6.Text = textdata(tagvalue)
            ElseIf loopcounter = 7 Then
                Label7.Visible = True

                TB7.Visible = True
                Label7.Tag = tagvalue
                TB7.Tag = tagvalue

                Label7.Text = tagvalue + 1

                TB7.Text = textdata(tagvalue)
            ElseIf loopcounter = 8 Then
                Label8.Visible = True

                TB8.Visible = True
                Label8.Tag = tagvalue
                TB8.Tag = tagvalue

                Label8.Text = tagvalue + 1

                TB8.Text = textdata(tagvalue)
            ElseIf loopcounter = 9 Then
                Label9.Visible = True

                TB9.Visible = True

                Label9.Text = tagvalue + 1
                Label9.Tag = tagvalue
                TB9.Text = textdata(tagvalue)
                TB9.Tag = tagvalue
            Else
                Dim restorevalue2 As Boolean = databeinginternallymanipulated

                databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                MsgBox("looping error in textdata_bottom()")
                databeinginternallymanipulated = restorevalue2

            End If

            tagvalue -= 1
            loopcounter -= 1
        End While



        If (tagvalue >= 10) Then

            Pic_textdataup10.Visible = True
        Else
            Pic_textdataup10.Visible = False

        End If


        databeinginternallymanipulated = restorevalue
    End Sub


    Public Sub textdata_top()
        Dim restorevalue = databeinginternallymanipulated
        databeinginternallymanipulated = True



        Dim loopcounter As Integer = 0

        'hide up buttons

        Lbl_textdataup1.Visible = False

        Pic_textdataup10.Visible = False
        lbl_textdatatop.Visible = False


        'there is a bug in VB such if this function is called from the background worker progress change event 
        'and this function attempts to modify a lable that has not been visible at least once
        'that the program freazes up
        'therefore we make it so that each lable is breafly visible each time this function is called
        'this function is automatically called at least once before the get data process occurs

        Label0.Visible = True
        Label1.Visible = True
        Label2.Visible = True
        Label3.Visible = True
        Label4.Visible = True
        Label5.Visible = True
        Label6.Visible = True
        Label7.Visible = True
        Label8.Visible = True
        Label9.Visible = True

        Label0.Visible = False
        Label1.Visible = False
        Label2.Visible = False
        Label3.Visible = False

        Label4.Visible = False

        Label5.Visible = False
        Label6.Visible = False
        Label7.Visible = False
        Label8.Visible = False
        Label9.Visible = False

        'Label0.Text = "1"
        'Label1.Text = "1"
        'Label2.Text = "1"
        'Label3.Text = "1"
        'Label4.Text = "1"
        'Label5.Text = "1"
        'Label6.Text = "1"
        'Label7.Text = "1"
        'Label8.Text = "1"
        'Label9.Text = "1"




        While loopcounter < textdata.Count
            If loopcounter = 0 Then
                TB0.Tag = loopcounter
                Label0.Tag = loopcounter

                Label0.Text = loopcounter + 1

                TB0.Text = textdata(loopcounter)
                Label0.Visible = True
                TB0.Visible = True


            ElseIf loopcounter = 1 Then

                Label1.Visible = True
                TB1.Visible = True

                TB1.Tag = loopcounter
                Label1.Tag = loopcounter

                Label1.Text = (loopcounter + 1).ToString

                TB1.Text = textdata(loopcounter)
                
            ElseIf loopcounter = 2 Then
                TB2.Tag = loopcounter

                Label2.Tag = loopcounter
                Label2.Visible = True
                Label2.Text = (loopcounter + 1).ToString
                TB2.Text = textdata(loopcounter)

                TB2.Visible = True

            ElseIf loopcounter = 3 Then
                TB3.Tag = loopcounter
                Label3.Tag = loopcounter

                Label3.Text = (loopcounter + 1).ToString

                TB3.Text = textdata(loopcounter)
                Label3.Visible = True
                TB3.Visible = True

            ElseIf loopcounter = 4 Then
                TB4.Tag = loopcounter
                Label4.Tag = loopcounter

                Label4.Visible = True
                Label4.Text = loopcounter + 1

                TB4.Text = textdata(loopcounter)

                TB4.Visible = True

            ElseIf loopcounter = 5 Then
                TB5.Tag = loopcounter
                Label5.Tag = loopcounter

                Label5.Text = loopcounter + 1

                TB5.Text = textdata(loopcounter)
                Label5.Visible = True
                TB5.Visible = True

            ElseIf loopcounter = 6 Then
                TB6.Tag = loopcounter

                Label6.Tag = loopcounter

                Label6.Text = loopcounter + 1
                TB6.Text = textdata(loopcounter)
                Label6.Visible = True
                TB6.Visible = True

            ElseIf loopcounter = 7 Then

                Label7.Tag = loopcounter
                TB7.Tag = loopcounter

                Label7.Text = loopcounter + 1

                TB7.Text = textdata(loopcounter)
                Label7.Visible = True
                TB7.Visible = True

            ElseIf loopcounter = 8 Then
                TB8.Tag = loopcounter
                Label8.Tag = loopcounter

                Label8.Text = loopcounter + 1

                TB8.Text = textdata(loopcounter)
                Label8.Visible = True
                TB8.Visible = True

            ElseIf loopcounter = 9 Then
                Label9.Tag = loopcounter
                TB9.Tag = loopcounter

                Label9.Text = loopcounter + 1

                TB9.Text = textdata(loopcounter)
                Label9.Visible = True
                TB9.Visible = True

            Else
                'loopcounter >= 10
                Exit While
            End If


            loopcounter += 1
        End While
        If (textdata.Count > 10) Then
            Lbl_textdatadown1.Visible = True

            Lbl_textdatabottom.Visible = True

            If textdata.Count > 20 Then
                Pic_textdatadown10.Visible = True
            Else
                Pic_textdatadown10.Visible = False
            End If

        Else
            Lbl_textdatadown1.Visible = False
            Pic_textdatadown10.Visible = False
            Lbl_textdatabottom.Visible = False
        End If

        While loopcounter < 10


            'there are fewer then 10 lines

            If loopcounter = 0 Then
                'this doesnt usually happen as most parts of the program make 1 the minimum
                Label0.Visible = False
                TB0.Visible = False

            ElseIf loopcounter = 1 Then

                Label1.Visible = False
                TB1.Visible = False

            ElseIf loopcounter = 2 Then
                Label2.Visible = False
                TB2.Visible = False

            ElseIf loopcounter = 3 Then
                Label3.Visible = False
                TB3.Visible = False

            ElseIf loopcounter = 4 Then
                Label4.Visible = False
                TB4.Visible = False
            ElseIf loopcounter = 5 Then
                Label5.Visible = False
                TB5.Visible = False
            ElseIf loopcounter = 6 Then
                Label6.Visible = False
                TB6.Visible = False
            ElseIf loopcounter = 7 Then
                Label7.Visible = False
                TB7.Visible = False
            ElseIf loopcounter = 8 Then
                Label8.Visible = False
                TB8.Visible = False
            ElseIf loopcounter = 9 Then
                Label9.Visible = False
                TB9.Visible = False
            Else
                'loopcounter >= 10
                Dim retorevalue As Boolean = databeinginternallymanipulated
                databeinginternallymanipulated = False
                MsgBox("bug in textdata_top")
                databeinginternallymanipulated = restorevalue
            End If

            loopcounter += 1

        End While

        databeinginternallymanipulated = restorevalue

    End Sub
    Private Sub initialize_textdata()
        textdata = New ArrayList
        Dim loopcounter = 0
        While loopcounter < linecount
            textdata.Add(New String(""))
            loopcounter += 1
        End While
        textdata_top()
    End Sub
    Private Sub LineConfigurationToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)


        line_configuration.ShowDialog()
        Return


        Dim controlls_array As ArrayList = New ArrayList
        Dim showagain As Boolean = True
        While (showagain)
            showagain = False
            'Dim controlls_array As ArrayList = New ArrayList
            controlls_array = New ArrayList

            controlls_array.Add(New ArrayList)
            controlls_array.Add(New ArrayList)
            controlls_array.Add(New ArrayList)


            controlls_array(mymsg.parameterArrayIndex.ControllType).add("inputint3")
            controlls_array(mymsg.parameterArrayIndex.ControllValue).add(linecount)
            controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("linecount")

            controlls_array(mymsg.parameterArrayIndex.ControllType).add("newrow")
            controlls_array(mymsg.parameterArrayIndex.ControllValue).add("")
            controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("")

            controlls_array(mymsg.parameterArrayIndex.ControllType).Add("radiobutton")
            Dim checkboxvalue As ArrayList = New ArrayList
            checkboxvalue.Add("add/remove lines to/from  beginning")
            checkboxvalue.Add("false")
            controlls_array(mymsg.parameterArrayIndex.ControllValue).Add(checkboxvalue)
            controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).Add("beginning")


            controlls_array(mymsg.parameterArrayIndex.ControllType).add("newrow")
            controlls_array(mymsg.parameterArrayIndex.ControllValue).add("")
            controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("")

            controlls_array(mymsg.parameterArrayIndex.ControllType).Add("radiobutton")
            Dim checkboxvalue2 As ArrayList = New ArrayList
            checkboxvalue2.Add("add/remove lines to/from  end")
            checkboxvalue2.Add("true")
            controlls_array(mymsg.parameterArrayIndex.ControllValue).Add(checkboxvalue2)
            controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).Add("end")

            controlls_array(mymsg.parameterArrayIndex.ControllType).add("newrow")
            controlls_array(mymsg.parameterArrayIndex.ControllValue).add("")
            controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("")

            controlls_array(mymsg.parameterArrayIndex.ControllType).add("label")
            controlls_array(mymsg.parameterArrayIndex.ControllValue).add("")
            controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("")

            controlls_array(mymsg.parameterArrayIndex.ControllType).add("newrow")
            controlls_array(mymsg.parameterArrayIndex.ControllValue).add("")
            controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("")


            controlls_array(mymsg.parameterArrayIndex.ControllType).add("label5")
            controlls_array(mymsg.parameterArrayIndex.ControllValue).add("")
            controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("")

            controlls_array(mymsg.parameterArrayIndex.ControllType).add("button8")
            controlls_array(mymsg.parameterArrayIndex.ControllValue).add("OK")
            controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("OK")

            controlls_array(mymsg.parameterArrayIndex.ControllType).add("label2")
            controlls_array(mymsg.parameterArrayIndex.ControllValue).add("")
            controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("")

            controlls_array(mymsg.parameterArrayIndex.ControllType).add("button8")
            controlls_array(mymsg.parameterArrayIndex.ControllValue).add("Cancel")
            controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("Cancel")

            controlls_array(mymsg.parameterArrayIndex.ControllType).add("newrow")
            controlls_array(mymsg.parameterArrayIndex.ControllValue).add("")
            controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("")

            controlls_array(mymsg.parameterArrayIndex.ControllType).add("label12")
            controlls_array(mymsg.parameterArrayIndex.ControllValue).add("")
            controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("")



            controlls_array(mymsg.parameterArrayIndex.ControllType).add("button")
            controlls_array(mymsg.parameterArrayIndex.ControllValue).add("Advanced")
            controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("Advanced")


            Dim selection_array As ArrayList = mymsg.showform("Enter number of lines", controlls_array)

            Dim pressed_button As String = selection_array(mymsg.returnArrayIndex.button)(mymsg.returnArraySecondDimention.identifyer)
            Dim checked_radiobutton As String = selection_array(mymsg.returnArrayIndex.radiobuttons)(mymsg.returnArraySecondDimention.identifyer)
            If pressed_button = "OK" Then
                Dim enteredvalue = selection_array(mymsg.returnArrayIndex.inputs)(mymsg.returnArraySecondDimention.value)(0)
                'MsgBox(enteredvalue)
                If enteredvalue > MAXLINES Then
                    Dim retorevalue3 As Boolean = databeinginternallymanipulated
                    databeinginternallymanipulated = False
                    MsgBox("bug in textdata_top")
                    MsgBox("Number of lines can not exceed " + MAXLINES.ToString + "!")
                    databeinginternallymanipulated = retorevalue3
                    showagain = True
                    Continue While
                End If

                If enteredvalue < linecount Then

                    Dim prompt As String = ""
                    Dim numoftruncatelines = linecount - enteredvalue
                    If (checked_radiobutton = "end") Then

                        prompt = "Are you sure you want to perminantly discard the last " + numoftruncatelines.ToString + " lines"

                    ElseIf (checked_radiobutton = "beginning") Then
                        prompt = "Are you sure you want to perminantly discard the first " + numoftruncatelines.ToString + " lines"
                    End If

                    'Dim reult As DialogResult = MsgBox(prompt, MsgBoxStyle.YesNoCancel)

                    controlls_array(mymsg.parameterArrayIndex.ControllType) = New ArrayList
                    controlls_array(mymsg.parameterArrayIndex.ControllValue) = New ArrayList
                    controlls_array(mymsg.parameterArrayIndex.ControllIdentifier) = New ArrayList

                    controlls_array(mymsg.parameterArrayIndex.ControllType).add("label6")
                    controlls_array(mymsg.parameterArrayIndex.ControllValue).add("")
                    controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("")

                    controlls_array(mymsg.parameterArrayIndex.ControllType).add("button6")
                    controlls_array(mymsg.parameterArrayIndex.ControllValue).add("yes")
                    controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("yes")

                    controlls_array(mymsg.parameterArrayIndex.ControllType).add("label6")
                    controlls_array(mymsg.parameterArrayIndex.ControllValue).add("")
                    controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("")

                    controlls_array(mymsg.parameterArrayIndex.ControllType).add("button6")
                    controlls_array(mymsg.parameterArrayIndex.ControllValue).add("no")
                    controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("no")

                    controlls_array(mymsg.parameterArrayIndex.ControllType).add("label6")
                    controlls_array(mymsg.parameterArrayIndex.ControllValue).add("")
                    controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("")


                    controlls_array(mymsg.parameterArrayIndex.ControllType).add("button6")
                    controlls_array(mymsg.parameterArrayIndex.ControllValue).add("Cancel")
                    controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("cancel")


                    Dim restorevalue2 = databeinginternallymanipulated
                    databeinginternallymanipulated = False
                    selection_array = mymsg.showform(prompt, controlls_array)
                    databeinginternallymanipulated = restorevalue2

                    pressed_button = selection_array(mymsg.returnArrayIndex.button)(mymsg.returnArraySecondDimention.identifyer)

                    If pressed_button = "cancel" Then
                        Return
                    ElseIf pressed_button = "yes" Then

                        If checked_radiobutton = "end" Then

                            linecount = enteredvalue

                            textdata.RemoveRange(0, numoftruncatelines)
                            If Not move_textscreen_updown(-numoftruncatelines) Then
                                textdata_top()
                            End If
                        ElseIf checked_radiobutton = "beginning" Then
                            linecount = enteredvalue
                            textdata.RemoveRange(textdata.Count - numoftruncatelines, numoftruncatelines)
                            If (Convert.ToInt32(TB9.Tag) >= textdata.Count) Then
                                textdata_bottom()
                            End If
                        Else
                            Dim restorevalue3 = databeinginternallymanipulated
                            databeinginternallymanipulated = False
                            MsgBox("bugg")

                            databeinginternallymanipulated = restorevalue3
                        End If
                    ElseIf pressed_button = "no" Then
                        showagain = True
                        Continue While
                    Else
                        Dim restorevalue3 = databeinginternallymanipulated
                        databeinginternallymanipulated = False
                        MsgBox("bugg")

                        databeinginternallymanipulated = restorevalue3
                    End If

                ElseIf enteredvalue > linecount Then
                    If checked_radiobutton = "end" Then
                        linecount = enteredvalue
                        While (textdata.Count < linecount)
                            textdata.Add("")

                        End While
                        move_textscreen_updown(0)

                    ElseIf checked_radiobutton = "beginning" Then
                        While (textdata.Count < linecount)
                            textdata.Insert(0, "")

                        End While
                        move_textscreen_updown(linecount)



                    End If
                    'else enteredvalue = linecount
                    'do nothing
                End If
                ADDRESS_STARTOFTEXTDATA = 500 - (linecount * settings(settingsindex.linelength))

            ElseIf pressed_button = "Advanced" Then
                MsgBox("functionality not yet implimented")
                showagain = True
                Continue While

            End If


        End While

        'if tricks have as sycling more lines then the new line count
        Dim limetocycleto = tricks_get_parameters(1)(1)
        If limetocycleto > linecount Then
            tricks_set_parameter(1, 1, linecount)
        End If

        refresh_trickcontrols()
        refresh_demo()

    End Sub

    ''''''''''''''''''''''''''''
    '''''trick data functions'''
    ''''''''''''''''''''''''''''


    Private Function tricks_edit_showoneline(ByVal trickindex As Integer, ByVal newlineshown As Integer) As Boolean

        'this functions edits an existing shown one line trick to change which line is shown
        'true if successful
        'false if an error is detected


        Dim addressptr As Integer = 2 'bytes for trick 0
        Dim loopcounter = 0

        If (newlineshown > linecount) Then
            'the line pased to show is greater then the number of line the sign is currently configured for

            Return False
        End If
        If (trickindex > trickdata(0)) Then

            'trickindex passed is larger then the number of tricks
            Return False
        End If

        While (loopcounter < trickindex)

            addressptr += trickdata(addressptr) 'bytes used by trick
            If (addressptr > trickdata.Count) Then
                Return False
            End If
            loopcounter += 1
        End While


        If (trickdata(addressptr) <> 5) Then

            'trick type 1 is supposed to use 5 bytes
            Return False
        End If

        addressptr += 1 'move from bytes address to tricktype address

        If (trickdata(addressptr) <> 1) Then

            'this function only works if passed an index to trick of type 1
            Return False
        End If

        addressptr += 1 'move from tricktype address to startline address

        trickdata(addressptr) = newlineshown


        'trickdata(0) += 1 ' number of tricks

        'trickdata.Add(4) 'bytes in trick = 4
        'trickdata.Add(1) 'tricktype = 1 
        'trickdata.Add(linenumber) 'line to startwith = linenumber   
        'trickdata.Add(1) 'lines to rotate through = 1 
        'trickdata.Add(255) 'time each line visible = 255


        Return True

    End Function

    Private Function tricks_append_rotatethroughlines(ByVal trick_startline As Integer, ByVal trick_linecount As Integer, ByVal trick_time As Integer) As Boolean


        If (trick_startline > linecount Or trick_startline < 0) Then
            Return False
        End If

        If (trick_linecount > linecount Or trick_linecount < 0) Then
            Return False
        End If

        If (trick_time > 255 Or trick_time < 0) Then
            Return False
        End If


        If trickdata.Count < 2 Then
            Return False
        End If
        If trickdata(0) >= 255 Or trickdata(0) < 0 Then
            Return False
        End If


        trickdata(0) += 1 ' number of tricks

        trickdata.Add(5) 'bytes in trick = 4  -2
        trickdata.Add(1) 'tricktype           -3 
        trickdata.Add(trick_startline) 'line to startwith -4   
        trickdata.Add(trick_linecount) 'lines to rotate through -5
        trickdata.Add(trick_time) 'time each line visible  -6

        Return True


    End Function
    Private Function tricks_append_showoneline(ByVal linenumber As Integer) As Integer


        Return tricks_append_rotatethroughlines(linenumber, 1, 255)

    End Function

    Private Function tricks_get_activetrick() As Integer
        If trickdata.Count < 2 Then
            Return -1

        End If
        Return trickdata(1)

    End Function
    Private Function tricks_set_activetrick(ByVal index) As Boolean
        If index > trickdata(0) Then
            Return False

        End If
        trickdata(1) = index

        Return True
    End Function
    Private Sub tricks_initialize()
        'this function clears the trick array 
        'and set the first 2 value so that tricks can be added
        'an error condition will result if no tricks are added after calling this function
        trickdata = New ArrayList
        trickdata.Add(0) 'number of tricks = 1
        trickdata.Add(0) 'current trick = 0 
    End Sub

    Private Function tricks_set_parameter(ByVal trickindex As Int16, ByVal parameterindex As Int16, ByVal value As Int16) As Boolean

        If trickindex > trickdata(0) Or trickindex < 0 Then
            Return False
        End If

        Dim loopcounter As Int16 = 0
        Dim indexptr As Integer = 2
        While loopcounter < trickindex
            indexptr += trickdata(indexptr)
            loopcounter += 1
        End While

        'indexptr is now pointing to the number of bytes for correct trick

        Dim bytes As Int16 = (trickdata(indexptr))

        If bytes - 2 < parameterindex Then
            'there are 2 more bytes then parameters these are bytes and tricktype
            Return False
        End If

        indexptr += 1
        'indexptr is now pointing to tricktype


        indexptr += parameterindex + 1

        trickdata(indexptr) = value
        Return True


    End Function
    Private Function tricks_set_parameters(ByVal trickindex As Int16, ByVal parameters As ArrayList) As Boolean


        If trickindex > trickdata(0) Or trickindex < 0 Then
            Return False
        End If

        Dim loopcounter As Int16 = 0
        Dim indexptr As Integer = 2
        While loopcounter < trickindex
            indexptr += trickdata(indexptr)
            loopcounter += 1
        End While

        'indexptr is now pointing to the number of bytes for correct trick

        Dim bytes As Int16 = (trickdata(indexptr))

        If bytes <> parameters.Count + 2 Then
            '2 more are bytes and tricktype
            Return False
        End If

        indexptr += 1
        'indexptr is now pointing to tricktype

        loopcounter = 0
        While loopcounter < bytes - 2
            indexptr += 1
            trickdata(indexptr) = parameters(loopcounter)
            loopcounter += 1
        End While
        Return True

    End Function

    Private Function tricks_makecompatible_with_1_003() As Boolean
        If Not tricks_datavalid() Then
            Return False
        End If
        Dim trickcount As Int16 = trickdata(0)

        If trickcount = 1 Then
            If tricks_get_tricktype(0, True) = 0 Then
                'append a rotate trhough lines trick with default values
                tricks_append_rotatethroughlines(1, linecount, 1)
                Return True
            ElseIf tricks_get_tricktype(0, True) = 1 Then
                'make the 0th trick a default show one line move the current trick to index 1

                'this is done by storing the values of the current trick, setting default tricks then setting trick 1 to stored value
                Dim trick1parameters As ArrayList = tricks_get_parameters(0)
                tricks_set_default()
                tricks_set_parameters(1, trick1parameters)
                Return True
            Else
                Return False
            End If
        ElseIf trickcount = 2 Then
            If tricks_get_tricktype(0, True) = 0 And (tricks_get_tricktype(1, True) = 1) Then
                Return True
            ElseIf tricks_get_tricktype(0, True) = 0 And linecount = 1 And tricks_get_tricktype(1, True) = 0 Then
                'with only one line it is only possible to rotate through 1 line. this situation is tricktype 0 by definition
                Return True
            ElseIf tricks_get_tricktype(0, True) = 1 And tricks_get_tricktype(1, True) = 0 Then
                Return tricks_swaptricks(0, 1)

            End If

        Else
            Return False


        End If

    End Function


    Private Function tricks_makecompatible_with_1_003(ByVal discard_tricks As Boolean) As Boolean
        'the only time false is returned is if discard_tricks is false
        'otherwise default tricks are set if no other way to make compatible

        If Not discard_tricks Then
            Return tricks_makecompatible_with_1_003()
        End If

        If tricks_makecompatible_with_1_003() Then
            'avoid duplicating code
            Return True
        End If


        If Not tricks_datavalid() Then
            tricks_set_default()
            Return True
        End If



        Dim trickcount As Int16 = tricks_get_trickcount()
        'Dim trick0indexes As ArrayList = New ArrayList
        'in version 1.03 the only supported start line for trick 0 is line 0
        Dim trick1indexes As ArrayList = New ArrayList

        Dim loopcounter As Int16 = 0
        Dim indexptr As Integer = 2
        While loopcounter < trickcount
            If tricks_get_tricktype(loopcounter, True) = 1 Then
                If tricks_get_parameters(loopcounter)(0) = 0 Then
                    'version 1.03 only supports trick1 starting with first line
                    trick1indexes.Add(loopcounter)
                End If


            End If
            indexptr += trickdata(indexptr)
            loopcounter += 1

        End While
        If trick1indexes.Count > 0 Then
            Dim trick1parameters As ArrayList = tricks_get_parameters(trick1indexes(0))
            tricks_set_default()
            tricks_set_parameters(1, trick1parameters)
        Else
            'no trick type 1 present
            tricks_set_default()
        End If

        Return True

    End Function
    Private Function tricks_swaptricks(ByVal index1 As Int16, ByVal index2 As Int16) As Boolean
        Dim trickcount = tricks_get_trickcount()
        If index1 >= trickcount Or index2 >= trickcount Or index1 < 0 Or index2 < 0 Then
            Return False
        End If
        Dim t1parameters As ArrayList = tricks_get_parameters(index1)
        Dim t2parameters As ArrayList = tricks_get_parameters(index2)

        If t1parameters.Count = 0 Or t2parameters.Count = 0 Then
            'the get parameters function failed
            Return False
        End If


        If t1parameters.Count <> t2parameters.Count Then
            'tricks use differing numbers of bytes
            'for now fails 
            'latter on will do more work to create new arraylist to allow this
            Return False
        End If

        If tricks_get_tricktype(index1) <> tricks_get_tricktype(index2) Then
            'different trick types
            'for now fails
            'later on work will be done to make it possible 
            Return False
        End If

        If Not tricks_set_parameters(index1, t2parameters) Then
            Return False
        End If

        If Not tricks_set_parameters(index2, t1parameters) Then
            Return False
        End If

        'nothing failed
        Return True
    End Function

    Private Function tricks_datavalid() As Boolean
        'this function tests if the trick data is valid and corrects a few correctable errors

        If trickdata.Count < 3 Then
            Return False
        End If
        Dim trickcount As Int16 = trickdata(0)
        Dim selectedtrick As Int16 = trickdata(1)

        If selectedtrick > trickcount Then
            'if this is the only error it should be fixed rather then telling the user the data is corrupt 
            selectedtrick = 0
        End If

        Dim loopcounter As Int16 = 0
        Dim indexptr As Integer = 2


        While loopcounter < trickcount
            If indexptr >= trickdata.Count Then
                'index is larger then the size of the arraylist
                'may result from invalid values in byte slot
                Return False

            End If



            Dim bytes As Int16 = trickdata(indexptr)
            Dim tricktype As Int16 = trickdata(indexptr + 1)


            If (tricktype = 1) Then
                If bytes = 4 Then
                    'an early version of tiniwindow made an error in the way it stored this value
                    trickdata(indexptr) = 5
                    bytes = 5
                ElseIf bytes = 5 Then
                    'correct value do nothing

                Else
                    'invalid value 
                    Return False

                End If


            End If

            indexptr += bytes


            loopcounter += 1
        End While


        If indexptr < trickdata.Count Then
            'pointer should be one value beyond arraylist if everything is in kilter
            'why its not I'm not sure

            Return False

        End If

        Return True

    End Function
    Private Function tricks_get_speed_of_trick1() As Int16

        Return tricks_get_parameters(1)(2)
    End Function
    Private Function tricks_get_linecount_of_trick1() As Int16

        Return tricks_get_parameters(1)(1)
    End Function

    Private Function tricks_get_startline_of_trick1() As Int16
        'on early versions of TiniWindow this value is programatically limited to first line (line 0)
        Return tricks_get_parameters(1)(0)
    End Function
    Private Function tricks_get_parameters(ByVal index As Int16) As ArrayList

        Dim returnarray As ArrayList = New ArrayList
        If index > trickdata(0) Or index < 0 Then
            Return returnarray
        End If

        Dim loopcounter As Int16 = 0
        Dim indexptr As Integer = 2
        While loopcounter < index
            indexptr += trickdata(indexptr)
            loopcounter += 1
        End While

        'indexptr is now pointing to the number of bytes for correct trick


        Dim bytes As Int16 = (trickdata(indexptr))
        indexptr += 1
        'indexptr is now pointing tricktype

        loopcounter = 0
        While loopcounter < bytes - 2
            indexptr += 1
            returnarray.Add(trickdata(indexptr))


            loopcounter += 1
        End While
        Return returnarray
    End Function

    Public Function tricks_get_startpointers() As ArrayList
        Dim returnarray As ArrayList = New ArrayList

        Try
            Dim trickcount As Int16 = trickdata(0)

            Dim loopcounter As Int16 = 0
            Dim indexptr As Integer = 2
            While loopcounter < trickcount
                returnarray.Add(indexptr)
                indexptr += trickdata(indexptr)
                loopcounter += 1
            End While

        Catch ex As Exception
            Return New ArrayList
        End Try

        Return returnarray
    End Function

    Private Function tricks_get_tricktype(ByVal index As Int16, ByVal includetypezero As Boolean) As Integer
        If index > trickdata(0) Or index < 0 Then
            Return (-1)
        End If
        Dim returnvalue As Integer
        Dim loopcounter As Int16 = 0
        Dim indexptr As Integer = 2
        While loopcounter < index
            indexptr += trickdata(indexptr)
            If indexptr >= trickdata.Count Then
                Return -1
            End If
            loopcounter += 1
        End While

        'indexptr is now pointing to the number of bytes for correct trick
        'advance one more memory location to point to trick type
        indexptr += 1
        If indexptr >= trickdata.Count Then
            Return -1
        End If
        returnvalue = (trickdata(indexptr))
        If returnvalue <> 1 Or Not includetypezero Then
            Return returnvalue
        End If
        indexptr += 2
        If indexptr >= trickdata.Count Then
            Return -1
        End If
        If trickdata(indexptr) = 1 Then
            Return 0
        Else
            Return 1
        End If
    End Function
    Public Function tricks_get_trickcount() As Integer
        Return trickdata(0)
    End Function
    Private Function tricks_get_tricktype(ByVal index As Int16) As Integer
        If index > trickdata(0) Or index < 0 Then
            Return (-1)
        End If

        Dim loopcounter As Int16 = 0
        Dim indexptr As Integer = 2
        'num of tricks
        'active trick
        'bytes
        'tricktype
        'startline
        'numoflines
        'time
        'bytes
        'tricktype
        'startline
        'numoflines
        'time



        While loopcounter < index
            indexptr += trickdata(indexptr)
            loopcounter += 1
        End While

        'indexptr is now pointing to the number of bytes for correct trick
        'advance one more memory location to point to trick type
        indexptr += 1
        Return (trickdata(indexptr))

    End Function
    Private Function tricks_set_default() As Boolean
        tricks_initialize()

        If Not tricks_append_showoneline(0) Then
            Return False
        End If

        If Not tricks_append_rotatethroughlines(0, linecount, 10) Then
            Return False

        End If


        Me.tricks_set_activetrick(1)
        Return True


    End Function
    ''''''''''''''''''''''''''''''''''
    ''''''''picture functions'''''''''
    '''''''''''''''''''''''''''''''''''
    Private Function getpicturename(ByVal picturefile As String) As String
        Dim returnvalue = picturefile
        returnvalue = returnvalue.Substring(returnvalue.LastIndexOf("/") + 1)
        returnvalue = returnvalue.Substring(returnvalue.LastIndexOf("\") + 1)
        returnvalue = returnvalue.Substring(0, returnvalue.LastIndexOf("."))
        'MsgBox(returnvalue)
        Return returnvalue

    End Function

    Private Sub loadpictures()
        Dim pictures As String()
        Try
            pictures = IO.Directory.GetFiles("pictures")

        Catch ex As Exception

            pan_no_pictures.Visible = True
            Return
        End Try

        Dim loopcounter As Integer = 0
        While loopcounter < pictures.Length
            CB_pictures.Items.Add(getpicturename(pictures(loopcounter)))
            loopcounter += 1
        End While
        CB_pictures.SelectedIndex = 0
    End Sub


    Public Sub CreateMyShortcut(ByVal strTarget As String, ByVal strShortCutName As String, Optional ByVal strShortCutDirectory As String = "")
        ''IWshShortcut or _comobject

        Dim shortcutstring As String

        If strShortCutDirectory = "" Then
            shortcutstring = My.Computer.FileSystem.SpecialDirectories.Desktop & "/" & strShortCutName & ".Lnk"
        ElseIf strShortCutDirectory.EndsWith("/") Or strShortCutDirectory.EndsWith("\") Then

            shortcutstring = strShortCutDirectory & strShortCutName & ".Lnk"
        Else
            shortcutstring = strShortCutDirectory & "/" & strShortCutName & ".Lnk"
        End If

        Dim wsh As Object
        Dim Shortcut As Object
        '_comObject
        wsh = CreateObject("wscript.shell")
        'Shortcut = wsh.CreateShortcut(strStartIn & "\" & strShortCutName & ".Lnk")
        Shortcut = wsh.CreateShortcut(shortcutstring)
        Shortcut.TargetPath = strTarget
        MsgBox(Shortcut.GetType.Name)
        Shortcut.TargetStartIn = "C:\Program Files\TiniWindow"
        Shortcut.Save()

    End Sub

    Private Sub Form1_Load(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MyBase.Load
        Tab_Easy.Hide()
        Tab_Combo.Hide()


        'testform.Show()

        'assume coordinator not (yet) found
        Pan_wirelessBaseNoSigns.Visible = False
        Pan_noWireless.Visible = True

        'msgbox (typeof(BGW_write_device) is  )

        'TBkw00.Text = Chr(0)
        'Dim thisStripItem = USBToolStripMenuItem.DropDownItems(0)
        'MsgBox(thisStripItem.GetType.ToString)
        'Cursor

        Lbl_dialog.BringToFront()
        'Animatedimageviewer1.imagefile = IO.Directory.GetCurrentDirectory & "\No-Connection.gif"

        'Me.mark_disabled(TxtBut_connect)
        'Me.mark_disabled(But_connect)

        connectionbuttons_markinactive(But_send)
        connectionbuttons_markinactive(But_get)
        connectionbuttons_markinactive(But_connect)

        font_functions.changesize(Txt_keyword.Font, 11.63)
        Try
            'the purpose of this try catch is to test if the fonts required for lite card to work properly are visible
            'note the lite card class has been modified to semi funtion with out these fonts
            'but there is no grid and the letters display in normal font
            Dim tempfontfamily = New FontFamily("Transponder Grid AOE")

        Catch ex As Exception

            'temporarily removed because a process is hogging attention and preventing the user from clicking ok
            'MsgBox("The sign simulator can not display letters true to the sign" & Constants.vbCrLf & "because required fonts have not been properly installed")

        End Try



        NUD_lines_cardcount.Maximum = MAX_LINELENGTH
        NUD_cardcount_easytab.Maximum = MAX_LINELENGTH
        NUD_cardcount_freestyletab.Maximum = MAX_LINELENGTH
        Me.NUD_combo_cardcount.Maximum = MAX_LINELENGTH




        'set color of litecards in demo

        LiteCard0.Backcolor = Demo_CardColor
        LiteCard1.Backcolor = Demo_CardColor
        LiteCard2.Backcolor = Demo_CardColor
        LiteCard3.Backcolor = Demo_CardColor
        LiteCard4.Backcolor = Demo_CardColor
        LiteCard5.Backcolor = Demo_CardColor
        LiteCard6.Backcolor = Demo_CardColor
        LiteCard7.Backcolor = Demo_CardColor
        LiteCard8.Backcolor = Demo_CardColor
        LiteCard9.Backcolor = Demo_CardColor
        LiteCard10.Backcolor = Demo_CardColor
        LiteCard11.Backcolor = Demo_CardColor
        LiteCard12.Backcolor = Demo_CardColor
        LiteCard13.Backcolor = Demo_CardColor
        LiteCard14.Backcolor = Demo_CardColor
        LiteCard15.Backcolor = Demo_CardColor
        LiteCard16.Backcolor = Demo_CardColor
        LiteCard17.Backcolor = Demo_CardColor
        LiteCard18.Backcolor = Demo_CardColor
        LiteCard19.Backcolor = Demo_CardColor
        'CMF-

        LiteCard0.ForeColor = demo_textcolor
        LiteCard1.ForeColor = demo_textcolor
        LiteCard2.ForeColor = demo_textcolor
        LiteCard3.ForeColor = demo_textcolor
        LiteCard4.ForeColor = demo_textcolor
        LiteCard5.ForeColor = demo_textcolor
        LiteCard6.ForeColor = demo_textcolor
        LiteCard7.ForeColor = demo_textcolor
        LiteCard8.ForeColor = demo_textcolor
        LiteCard9.ForeColor = demo_textcolor
        LiteCard10.ForeColor = demo_textcolor
        LiteCard11.ForeColor = demo_textcolor
        LiteCard12.ForeColor = demo_textcolor
        LiteCard13.ForeColor = demo_textcolor
        LiteCard14.ForeColor = demo_textcolor
        LiteCard15.ForeColor = demo_textcolor
        LiteCard16.ForeColor = demo_textcolor
        LiteCard17.ForeColor = demo_textcolor
        LiteCard18.ForeColor = demo_textcolor
        LiteCard19.ForeColor = demo_textcolor
        'Changming

        demo_set_ratio()


        'oneline_simulator_ratio = simulator_form.Width / Pan_cardbackground.Width

        'Pan_cardbackground.Height = simulator_form.Width / oneline_simulator_ratio




        'dock these programatically an dleave undocked in designer to make easier to deal with
        Pan_demo_oneline.Dock = DockStyle.Fill
        Pan_demo_multiline.Dock = DockStyle.Fill

        'Pan_demo_none.Dock = DockStyle.Fill

        'CreateMyShortcut(Application.StartupPath + "/" + ApplicationName, " myshortcut")

        'MsgBox(Chr(200))
        Dim this_comport As String = getCommandLineParameter("comport")
        Dim this_openfile As String = myunescapechars(getCommandLineParameter("OpenFile"))

        'Txt_keyword.MaxLength = settings(settingsindex.linelength) - 1
        TabControl1_SelectedIndexChanged(New Object, New EventArgs)

        If Not (IO.File.Exists(ApplicationName)) Then
            MsgBox("please rename this file to " + ApplicationName)
            Me.Close()
            Return
        End If

        Dim screenRectangle As System.Drawing.Rectangle = Screen.PrimaryScreen.WorkingArea
        Dim screenHeight As Int32 = screenRectangle.Height
        Dim screenWidth As Int32 = screenRectangle.Width

        CheckForIllegalCrossThreadCalls = False 'the (old) progress form is(was) shown in primary thread
        'but what is(was) displays is(was) modified in read and write threads

        Me.Text = labletext
        readsettingfile()
        readuserdatafile()

        NUD_lines_cardcount.Value = linelength
        'fixes a bug where static variable oldvalue was not properly set


        Dim mywelcome_form = New welcome_form
        If (settings(settingsindex.showwelcomeform)) Then
            mywelcome_form.show()
        End If
        Me.Height = screenHeight
        Me.Location = New System.Drawing.Point(screenWidth - Me.Width - 15, screenHeight - Me.Height)

        FileName = NOFILE
        'settings(settingsindex.askforname) = True
        change = False 'used for prompting to save file

        'timer_startup.Start()
        footertext(0) = "For help press F1"
        lbl_directory.Text = ""




        'initializesignpatterns()

        showEdit()

        If (this_comport <> "") Then

            mySerialPort = New System.IO.Ports.SerialPort(this_comport, 9600, System.IO.Ports.Parity.None, 8, System.IO.Ports.StopBits.One)

            If (Not getversion(TiniDiskMajorVersion, TiniDiskMinorVersion)) Then
                Dim message As String
                message = "the comport sent as a commandline parameter is invalid"
                MsgBox(message)
                comportselected = False
            Else
                comportselected = True
            End If

        End If

        'If (this_openfile <> "") Then

        '    'MsgBox((this_openfile))
        '    OpenFile(this_openfile)
        'ElseIf (userdata(userdataindex.defaultfile) <> "") Then

        '    'MsgBox((this_openfile))
        '    OpenFile(userdata(userdataindex.defaultfile))
        'Else

        '    men_make_default.Enabled = False

        'End If


        initialisetooltips()

        'CB_hide_beginners_help.Checked = Not settings(settingsindex.showbeginnershelp)
        If (settings(settingsindex.showbeginnershelp)) Then
            Pan_beginners_help.Visible = True
        Else
            Pan_beginners_help.Visible = False
        End If

        'MsgBox(Me.Height)
        'MsgBox(Pan_beginners_help.Top)
        'MsgBox(StatusStrip1.Height)


        Pan_beginners_help.Height = Me.Height - Pan_beginners_help.Top - StatusStrip1.Height - 55


        PDFview_usermanuel_small.Height = Pan_beginners_help.Height  'the value determined expirimentally

        'TB_beginners_help.Height = Pan_beginners_help.Height - 89 'the value determined expirimentally
        'But_hide_pan_beginners.Top = PDFview_usermanuel_small.Height + 5
        'CB_hide_beginners_help.Top = PDFview_usermanuel_small.Height + 10

        PDFview_usermanuel_small.LoadFile(USERMANUELFILE)

        'showmainhelp()
        loadvideos()
        loadpictures()
        initialize_textdata()

        If Not tricks_set_default() Then
            MsgBox("err1")
        End If

        'refresh_trickcontrols()
        refresh_demo()
        RB_pat_Constant.Checked = True

        set_linelenth(settings(settingsindex.linelength), line_configuration.add_or_truncate_position._none, True)
        'Num_linelength.Value = settings(settingsindex.linelength)
        'show oneline demo by default
        demooption_oneline_Click(Lbl_demooption_oneline, New EventArgs)
        change = False

        'taken out 060709 put back if buggy
        'position_cards_horLine()



        simulator_form._initialize()
        simulator_form.Show()



        colorpatterns._initialize()

        combotab_refresh()


        'MsgBox('NUDreps06.Value)




        formloaded = True
        RemoteSignsForm.init()

        Txt_keyword.MaxLength = Form1.MAX_LINELENGTH + 1
        Txt_keyword.Focus()


        'JP oct 18 2011 coment out command to show configure internet form at start up
        'men_configure_internet_Click(Nothing, Nothing)

        'Timer_formloaded.Start()
    End Sub

    Private Sub Form1_FormClosing(ByVal sender As System.Object, ByVal e As System.Windows.Forms.FormClosingEventArgs) Handles MyBase.FormClosing
        'Try


        'Static proceed = False

        'If (proceed) Then
        If (change) Then
            If (Not saveit()) Then
                e.Cancel = True
                Return
            End If
        End If


        'must be done here rather then in destructors because the stream is incorrectly shut down before destructor called
        'used in an earlier version of TiniWindow - causes exceptions in this version
        'DirectCast(Me.mysignconnections(Me.signconnectionindex.internet_via_server), SignConnection_OneSign_internet).closeallclients()






        Try

            'this sereial port is not used in this version of TiniWindow
            'it is now a junk object dating back to before sign connection objects were created
            mySerialPort.Close()
        Catch ex As Exception

        End Try
        'settings(settingsindex.showbeginnershelp) = Not CB_hide_beginners_help.Checked
        'if the panel is still visible, the value checked on the box needs to be recorded
        writesettingfile()
        writeuserdatafile()

        simulator_form.ExportdisplayPattern(simulator_form.StartUpDisplayPaternFile)




    End Sub

    Private Sub change_Lbl_pattern_type()
        Dim patterntype As Int16 = 0
        Dim dummystirng As String = ""

        If currenttrickcodingversion = TRICKCODINGVERSION_COMBOKEYWORDS_PRE_20110310 Then
            'working with combo tab
            'the lable being set was designed to display patterns pertaining to easy tab
            Lbl_pattern_type.Text = ""

            Return


        ElseIf determine_easy_pattern_type_from_text(dummystirng, patterntype) Then

            If selected_easy_pattern_type = easy_pattern_types.add_on And RB_pat_AddOn.Enabled Then
                Lbl_pattern_type.Text = "Add On"
            ElseIf selected_easy_pattern_type = easy_pattern_types.blink_fast And RB_pat_BlinkFast.Enabled Then
                Lbl_pattern_type.Text = "Blink Fast"
            ElseIf selected_easy_pattern_type = easy_pattern_types.blink_slow And RB_pat_BlinkSlow.Enabled Then
                Lbl_pattern_type.Text = "Blink Slow"
            ElseIf selected_easy_pattern_type = easy_pattern_types.constant And RB_pat_Constant.Enabled Then
                Lbl_pattern_type.Text = "Still"
            ElseIf selected_easy_pattern_type = easy_pattern_types.dance And RB_pat_Dance.Enabled Then
                Lbl_pattern_type.Text = "Dance"
            ElseIf selected_easy_pattern_type = easy_pattern_types.flow_left And RB_pat_FlowLeft.Enabled Then
                Lbl_pattern_type.Text = "Flow Left"
            ElseIf selected_easy_pattern_type = easy_pattern_types.flow_right And RB_pat_FlowRight.Enabled Then
                Lbl_pattern_type.Text = "Flow Right"
            ElseIf selected_easy_pattern_type = easy_pattern_types.join_in And RB_pat_JoinIn.Enabled Then
                Lbl_pattern_type.Text = "Join In"
            ElseIf selected_easy_pattern_type = easy_pattern_types.split_out And RB_pat_SplitOut.Enabled Then
                Lbl_pattern_type.Text = "Split Out"
            ElseIf selected_easy_pattern_type = easy_pattern_types.zoom And RB_pat_zoom.Enabled Then
                Lbl_pattern_type.Text = "Zoom In/Out"
            ElseIf selected_easy_pattern_type = easy_pattern_types.random And RB_pat_random.Enabled Then
                Lbl_pattern_type.Text = "Random"
            Else
                Lbl_pattern_type.Text = "(No Pattern)"
            End If


            dialog_unable_to_display_easy_tab.backupfile(dialog_unable_to_display_easy_tab.backupfileflags.saveCurrentState)
        Else

            Lbl_pattern_type.Text = "(No Pattern)"


        End If

    End Sub
    'TB is text box
    Private Sub TB_commen_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles TB9.TextChanged, TB8.TextChanged, TB7.TextChanged, TB6.TextChanged, TB5.TextChanged, TB4.TextChanged, TB3.TextChanged, TB2.TextChanged, TB1.TextChanged, TB0.TextChanged

        If Not formloaded Then
            Return
        End If

        Static Dim previous_strings As ArrayList = New ArrayList
        Static Dim recursive As Boolean = False
        If previous_strings.Count <> textdata.Count Then

            previous_strings = New ArrayList
            Dim loopcounter As Integer = 0
            While loopcounter < textdata.Count

                previous_strings.Add(textdata(loopcounter))

                loopcounter += 1
            End While
        End If

        If databeinginternallymanipulated Then
            Return
        End If




        If (Not recursive) Then



            recursive = True

            If currenttrickcodingversion = TRICKCODINGVERSION_COMBOKEYWORDS_PRE_20110310 Or currenttrickcodingversion = TRICKCODINGVERSION_COMBOKEYWORDS_CURRENT Then
                If promptbeforedisablingstandadtab Then


                    Dim message As String = "If you proceed with editing data in this tab you will not be able to return to combo tab!" + Constants.vbCrLf

                    message += "Are you sure you want to proceed"

                    Dim result As DialogResult = MsgBox(message, MsgBoxStyle.OkCancel)

                    If result = Windows.Forms.DialogResult.Cancel Then

                        sender.text = previous_strings(Convert.ToInt32(sender.tag))

                        recursive = False
                        Return
                    Else

                        If currenttrickcodingversion = TRICKCODINGVERSION_COMBOKEYWORDS_PRE_20110310 Then
                            'they are using the old file format. assume they wish to continue

                            currenttrickcodingversion = TRICKCODINGVERSION_LINESONLY_PRE_20110310

                        ElseIf currenttrickcodingversion = TRICKCODINGVERSION_COMBOKEYWORDS_CURRENT Then

                            currenttrickcodingversion = TRICKCODINGVERSION_LINESONLY_CURRENT

                        End If


                    End If
                Else


                    'make the change with no prompts
                    If currenttrickcodingversion = TRICKCODINGVERSION_COMBOKEYWORDS_PRE_20110310 Then

                        'they are using the old file format. assume they wish to continue

                        currenttrickcodingversion = TRICKCODINGVERSION_LINESONLY_PRE_20110310

                    ElseIf currenttrickcodingversion = TRICKCODINGVERSION_COMBOKEYWORDS_CURRENT Then

                        currenttrickcodingversion = TRICKCODINGVERSION_LINESONLY_CURRENT

                    End If

                End If
            End If


            deviceandmemorymatch = False
            hidetooltip()




            Dim index As Integer = sender.tag

            Dim cursor_pos As Integer = sender.SelectionStart
            'Dim highlite_length As Integer = sender.SelectionLength

            If (sender.Text.Length > settings(settingsindex.linelength)) Then
                Dim startinglength As Integer = sender.Text.Length
                While (sender.Text.Length > settings(settingsindex.linelength) And sender.Text.EndsWith(" "))
                    sender.Text = sender.Text.Substring(0, sender.Text.Length - 1)
                End While
                If (sender.Text.Length > settings(settingsindex.linelength)) Then
                    sender.Text = previous_strings(sender.Tag)
                    sender.SelectionStart = cursor_pos - (startinglength - sender.Text.Length)
                    recursive = False

                    Return
                End If
            End If



            sender.text = sender.text.ToUpper
            'Dim cursor_pos As Integer = sender.SelectionStart
            sender.SelectionStart = cursor_pos

            If Not databeinginternallymanipulated Then
                change = True 'this is a global variable used for prompting to save file
            End If



            If (InMonitorMode) Then

                Dim oldstring As String = previous_strings(sender.tag)

                Timer_pole_active_string.Stop()
                While (oldstring.Length < settings(settingsindex.linelength))
                    oldstring += " "
                End While



                Dim newstring As String = sender.text
                While (newstring.Length < settings(settingsindex.linelength))
                    newstring += " "
                End While



                Dim indexofchangedcharacters(settings(settingsindex.linelength)) As Integer
                Dim countofchangedcharacters As Integer = 0
                Dim loopcounter As Integer = 0

                While (loopcounter < settings(settingsindex.linelength))
                    If (oldstring.Substring(loopcounter, 1) <> newstring.Substring(loopcounter, 1)) Then
                        indexofchangedcharacters(countofchangedcharacters) = loopcounter

                        countofchangedcharacters += 1

                    End If

                    loopcounter += 1
                End While


                loopcounter = 0
                Dim communication_good As Boolean = True
                While (loopcounter < countofchangedcharacters And communication_good)
                    While (communication_good And Not writecharactertodevice(newstring.Substring(indexofchangedcharacters(loopcounter), 1), addresses(index) + indexofchangedcharacters(loopcounter)))
                        If (Not Attempt_reestablish_communication()) Then

                            sender.text = previous_strings(sender.tag)
                            showmonitor_commerror()
                            communication_good = False
                        End If
                    End While
                    loopcounter += 1

                End While
                If (communication_good) Then
                    Timer_pole_active_string.Start()
                End If

            End If



            'Dim temparray() As String = {TB0.Text, TB1.Text, TB2.Text, TB3.Text, TB4.Text, TB5.Text, TB6.Text, TB7.Text, TB8.Text, TB9.Text}



            'fix demo_multiline text
            'Dim textdata_index As Integer = Convert.ToInt32(sender.tag)
            'Dim screen_oftextdata As Int16

            'If textdata_index <= 9 Then
            '    screen_oftextdata = 0
            'ElseIf textdata_index <= 19 Then
            '    screen_oftextdata = 1
            'ElseIf textdata_index <= 29 Then
            '    screen_oftextdata = 2
            'ElseIf textdata_index <= 39 Then
            '    screen_oftextdata = 3
            'ElseIf textdata_index <= 49 Then
            '    screen_oftextdata = 4
            'ElseIf textdata_index <= 59 Then
            '    screen_oftextdata = 5
            'Else
            '    screen_oftextdata = 100
            '    'a high number that eill not be showing
            'End If

            'If screen_oftextdata = demo_mulitlinescreen Then



            'End If




            previous_strings(Convert.ToInt32(sender.tag)) = sender.text


            textdata(index) = sender.text
            demo_set_multilinescreen(demo_mulitlinescreen)

            change_Lbl_pattern_type()
            recursive = False
        End If
    End Sub

    Private Sub But_write_device_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles But_send.Click
        If selectedConnectionindex = -1 Then
            'a message is given when they hover over button
            '   MsgBox("you must connect to a sign before sending data")
            Return
        ElseIf Not Me.mysignconnections(selectedConnectionindex).connected Then
            'a message is given when they hover over button
            'MsgBox("you must connect to a sign before sending data")
            Return

        Else

            Me.mysignconnections(selectedConnectionindex).sendData()
            Return
        End If

        'should not reach here
        MsgBox("Bug")
        Return


        ''backgroung_worker_tracer_form.Show()
        'If (Not comportselected) Then

        '    TB_beginners_help.Clear()
        '    select_comport_form.clear_help_at_load = False

        '    appendrichtext("Before data can sent to the sign, The sign must be plugged into the ", 12, FontStyle.Bold)
        '    appendrichtext("USB port and the comport must be selected" + Constants.vbCrLf + Constants.vbCrLf, 12, FontStyle.Bold)
        '    If (Not selectcomport()) Then
        '        Return
        '    End If
        'End If

        ''myprogressform = New progress_form()
        'progresform_process = "write" 'used with cancle
        ''myprogressform.setheader("Sending data to device")

        'backgroundworkerdebugvalue = "00"
        ''Dim trickcount As Integer = tricks_get_trickcount()
        ''progress_form.setstepcount(linecount + trickcount + 1)
        'progresform_AutoCloseAtCompletion = True
        'BGW_write_device.RunWorkerAsync()
        'TB_beginners_help.Clear()
        'appendrichtext("sending data to the sign. ", 12, FontStyle.Bold)
        'appendrichtext(Constants.vbCrLf + Constants.vbCrLf + "When process is finished, press 'continue' button on progress form" + Constants.vbCrLf + Constants.vbCrLf, 10)
        'appendrichtext("To cancel getting data, press 'cancel' on progress form " + Constants.vbCrLf + Constants.vbCrLf, 10)
        'oldprogress_form.ShowDialog()
        'deviceandmemorymatch = True

    End Sub

    Private Function read_device()
        'this function is called by the button click and/or menue click events for get data from sign
        'it starts up the background worker 
        Timer_demo.Stop()
        simulator_form.Tim_trick1.Stop()
        ' changming 040413


        If selectedConnectionindex = -1 Then
            MsgBox("you must connect to a sign before getting data")
            Return False
        ElseIf Not Me.mysignconnections(selectedConnectionindex).connected Then

            MsgBox("you must connect to a sign before getting data")
            Return False

        Else



            If (change) Then
                If (Not saveit()) Then
                    Return False
                End If
            End If

            Lbl_pattern_type.Text = ""
            TabControl1.SelectedTab = Tab_Lines
            Lbl_pattern_type.Text = ""
            'Tim_trickcontrolls.Stop()
            Timer_demo.Stop()


            If currenttrickcodingversion = TRICKCODINGVERSION_COMBOKEYWORDS_PRE_20110310 Or currenttrickcodingversion = TRICKCODINGVERSION_LINESONLY_PRE_20110310 Then
                'they are using the old file format. assume they wish to continue

                currenttrickcodingversion = TRICKCODINGVERSION_LINESONLY_PRE_20110310 'the sign can not store keywords 

            Else

                currenttrickcodingversion = TRICKCODINGVERSION_LINESONLY_CURRENT

            End If




            'clear the teact data and move display to top so that while reading the text can be diaplayed one by one
            set_linecount(1, line_configuration.add_or_truncate_position._end)
            textdata(0) = ""
            Me.textdata_top()
            If (mysignconnections(selectedConnectionindex).GetData()) Then
                deviceandmemorymatch = True
                refresh_demo()
                'refresh_Pan_trick_parameters()
                refresh_trickcontrols()
                textdata_top()
                If possible_to_view_file_in_easytab() Then
                    TabControl1.SelectedTab = Me.Tab_Easy
                End If

                refresh_pan_morelines()

                Return True
            Else
                Return False
            End If

        End If
    End Function
    Private Sub enable_savefile()
        men_save.Enabled = True
        men_saveas.Enabled = True
        men_export_tricks.Enabled = True
    End Sub
    Private Sub disable_savefile()
        men_save.Enabled = False
        men_saveas.Enabled = False
        men_export_tricks.Enabled = False
    End Sub


    Private Sub But_read_device_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles But_get.Click


        If selectedConnectionindex = -1 Then
            'a message is given when they hover
            'MsgBox("you must connect to a sign before getting data")
            Return
        ElseIf Not Me.mysignconnections(selectedConnectionindex).connected Then
            'a message is given when they hover over the button
            'MsgBox("you must connect to a sign before getting data")
            Return

        Else


            'TB_beginners_help.Clear()
            'appendrichtext("Getting data from sign ", 12, FontStyle.Bold)

            'appendrichtext(Constants.vbCrLf + Constants.vbCrLf + "When process is finished, press 'continue' button on progress" + Constants.vbCrLf + Constants.vbCrLf, 10)
            'appendrichtext("To cancel getting data, press 'cancel' on progress form " + Constants.vbCrLf + Constants.vbCrLf, 10)
            'progresform_AutoCloseAtCompletion = True

            'backgroundworkerdebugvalue = "cc1"

            'clear the data and move the form to the top so that lines can be diaplayed as read


            read_device()

            'If (backgroundworker_showfileerror) Then
            '    'this probably does not work with since multiclass structure implimented
            '    pan_filerestrictions.Visible = True

            '    If (activetrick > tricktypecount - 1) Then
            '        disable_savefile()
            '    End If
            'Else
            '    refresh_demo()
            '    'refresh_Pan_trick_parameters()
            '    refresh_trickcontrols()
            '    textdata_top()
            '    If TabControl1.SelectedTab Is Tab_easy Then
            '        'if the easy tab is open but this file can not be displayed on it 
            '        'the lines tab is activated.

            '        Me.databeinginternallymanipulated = True
            '        TabControl1.SelectedTab = Tab_lines
            '        Me.databeinginternallymanipulated = False

            '        If possible_to_view_file_in_easytab() Then
            '            TabControl1.SelectedTab = Me.Tab_easy
            '        End If
            '    ElseIf TabControl1.SelectedTab Is Tab_combo Then
            '        'currently data read from sign can not be displayed on combo tab because key words are not stored
            '        'if it can be displayed on easy tab do so
            '        'otherwise switch to lines tab

            '        If refresh_easy_tab() Then

            '            TabControl1.SelectedTab = Tab_easy
            '        Else
            '            TabControl1.SelectedTab = Tab_lines
            '        End If
            '    ElseIf TabControl1.SelectedTab Is Tab_lines Then
            '        'stay in this tab
            '    Else
            '        'error condition
            '        MsgBox("Programmer added a tab and neglected to add functionality to get data process")
            '    End If
            'End If

        End If
        'showmainhelp()
    End Sub

    Private Function trickcodingformat1_2possible() As Boolean
        'trickcoding (file) format 1.2 is possible if there are exactly 2 trick 
        'one has to be show one line, the other rotate through lines

        If (linecount > 10 Or settings(settingsindex.linelength) > 20) Then
            Return False
        End If
        'MsgBox(0)
        If trickdata(0) <> 2 Then
            'more then 2 tricks
            Return False
        End If
        'MsgBox(1)
        '        MsgBox(tricks_get_tricktype(0))
        '       MsgBox(tricks_get_tricktype(1))

        If tricks_get_tricktype(0, True) = 0 And tricks_get_tricktype(1, True) = 1 Then
            Return True
        End If

        If tricks_get_tricktype(0, True) = 1 And tricks_get_tricktype(1, True) = 0 Then
            Return True
        End If
        'MsgBox(2)

        Return False
        'trickdata.Add(1) 'number of tricks = 1
        'trickdata.Add(0) 'current trick = 0


    End Function

    Public Function generate_file_output() As String
        'JP feb/18/2011 seperated from save file so that could be used with saving to server

        Dim outputstring As String = ""
        Dim loopcounter As Integer = 0

        While (loopcounter < textdata.Count)
            outputstring += textdata(loopcounter) + Constants.vbCrLf
            loopcounter += 1
        End While
        'mmmmm()

        If (currenttrickcodingversion = TRICKCODINGVERSION_COMBOKEYWORDS_CURRENT) Then
            outputstring += "[trick coding version " + currenttrickcodingversion.ToString + "]" + Constants.vbCrLf

            outputstring += "[TiniWindow Version " & TiniWindowVersion & "." & TiniWindoCompileDate & "]" & Constants.vbCrLf 'in the future will help determine if patters are current or legacy
            outputstring += "[start trick data]" & trickdata.Count.ToString & Constants.vbCrLf
            loopcounter = 0

            '    Dim debug1 As String = ""
            '   Dim debug2 As String = ""

            While (loopcounter < trickdata.Count)
                'this single byte value is stored in file as 2 hex digits

                '      debug1 &= Chr(trickdata(loopcounter))

                Dim valinhex As String = Hex(trickdata(loopcounter))
                If valinhex.Length = 1 Then
                    valinhex = "0" & valinhex 'pad to 2 digits
                End If

                '     debug2 &= valinhex
                outputstring += valinhex
                loopcounter += 1
            End While

            'MsgBox("[" & debug1 & "]" & Constants.vbCrLf & "[" & debug2 & "]")

            outputstring += Constants.vbCrLf
            outputstring += "[end trick data]" + Constants.vbCrLf
            outputstring += "[start keyword data]" + Constants.vbCrLf

            outputstring += keywordallignment(0) & Constants.vbCrLf
            outputstring += keywordexceedlinelength(0) & Constants.vbCrLf

            outputstring += TBkw00.Text + Constants.vbCrLf
            outputstring += combotabpatterns_indexvaluetoindexname(CBpattern00.SelectedIndex) + Constants.vbCrLf
            outputstring += NUDfc00.Maximum.ToString + Constants.vbCrLf
            outputstring += NUDfc00.Minimum.ToString + Constants.vbCrLf
            outputstring += NUDfc00.Text + Constants.vbCrLf



            outputstring += keywordallignment(1) & Constants.vbCrLf
            outputstring += keywordexceedlinelength(1) & Constants.vbCrLf
            outputstring += TBkw01.Text + Constants.vbCrLf
            outputstring += combotabpatterns_indexvaluetoindexname(CBpattern01.SelectedIndex) + Constants.vbCrLf
            outputstring += NUDfc01.Maximum.ToString + Constants.vbCrLf
            outputstring += NUDfc01.Minimum.ToString + Constants.vbCrLf
            outputstring += NUDfc01.Text + Constants.vbCrLf


            outputstring += keywordallignment(2) & Constants.vbCrLf
            outputstring += keywordexceedlinelength(2) & Constants.vbCrLf
            outputstring += TBkw02.Text + Constants.vbCrLf
            outputstring += combotabpatterns_indexvaluetoindexname(CBpattern02.SelectedIndex) + Constants.vbCrLf
            outputstring += NUDfc02.Maximum.ToString + Constants.vbCrLf
            outputstring += NUDfc02.Minimum.ToString + Constants.vbCrLf
            outputstring += NUDfc02.Text + Constants.vbCrLf

            outputstring += keywordallignment(3) & Constants.vbCrLf
            outputstring += keywordexceedlinelength(3) & Constants.vbCrLf
            outputstring += TBkw03.Text + Constants.vbCrLf
            outputstring += combotabpatterns_indexvaluetoindexname(CBpattern03.SelectedIndex) + Constants.vbCrLf
            outputstring += NUDfc03.Maximum.ToString + Constants.vbCrLf
            outputstring += NUDfc03.Minimum.ToString + Constants.vbCrLf
            outputstring += NUDfc03.Text + Constants.vbCrLf


            outputstring += keywordallignment(4) & Constants.vbCrLf
            outputstring += keywordexceedlinelength(4) & Constants.vbCrLf
            outputstring += TBkw04.Text + Constants.vbCrLf
            outputstring += combotabpatterns_indexvaluetoindexname(CBpattern04.SelectedIndex) + Constants.vbCrLf
            outputstring += NUDfc04.Maximum.ToString + Constants.vbCrLf
            outputstring += NUDfc04.Minimum.ToString + Constants.vbCrLf
            outputstring += NUDfc04.Text + Constants.vbCrLf



            outputstring += keywordallignment(5) & Constants.vbCrLf

            outputstring += keywordexceedlinelength(5) & Constants.vbCrLf


            outputstring += TBkw05.Text + Constants.vbCrLf
            outputstring += combotabpatterns_indexvaluetoindexname(CBpattern05.SelectedIndex) + Constants.vbCrLf
            outputstring += NUDfc05.Maximum.ToString + Constants.vbCrLf
            outputstring += NUDfc05.Minimum.ToString + Constants.vbCrLf
            outputstring += NUDfc05.Text + Constants.vbCrLf



            outputstring += keywordallignment(6) & Constants.vbCrLf

            outputstring += keywordexceedlinelength(6) & Constants.vbCrLf


            outputstring += TBkw06.Text + Constants.vbCrLf
            outputstring += combotabpatterns_indexvaluetoindexname(CBpattern06.SelectedIndex) + Constants.vbCrLf
            outputstring += NUDfc06.Maximum.ToString + Constants.vbCrLf
            outputstring += NUDfc06.Minimum.ToString + Constants.vbCrLf
            outputstring += NUDfc06.Text + Constants.vbCrLf





            outputstring += keywordallignment(7) & Constants.vbCrLf
            outputstring += keywordexceedlinelength(7) & Constants.vbCrLf
            outputstring += TBkw07.Text + Constants.vbCrLf
            outputstring += combotabpatterns_indexvaluetoindexname(CBpattern07.SelectedIndex) + Constants.vbCrLf
            outputstring += NUDfc07.Maximum.ToString + Constants.vbCrLf
            outputstring += NUDfc07.Minimum.ToString + Constants.vbCrLf
            outputstring += NUDfc07.Text + Constants.vbCrLf


            outputstring += keywordallignment(8) & Constants.vbCrLf
            outputstring += keywordexceedlinelength(8) & Constants.vbCrLf
            outputstring += TBkw08.Text + Constants.vbCrLf
            outputstring += combotabpatterns_indexvaluetoindexname(CBpattern08.SelectedIndex) + Constants.vbCrLf
            outputstring += NUDfc08.Maximum.ToString + Constants.vbCrLf
            outputstring += NUDfc08.Minimum.ToString + Constants.vbCrLf
            outputstring += NUDfc08.Text + Constants.vbCrLf




            outputstring += keywordallignment(9) & Constants.vbCrLf
            outputstring += keywordexceedlinelength(9) & Constants.vbCrLf
            outputstring += TBkw09.Text + Constants.vbCrLf
            outputstring += combotabpatterns_indexvaluetoindexname(CBpattern09.SelectedIndex) + Constants.vbCrLf
            outputstring += NUDfc09.Maximum.ToString + Constants.vbCrLf
            outputstring += NUDfc09.Minimum.ToString + Constants.vbCrLf
            outputstring += NUDfc09.Text + Constants.vbCrLf


            outputstring += "[end keyword data]"


        ElseIf (currenttrickcodingversion = TRICKCODINGVERSION_COMBOKEYWORDS_PRE_20110310) Then
            outputstring += "[trick coding version " + currenttrickcodingversion.ToString + "]" + Constants.vbCrLf

            outputstring += "[TiniWindow Version " & TiniWindowVersion & "." & TiniWindoCompileDate & "]" & Constants.vbCrLf 'in the future will help determine if patters are current or legacy
            outputstring += "[start trick data]" & trickdata.Count.ToString & Constants.vbCrLf
            loopcounter = 0
            While (loopcounter < trickdata.Count)
                outputstring += Chr(trickdata(loopcounter))
                loopcounter += 1
            End While

            outputstring += Constants.vbCrLf
            outputstring += "[end trick data]" + Constants.vbCrLf
            outputstring += "[start keyword data]" + Constants.vbCrLf

            outputstring += keywordallignment(0) & Constants.vbCrLf
            outputstring += keywordexceedlinelength(0) & Constants.vbCrLf

            outputstring += TBkw00.Text + Constants.vbCrLf
            outputstring += combotabpatterns_indexvaluetoindexname(CBpattern00.SelectedIndex) + Constants.vbCrLf
            outputstring += NUDfc00.Maximum.ToString + Constants.vbCrLf
            outputstring += NUDfc00.Minimum.ToString + Constants.vbCrLf
            outputstring += NUDfc00.Text + Constants.vbCrLf



            outputstring += keywordallignment(1) & Constants.vbCrLf
            outputstring += keywordexceedlinelength(1) & Constants.vbCrLf
            outputstring += TBkw01.Text + Constants.vbCrLf
            outputstring += combotabpatterns_indexvaluetoindexname(CBpattern01.SelectedIndex) + Constants.vbCrLf
            outputstring += NUDfc01.Maximum.ToString + Constants.vbCrLf
            outputstring += NUDfc01.Minimum.ToString + Constants.vbCrLf
            outputstring += NUDfc01.Text + Constants.vbCrLf


            outputstring += keywordallignment(2) & Constants.vbCrLf
            outputstring += keywordexceedlinelength(2) & Constants.vbCrLf
            outputstring += TBkw02.Text + Constants.vbCrLf
            outputstring += combotabpatterns_indexvaluetoindexname(CBpattern02.SelectedIndex) + Constants.vbCrLf
            outputstring += NUDfc02.Maximum.ToString + Constants.vbCrLf
            outputstring += NUDfc02.Minimum.ToString + Constants.vbCrLf
            outputstring += NUDfc02.Text + Constants.vbCrLf

            outputstring += keywordallignment(3) & Constants.vbCrLf
            outputstring += keywordexceedlinelength(3) & Constants.vbCrLf
            outputstring += TBkw03.Text + Constants.vbCrLf
            outputstring += combotabpatterns_indexvaluetoindexname(CBpattern03.SelectedIndex) + Constants.vbCrLf
            outputstring += NUDfc03.Maximum.ToString + Constants.vbCrLf
            outputstring += NUDfc03.Minimum.ToString + Constants.vbCrLf
            outputstring += NUDfc03.Text + Constants.vbCrLf


            outputstring += keywordallignment(4) & Constants.vbCrLf
            outputstring += keywordexceedlinelength(4) & Constants.vbCrLf
            outputstring += TBkw04.Text + Constants.vbCrLf
            outputstring += combotabpatterns_indexvaluetoindexname(CBpattern04.SelectedIndex) + Constants.vbCrLf
            outputstring += NUDfc04.Maximum.ToString + Constants.vbCrLf
            outputstring += NUDfc04.Minimum.ToString + Constants.vbCrLf
            outputstring += NUDfc04.Text + Constants.vbCrLf



            outputstring += keywordallignment(5) & Constants.vbCrLf

            outputstring += keywordexceedlinelength(5) & Constants.vbCrLf


            outputstring += TBkw05.Text + Constants.vbCrLf
            outputstring += combotabpatterns_indexvaluetoindexname(CBpattern05.SelectedIndex) + Constants.vbCrLf
            outputstring += NUDfc05.Maximum.ToString + Constants.vbCrLf
            outputstring += NUDfc05.Minimum.ToString + Constants.vbCrLf
            outputstring += NUDfc05.Text + Constants.vbCrLf



            outputstring += keywordallignment(6) & Constants.vbCrLf

            outputstring += keywordexceedlinelength(6) & Constants.vbCrLf


            outputstring += TBkw06.Text + Constants.vbCrLf
            outputstring += combotabpatterns_indexvaluetoindexname(CBpattern06.SelectedIndex) + Constants.vbCrLf
            outputstring += NUDfc06.Maximum.ToString + Constants.vbCrLf
            outputstring += NUDfc06.Minimum.ToString + Constants.vbCrLf
            outputstring += NUDfc06.Text + Constants.vbCrLf





            outputstring += keywordallignment(7) & Constants.vbCrLf
            outputstring += keywordexceedlinelength(7) & Constants.vbCrLf
            outputstring += TBkw07.Text + Constants.vbCrLf
            outputstring += combotabpatterns_indexvaluetoindexname(CBpattern07.SelectedIndex) + Constants.vbCrLf
            outputstring += NUDfc07.Maximum.ToString + Constants.vbCrLf
            outputstring += NUDfc07.Minimum.ToString + Constants.vbCrLf
            outputstring += NUDfc07.Text + Constants.vbCrLf


            outputstring += keywordallignment(8) & Constants.vbCrLf
            outputstring += keywordexceedlinelength(8) & Constants.vbCrLf
            outputstring += TBkw08.Text + Constants.vbCrLf
            outputstring += combotabpatterns_indexvaluetoindexname(CBpattern08.SelectedIndex) + Constants.vbCrLf
            outputstring += NUDfc08.Maximum.ToString + Constants.vbCrLf
            outputstring += NUDfc08.Minimum.ToString + Constants.vbCrLf
            outputstring += NUDfc08.Text + Constants.vbCrLf




            outputstring += keywordallignment(9) & Constants.vbCrLf
            outputstring += keywordexceedlinelength(9) & Constants.vbCrLf
            outputstring += TBkw09.Text + Constants.vbCrLf
            outputstring += combotabpatterns_indexvaluetoindexname(CBpattern09.SelectedIndex) + Constants.vbCrLf
            outputstring += NUDfc09.Maximum.ToString + Constants.vbCrLf
            outputstring += NUDfc09.Minimum.ToString + Constants.vbCrLf
            outputstring += NUDfc09.Text + Constants.vbCrLf


            outputstring += "[end keyword data]"



        ElseIf (currenttrickcodingversion = TRICKCODINGVERSION_COMBOKEYWORDS_1_08_01) Then
            'outputstring += "[trick coding version " + TRICKCODINGVERSION_COMBOKEYWORDS_1_08_01.ToString + "]" + Constants.vbCrLf
            'outputstring += "[start trick data]" & trickdata.Count.ToString & Constants.vbCrLf
            'loopcounter = 0
            'While (loopcounter < trickdata.Count)
            '    outputstring += Chr(trickdata(loopcounter))
            '    loopcounter += 1
            'End While

            'outputstring += Constants.vbCrLf
            'outputstring += "[end trick data]" + Constants.vbCrLf
            'outputstring += "[start keyword data]" + Constants.vbCrLf

            'outputstring += TBkw00.Text + Constants.vbCrLf
            'outputstring += combotabpatterns_indexvaluetoindexname(CBpattern00.SelectedIndex) + Constants.vbCrLf
            'outputstring += NUDfc00.Maximum.ToString + Constants.vbCrLf
            'outputstring += NUDfc00.Minimum.ToString + Constants.vbCrLf
            'outputstring += NUDfc00.Text + Constants.vbCrLf
            'outputstring += 'NUDreps00.Maximum.ToString + Constants.vbCrLf
            'outputstring += 'NUDreps00.Minimum.ToString + Constants.vbCrLf
            'outputstring += 'NUDreps00.Text + Constants.vbCrLf


            'outputstring += TBkw01.Text + Constants.vbCrLf
            'outputstring += combotabpatterns_indexvaluetoindexname(CBpattern01.SelectedIndex) + Constants.vbCrLf
            'outputstring += NUDfc01.Maximum.ToString + Constants.vbCrLf
            'outputstring += NUDfc01.Minimum.ToString + Constants.vbCrLf
            'outputstring += NUDfc01.Text + Constants.vbCrLf
            'outputstring += 'NUDreps01.Maximum.ToString + Constants.vbCrLf
            'outputstring += 'NUDreps01.Minimum.ToString + Constants.vbCrLf
            'outputstring += 'NUDreps01.Text + Constants.vbCrLf



            'outputstring += TBkw02.Text + Constants.vbCrLf
            'outputstring += combotabpatterns_indexvaluetoindexname(CBpattern02.SelectedIndex) + Constants.vbCrLf
            'outputstring += NUDfc02.Maximum.ToString + Constants.vbCrLf
            'outputstring += NUDfc02.Minimum.ToString + Constants.vbCrLf
            'outputstring += NUDfc02.Text + Constants.vbCrLf
            'outputstring += 'NUDreps02.Maximum.ToString + Constants.vbCrLf
            'outputstring += 'NUDreps02.Minimum.ToString + Constants.vbCrLf
            'outputstring += 'NUDreps02.Text + Constants.vbCrLf


            'outputstring += TBkw03.Text + Constants.vbCrLf
            'outputstring += combotabpatterns_indexvaluetoindexname(CBpattern03.SelectedIndex) + Constants.vbCrLf
            'outputstring += NUDfc03.Maximum.ToString + Constants.vbCrLf
            'outputstring += NUDfc03.Minimum.ToString + Constants.vbCrLf
            'outputstring += NUDfc03.Text + Constants.vbCrLf
            'outputstring += 'NUDreps03.Maximum.ToString + Constants.vbCrLf
            'outputstring += 'NUDreps03.Minimum.ToString + Constants.vbCrLf
            'outputstring += 'NUDreps03.Text + Constants.vbCrLf


            'outputstring += TBkw04.Text + Constants.vbCrLf
            'outputstring += combotabpatterns_indexvaluetoindexname(CBpattern04.SelectedIndex) + Constants.vbCrLf
            'outputstring += NUDfc04.Maximum.ToString + Constants.vbCrLf
            'outputstring += NUDfc04.Minimum.ToString + Constants.vbCrLf
            'outputstring += NUDfc04.Text + Constants.vbCrLf
            'outputstring += 'NUDreps04.Maximum.ToString + Constants.vbCrLf
            'outputstring += 'NUDreps04.Minimum.ToString + Constants.vbCrLf
            'outputstring += 'NUDreps04.Text + Constants.vbCrLf


            'outputstring += TBkw05.Text + Constants.vbCrLf
            'outputstring += combotabpatterns_indexvaluetoindexname(CBpattern05.SelectedIndex) + Constants.vbCrLf
            'outputstring += NUDfc05.Maximum.ToString + Constants.vbCrLf
            'outputstring += NUDfc05.Minimum.ToString + Constants.vbCrLf
            'outputstring += NUDfc05.Text + Constants.vbCrLf
            'outputstring += 'NUDreps05.Maximum.ToString + Constants.vbCrLf
            'outputstring += 'NUDreps05.Minimum.ToString + Constants.vbCrLf
            'outputstring += 'NUDreps05.Text + Constants.vbCrLf


            'outputstring += TBkw06.Text + Constants.vbCrLf
            'outputstring += combotabpatterns_indexvaluetoindexname(CBpattern06.SelectedIndex) + Constants.vbCrLf
            'outputstring += NUDfc06.Maximum.ToString + Constants.vbCrLf
            'outputstring += NUDfc06.Minimum.ToString + Constants.vbCrLf
            'outputstring += NUDfc06.Text + Constants.vbCrLf
            'outputstring += 'NUDreps06.Maximum.ToString + Constants.vbCrLf
            'outputstring += 'NUDreps06.Minimum.ToString + Constants.vbCrLf
            'outputstring += 'NUDreps06.Text + Constants.vbCrLf


            'outputstring += TBkw07.Text + Constants.vbCrLf
            'outputstring += combotabpatterns_indexvaluetoindexname(CBpattern07.SelectedIndex) + Constants.vbCrLf
            'outputstring += NUDfc07.Maximum.ToString + Constants.vbCrLf
            'outputstring += NUDfc07.Minimum.ToString + Constants.vbCrLf
            'outputstring += NUDfc07.Text + Constants.vbCrLf
            'outputstring += 'NUDreps07.Maximum.ToString + Constants.vbCrLf
            'outputstring += 'NUDreps07.Minimum.ToString + Constants.vbCrLf
            'outputstring += 'NUDreps07.Text + Constants.vbCrLf


            'outputstring += TBkw08.Text + Constants.vbCrLf
            'outputstring += combotabpatterns_indexvaluetoindexname(CBpattern08.SelectedIndex) + Constants.vbCrLf
            'outputstring += NUDfc08.Maximum.ToString + Constants.vbCrLf
            'outputstring += NUDfc08.Minimum.ToString + Constants.vbCrLf
            'outputstring += NUDfc08.Text + Constants.vbCrLf
            'outputstring += 'NUDreps08.Maximum.ToString + Constants.vbCrLf
            'outputstring += 'NUDreps08.Minimum.ToString + Constants.vbCrLf
            'outputstring += 'NUDreps08.Text + Constants.vbCrLf


            'outputstring += TBkw09.Text + Constants.vbCrLf
            'outputstring += combotabpatterns_indexvaluetoindexname(CBpattern09.SelectedIndex) + Constants.vbCrLf
            'outputstring += NUDfc09.Maximum.ToString + Constants.vbCrLf
            'outputstring += NUDfc09.Minimum.ToString + Constants.vbCrLf
            'outputstring += NUDfc09.Text + Constants.vbCrLf
            'outputstring += 'NUDreps09.Maximum.ToString + Constants.vbCrLf
            'outputstring += 'NUDreps09.Minimum.ToString + Constants.vbCrLf
            'outputstring += 'NUDreps09.Text + Constants.vbCrLf






            'outputstring += "[end keyword data]"

        ElseIf (currenttrickcodingversion = TRICKCODINGVERSION_LINESONLY_CURRENT) Then
            outputstring += "[trick coding version " + TRICKCODINGVERSION_LINESONLY_CURRENT.ToString + "]" + Constants.vbCrLf

            loopcounter = 0
            While (loopcounter < trickdata.Count)

                Dim valhex As String = Hex(trickdata(loopcounter))
                If valhex.Length = 1 Then
                    'pad to 2 digits
                    valhex = "0" & valhex
                End If
                outputstring += valhex
                loopcounter += 1
            End While

            'this version does not read correctly if an ending tag is present
            'outputstring += "[end trick data]"


        ElseIf (currenttrickcodingversion = TRICKCODINGVERSION_LINESONLY_PRE_20110310) Then
            outputstring += "[trick coding version " + TRICKCODINGVERSION_LINESONLY_PRE_20110310.ToString + "]" + Constants.vbCrLf

            loopcounter = 0
            While (loopcounter < trickdata.Count)
                outputstring += Chr(trickdata(loopcounter))
                loopcounter += 1
            End While

            'this version does not read correctly if an ending tag is present
            'outputstring += "[end trick data]"
        ElseIf (currenttrickcodingversion = 1.2) Then

            'MsgBox("backward file compatibility not yet implemented")
            ' Return

            If Not trickcodingformat1_2possible() Then
                MsgBox("internal file format error!" + Constants.vbCrLf + "please report this bug")
                Return ""
            End If

            outputstring += "[trick coding version 1.2]" + Constants.vbCrLf
            outputstring += Chr(trickdata(1))
            'tricks count
            'actuve tric
            'bytes
            'tricktype
            'startline
            'lines
            'time
            'bytes
            'tricktype
            'startline
            'lines
            'time
            If tricks_get_tricktype(0, True) = 0 Then
                outputstring += Chr(trickdata(4))
                outputstring += Constants.vbCrLf
                outputstring += Chr(trickdata(9))
                outputstring += Chr(trickdata(10))
                outputstring += Chr(trickdata(11))
                outputstring += Constants.vbCrLf
                outputstring += "[end trick data]"

            ElseIf tricks_get_tricktype(1, True) = 0 Then
                outputstring += Chr(trickdata(9))
                outputstring += Constants.vbCrLf
                outputstring += Chr(trickdata(4))
                outputstring += Chr(trickdata(5))
                outputstring += Chr(trickdata(6))
                outputstring += Constants.vbCrLf
                outputstring += "[end trick data]"

            Else
                MsgBox("internal file format error!" + Constants.vbCrLf + "please report this bug")
                Return ""
            End If

        ElseIf (currenttrickcodingversion = -1) Then
            outputstring += unrecognisedtrickdata
        End If

        Return outputstring

    End Function

    Private Sub savefile()
        Dim SW As IO.StreamWriter = IO.File.CreateText(FileName)
        
        SW.Write(Me.generate_file_output)
        SW.Close()
        change = False
    End Sub
    Public Function Readline(ByRef SR As String, ByRef linein As String) As Boolean
        'when seperating processFileContents() from openFile()
        'I created this function that uses a SR string instead of SR stream reader 
        'as a way to minimize rewriting code
        If (SR.Length > 0) Then
            Dim indexcr As Int16
            Dim indexlf As Int16
            Dim indexeol

            indexcr = SR.IndexOf(Constants.vbCr)
            indexlf = SR.IndexOf(Constants.vbLf)


            If indexcr < 0 Or indexlf < 0 Then
                If indexcr >= 0 Then

                    linein = SR.Substring(0, indexcr)
                    SR = SR.Substring(indexcr + 1)
                    Return True
                ElseIf indexlf >= 0 Then
                    linein = SR.Substring(0, indexlf)
                    SR = SR.Substring(indexlf + 1)
                    Return True
                Else
                    'no cr or lf - return remainder of file

                    linein = SR
                    SR = ""
                    Return True

                End If


            ElseIf indexcr < indexlf Then


                linein = SR.Substring(0, indexcr)
                SR = SR.Substring(indexcr + 1)
                While (SR.StartsWith(Constants.vbLf) Or SR.StartsWith(Constants.vbCr))
                    SR = SR.Substring(1)

                End While

                Return True

            ElseIf indexlf < indexcr Then
                linein = SR.Substring(0, indexlf)
                SR = SR.Substring(indexcr + 1)
                While (SR.StartsWith(Constants.vbLf) Or SR.StartsWith(Constants.vbCr))
                    SR = SR.Substring(1)

                End While

                Return True

            Else
                'bug this condition should be impossible
                'the only time the index of both char is identical 
                'is when neither is in string - already tested for

                MsgBox("bug in reading line")
            End If

        Else

            Return False
        End If


    End Function


    Public Function Readline(ByVal SR As IO.StreamReader, ByRef linein As String) As Boolean
        'READS FROM FILE
        If (SR.Peek >= 0) Then
            linein = SR.ReadLine

        Else

            Return False
        End If

        Return True

    End Function

    Private Sub trimspaces(ByVal SR As IO.StreamReader)
        'this function trims spaces (and tabs) from the stream reader input
        'note it intentionally does not trim line breaks
        While (SR.Peek = " " Or SR.Peek = " ")
            SR.Read()
        End While
    End Sub
    Private Function isnumber(ByVal ch As Char) As Boolean
        If (ch = "0" Or ch = "1" Or ch = "2" Or ch = "3" Or ch = "4" Or ch = "5" Or ch = "6" Or ch = "7" Or ch = "8" Or ch = "9") Then
            Return True
        End If
    End Function

    Private Function convertlinetoparameters(ByVal line As String, ByRef parameters As ArrayList) As Boolean
        parameters = New ArrayList

        While (line <> "")
            parameters.Add(Asc(line))
            line.Substring(1)
        End While
    End Function


    Public Function fileistrickfile(ByVal filename As String) As Boolean

        Dim extentionlist_string As String = userdata(userdataindex.trickFileExtentions).Replace("*.", "*").Trim
        Dim extentionlist_array As ArrayList = New ArrayList
        Dim fileextention = filename.Substring(filename.LastIndexOf(".") + 1)

        'MsgBox(fileextention)
        While extentionlist_string.Length <> 0
            Dim indexofstar As Integer = extentionlist_string.LastIndexOf("*")
            Dim indexofsemicolon = extentionlist_string.LastIndexOf(";")

            extentionlist_array.Add(extentionlist_string.Substring(indexofstar + 1, indexofsemicolon - indexofstar - 1).Trim())
            extentionlist_string = extentionlist_string.Substring(0, extentionlist_string.LastIndexOf("*")).Trim
        End While
        Dim loopcounter = 0
        While (loopcounter < extentionlist_array.Count)

            'MsgBox(extentionlist_array(loopcounter))
            If fileextention = extentionlist_array(loopcounter) Then
                Return True
            End If
            loopcounter += 1
        End While
        Return False
    End Function
    ''''''''''''
    Public Function ProcessFileContents(ByVal FileContents As String) As Boolean
        'Dim SR As IO.StreamReader = IO.File.OpenText(FileNameHolder)
        Dim _mymsg As mymsg = New mymsg
        Dim SR As String = FileContents
        Dim linein As String = ""
        Dim longestlinelength As Int16 = 0
        deviceandmemorymatch = False
        textdata = New ArrayList
        linecount = 0
        While (readline(SR, linein) And Not linein.StartsWith("[trick coding version"))
            linecount += 1

            textdata.Add(linein)
            If longestlinelength < linein.Length Then
                longestlinelength = linein.Length
            End If
            linein = ""
        End While



        If (linein <> "") Then
            'MsgBox("[" + linein + "]")
            'outputstring += keywordallignment(0).ToString
            'outputstring += keywordexceedlinelength(0).ToString

            If (linein = "[trick coding version 3.2]" Or linein = "[trick coding version 3.3]") Then

                If (linein = "[trick coding version 3.2]") Then

                    settrickcodingversion(3.2)
                ElseIf (linein = "[trick coding version 3.3]") Then
                    settrickcodingversion(3.3)

                End If




                readline(SR, linein)

                If linein.StartsWith("[TiniWindow Version") Then
                    'for now let it work even if this line is missing
                    'in future line missing may result in corrupt file error
                    readline(SR, linein)
                End If


                If (Not linein.StartsWith("[start trick data]")) Then
                    databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                    MsgBox("unable to open file! it is corrupt!")
                    databeinginternallymanipulated = True
                    cancelopenfile(cancelopenfileflags.restoreStoredState)
                    databeinginternallymanipulated = False
                    Return False
                End If

                trickdata = New ArrayList 'not neccesray (and wrong) to initialize becaue first few EEprom values stored in file
                Dim trickbytes As Int16
                Try
                    trickbytes = Convert.ToInt16(linein.Substring("[start trick data]".Length))
                Catch ex As Exception

                    databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                    MsgBox("unable to open file! it is corrupt!")
                    databeinginternallymanipulated = True
                    cancelopenfile(cancelopenfileflags.restoreStoredState)
                    databeinginternallymanipulated = False
                    Return False

                End Try

                Dim bytecounter As Int16 = 0

                If (currenttrickcodingversion = 3.2) Then


                    While bytecounter < trickbytes And SR.Length > 0

                        trickdata.Add(Asc(SR(0)))
                        If SR.Length <= 1 Then
                            SR = ""

                        Else
                            SR = SR.Substring(1)
                        End If



                        bytecounter += 1

                    End While

                ElseIf (currenttrickcodingversion = 3.3) Then

                    If trickbytes Mod 2 = 1 Then
                        'odd number of bytes signifying an error

                    End If
                    While bytecounter < 2 * trickbytes And SR.Length > 0

                        Dim val_as_string As String = (SR(0)) & (SR(1)) 'read 2 chars
                        If SR <= 2 Then
                            SR = ""
                        Else
                            SR = SR.Substring(2)
                        End If


                        trickdata.Add(Convert.ToInt16(val_as_string, 16))

                        bytecounter += 2

                    End While

                Else
                    MsgBox("bug!")
                End If



                '''''''

                If (currenttrickcodingversion = 3.2) Then

                    'the file is old format -  prompt to update

                    databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                    openoldfiledialog.ShowDialog()
                    databeinginternallymanipulated = True

                    If openoldfiledialog.DialogResult = Windows.Forms.DialogResult.Yes Then
                        'update
                        settrickcodingversion(3.3)
                        change = True

                    ElseIf openoldfiledialog.DialogResult = Windows.Forms.DialogResult.No Then
                        'don't update

                    ElseIf openoldfiledialog.DialogResult = Windows.Forms.DialogResult.Cancel Then

                        cancelopenfile(cancelopenfileflags.restoreStoredState)
                        refresh_demo()
                        databeinginternallymanipulated = False
                        Return False

                    Else
                        databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                        MsgBox("error opening file" + Constants.vbCrLf + "please report this bug")
                        databeinginternallymanipulated = True
                        cancelopenfile(cancelopenfileflags.restoreStoredState)
                        refresh_demo()
                        databeinginternallymanipulated = False
                        Return False


                    End If


                End If




                'Dim tempch As Char = SR.Read

                If (SR(0) <> Constants.vbCr And (SR(1)) <> Constants.vbLf) Then
                    'there should be a crlf imediatelly after trick data

                    databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                    MsgBox("unable to open file! it is corrupt!")
                    databeinginternallymanipulated = True
                    cancelopenfile(cancelopenfileflags.restoreStoredState)
                    databeinginternallymanipulated = False

                    Return False


                End If
                If SR.Length <= 2 Then
                    SR = ""
                Else
                    SR = SR.Substring(2)
                End If

                readline(SR, linein)

                If (linein <> "[end trick data]") Then
                    databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                    MsgBox("unable to open file! it is corrupt!")
                    databeinginternallymanipulated = True
                    cancelopenfile(cancelopenfileflags.restoreStoredState)
                    databeinginternallymanipulated = False
                    Return False
                End If

                readline(SR, linein)

                If (linein <> "[start keyword data]") Then
                    databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                    MsgBox("unable to open file! it is corrupt!")
                    databeinginternallymanipulated = True
                    cancelopenfile(cancelopenfileflags.restoreStoredState)
                    databeinginternallymanipulated = False
                    Return False
                End If

                Dim keywordlinecounter As Int16 = 0
                Dim kewywordcontrollcounter As Int16 = 0


                While (readline(SR, linein) And linein <> "[end keyword data]")

                    'this routine will not complain if the file ends with out "[end keywords]" tag as long as data is otherwise complete


                    If kewywordcontrollcounter = 0 Then

                        'these 2 controll counter do not require a seperate condition for each keywordlinecounter 
                        keywordallignment(keywordlinecounter) = Convert.ToInt16(linein)
                        kewywordcontrollcounter += 1
                        Continue While
                    ElseIf kewywordcontrollcounter = 1 Then

                        keywordexceedlinelength(keywordlinecounter) = Convert.ToBoolean(linein)
                        kewywordcontrollcounter += 1
                        Continue While
                    End If



                    If keywordlinecounter = 0 Then


                        If kewywordcontrollcounter = 2 Then

                            'keyword
                            TBkw00.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'pattern
                            CBpattern00.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines max

                            NUDfc00.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 5 Then
                            'lines min
                            NUDfc00.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'lines  value
                            NUDfc00.Value = Convert.ToInt16(linein)
                            ''NUDreps00.Value = 1
                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1
                        Else
                            databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                            MsgBox("error")
                            databeinginternallymanipulated = True

                        End If

                    ElseIf keywordlinecounter = 1 Then



                        If kewywordcontrollcounter = 2 Then
                            'keyword
                            TBkw01.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'pattern
                            CBpattern01.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines max

                            NUDfc01.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 5 Then
                            'lines min
                            NUDfc01.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'lines  value
                            NUDfc01.Value = Convert.ToInt16(linein)
                            ''NUDreps01.Value = 1
                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1
                        Else

                            databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                            MsgBox("error")
                            databeinginternallymanipulated = True

                        End If


                    ElseIf keywordlinecounter = 2 Then


                        If kewywordcontrollcounter = 2 Then
                            'keyword
                            TBkw02.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'pattern
                            CBpattern02.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines max

                            NUDfc02.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 5 Then
                            'lines min
                            NUDfc02.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'lines  value
                            NUDfc02.Value = Convert.ToInt16(linein)

                            ''NUDreps02.Value = 1
                            kewywordcontrollcounter = 0


                            keywordlinecounter += 1

                        Else
                            databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                            MsgBox("error")
                            databeinginternallymanipulated = True
                        End If

                    ElseIf keywordlinecounter = 3 Then


                        If kewywordcontrollcounter = 2 Then
                            'keyword
                            TBkw03.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'pattern
                            CBpattern03.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines max

                            NUDfc03.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 5 Then
                            'lines min
                            NUDfc03.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'lines  value
                            NUDfc03.Value = Convert.ToInt16(linein)
                            ''NUDreps03.Value = 1
                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1

                        Else
                            databeinginternallymanipulated = False 'prevent tripping watchdog timmer

                            MsgBox("error")
                            databeinginternallymanipulated = True

                        End If

                    ElseIf keywordlinecounter = 4 Then


                        If kewywordcontrollcounter = 2 Then
                            'keyword
                            TBkw04.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'pattern
                            CBpattern04.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines max

                            NUDfc04.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 5 Then
                            'lines min
                            NUDfc04.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'lines  value
                            NUDfc04.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                            ''NUDreps04.Value = 1
                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1

                        Else

                            databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                            MsgBox("error")
                            databeinginternallymanipulated = True
                        End If

                    ElseIf keywordlinecounter = 5 Then


                        If kewywordcontrollcounter = 2 Then
                            'keyword
                            TBkw05.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'pattern
                            CBpattern05.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines max

                            NUDfc05.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 5 Then
                            'lines min
                            NUDfc05.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'lines  value
                            NUDfc05.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                            ''NUDreps05.Value = 1
                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1

                        Else

                            databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                            MsgBox("error")
                            databeinginternallymanipulated = True
                        End If

                    ElseIf keywordlinecounter = 6 Then


                        If kewywordcontrollcounter = 2 Then
                            'keyword
                            TBkw06.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'pattern
                            CBpattern06.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines max

                            NUDfc06.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 5 Then
                            'lines min
                            NUDfc06.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'lines  value
                            NUDfc06.Value = Convert.ToInt16(linein)

                            'NUDreps06.Value = 1
                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1

                        Else
                            databeinginternallymanipulated = False 'prevent tripping watchdog timmer


                            MsgBox("error")
                            databeinginternallymanipulated = True
                        End If

                    ElseIf keywordlinecounter = 7 Then


                        If kewywordcontrollcounter = 2 Then
                            'keyword
                            TBkw07.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'pattern
                            CBpattern07.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines max

                            NUDfc07.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 5 Then
                            'lines min
                            NUDfc07.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'lines  value
                            NUDfc07.Value = Convert.ToInt16(linein)
                            ''NUDreps07.Value = 1
                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1

                        Else
                            databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                            MsgBox("error")
                            databeinginternallymanipulated = True
                        End If

                    ElseIf keywordlinecounter = 8 Then


                        If kewywordcontrollcounter = 2 Then
                            'keyword
                            TBkw08.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'pattern
                            CBpattern08.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines max

                            NUDfc08.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 5 Then
                            'lines min
                            NUDfc08.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'lines  value
                            NUDfc08.Value = Convert.ToInt16(linein)
                            ''NUDreps08.Value = 1
                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1

                        Else

                            databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                            MsgBox("error")
                            databeinginternallymanipulated = True
                        End If

                    ElseIf keywordlinecounter = 9 Then


                        If kewywordcontrollcounter = 2 Then
                            'keyword
                            TBkw09.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'pattern
                            CBpattern09.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines max

                            NUDfc09.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 5 Then
                            'lines min
                            NUDfc09.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'lines  value
                            NUDfc09.Value = Convert.ToInt16(linein)
                            ''NUDreps09.Value = 1
                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1


                        Else

                            databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                            MsgBox("error")
                            databeinginternallymanipulated = True
                        End If
                        'endif
                    Else
                        databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                        MsgBox("unable to open this file because it contains more keywords then this version of TiniWindow supports")
                        databeinginternallymanipulated = True
                        cancelopenfile(cancelopenfileflags.restoreStoredState)
                        databeinginternallymanipulated = False
                        Return False
                    End If


                End While

                If kewywordcontrollcounter <> 0 Then
                    'part of a line was read but not all the controll variables were read
                    databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                    MsgBox("unable to open this file because it is corupt")
                    databeinginternallymanipulated = True
                    cancelopenfile(cancelopenfileflags.restoreStoredState)
                    databeinginternallymanipulated = False
                    Return False

                End If

                While keywordlinecounter < 10
                    'fill in lines missing from file using default pattern which is emptylinem still, 1line 0 reps


                    'these conditions are a hack to avoid changing each condition below  
                    If kewywordcontrollcounter = 2 Then
                        'keyword
                        linein = jpstringsfunctions.padright(" ", " ", settings(settingsindex.linelength))

                    ElseIf kewywordcontrollcounter = 3 Then
                        'pattern
                        linein = "still"
                    ElseIf kewywordcontrollcounter = 4 Then
                        'lines max

                        linein = "5"
                    ElseIf kewywordcontrollcounter = 5 Then
                        'lines min
                        linein = "0"

                    ElseIf kewywordcontrollcounter = 6 Then
                        'lines  value
                        linein = "1"

                    End If


                    If kewywordcontrollcounter = 0 Then
                        keywordallignment(keywordlinecounter) = Convert.ToInt16(linein)
                    ElseIf kewywordcontrollcounter = 1 Then

                        keywordexceedlinelength(keywordlinecounter) = Convert.ToBoolean(linein)

                    End If
                    If keywordlinecounter = 0 Then


                        If kewywordcontrollcounter = 2 Then

                            'keyword
                            TBkw00.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'pattern
                            CBpattern00.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines max

                            NUDfc00.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 5 Then
                            'lines min
                            NUDfc00.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'lines  value
                            NUDfc00.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        Else

                            ''NUDreps00.Value = 1
                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1
                        End If

                    ElseIf keywordlinecounter = 1 Then

                        If kewywordcontrollcounter = 2 Then
                            'keyword
                            TBkw01.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'pattern
                            CBpattern01.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines max

                            NUDfc01.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 5 Then
                            'lines min
                            NUDfc01.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'lines  value
                            NUDfc01.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        Else

                            ''NUDreps01.Value = 1
                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1
                        End If


                    ElseIf keywordlinecounter = 2 Then


                        If kewywordcontrollcounter = 2 Then
                            'keyword
                            TBkw02.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'pattern
                            CBpattern02.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines max

                            NUDfc02.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 5 Then
                            'lines min
                            NUDfc02.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'lines  value
                            NUDfc02.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        Else

                            ''NUDreps02.Value = 1
                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1
                        End If

                    ElseIf keywordlinecounter = 3 Then


                        If kewywordcontrollcounter = 2 Then
                            'keyword
                            TBkw03.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'pattern
                            CBpattern03.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines max

                            NUDfc03.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 5 Then
                            'lines min
                            NUDfc03.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'lines  value
                            NUDfc03.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        Else

                            ''NUDreps03.Value = 1
                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1

                        End If

                    ElseIf keywordlinecounter = 4 Then


                        If kewywordcontrollcounter = 2 Then
                            'keyword
                            TBkw04.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'pattern
                            CBpattern04.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines max

                            NUDfc04.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 5 Then
                            'lines min
                            NUDfc04.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'lines  value
                            NUDfc04.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        Else

                            ''NUDreps04.Value = 1
                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1
                        End If

                    ElseIf keywordlinecounter = 5 Then


                        If kewywordcontrollcounter = 2 Then
                            'keyword
                            TBkw05.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'pattern
                            CBpattern05.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines max

                            NUDfc05.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 5 Then
                            'lines min
                            NUDfc05.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'lines  value
                            NUDfc05.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        Else

                            ''NUDreps05.Value = 1
                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1

                        End If

                    ElseIf keywordlinecounter = 6 Then


                        If kewywordcontrollcounter = 2 Then
                            'keyword
                            TBkw06.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'pattern
                            CBpattern06.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines max

                            NUDfc06.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 5 Then
                            'lines min
                            NUDfc06.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'lines  value
                            NUDfc06.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        Else

                            ''NUDreps06.Value = 1
                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1
                        End If

                    ElseIf keywordlinecounter = 7 Then


                        If kewywordcontrollcounter = 2 Then
                            'keyword
                            TBkw07.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'pattern
                            CBpattern07.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines max

                            NUDfc07.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 5 Then
                            'lines min
                            NUDfc07.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'lines  value
                            NUDfc07.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        Else

                            'NUDreps07.Value = 1
                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1
                        End If

                    ElseIf keywordlinecounter = 8 Then


                        If kewywordcontrollcounter = 2 Then
                            'keyword
                            TBkw08.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'pattern
                            CBpattern08.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines max

                            NUDfc08.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 5 Then
                            'lines min
                            NUDfc08.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'lines  value
                            NUDfc08.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        Else

                            'NUDreps08.Value = 1
                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1
                        End If

                    ElseIf keywordlinecounter = 9 Then


                        If kewywordcontrollcounter = 2 Then
                            'keyword
                            TBkw09.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'pattern
                            CBpattern09.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines max

                            NUDfc09.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 5 Then
                            'lines min
                            NUDfc09.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'lines  value
                            NUDfc09.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        Else

                            'NUDreps09.Value = 1
                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1

                        End If

                    End If





                End While




                'combotabpatterns_indexnametoindexvalue


            ElseIf (linein = "[trick coding version 3.1]") Then





                readline(SR, linein)

                If (Not linein.StartsWith("[start trick data]")) Then
                    databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                    MsgBox("unable to open file! it is corrupt!")

                    cancelopenfile(cancelopenfileflags.restoreStoredState)
                    Return False
                End If
                settrickcodingversion(3.2) 'for now we are automatically updating from 3.1 to 3.2

                trickdata = New ArrayList 'not neccesray (and wrong) to initialize becaue first few EEprom values stored in file
                Dim trickbytes As Int16
                Try
                    trickbytes = Convert.ToInt16(linein.Substring("[start trick data]".Length))
                Catch ex As Exception
                    databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                    MsgBox("unable to open file! it is corrupt!")
                    cancelopenfile(cancelopenfileflags.restoreStoredState)
                    Return False

                End Try

                Dim bytecounter As Int16 = 0

                While bytecounter < trickbytes And SR.Length > 0

                    trickdata.Add(SR(0))
                    If SR <= 1 Then
                        SR = ""
                    Else
                        SR = SR.Substring(1)
                    End If

                    bytecounter += 1

                End While

                'Dim tempch As Char = SR.Read

                If (SR(0)) <> Constants.vbCr And (SR(1)) <> Constants.vbLf Then
                    'there should be a crlf imediatelly after trick data
                    databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                    MsgBox("unable to open file! it is corrupt!")
                    cancelopenfile(cancelopenfileflags.restoreStoredState)
                    Return False


                End If
                If SR.Length <= 2 Then
                    SR = ""
                Else
                    SR = SR.Substring(2)
                End If

                readline(SR, linein)

                If (linein <> "[end trick data]") Then
                    databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                    MsgBox("unable to open file! it is corrupt!")
                    cancelopenfile(cancelopenfileflags.restoreStoredState)
                    Return False
                End If

                readline(SR, linein)

                If (linein <> "[start keyword data]") Then

                    databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                    MsgBox("unable to open file! it is corrupt!")
                    cancelopenfile(cancelopenfileflags.restoreStoredState)
                    Return False
                End If

                Dim keywordlinecounter As Int16 = 0
                Dim kewywordcontrollcounter As Int16 = 0


                While (readline(SR, linein) And linein <> "[end keyword data]")

                    'this routine will not complain if the file ends with out "[end keywords]" tag as long as data is otherwise complete

                    'a hack
                    'If kewywordcontrollcounter = 5 Then
                    '    'reps max
                    '    linein = 1
                    'Else
                    '    kewywordcontrollcounter = 7
                    '    'reps value
                    '    linein = 1
                    'End If


                    If keywordlinecounter = 0 Then

                        If kewywordcontrollcounter = 0 Then
                            'keyword
                            TBkw00.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 1 Then
                            'pattern
                            CBpattern00.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 2 Then
                            'lines max

                            NUDfc00.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'lines min
                            NUDfc00.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines  value
                            NUDfc00.Value = Convert.ToInt16(linein)


                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 5 Then
                            'reps max
                            'NUDreps00.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'reps min
                            'NUDreps00.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 7 Then
                            'reps value

                            'set reps to 1 because this version of tiniwindow doesnt use reps

                            'if the file calls for 0 reps set line count to 0

                            'NUDreps00.Value = 1 ' 

                            If Convert.ToInt16(linein) = 0 Then

                                NUDfc00.Value = 0

                            End If


                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1

                        End If

                    ElseIf keywordlinecounter = 1 Then


                        If kewywordcontrollcounter = 0 Then
                            'keyword
                            TBkw01.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 1 Then
                            'pattern
                            CBpattern01.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 2 Then
                            'lines max

                            NUDfc01.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'lines min
                            NUDfc01.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines  value
                            NUDfc01.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 5 Then
                            'reps max
                            'NUDreps01.Maximum = 1
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'reps min
                            'NUDreps01.Minimum = 1
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 7 Then
                            'reps value


                            'set reps to 1 because this version of tiniwindow doesnt use reps

                            'if the file calls for 0 reps set line count to 0

                            'NUDreps01.Value = 1 ' 

                            If Convert.ToInt16(linein) = 0 Then
                                NUDfc01.Minimum = 0
                                NUDfc01.Value = 0

                            End If



                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1


                        End If




                    ElseIf keywordlinecounter = 2 Then


                        If kewywordcontrollcounter = 0 Then
                            'keyword
                            TBkw02.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 1 Then
                            'pattern
                            CBpattern02.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 2 Then
                            'lines max

                            NUDfc02.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'lines min
                            NUDfc02.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines  value
                            NUDfc02.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 5 Then
                            'reps max
                            'NUDreps02.Maximum = 1
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'reps min
                            'NUDreps02.Minimum = 1
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 7 Then
                            'reps value

                            'set reps to 1 because this version of tiniwindow doesnt use reps

                            'if the file calls for 0 reps set line count to 0

                            'NUDreps02.Value = 1 ' 

                            If Convert.ToInt16(linein) = 0 Then
                                NUDfc02.Minimum = 0
                                NUDfc02.Value = 0

                            End If

                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1

                        End If

                    ElseIf keywordlinecounter = 3 Then


                        If kewywordcontrollcounter = 0 Then
                            'keyword
                            TBkw03.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 1 Then
                            'pattern
                            CBpattern03.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 2 Then
                            'lines max

                            NUDfc03.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'lines min
                            NUDfc03.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines  value
                            NUDfc03.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 5 Then
                            'reps max
                            'NUDreps03.Maximum = 1
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'reps min
                            'NUDreps03.Minimum = 1
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 7 Then
                            'reps value
                            'set reps to 1 because this version of tiniwindow doesnt use reps

                            'if the file calls for 0 reps set line count to 0

                            'NUDreps03.Value = 1 ' 

                            If Convert.ToInt16(linein) = 0 Then
                                NUDfc03.Minimum = 0
                                NUDfc03.Value = 0

                            End If
                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1

                        End If

                    ElseIf keywordlinecounter = 4 Then


                        If kewywordcontrollcounter = 0 Then
                            'keyword
                            TBkw04.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 1 Then
                            'pattern
                            CBpattern04.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 2 Then
                            'lines max

                            NUDfc04.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'lines min
                            NUDfc04.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines  value
                            NUDfc04.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 5 Then
                            'reps max
                            'NUDreps04.Maximum = 1
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'reps min
                            'NUDreps04.Minimum = 1
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 7 Then
                            'reps value
                            'set reps to 1 because this version of tiniwindow doesnt use reps

                            'if the file calls for 0 reps set line count to 0

                            'NUDreps04.Value = 1 ' 

                            If Convert.ToInt16(linein) = 0 Then
                                NUDfc04.Minimum = 0
                                NUDfc04.Value = 0

                            End If
                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1

                        End If

                    ElseIf keywordlinecounter = 5 Then


                        If kewywordcontrollcounter = 0 Then
                            'keyword
                            TBkw05.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 1 Then
                            'pattern
                            CBpattern05.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 2 Then
                            'lines max

                            NUDfc05.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'lines min
                            NUDfc05.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines  value
                            NUDfc05.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 5 Then
                            'reps max
                            'NUDreps05.Maximum = 1
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'reps min
                            'NUDreps05.Minimum = 1
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 7 Then
                            'reps value
                            'set reps to 1 because this version of tiniwindow doesnt use reps

                            'if the file calls for 0 reps set line count to 0

                            ''NUDreps06.Value = 1 ' 

                            If Convert.ToInt16(linein) = 0 Then

                                NUDfc05.Minimum = 0
                                NUDfc05.Value = 0

                            End If


                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1

                        End If

                    ElseIf keywordlinecounter = 6 Then


                        If kewywordcontrollcounter = 0 Then
                            'keyword
                            TBkw06.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 1 Then
                            'pattern
                            CBpattern06.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 2 Then
                            'lines max

                            NUDfc06.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'lines min
                            NUDfc06.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines  value
                            NUDfc06.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 5 Then
                            'reps max
                            ''NUDreps06.Maximum = 1
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'reps min
                            ''NUDreps06.Minimum = 1
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 7 Then
                            'reps value
                            'set reps to 1 because this version of tiniwindow doesnt use reps

                            'if the file calls for 0 reps set line count to 0

                            ''NUDreps06.Value = 1 ' 

                            If Convert.ToInt16(linein) = 0 Then

                                NUDfc06.Minimum = 0
                                NUDfc06.Value = 0

                            End If

                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1

                        End If

                    ElseIf keywordlinecounter = 7 Then


                        If kewywordcontrollcounter = 0 Then
                            'keyword
                            TBkw07.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 1 Then
                            'pattern
                            CBpattern07.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 2 Then
                            'lines max

                            NUDfc07.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'lines min
                            NUDfc07.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines  value
                            NUDfc07.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 5 Then
                            'reps max
                            'NUDreps07.Maximum = 1
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'reps min
                            'NUDreps07.Minimum = 1
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 7 Then
                            'reps value
                            'set reps to 1 because this version of tiniwindow doesnt use reps

                            'if the file calls for 0 reps set line count to 0

                            'NUDreps07.Value = 1 ' 

                            If Convert.ToInt16(linein) = 0 Then

                                NUDfc07.Minimum = 0
                                NUDfc07.Value = 0

                            End If

                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1

                        End If

                    ElseIf keywordlinecounter = 8 Then


                        If kewywordcontrollcounter = 0 Then
                            'keyword
                            TBkw08.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 1 Then
                            'pattern
                            CBpattern08.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 2 Then
                            'lines max

                            NUDfc08.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'lines min
                            NUDfc08.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines  value
                            NUDfc08.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 5 Then
                            'reps max
                            'NUDreps08.Maximum = 1
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'reps min
                            'NUDreps08.Minimum = 1
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 7 Then
                            'reps value
                            'set reps to 1 because this version of tiniwindow doesnt use reps

                            'if the file calls for 0 reps set line count to 0

                            'NUDreps08.Value = 1 ' 

                            If Convert.ToInt16(linein) = 0 Then


                                NUDfc08.Minimum = 0

                                NUDfc08.Value = 0

                            End If


                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1

                        End If

                    ElseIf keywordlinecounter = 9 Then


                        If kewywordcontrollcounter = 0 Then
                            'keyword
                            TBkw09.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 1 Then
                            'pattern
                            CBpattern09.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 2 Then
                            'lines max

                            NUDfc09.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'lines min
                            NUDfc09.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines  value
                            NUDfc09.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 5 Then
                            'reps max
                            'NUDreps09.Maximum = 1
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'reps min
                            'NUDreps09.Minimum = 1
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 7 Then
                            'reps value
                            'set reps to 1 because this version of tiniwindow doesnt use reps

                            'if the file calls for 0 reps set line count to 0

                            'NUDreps09.Value = 1 ' 

                            If Convert.ToInt16(linein) = 0 Then

                                NUDfc09.Minimum = 0
                                NUDfc09.Value = 0

                            End If

                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1

                        End If

                    Else

                        databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                        MsgBox("unable to open this file because it contains more keywords then this version of TiniWindow supports")
                        cancelopenfile(cancelopenfileflags.restoreStoredState)
                        Return False
                    End If


                End While

                If kewywordcontrollcounter <> 0 Then
                    'part of a line was read but not all the controll variables were read

                    databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                    MsgBox("unable to open this file because it is corupt")
                    cancelopenfile(cancelopenfileflags.restoreStoredState)
                    Return False

                End If

                While keywordlinecounter < 10
                    'fill in lines missing from file using default pattern which is emptylinem still, 1line 0 reps


                    'these conditions are a hack to avoid changing each condition below  
                    If kewywordcontrollcounter = 0 Then
                        'keyword
                        linein = jpstringsfunctions.padright(" ", " ", settings(settingsindex.linelength))

                    ElseIf kewywordcontrollcounter = 1 Then
                        'pattern
                        linein = "still"
                    ElseIf kewywordcontrollcounter = 2 Then
                        'lines max

                        linein = "5"
                    ElseIf kewywordcontrollcounter = 3 Then
                        'lines min
                        linein = "0"

                    ElseIf kewywordcontrollcounter = 4 Then
                        'lines  value
                        linein = "0"

                    ElseIf kewywordcontrollcounter = 5 Then
                        'reps max
                        linein = "1"
                    ElseIf kewywordcontrollcounter = 6 Then
                        'reps min
                        linein = "1"

                    ElseIf kewywordcontrollcounter = 7 Then
                        'reps value
                        linein = "1"
                    End If

                    If keywordlinecounter = 0 Then


                        If kewywordcontrollcounter = 0 Then
                            'keyword
                            TBkw00.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 1 Then
                            'pattern
                            CBpattern00.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 2 Then
                            'lines max

                            NUDfc00.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'lines min
                            NUDfc00.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines  value
                            NUDfc00.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 5 Then
                            'reps max
                            'NUDreps00.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'reps min
                            'NUDreps00.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 7 Then
                            'reps value
                            'NUDreps00.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1

                        End If

                    ElseIf keywordlinecounter = 1 Then


                        If kewywordcontrollcounter = 0 Then
                            'keyword
                            TBkw01.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 1 Then
                            'pattern
                            CBpattern01.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 2 Then
                            'lines max

                            NUDfc01.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'lines min
                            NUDfc01.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines  value
                            NUDfc01.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 5 Then
                            'reps max
                            'NUDreps01.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'reps min
                            'NUDreps01.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 7 Then
                            'reps value
                            'NUDreps01.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1


                        End If




                    ElseIf keywordlinecounter = 2 Then


                        If kewywordcontrollcounter = 0 Then
                            'keyword
                            TBkw02.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 1 Then
                            'pattern
                            CBpattern02.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 2 Then
                            'lines max

                            NUDfc02.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'lines min
                            NUDfc02.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines  value
                            NUDfc02.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 5 Then
                            'reps max
                            'NUDreps02.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'reps min
                            'NUDreps02.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 7 Then
                            'reps value
                            'NUDreps02.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1

                        End If

                    ElseIf keywordlinecounter = 3 Then


                        If kewywordcontrollcounter = 0 Then
                            'keyword
                            TBkw03.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 1 Then
                            'pattern
                            CBpattern03.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 2 Then
                            'lines max

                            NUDfc03.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'lines min
                            NUDfc03.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines  value
                            NUDfc03.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 5 Then
                            'reps max
                            'NUDreps03.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'reps min
                            'NUDreps03.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 7 Then
                            'reps value
                            'NUDreps03.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1

                        End If

                    ElseIf keywordlinecounter = 4 Then


                        If kewywordcontrollcounter = 0 Then
                            'keyword
                            TBkw04.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 1 Then
                            'pattern
                            CBpattern04.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 2 Then
                            'lines max

                            NUDfc04.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'lines min
                            NUDfc04.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines  value
                            NUDfc04.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 5 Then
                            'reps max
                            'NUDreps04.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'reps min
                            'NUDreps04.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 7 Then
                            'reps value
                            'NUDreps04.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1

                        End If

                    ElseIf keywordlinecounter = 5 Then


                        If kewywordcontrollcounter = 0 Then
                            'keyword
                            TBkw05.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 1 Then
                            'pattern
                            CBpattern05.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 2 Then
                            'lines max

                            NUDfc05.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'lines min
                            NUDfc05.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines  value
                            NUDfc05.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 5 Then
                            'reps max
                            'NUDreps05.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'reps min
                            'NUDreps05.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 7 Then
                            'reps value
                            'NUDreps05.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1

                        End If

                    ElseIf keywordlinecounter = 6 Then


                        If kewywordcontrollcounter = 0 Then
                            'keyword
                            TBkw06.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 1 Then
                            'pattern
                            CBpattern06.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 2 Then
                            'lines max

                            NUDfc06.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'lines min
                            NUDfc06.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines  value
                            NUDfc06.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 5 Then
                            'reps max
                            ''NUDreps06.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'reps min
                            ''NUDreps06.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 7 Then
                            'reps value
                            ''NUDreps06.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1

                        End If

                    ElseIf keywordlinecounter = 7 Then


                        If kewywordcontrollcounter = 0 Then
                            'keyword
                            TBkw07.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 1 Then
                            'pattern
                            CBpattern07.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 2 Then
                            'lines max

                            NUDfc07.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'lines min
                            NUDfc07.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines  value
                            NUDfc07.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 5 Then
                            'reps max
                            'NUDreps07.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'reps min
                            'NUDreps07.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 7 Then
                            'reps value
                            'NUDreps07.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1

                        End If

                    ElseIf keywordlinecounter = 8 Then


                        If kewywordcontrollcounter = 0 Then
                            'keyword
                            TBkw08.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 1 Then
                            'pattern
                            CBpattern08.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 2 Then
                            'lines max

                            NUDfc08.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'lines min
                            NUDfc08.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines  value
                            NUDfc08.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 5 Then
                            'reps max
                            'NUDreps08.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'reps min
                            'NUDreps08.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 7 Then
                            'reps value
                            'NUDreps08.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1

                        End If

                    ElseIf keywordlinecounter = 9 Then


                        If kewywordcontrollcounter = 0 Then
                            'keyword
                            TBkw09.Text = linein
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 1 Then
                            'pattern
                            CBpattern09.SelectedIndex = combotabpatterns_indexnametoindexvalue(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 2 Then
                            'lines max

                            NUDfc09.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1
                        ElseIf kewywordcontrollcounter = 3 Then
                            'lines min
                            NUDfc09.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 4 Then
                            'lines  value
                            NUDfc09.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 5 Then
                            'reps max
                            'NUDreps09.Maximum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 6 Then
                            'reps min
                            'NUDreps09.Minimum = Convert.ToInt16(linein)
                            kewywordcontrollcounter += 1

                        ElseIf kewywordcontrollcounter = 7 Then
                            'reps value
                            'NUDreps09.Value = Convert.ToInt16(linein)
                            kewywordcontrollcounter = 0
                            keywordlinecounter += 1

                        End If

                    Else
                        databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                        MsgBox("unable to open this file because it contains more keywords then this version of TiniWindow supports")
                        cancelopenfile(cancelopenfileflags.restoreStoredState)
                        Return False
                    End If





                End While




                'combotabpatterns_indexnametoindexvalue
            ElseIf (linein = "[trick coding version 2.1]" Or linein = "[trick coding version 2.2]") Then

                If linein = "[trick coding version 2.1]" Then

                    settrickcodingversion(2.1)
                ElseIf linein = "[trick coding version 2.2]" Then
                    settrickcodingversion(2.2)
                Else
                    MsgBox("error opening file - please report this bug")

                End If




                trickdata = New ArrayList 'not neccesray (and wrong) to initialize becaue first few EEprom values stored in file

                If Me.currenttrickcodingversion = Me.TRICKCODINGVERSION_LINESONLY_PRE_20110310 Then
                    While (SR.Length > 0)

                        Dim value As Int16 = Asc(SR(0))
                        If SR.Length = 1 Then
                            SR = ""

                        Else
                            SR = SR(1)
                        End If

                        trickdata.Add(value)

                    End While


                ElseIf Me.currenttrickcodingversion = Me.TRICKCODINGVERSION_LINESONLY_CURRENT Then
                    While (SR.Length > 0)
                        If (SR.EndsWith(Constants.vbCrLf)) Then
                            SR = SR.Substring(0, SR.Length - 2)
                        End If

                        If (SR.EndsWith(Constants.vbCr)) Then
                            SR = SR.Substring(0, SR.Length - 1)
                        End If

                        If (SR.EndsWith(Constants.vbLf)) Then
                            SR = SR.Substring(0, SR.Length - 1)
                        End If

                        Dim valasstring As String = (SR(0)) & (SR(1)) '2 bytes 
                        trickdata.Add(Convert.ToInt16(valasstring, 16))

                        If SR.Length <= 2 Then
                            SR = ""
                        Else
                            SR = SR.Substring(2)
                        End If

                    End While


                End If



                If linein = "[trick coding version 2.1]" Then
                    'prompt to update file format

                    databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                    openoldfiledialog.ShowDialog()
                    databeinginternallymanipulated = True

                    If openoldfiledialog.DialogResult = Windows.Forms.DialogResult.Yes Then
                        'update
                        settrickcodingversion(TRICKCODINGVERSION_LINESONLY_CURRENT) '2.2
                        change = True

                    ElseIf openoldfiledialog.DialogResult = Windows.Forms.DialogResult.No Then
                        'don't update

                    ElseIf openoldfiledialog.DialogResult = Windows.Forms.DialogResult.Cancel Then

                        cancelopenfile(cancelopenfileflags.restoreStoredState)
                        refresh_demo()
                        databeinginternallymanipulated = False
                        Return False

                    Else
                        databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                        MsgBox("error opening file" + Constants.vbCrLf + "please report this bug")
                        databeinginternallymanipulated = True
                        cancelopenfile(cancelopenfileflags.restoreStoredState)
                        refresh_demo()
                        databeinginternallymanipulated = False
                        Return False


                    End If


                End If



                If Not tricks_datavalid() Then
                    databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                    MsgBox("Display patterns are corrupt" + Constants.vbCrLf + "default have been set")
                    databeinginternallymanipulated = True
                    tricks_set_default()


                End If
                If Not tricks_makecompatible_with_1_003() Then
                    'prompt goes here
                    databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                    attemptimporttrickswithunsupporteddata.ShowDialog()
                    databeinginternallymanipulated = True

                End If

            ElseIf (linein = "[trick coding version 1.2]") Then

                'this is an older file format this has very limited support on this version of Tiniwindow


                databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                openoldfiledialog.ShowDialog()
                databeinginternallymanipulated = True

                If openoldfiledialog.DialogResult = Windows.Forms.DialogResult.Yes Then
                    'update
                    settrickcodingversion(TRICKCODINGVERSION_LINESONLY_CURRENT)
                    change = True

                ElseIf openoldfiledialog.DialogResult = Windows.Forms.DialogResult.No Then
                    'don't update
                    settrickcodingversion(1.2)
                ElseIf openoldfiledialog.DialogResult = Windows.Forms.DialogResult.Cancel Then

                    cancelopenfile(cancelopenfileflags.restoreStoredState)
                    refresh_demo()
                    databeinginternallymanipulated = False
                    Return False

                Else
                    databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                    MsgBox("error opening file" + Constants.vbCrLf + "please report this bug")
                    databeinginternallymanipulated = True
                    cancelopenfile(cancelopenfileflags.restoreStoredState)
                    refresh_demo()
                    databeinginternallymanipulated = False
                    Return False


                End If

                While (True)

                    'there is no repetition
                    'the only purpose of the wile is to allow breaking out of the block if their is an error


                    'first line has active trick and the single parameter for trick 1
                    'second line has 3 parameters for trick 1


                    tricks_initialize()


                    If (SR.Length) < 0 Then
                        databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                        MsgBox("trick data in file is corrupt!")
                        databeinginternallymanipulated = True
                        tricks_set_default()
                        Exit While
                    End If


                    'get and store selected trick
                    'can not be set before appending tricks 
                    'because this would trip an error condition
                    Dim selectedtrickindex = SR(0)

                    If SR.Length <= 1 Then

                    Else
                        SR = SR.Substring(1)
                    End If


                    If (SR.Length) < 0 Then
                        databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                        MsgBox("trick data in file is corrupt!")
                        databeinginternallymanipulated = True
                        tricks_set_default()
                        Exit While
                    End If


                    'get and set trick 0
                    Dim tempactiveline As Integer = Asc(SR(0))
                    If SR.Length <= 1 Then
                        SR = ""
                    Else
                        SR = SR.Substring(1)
                    End If


                    If Not (tricks_append_showoneline(tempactiveline)) Then
                        databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                        MsgBox(tempactiveline.ToString + " there is an internal error appending trick 0" + Constants.vbCrLf + "please report the bug")
                        databeinginternallymanipulated = True
                        tricks_set_default()
                        Exit While
                    End If


                    If (SR(0) + (SR(1)) <> Constants.vbCrLf) Then

                        databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                        MsgBox("trick data in file is corrupt!")
                        databeinginternallymanipulated = True
                        tricks_set_default()
                        Exit While
                        'copytrickdata(oldtricks, tricks)

                        'Exit While
                    End If
                    If SR.Length <= 2 Then
                        SR = ""
                    Else
                        SR = SR.Substring(2)
                    End If

                    If (SR.Length) < 0 Then
                        databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                        MsgBox("trick data in file is corrupt!")
                        databeinginternallymanipulated = True
                        tricks_set_default()
                        Exit While
                    End If

                    'get and set trick 1
                    Dim temp_startline As Integer = Asc(SR(0))
                    SR = SR(1)
                    If (SR.Length) < 0 Then
                        databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                        MsgBox("trick data in file is corrupt!")
                        databeinginternallymanipulated = True
                        tricks_set_default()
                        Exit While
                    End If

                    Dim temp_linecount As Integer = Asc(SR(0))
                    SR = SR(1)
                    If (SR.Length) < 0 Then
                        databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                        MsgBox("trick data in file is corrupt!")
                        databeinginternallymanipulated = True
                        tricks_set_default()
                        Exit While
                    End If

                    Dim temp_time As Integer = Asc(SR(0))
                    If SR.Length <= 1 Then
                        SR = ""
                    Else
                        SR = SR.Substring(1)
                    End If


                    tricks_append_rotatethroughlines(temp_startline, temp_linecount, temp_time)



                    'If (Chr(SR.Read) + Chr(SR.Read) <> Constants.vbCrLf) Then
                    '    MsgBox("trick data in file is corrupt!")
                    '    tricks_set_default()
                    '    Exit While

                    '    'copytrickdata(oldtricks, tricks)

                    '    'Exit While
                    'End If

                    tricks_set_activetrick(selectedtrickindex)
                    Exit While
                End While


            ElseIf (linein = "[trick coding version 1]") Then

                Dim message As String = "Trick coding version 1 was used very early in R&D and is no longer supported" + Constants.vbCrLf
                message += "default tricks have been set"
                databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                MsgBox(message)
                databeinginternallymanipulated = True


                tricks_set_default()
                settrickcodingversion(TRICKCODINGVERSION_LINESONLY_CURRENT)

                change = True
                ''the file only contains data for trick 0 
                ''since this version was used very early in R&d and not released  
                ''files will be updated to version 1.2  
                'currenttrickcodingversion = DEFAULTTRICKCODINGVERSION
                'activetrick = SR.Read
                'Dim loopcounter = 1
                'While (loopcounter < tricktypecount)
                '    Dim loopcounter2 = 0


                '    Dim loop2max As Integer = tricks(loopcounter, tricks_2nd_demention_index.actualvalue).Count
                '    While (loopcounter2 < loop2max)
                '        Dim parameter As Int16 = SR.Read
                '        tricks(loopcounter, tricks_2nd_demention_index.actualvalue)(loopcounter2) = parameter
                '        loopcounter2 += 1
                '    End While

                '    If (Chr(SR.Read) + Chr(SR.Read) <> Constants.vbCrLf) Then
                '        MsgBox("trick data in file is corrupt!")
                '        copytrickdata(oldtricks, tricks)
                '        Exit While
                '    End If

                '    loopcounter += 1

                'End While


            ElseIf (linein.Substring(0, 21) = "[trick coding version") Then
                databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                attempttoopenfilewithunrecognizedtrickcodingversion.ShowDialog()
                databeinginternallymanipulated = True

                'gggggg'
                If (attempttoopenfilewithunrecognizedtrickcodingversion.DialogResult = Windows.Forms.DialogResult.Yes) Then
                    pan_filerestrictions.Visible = True
                    men_write_device.Enabled = False
                    settrickcodingversion(-1)
                    unrecognisedtrickdata = linein + Constants.vbCrLf + SR 'to end
                    SR = ""

                    mark_unselected(TB0)
                    mark_unselected(TB1)
                    mark_unselected(TB2)
                    mark_unselected(TB3)
                    mark_unselected(TB4)
                    mark_unselected(TB5)
                    mark_unselected(TB6)
                    mark_unselected(TB7)
                    mark_unselected(TB8)
                    mark_unselected(TB9)

                ElseIf (attempttoopenfilewithunrecognizedtrickcodingversion.DialogResult = Windows.Forms.DialogResult.OK) Then

                    tricks_set_default()
                    settrickcodingversion(TRICKCODINGVERSION_LINESONLY_CURRENT)

                    change = True


                ElseIf (attempttoopenfilewithunrecognizedtrickcodingversion.DialogResult = Windows.Forms.DialogResult.Retry) Then
                    cancelopenfile(cancelopenfileflags.restoreStoredState)
                    OpenFile()
                    databeinginternallymanipulated = True
                    refresh_demo()
                    databeinginternallymanipulated = False
                    Return False
                ElseIf (attempttoopenfilewithunrecognizedtrickcodingversion.DialogResult = Windows.Forms.DialogResult.Cancel) Then
                    cancelopenfile(cancelopenfileflags.restoreStoredState)
                    refresh_demo()
                    databeinginternallymanipulated = False
                    Return False


                End If

            Else

                'this section used to be reached when somthing other then trick data followed line 10
                'should never now be reached
                databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                MsgBox("error adfads in opening file" + Constants.vbCrLf + "Please report bug")
                databeinginternallymanipulated = True
            End If
        Else
            'file ends after 10 lines - ie no trick info

            'since no software was released with files containing no trick data, they will be updated to current version  
            settrickcodingversion(TRICKCODINGVERSION_LINESONLY_CURRENT)

        End If







        'done reading in file and tricks 



        If (currenttrickcodingversion <> -1) Then



            'check for discplay patters that have values that this version of TiniWindow does not support editing
            'trickcoding version of -1 means file is open with restrictions and unrecognized trick data written back verbatem


            'Dim unsupportedvaluesdetected As Boolean = False
            'Dim tricktypwalker As Integer = 0
            'Dim trickcount As Int16 = tricks_get_trickcount()

            'If trickcount > 2 Then
            '    unsupportedvaluesdetected = True
            'Else
            '    Dim loopcounter As Int16 = 0
            '    While loopcounter < trickcount
            '        If tricks_get_tricktype(loopcounter) <> 1 Then
            '            unsupportedvaluesdetected = True
            '        End If
            '    End While
            'End If




            'If (unsupportedvaluesdetected) Then

            '    attemptopenfilewithunsupporteddata.ShowDialog()
            '    If (attemptopenfilewithunsupporteddata.DialogResult = Windows.Forms.DialogResult.Yes) Then
            '        pan_filerestrictions.Visible = True
            '    ElseIf (attemptopenfilewithunsupporteddata.DialogResult = Windows.Forms.DialogResult.OK) Then

            '        tricktypwalker = 0
            '        While tricktypwalker < tricktypecount
            '            Dim second_demen_sionwalker As Integer = 0
            '            While second_demen_sionwalker < tricks(tricktypwalker, tricks_2nd_demention_index.controlltype).count

            '                If tricks(tricktypwalker, tricks_2nd_demention_index.controlltype)(second_demen_sionwalker) = controlltype.none Then

            '                    Dim valueinfile = tricks(tricktypwalker, tricks_2nd_demention_index.actualvalue)(second_demen_sionwalker)
            '                    Dim defaultvalue = defaulttricks(tricktypwalker, tricks_2nd_demention_index.actualvalue)(second_demen_sionwalker)
            '                    If valueinfile <> defaultvalue Then
            '                        tricks(tricktypwalker, tricks_2nd_demention_index.actualvalue)(second_demen_sionwalker) = defaulttricks(tricktypwalker, tricks_2nd_demention_index.actualvalue)(second_demen_sionwalker)

            '                    End If
            '                End If

            '                second_demen_sionwalker += 1
            '            End While
            '            tricktypwalker += 1
            '        End While
            '    ElseIf (attemptopenfilewithunsupporteddata.DialogResult = Windows.Forms.DialogResult.Retry) Then
            '        OpenFile()
            '        Return
            '    ElseIf (attemptopenfilewithunsupporteddata.DialogResult = Windows.Forms.DialogResult.Cancel) Then


            '        copytrickdata(oldtricks, tricks)


            '        activetrick = oldactivetrick

            '        CB_monitor_active_trick.SelectedIndex = activetrick
            '        currenttrickcodingversion = oldtrickcodingversion
            '        refresh_Pan_trick_parameters()
            '        Return

            '    End If


            '    'Pan_selectactivetrick2.Visible = False
            '    'Pan_trick_parameters.Visible = False
            '    'MsgBox("unsupportedvalues")
            'Else
            '    pan_filerestrictions.Visible = False
            '    'Pan_selectactivetrick2.Visible = True
            '    'Pan_trick_parameters.Visible = True
            'End If


        End If





        If longestlinelength > settings(settingsindex.linelength) Then
            'check for files with more characters then configuration allows

            'show mymessegbox with options to 
            ''truncate lines,
            ''cancle open
            ''keep extra characters as uneditable -not yet implimented


            Dim pressed_button As String = ""
            If settings(settingsindex.openfilewithtoomanycharsaction) = 2 Then
                'cancle opening
                refresh_demo()
                databeinginternallymanipulated = False
                Return False
            End If

            If settings(settingsindex.openfilewithtoomanycharsaction) = 0 Then
                'only prompt if this setting == 0

                Dim prompt As String = "you are attempting to open a file for " + longestlinelength.ToString + " light cards but TiniWindow is configured for " + settings(settingsindex.linelength).ToString + " cards" + Constants.vbCrLf

                prompt += "how do you wish to proced?" + Constants.vbCrLf


                If longestlinelength > MAX_LINELENGTH Then
                    'cancel opeinig file because it has more letters when this version of TinWindow supports
                    prompt = "you are attempting to open a file for " + longestlinelength.ToString + " light cards " + Constants.vbCrLf
                    prompt += "But this version of TinieWindow supports a maximum of " + MAX_LINELENGTH.ToString + " cards" + Constants.vbCrLf

                    databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                    MsgBox(prompt)
                    databeinginternallymanipulated = True
                    cancelopenfile(cancelopenfileflags.restoreStoredState)
                    refresh_demo()
                    databeinginternallymanipulated = False
                    Return False



                End If
                Dim letterstodiscard As Int16 = longestlinelength - settings(settingsindex.linelength)


                Dim controlls_array As ArrayList = New ArrayList

                controlls_array.Add(New ArrayList)
                controlls_array.Add(New ArrayList)
                controlls_array.Add(New ArrayList)


                controlls_array(mymsg.parameterArrayIndex.ControllType).add("button")
                controlls_array(mymsg.parameterArrayIndex.ControllValue).add("Discard first " + letterstodiscard.ToString + " letters")
                controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("beg")

                controlls_array(mymsg.parameterArrayIndex.ControllType).add("newrow")
                controlls_array(mymsg.parameterArrayIndex.ControllValue).add("")
                controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("")

                controlls_array(mymsg.parameterArrayIndex.ControllType).add("button")
                controlls_array(mymsg.parameterArrayIndex.ControllValue).add("Discard last " + letterstodiscard.ToString + " letters")
                controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("end")

                controlls_array(mymsg.parameterArrayIndex.ControllType).add("newrow")
                controlls_array(mymsg.parameterArrayIndex.ControllValue).add("")
                controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("")

                controlls_array(mymsg.parameterArrayIndex.ControllType).add("button")
                controlls_array(mymsg.parameterArrayIndex.ControllValue).add("configure TiniWindow for " + longestlinelength.ToString + "letters")
                controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("configure")
                controlls_array(mymsg.parameterArrayIndex.ControllType).add("newrow")
                controlls_array(mymsg.parameterArrayIndex.ControllValue).add("")
                controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("")

                controlls_array(mymsg.parameterArrayIndex.ControllType).add("button")
                controlls_array(mymsg.parameterArrayIndex.ControllValue).add("cancel")
                controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("cancel")


                'controlls_array(mymsg.parameterArrayIndex.ControllType).add("checkbox")
                'controlls_array(mymsg.parameterArrayIndex.ControllValue).add("alway do my selection")
                'controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("")
                databeinginternallymanipulated = False 'prevent tripping watchdog timmer

                Try

                    Dim return_array As ArrayList = _mymsg.showform(prompt, controlls_array)
                    databeinginternallymanipulated = True

                    pressed_button = return_array(mymsg.returnArrayIndex.button)(mymsg.returnArraySecondDimention.identifyer)

                    'If return_array(mymsg.returnArrayIndex.checkboxes)(mymsg.returnArraySecondDimention.index).count > 0 Then


                    '    If pressed_button = "truncate" Then
                    '        settings(settingsindex.openfilewithtoomanycharsaction) = 1

                    '    ElseIf pressed_button = "cancle" Then
                    '        settings(settingsindex.openfilewithtoomanycharsaction) = 2
                    '    End If
                    'End If


                    If pressed_button = "cancel" Then


                        cancelopenfile(cancelopenfileflags.restoreStoredState)
                        refresh_demo()
                        databeinginternallymanipulated = False
                        Return False


                    ElseIf pressed_button = "beg" Then
                        Dim currlinelength As Int16 = settings(settingsindex.linelength)

                        settings(settingsindex.linelength) = longestlinelength 'possible_to_view_file_in_easytab() won't work correctly otherwise
                        If possible_to_view_file_in_easytab() Then
                            settings(settingsindex.linelength) = currlinelength
                            set_linelenth(longestlinelength, line_configuration.add_or_truncate_position._end, True)
                            refresh_easy_tab()
                            set_linelenth(currlinelength, line_configuration.add_or_truncate_position._beginning, True)


                        Else
                            settings(settingsindex.linelength) = currlinelength
                            If longestlinelength <= MAX_LINELENGTH Then
                                set_linelenth(longestlinelength, line_configuration.add_or_truncate_position._end, False)
                            Else
                                set_linelenth(MAX_LINELENGTH, line_configuration.add_or_truncate_position._end, False)
                            End If

                            set_linelenth(currlinelength, line_configuration.add_or_truncate_position._beginning, False)
                        End If
                        change = True
                    ElseIf pressed_button = "end" Then
                        Dim currlinelength As Int16 = settings(settingsindex.linelength)

                        settings(settingsindex.linelength) = longestlinelength 'possible_to_view_file_in_easytab() won't work correctly otherwise
                        If possible_to_view_file_in_easytab() And longestlinelength <= MAX_LINELENGTH Then

                            settings(settingsindex.linelength) = currlinelength
                            If Not set_linelenth(longestlinelength, line_configuration.add_or_truncate_position._end, True) Then
                                Dim junk



                            End If

                            If Not refresh_easy_tab() Then
                                Dim junk
                            End If
                            If Not set_linelenth(longestlinelength, line_configuration.add_or_truncate_position._end, True) Then

                                Dim junk

                            End If


                        Else
                            settings(settingsindex.linelength) = currlinelength
                            If longestlinelength <= MAX_LINELENGTH Then
                                set_linelenth(longestlinelength, line_configuration.add_or_truncate_position._end, False)
                            Else
                                set_linelenth(MAX_LINELENGTH, line_configuration.add_or_truncate_position._end, False)
                            End If

                            set_linelenth(currlinelength, line_configuration.add_or_truncate_position._end, False)




                        End If
                        change = True
                    ElseIf pressed_button = "configure" Then


                        If possible_to_view_file_in_easytab() Then

                            set_linelenth(longestlinelength, line_configuration.add_or_truncate_position._end, True)


                        Else
                            set_linelenth(longestlinelength, line_configuration.add_or_truncate_position._end, False)

                        End If
                    Else
                        databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                        MsgBox("bug - no selection made?")
                        databeinginternallymanipulated = True
                    End If


                Catch ex As Exception
                    'mymsg does not work when this function is marshaled while opening a file via server

                    'for now just configure TiniWindow
                    If possible_to_view_file_in_easytab() Then

                        set_linelenth(longestlinelength, line_configuration.add_or_truncate_position._end, True)


                    Else
                        set_linelenth(longestlinelength, line_configuration.add_or_truncate_position._end, False)

                    End If

                End Try

            End If

        ElseIf longestlinelength < settings(settingsindex.linelength) Then
            Me.set_linelenth(longestlinelength, line_configuration.add_or_truncate_position._end, , False)

        End If




        '    If settings(settingsindex.openfilewithtoomanycharsaction) = 1 Or pressed_button = "truncate" Then
        '        'truncate if they select or if the settings says to do so with out prompting
        '        change = True
        '        Dim loopcounter As Integer = 0
        '        While loopcounter < textdata.Count
        '            If textdata(loopcounter).length > linelength Then
        '                textdata(loopcounter) = textdata(loopcounter).Substring(0, linelength)
        '            End If
        '            loopcounter += 1
        '        End While


        '    End If
        '    '(returnArrayIndex.checkboxes)(returnArraySecondDimention.index)

        'End If
                

        If linecount > MAXLINES Then
            Me.set_linecount(MAXLINES, line_configuration.add_or_truncate_position._end)
        End If

    End Function


    'Private Sub OpenFile(ByVal passed_filename As String)

    '    'this function does not work because it has not been updated for many versions 


    '    Dim longestlinelength As Int16 = 0
    '    'Dim result As Integer
    '    Dim linein1 As String = ""
    '    Dim linein2 As String = ""
    '    Dim linein3 As String = ""
    '    Dim linein4 As String = ""
    '    Dim linein5 As String = ""
    '    Dim linein6 As String = ""
    '    Dim linein7 As String = ""
    '    Dim linein8 As String = ""
    '    Dim linein9 As String = ""
    '    Dim linein10 As String = ""

    '    Dim trickline As String = ""
    '    Dim temptrickparameters As ArrayList = New ArrayList
    '    Dim dummyline As String = ""
    '    'used to see if there are too many lines in file
    '    Dim FileNameHolder As String
    '    Dim linetoolong As Boolean = False
    '    Dim toofewlines As Boolean = False
    '    Dim toomanylines As Boolean = False
    '    Dim path As String 'copied functioanlity  changes the default path 
    '    'making the program not find the help file



    '    Dim oldtricks(tricktypecount - 1, 8)

    '    copytrickdata(tricks, oldtricks)

    '    With OFD



    '        'Path is saved because some of the functionality copied from other openfile functions
    '        'changes the default directory, preventing the help file from being found

    '        path = IO.Directory.GetCurrentDirectory
    '        pathofopenfile = userdata(userdataindex.OpenFilePath) 'used in timer_update_footer
    '        FileNameHolder = passed_filename


    '        If (fileistrickfile(FileNameHolder)) Then

    '            If (settings(settingsindex.opentrickfileaction) = opentrickfileaction_value.showdialog) Then

    '                Dim myform As attepttoopentrickfileasdata_form = New attepttoopentrickfileasdata_form

    '                myform.ShowDialog()
    '                If myform.DialogResult = Windows.Forms.DialogResult.Cancel Then

    '                    IO.Directory.SetCurrentDirectory(path)
    '                    Return
    '                ElseIf myform.DialogResult = Windows.Forms.DialogResult.Retry Then
    '                    IO.Directory.SetCurrentDirectory(path)
    '                    OpenFile()
    '                    Return
    '                ElseIf myform.DialogResult = Windows.Forms.DialogResult.Yes Then
    '                    IO.Directory.SetCurrentDirectory(path)
    '                    importtricks(FileNameHolder)
    '                    Return
    '                Else
    '                    'open as datafile
    '                End If
    '            ElseIf (settings(settingsindex.opentrickfileaction) = opentrickfileaction_value.pickanotherfile) Then
    '                Dim message As String = "you have selected a file used for importing and exporting tricks" + Constants.vbCrLf
    '                message += "please select another file" + Constants.vbCrLf

    '                message += Constants.vbCrLf + "If you are certain this is a data file, you may change settings in order to open it "
    '                MsgBox(message)
    '                IO.Directory.SetCurrentDirectory(path)
    '                OpenFile()
    '                Return
    '            ElseIf (settings(settingsindex.opentrickfileaction) = opentrickfileaction_value.cancel) Then
    '                Dim message As String = "open file operation canceled" + Constants.vbCrLf
    '                message += "you have selected a file used for importing and exporting tricks" + Constants.vbCrLf

    '                message += Constants.vbCrLf + "If you do not like having the open file dialog canceled" + Constants.vbCrLf

    '                message += "you may change the settings "
    '                MsgBox(message)
    '                IO.Directory.SetCurrentDirectory(path)
    '                Return
    '            ElseIf (settings(settingsindex.opentrickfileaction) = opentrickfileaction_value.import) Then
    '                IO.Directory.SetCurrentDirectory(path)
    '                importtricks(FileNameHolder)
    '                Return
    '            ElseIf (settings(settingsindex.opentrickfileaction) = opentrickfileaction_value.openasdatafile) Then
    '                'continue the rest of this function 
    '            Else
    '                'setting error
    '                'show dialog 
    '                Dim myform As attepttoopentrickfileasdata_form = New attepttoopentrickfileasdata_form

    '                myform.ShowDialog()
    '                If myform.DialogResult = Windows.Forms.DialogResult.Cancel Then

    '                    IO.Directory.SetCurrentDirectory(path)
    '                    Return
    '                ElseIf myform.DialogResult = Windows.Forms.DialogResult.Retry Then
    '                    IO.Directory.SetCurrentDirectory(path)
    '                    OpenFile()
    '                    Return
    '                ElseIf myform.DialogResult = Windows.Forms.DialogResult.Yes Then
    '                    IO.Directory.SetCurrentDirectory(path)
    '                    importtricks(FileNameHolder)
    '                    Return
    '                Else
    '                    'open as datafile
    '                End If
    '            End If



    '        End If


    '        If (InMonitorMode) Then
    '            ConfirmOpenFileInMonitorMode.ShowDialog()
    '            If ConfirmOpenFileInMonitorMode.DialogResult = Windows.Forms.DialogResult.Yes Then
    '                'remain in monitor mode and open file
    '            ElseIf ConfirmOpenFileInMonitorMode.DialogResult = Windows.Forms.DialogResult.No Then
    '                showEdit()

    '            Else
    '                Return

    '            End If

    '        End If



    '        Dim SR As IO.StreamReader = IO.File.OpenText(FileNameHolder)
    '        deviceandmemorymatch = False
    '        If (Not readline(SR, linein1)) Then
    '            'if it doesnt read at least one line it sais file is corrupt

    '            MsgBox("File '" + FileNameHolder + "is corrupt!")
    '            SR.Close()
    '            Return
    '        End If
    '        If (Not readline(SR, linein2)) Then
    '            toofewlines = True
    '        End If
    '        If (Not readline(SR, linein3)) Then
    '            toofewlines = True
    '        End If
    '        If (Not readline(SR, linein4)) Then
    '            toofewlines = True
    '        End If
    '        If (Not readline(SR, linein5)) Then
    '            toofewlines = True
    '        End If
    '        If (Not readline(SR, linein6)) Then
    '            toofewlines = True

    '        End If
    '        If (Not readline(SR, linein7)) Then
    '            toofewlines = True
    '        End If
    '        If (Not readline(SR, linein8)) Then
    '            toofewlines = True
    '        End If
    '        If (Not readline(SR, linein9)) Then
    '            toofewlines = True
    '        End If
    '        If (Not readline(SR, linein10)) Then
    '            toofewlines = True
    '        End If


    '        If readline(SR, trickline) Then
    '            'MsgBox("[" + trickline + "]")
    '            If (trickline = "[trick coding version 1.2]") Then
    '                currenttrickcodingversion = 1.2
    '                activetrick = SR.Read
    '                CB_monitor_active_trick.SelectedIndex = activetrick
    '                Dim loopcounter = 0
    '                While (loopcounter < tricktypecount)
    '                    Dim loopcounter2 = 0


    '                    Dim loop2max As Integer = tricks(loopcounter, tricks_2nd_demention_index.actualvalue).Count
    '                    While (loopcounter2 < loop2max)
    '                        Dim parameter As Int16 = SR.Read
    '                        tricks(loopcounter, tricks_2nd_demention_index.actualvalue)(loopcounter2) = parameter
    '                        loopcounter2 += 1
    '                    End While
    '                    If (SR.Peek < 0) Then
    '                        Exit While
    '                    End If
    '                    If (Chr(SR.Read) + Chr(SR.Read) <> Constants.vbCrLf) Then
    '                        MsgBox("trick data in file is corrupt!")
    '                        copytrickdata(oldtricks, tricks)
    '                        Exit While
    '                    End If
    '                    If (SR.Peek < 0) Then
    '                        Exit While
    '                    End If
    '                    loopcounter += 1

    '                End While


    '            ElseIf (trickline = "[trick coding version 1]") Then
    '                'the file only contains data for trick 1 
    '                'since no software was released with version 1 files will be updated to current version  
    '                currenttrickcodingversion = TRICKCODINGVERSION_LINESONLY_CURRENT
    '                activetrick = SR.Read
    '                Dim loopcounter = 1
    '                While (loopcounter < tricktypecount)
    '                    Dim loopcounter2 = 0


    '                    Dim loop2max As Integer = tricks(loopcounter, tricks_2nd_demention_index.actualvalue).Count
    '                    While (loopcounter2 < loop2max)
    '                        Dim parameter As Int16 = SR.Read
    '                        tricks(loopcounter, tricks_2nd_demention_index.actualvalue)(loopcounter2) = parameter
    '                        loopcounter2 += 1
    '                    End While

    '                    If (Chr(SR.Read) + Chr(SR.Read) <> Constants.vbCrLf) Then
    '                        MsgBox("trick data in file is corrupt!")
    '                        copytrickdata(oldtricks, tricks)
    '                        Exit While
    '                    End If

    '                    loopcounter += 1

    '                End While


    '            ElseIf (trickline.Substring(0, 21) = "[trick coding version") Then
    '                currenttrickcodingversion = -1
    '                Dim message As String
    '                message = "This file stores trick data using unrecognized trick coding version " + (trickline.Substring(21, trickline.Length - 22)) + Constants.vbCrLf
    '                message += "File is opened for editing string data only" + Constants.vbCrLf
    '                message += "Because the coding is not recognized, the tricks can not be used or modified."
    '                MsgBox(message)

    '                unrecognisedtrickdata = trickline + Constants.vbCrLf + SR.ReadToEnd

    '            Else
    '                ''somthing other then trick data follows line 10
    '                currenttrickcodingversion = 1.2
    '                toomanylines = True
    '            End If
    '        Else
    '            'file ends after 10 lines - ie no trick info

    '            'since no software was released with files containing no trick data, they will be updated to current version  
    '            currenttrickcodingversion = TRICKCODINGVERSION_LINESONLY_CURRENT

    '        End If




    '        SR.Close()
    '        IO.Directory.SetCurrentDirectory(path)

    '        '.Dispose()
    '        longestlinelength = linein1.Length()

    '        If linein2.Length() > longestlinelength Then
    '            longestlinelength = linein2.Length()
    '        End If
    '        If linein3.Length() > longestlinelength Then
    '            longestlinelength = linein3.Length()
    '        End If
    '        If linein4.Length() > longestlinelength Then
    '            longestlinelength = linein4.Length()
    '        End If
    '        If linein5.Length() > longestlinelength Then
    '            longestlinelength = linein5.Length()
    '        End If
    '        If linein6.Length() > longestlinelength Then
    '            longestlinelength = linein6.Length()
    '        End If
    '        If linein7.Length() > longestlinelength Then
    '            longestlinelength = linein7.Length()
    '        End If
    '        If linein8.Length() > longestlinelength Then
    '            longestlinelength = linein8.Length()
    '        End If
    '        If linein9.Length() > longestlinelength Then
    '            longestlinelength = linein9.Length()
    '        End If
    '        If linein10.Length() > longestlinelength Then
    '            longestlinelength = linein10.Length()
    '        End If


    '        If longestlinelength > settings(settingsindex.linelength) Then
    '            'show mymessegbox with options to 
    '            ''truncate lines,
    '            ''cancle open
    '            ''keep extra characters as uneditable -not yet implimented


    '            Dim pressed_button As String = ""
    '            If settings(settingsindex.openfilewithtoomanycharsaction) = 2 Then
    '                'cancle opening
    '                Return
    '            End If

    '            If settings(settingsindex.openfilewithtoomanycharsaction) = 0 Then
    '                'only prompt if this setting == 0
    '                Dim prompt As String = "you are attempting to opening " + longestlinelength.ToString + "-character file with a " + settings(settingsindex.linelength).ToString + "-character version of TiniWindow" + Constants.vbCrLf

    '                prompt += "how do you wish to proced?" + Constants.vbCrLf


    '                Dim controlls_array As ArrayList = New ArrayList

    '                controlls_array.Add(New ArrayList)
    '                controlls_array.Add(New ArrayList)
    '                controlls_array.Add(New ArrayList)

    '                controlls_array(mymsg.parameterArrayIndex.ControllType).add("button")
    '                controlls_array(mymsg.parameterArrayIndex.ControllValue).add("truncate extra characters")
    '                controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("truncate")

    '                controlls_array(mymsg.parameterArrayIndex.ControllType).add("button")
    '                controlls_array(mymsg.parameterArrayIndex.ControllValue).add("cancle")
    '                controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("cancle")

    '                controlls_array(mymsg.parameterArrayIndex.ControllType).add("carraigenewrow")
    '                controlls_array(mymsg.parameterArrayIndex.ControllValue).add("")
    '                controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("")

    '                controlls_array(mymsg.parameterArrayIndex.ControllType).add("checkbox")
    '                controlls_array(mymsg.parameterArrayIndex.ControllValue).add("alway do my selection")
    '                controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("")

    '                Dim return_array As ArrayList = mymsg.showform(prompt, controlls_array)

    '                pressed_button = return_array(mymsg.returnArrayIndex.button)(mymsg.returnArraySecondDimention.identifyer)

    '                If return_array(mymsg.returnArrayIndex.checkboxes)(mymsg.returnArraySecondDimention.index).count > 0 Then


    '                    If pressed_button = "truncate" Then
    '                        settings(settingsindex.openfilewithtoomanycharsaction) = 1

    '                    ElseIf pressed_button = "cancle" Then
    '                        settings(settingsindex.openfilewithtoomanycharsaction) = 2
    '                    End If
    '                End If


    '                If pressed_button = "cancle" Then
    '                    databeinginternallymanipulated = False
    '                    Return



    '                End If

    '            End If



    '            If settings(settingsindex.openfilewithtoomanycharsaction) = 1 Or pressed_button = "truncate" Then
    '                'truncate if they select or if the settings says to do so with out prompting
    '                change = True


    '                If (linein1.Length > settings(settingsindex.linelength)) Then
    '                    linein1 = linein1.Substring(0, settings(settingsindex.linelength))
    '                End If

    '                If (linein2.Length > settings(settingsindex.linelength)) Then
    '                    linein2 = linein2.Substring(0, settings(settingsindex.linelength))
    '                End If

    '                If (linein3.Length > settings(settingsindex.linelength)) Then
    '                    linein3 = linein3.Substring(0, settings(settingsindex.linelength))
    '                End If

    '                If (linein4.Length > settings(settingsindex.linelength)) Then
    '                    linein4 = linein4.Substring(0, settings(settingsindex.linelength))
    '                End If

    '                If (linein5.Length > settings(settingsindex.linelength)) Then
    '                    linein5 = linein5.Substring(0, settings(settingsindex.linelength))
    '                End If

    '                If (linein6.Length > settings(settingsindex.linelength)) Then
    '                    linein6 = linein6.Substring(0, settings(settingsindex.linelength))
    '                End If

    '                If (linein7.Length > settings(settingsindex.linelength)) Then
    '                    linein7 = linein7.Substring(0, settings(settingsindex.linelength))
    '                End If

    '                If (linein8.Length > settings(settingsindex.linelength)) Then
    '                    linein8 = linein8.Substring(0, settings(settingsindex.linelength))
    '                End If

    '                If (linein9.Length > settings(settingsindex.linelength)) Then
    '                    linein9 = linein9.Substring(0, settings(settingsindex.linelength))
    '                End If

    '                If (linein10.Length > settings(settingsindex.linelength)) Then
    '                    linein10 = linein10.Substring(0, settings(settingsindex.linelength))
    '                End If


    '            End If
    '            '(returnArrayIndex.checkboxes)(returnArraySecondDimention.index)

    '        End If


    '        If (InMonitorMode) Then
    '            InMonitorMode = False

    '            TB0.Text = linein1
    '            TB1.Text = linein2
    '            TB2.Text = linein3
    '            TB3.Text = linein4
    '            TB4.Text = linein5
    '            TB5.Text = linein6
    '            TB6.Text = linein7
    '            TB7.Text = linein8
    '            TB8.Text = linein9
    '            TB9.Text = linein10
    '            progresform_AutoCloseAtCompletion = True

    '            progresform_process = "write" 'used with cancle
    '            'myprogressform.setheader("Sending data to device")

    '            backgroundworkerdebugvalue = "00"
    '            BGW_write_device.RunWorkerAsync()


    '            oldprogress_form.ShowDialog()


    '            If (progresform_cancel) Then
    '                MsgBox("you are no longer in monitor mode")
    '                showEdit()
    '            Else
    '                InMonitorMode = True
    '            End If

    '        Else
    '            TB0.Text = linein1
    '            TB1.Text = linein2
    '            TB2.Text = linein3
    '            TB3.Text = linein4
    '            TB4.Text = linein5
    '            TB5.Text = linein6
    '            TB6.Text = linein7
    '            TB7.Text = linein8
    '            TB8.Text = linein9
    '            TB9.Text = linein10
    '            FileName = FileNameHolder
    '            Me.Text = labletext + " : "

    '            If (FileNameHolder.IndexOf("\") > 0) Then
    '                FileNameHolder = FileNameHolder.Substring(FileNameHolder.LastIndexOf("\") + 1)

    '            End If
    '            If (FileNameHolder.IndexOf("/") > 0) Then
    '                FileNameHolder = FileNameHolder.Substring(FileNameHolder.LastIndexOf("/") + 1)

    '            End If

    '            Me.Text += FileNameHolder
    '            men_make_default.Enabled = True

    '        End If

    '    End With
    '    'note no error is giving if the file has too few lines. 
    '    'the remaining lines are simply left blank on the form

    '    Dim errormessage As String = ""
    '    If (toofewlines And toomanylines) Then
    '        errormessage = "There seems to be a programing bug reading the file"
    '    Else
    '        errormessage += "The file has been modified outside this program" + Constants.vbCrLf
    '        If (toomanylines) Then
    '            errormessage += "There are more then 10 lines. Extra lines have been truncated" + Constants.vbCrLf
    '        End If
    '        If (linetoolong) Then
    '            errormessage += "There are lines with more then 20 letters. Extra letters have been truncated" + Constants.vbCrLf
    '        End If
    '    End If

    '    If (toomanylines Or linetoolong) Then
    '        MsgBox(errormessage)
    '    Else
    '        change = False
    '        'change is a global variable used to propt user to save file 
    '        'before closing it
    '    End If
    '    refresh_Pan_trick_parameters()
    '    simulator_form._refresh()
    '    refresh_demo()
    'End Sub

    Public Enum cancelopenfileflags
        restoreStoredState
        saveCurrentState

    End Enum
    'cancelopenfil(cancelopenfileflags.)

    Public Sub cancelopenfile(ByVal flag As Int16)
        Static storedtextdata As ArrayList
        Static storedtrickdata As ArrayList

        Static storedlinecount As Int16
        Static storedlinelength As Int16

        Static storedmetext As String = Me.Text
        Static storedopenfilepath
        Static storedchange
        If flag = cancelopenfileflags.saveCurrentState Then
            Dim loopcounter = 0
            storedlinecount = linecount
            storedlinelength = settings(settingsindex.linelength)
            storedopenfilepath = userdata(userdataindex.OpenFilePath)
            storedtextdata = New ArrayList
            While loopcounter < textdata.Count
                storedtextdata.Add(textdata(loopcounter))
                loopcounter += 1
            End While

            loopcounter = 0
            storedtrickdata = New ArrayList

            While loopcounter < trickdata.Count
                storedtrickdata.Add(trickdata(loopcounter))
                loopcounter += 1
            End While
            storedchange = change
        ElseIf flag = cancelopenfileflags.restoreStoredState Then
            Dim loopcounter = 0
            linecount = storedlinecount
            'LINELENGTH = storedlinelength
            userdata(userdataindex.OpenFilePath) = storedopenfilepath
            textdata = New ArrayList
            While loopcounter < storedtextdata.Count
                textdata.Add(storedtextdata(loopcounter))
                loopcounter += 1
            End While

            loopcounter = 0
            trickdata = New ArrayList

            While loopcounter < storedtrickdata.Count
                trickdata.Add(storedtrickdata(loopcounter))
                loopcounter += 1
            End While

            change = storedchange

        End If

    End Sub
    Private Sub settrickcodingversion(ByVal version As Single)

        currenttrickcodingversion = version

        If version = Convert.ToSingle(3.1) Then

            MsgBox("Error: This version of TiniWindow does not support trick coding version 3.1" & Constants.vbCrLf & "updated to version 3.2")

            currenttrickcodingversion = 3.2

            LineConfigurationToolStripMenuItem.Enabled = True

        ElseIf version = Convert.ToSingle(2.1) Or version = Convert.ToSingle(3.2) Then
            LineConfigurationToolStripMenuItem.Enabled = True
        ElseIf version = Convert.ToSingle(1.2) Then
            LineConfigurationToolStripMenuItem.Enabled = False
        ElseIf version = Convert.ToSingle(-1) Then
            'the assumption is that all future versions will allow line configuration  
            LineConfigurationToolStripMenuItem.Enabled = True
        End If

    End Sub

    Private Sub OpenFile()
        'save current file state in case open file is cancled
        cancelopenfile(cancelopenfileflags.saveCurrentState)


        databeinginternallymanipulated = True
        Timer_demo.Stop()

        Dim longestlinelength As Int16 = 0
        Dim result As Integer
        Dim linein As String = ""

        'Dim trickline As String = ""
        'Dim temptrickparameters As ArrayList = New ArrayList
        'Dim dummyline As String = ""
        'used to see if there are too many lines in file
        Dim FileNameHolder As String
        Dim linetoolong As Boolean = False
        Dim toofewlines As Boolean = False
        Dim toomanylines As Boolean = False
        Dim path As String 'the file diolog box changes the default path 
        'making the program not find the help file




        change = False 'a global variable used to prompt for saving file
        'may be set true elsewhere in this function

        men_write_device.Enabled = True 'enabled here so that it is enabled by default
        With OFD

            .Reset() 'changing the initial directory doesnt work otherwise
            .Filter = filter


            'the .ShowDialog function reset the path which needs to be restored in order for hep userdata and settings to be
            'written and read correctly. also I am saving the selected directory in user data file so that the dialog box will
            'open to the same path
            path = IO.Directory.GetCurrentDirectory
            IO.Directory.SetCurrentDirectory(userdata(userdataindex.OpenFilePath))

            .InitialDirectory = userdata(userdataindex.OpenFilePath)

            databeinginternallymanipulated = False 'prevent tripping watchdog timmer
            result = .ShowDialog
            databeinginternallymanipulated = True

            userdata(userdataindex.OpenFilePath) = IO.Directory.GetCurrentDirectory

            If result = Windows.Forms.DialogResult.Cancel Then
                cancelopenfile(cancelopenfileflags.restoreStoredState)
                IO.Directory.SetCurrentDirectory(path)
                refresh_demo()
                databeinginternallymanipulated = False
                Return
            End If
            pathofopenfile = IO.Directory.GetCurrentDirectory 'used in timer_update_footer
            FileNameHolder = .FileName
            IO.Directory.SetCurrentDirectory(path)
            If (fileistrickfile(FileNameHolder)) Then


                If (settings(settingsindex.opentrickfileaction) = opentrickfileaction_value.showdialog) Then

                    'TB_beginners_help.Clear()
                    appendrichtext("The file you are opening appears to be an exported display pattern file." + Constants.vbCrLf, 12, FontStyle.Bold)

                    appendrichtext(Constants.vbCrLf + "This type of file does not contain any text - only display pattern data " + Constants.vbCrLf, 10, FontStyle.Bold)
                    appendrichtext(Constants.vbCrLf + "To import this display patter press 'import'  " + Constants.vbCrLf + Constants.vbCrLf, 9)
                    appendrichtext("If you are certain it is a regular data file, press 'open as datafile " + Constants.vbCrLf + Constants.vbCrLf, 9)
                    appendrichtext("To select another file to open, press 'Pick another file" + Constants.vbCrLf + Constants.vbCrLf, 9)
                    appendrichtext("To quit with out opening or inporting anything, press 'cancel'" + Constants.vbCrLf + Constants.vbCrLf, 9)

                    Dim myform As attepttoopentrickfileasdata_form = New attepttoopentrickfileasdata_form
                    databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                    myform.ShowDialog()
                    databeinginternallymanipulated = True
                    If myform.DialogResult = Windows.Forms.DialogResult.Cancel Then
                        cancelopenfile(cancelopenfileflags.restoreStoredState)
                        IO.Directory.SetCurrentDirectory(path)

                        refresh_demo()
                        databeinginternallymanipulated = False
                        Return
                    ElseIf myform.DialogResult = Windows.Forms.DialogResult.Retry Then
                        IO.Directory.SetCurrentDirectory(path)
                        OpenFile()
                        databeinginternallymanipulated = True
                        refresh_demo()
                        databeinginternallymanipulated = False
                        Return
                    ElseIf myform.DialogResult = Windows.Forms.DialogResult.Yes Then
                        IO.Directory.SetCurrentDirectory(path)
                        importtricks(FileNameHolder)
                        refresh_demo()
                        databeinginternallymanipulated = False
                        Return
                    Else
                        'open as datafile
                    End If
                ElseIf (settings(settingsindex.opentrickfileaction) = opentrickfileaction_value.pickanotherfile) Then
                    Dim message As String = "you have selected a file used for importing and exporting display patterns" + Constants.vbCrLf


                    message += "please select another file" + Constants.vbCrLf

                    message += Constants.vbCrLf + "If you are certain this is a data file, you may change settings in order to open it "
                    'TB_beginners_help.Clear()
                    appendrichtext("The file you are opening appears to be an exported display pattern file." + Constants.vbCrLf, 12, FontStyle.Bold)
                    appendrichtext(Constants.vbCrLf + "This type of file does not contain any text - only display pattern data " + Constants.vbCrLf, 10, FontStyle.Bold)

                    appendrichtext("Your current setting specify to prompt you to open another file " + Constants.vbCrLf + Constants.vbCrLf, 9)
                    appendrichtext("These setting can be changed" + Constants.vbCrLf + Constants.vbCrLf, 9)
                    databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                    MsgBox(message)
                    databeinginternallymanipulated = True
                    showmainhelp()
                    IO.Directory.SetCurrentDirectory(path)
                    OpenFile()
                    databeinginternallymanipulated = True
                    refresh_demo()
                    databeinginternallymanipulated = False
                    Return
                ElseIf (settings(settingsindex.opentrickfileaction) = opentrickfileaction_value.cancel) Then
                    Dim message As String = "open file operation canceled" + Constants.vbCrLf
                    message += "you have selected a file used for importing and exporting tricks" + Constants.vbCrLf


                    'TB_beginners_help.Clear()
                    appendrichtext("The file you are opening appears to be an exported display pattern file." + Constants.vbCrLf, 12, FontStyle.Bold)
                    appendrichtext(Constants.vbCrLf + "This type of file does not contain any text - only display pattern data " + Constants.vbCrLf, 10, FontStyle.Bold)

                    appendrichtext("Your current setting specify to cancel open file " + Constants.vbCrLf + Constants.vbCrLf, 9)
                    appendrichtext("These setting can be changed" + Constants.vbCrLf + Constants.vbCrLf, 9)

                    databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                    MsgBox(message)
                    databeinginternallymanipulated = True
                    showmainhelp()
                    IO.Directory.SetCurrentDirectory(path)
                    cancelopenfile(cancelopenfileflags.restoreStoredState)
                    refresh_demo()
                    databeinginternallymanipulated = False
                    Return
                ElseIf (settings(settingsindex.opentrickfileaction) = opentrickfileaction_value.import) Then
                    'TB_beginners_help.Clear()
                    appendrichtext("The file you 'opened' is an exported display pattern file and contains no text  " + Constants.vbCrLf, 12, FontStyle.Bold)
                    appendrichtext("Your current setting specify to import the display pattern without any  prompting " + Constants.vbCrLf + Constants.vbCrLf, 9)
                    appendrichtext("These setting can be changed" + Constants.vbCrLf + Constants.vbCrLf, 9)
                    IO.Directory.SetCurrentDirectory(path)
                    importtricks(FileNameHolder)
                    showmainhelp(False)
                    refresh_demo()
                    databeinginternallymanipulated = False
                    Return
                ElseIf (settings(settingsindex.opentrickfileaction) = opentrickfileaction_value.openasdatafile) Then
                    'continue the rest of this function 
                Else
                    'setting error
                    'show dialog 
                    Dim myform As attepttoopentrickfileasdata_form = New attepttoopentrickfileasdata_form

                    databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                    myform.ShowDialog()
                    databeinginternallymanipulated = True
                    If myform.DialogResult = Windows.Forms.DialogResult.Cancel Then

                        IO.Directory.SetCurrentDirectory(path)
                        refresh_demo()
                        databeinginternallymanipulated = False
                        Return
                    ElseIf myform.DialogResult = Windows.Forms.DialogResult.Retry Then
                        IO.Directory.SetCurrentDirectory(path)
                        OpenFile()

                        databeinginternallymanipulated = True
                        refresh_demo()
                        databeinginternallymanipulated = False
                        Return
                    ElseIf myform.DialogResult = Windows.Forms.DialogResult.Yes Then
                        IO.Directory.SetCurrentDirectory(path)
                        importtricks(FileNameHolder)
                        refresh_demo()
                        databeinginternallymanipulated = False
                        Return
                    Else
                        'open as datafile
                    End If
                End If



            End If

            '20110313 removed code pertaining to monitor mode

        End With


        Dim sr As IO.StreamReader = New IO.StreamReader(FileNameHolder)
        Dim filecontents = sr.ReadToEnd

        ProcessFileContents(filecontents)





        '20110313 removed code pertaining to monitor mode

            textdata_top()
        FileName = FileNameHolder

        Me.Text = labletext + " : "
        If (FileNameHolder.IndexOf("\") > 0) Then
            FileNameHolder = FileNameHolder.Substring(FileNameHolder.LastIndexOf("\") + 1)

        End If
        If (FileNameHolder.IndexOf("/") > 0) Then
            FileNameHolder = FileNameHolder.Substring(FileNameHolder.LastIndexOf("/") + 1)

        End If

        Me.Text += FileNameHolder


        'men_make_default.Enabled = True


   
        'note no error is giving if the file has too few lines. 
        'the remaining lines are simply left blank on the form

        Dim errormessage As String = ""



        'change is a global variable used to propt user to save file 
        'before closing it

        If (currenttrickcodingversion <> -1) Then
            'refresh_Pan_trick_parameters()
            refresh_trickcontrols()


        End If

        enable_savefile()

        simulator_form._refresh()
        refresh_demo()

        If TabControl1.SelectedTab Is Tab_Easy Then
            'if the easy tab is open but this file can not be displayed on it 
            'the advance tab is activated.
            If Not refresh_easy_tab() Then
                TabControl1.SelectedTab = Tab_Lines
            End If
        End If
        If TabControl1.SelectedTab Is Tab_Lines Or TabControl1.SelectedTab Is Tab_FreeStyle Then
            'this section saves or clears data for discarding recent changes in order to switch back to easy tab 
            change_Lbl_pattern_type()

            If Me.possible_to_view_file_in_easytab Then
                refresh_easy_tab()
                dialog_unable_to_display_easy_tab.backupfile(dialog_unable_to_display_easy_tab.backupfileflags.saveCurrentState)
            Else
                dialog_unable_to_display_easy_tab.backupfile(dialog_unable_to_display_easy_tab.backupfileflags.clear)
            End If
            Me.refresh_freestyle_text()


        End If


        NUD_linestab_liinecounts.Value = linecount
        databeinginternallymanipulated = False






        IO.Directory.SetCurrentDirectory(path)

    End Sub
    Private Function saveAs() As Boolean
        Dim result As Boolean = True
        Dim answer As DialogResult
        Dim path As String 'the file diolog box changes the default path 
        'making the program not find the help file
        With SFD
            .Reset() 'changing the initial directory doesnt work otherwise
            .Filter = filter

            'the .ShowDialog function reset the path which needs to be restored in order for hep userdata and settings to be
            'written and read correctly. also I am saving the selected directory in user data file so that the dialog box will
            'open to the same path

            path = IO.Directory.GetCurrentDirectory



            IO.Directory.SetCurrentDirectory(userdata(userdataindex.SaveFilePath))

            .InitialDirectory = userdata(userdataindex.SaveFilePath)

            answer = .ShowDialog

            userdata(userdataindex.SaveFilePath) = IO.Directory.GetCurrentDirectory

            If answer = Windows.Forms.DialogResult.Cancel Then
                result = False
            Else
                FileName = .FileName
                Me.Text = labletext + " : "
                If (FileName.IndexOf("\") > 0) Then
                    Me.Text += FileName.Substring(FileName.LastIndexOf("\") + 1)
                Else
                    Me.Text += FileName
                End If
                savefile()
                'men_make_default.Enabled = True
            End If
        End With
        IO.Directory.SetCurrentDirectory(path)
        Return result

    End Function

    Private Function saveit() As Boolean
        Dim Result As Boolean = True
        Dim Answer As DialogResult

        If FileName = NOFILE Then
            Answer = MsgBox("File has changed! Do you want to save it?", MsgBoxStyle.YesNoCancel)
        Else
            Answer = MsgBox("File '" + FileName + "' has changed! Do you want to save it?", MsgBoxStyle.YesNoCancel)
        End If


        If Answer = Windows.Forms.DialogResult.Yes Then
            If FileName = NOFILE Then
                If Not saveAs() Then
                    Result = False
                End If
            Else
                savefile()
            End If
        ElseIf Answer = Windows.Forms.DialogResult.Cancel Then
            Result = False
        End If

        Return Result

    End Function

    Private Sub But_write_file_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles men_save.Click
        If (FileName = NOFILE) Then
            saveAs()
        Else
            savefile()
        End If
        showEdit()

    End Sub

    Private Sub But_write_new_file_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles men_saveas.Click
        saveAs()
    End Sub

    Private Sub But_open_file_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles men_open.Click
        If (change) Then
            If (Not saveit()) Then
                Return
            End If
        End If
        OpenFile()
        'showEdit()

    End Sub


    Public Function selectcomport() As Boolean
        Timer_footer_change.Stop()
        Dim oldSerialPort As System.IO.Ports.SerialPort = mySerialPort 'in case user cancles
        Dim comport As String = ""
        'Dim result As Windows.Forms.DialogResult
        'Dim my_select_comport_form As select_comport_form = New select_comport_form()
        Try
            comport = mySerialPort.PortName()
            select_comport_form.setcomport(comport)
        Catch ex As Exception

        End Try

        CB_monitor_active_trick.Focus()
        select_comport_form.ShowDialog()

        If select_comport_form.DialogResult = Windows.Forms.DialogResult.Cancel Then


            mySerialPort = oldSerialPort
            Return False
        Else
            Try
                oldSerialPort.Close()
            Catch ex As Exception

            End Try
        End If

        If (selectcomportclicked) Then
            showtooltip()
        End If

        Timer_footer_change.Start()
        Return True



        'While (True)
        '    If (my_select_comport_form.DialogResult = Windows.Forms.DialogResult.OK) Then

        '        If my_select_comport_form.getcomport() = comport Then
        '            MsgBox(comport + " is already currently selected!")
        '            my_select_comport_form.ShowDialog()
        '            Continue While
        '        End If

        '        comport = my_select_comport_form.getcomport()

        '        mySerialPort = New System.IO.Ports.SerialPort(comport, 9600, System.IO.Ports.Parity.None, 8, System.IO.Ports.StopBits.One)

        '        If (Not getversion(TiniDiskMajorVersion, TiniDiskMinorVersion)) Then
        '            'check for bootloader
        '            If (bootloaderrunning()) Then
        '                If My.Computer.Network.IsAvailable = True Then
        '                    Dim message As String = "this appears to be the correct comport" + Constants.vbCrLf
        '                    message += "however no valid software was found!" + Constants.vbCrLf
        '                    message += "do you wish to download software?"
        '                    Dim result As Windows.Forms.DialogResult = MsgBox(message, MsgBoxStyle.YesNo)
        '                    If result = Windows.Forms.DialogResult.Yes Then
        '                        TiniDiskMajorVersion = -1
        '                        TiniDiskMinorVersion = -1
        '                        CheckForUpdatesToolStripMenuItem_Click(New Object, New System.EventArgs)
        '                    ElseIf result = Windows.Forms.DialogResult.No Then
        '                        my_select_comport_form.ShowDialog()
        '                        Continue While
        '                    Else
        '                        MsgBox("bugg!")
        '                    End If

        '                End If
        '            Else

        '                Dim message As String
        '                message = "communication error with port " + mySerialPort.PortName + Constants.vbCrLf
        '                message += "make sure you have selected the correct comport and that the device is plugged in"
        '                MsgBox(message)
        '                my_select_comport_form.ShowDialog()
        '                Continue While
        '            End If

        '        End If
        '        comportselected = True
        '        Try
        '            oldSerialPort.Close()
        '        Catch ex As Exception

        '        End Try
        '        If (selectcomportclicked) Then
        '            showtooltip()
        '        End If
        '        Return True
        '    ElseIf (my_select_comport_form.DialogResult = Windows.Forms.DialogResult.Cancel) Then
        '        mySerialPort = oldSerialPort
        '        Return False
        '    Else
        '        MsgBox("error")

        '    End If
        'End While
    End Function

    Public Sub New()

        ' This call is required by the Windows Form Designer.
        InitializeComponent()

        ' Add any initialization after the InitializeComponent() call.

    End Sub
    Private Sub setdefaulttricks()

        copytrickdata(defaulttricks, tricks)
        pan_filerestrictions.Visible = False
        deviceandmemorymatch = False
        activetrick = defaultactivetrick
        CB_monitor_active_trick.SelectedIndex = activetrick

    End Sub

    Private Function newfile() As Boolean
        If (change) Then


            Dim restorevalue2 = databeinginternallymanipulated
            databeinginternallymanipulated = False

            If (Not saveit()) Then
                databeinginternallymanipulated = restorevalue2
                Return False
            End If
            databeinginternallymanipulated = restorevalue2
        End If

        promptbeforedisablingstandadtab = False
        Dim restorevalue = databeinginternallymanipulated
        databeinginternallymanipulated = True


        currenttrickcodingversion = TRICKCODINGVERSION_COMBOKEYWORDS_CURRENT

        If TabControl1.SelectedTab Is Tab_Combo Then

            combotab_clear_data()

        ElseIf TabControl1.SelectedTab Is Me.Tab_Lines Then
            'Dim linecountcopy As Integer = textdata.Count

            Dim loopcounte As Integer = 0
            combotab_clear_data() 'erases all data

            'setlinecount(totallines) 'make it so that there are 30 blanc lines
            setlinecount(1) 'make it so that there is one blanc line



            'While loopcounte < totallines
            '    textdata.Add(Me.jpstringsfunctions.padleft(" ", " ", linelength))

            '    loopcounte += 1
            'End While
            textdata_top()

        ElseIf TabControl1.SelectedTab Is Me.Tab_Easy Then
            RB_pat_Constant.Checked = True
            Txt_keyword.Text = ""
            combotab_clear_data()
        ElseIf TabControl1.SelectedTab Is Me.Tab_FreeStyle Then

            'sloppy way of doing it but combotab_clear_data empties textdata array
            combotab_clear_data()

            setlinecount(1) 'make it so that there is one blanc line

            Me.refresh_freestyle_text()
        
        Else
            MsgBox("missing functionality for selected tab !")
        End If



        FileName = NOFILE

        Me.Text = labletext + " : "
        If (FileName.IndexOf("\") > 0) Then
            Me.Text += FileName.Substring(FileName.LastIndexOf("\") + 1)
        Else
            Me.Text += FileName
        End If

        change = False
        promptbeforedisablingstandadtab = False
        'change_Lbl_pattern_type()

        databeinginternallymanipulated = restorevalue
        Return True



    End Function

    Private Sub But_new_file_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles men_new.Click
        newfile()
    End Sub

    Private Function getactivestring() As Boolean
        'this fucntions read the active string from the device 
        'and set the apropriate radio button in the checked state
        'I read the bit as a character and then converted it to the asc value
        'because the code for reading it as a character was already written and 
        'writing new code to read as hex value would take more work 
        'note for numbers 0-9 dec numbers are interchangable with hex numbers

        'note the byte on the device, read to active_string is 0 bassed 
        'this applet uses 1 base
        pollingactivestring = True

        Dim active_string As Char = ""
        If (Not readcharacterfromdevice(active_string, ADDRESS_ACTIVE_STRING)) Then
            Return False
        End If
        If Asc(active_string) <> 0 Then
            MsgBox("Your sign contains data for features not supported by this version of TiniWindow")

        End If

        tricks(0, tricks_2nd_demention_index.actualvalue)(0) = Asc(active_string)
        'If (Asc(active_string) = 1) Then
        '    RadioButton1.Checked = True
        'ElseIf (Asc(active_string) = 2) Then
        '    RadioButton2.Checked = True
        'ElseIf (Asc(active_string) = 3) Then
        '    RadioButton3.Checked = True
        'ElseIf (Asc(active_string) = 4) Then
        '    RadioButton4.Checked = True
        'ElseIf (Asc(active_string) = 5) Then
        '    RadioButton5.Checked = True
        'ElseIf (Asc(active_string) = 6) Then
        '    RadioButton6.Checked = True
        'ElseIf (Asc(active_string) = 7) Then
        '    RadioButton7.Checked = True
        'ElseIf (Asc(active_string) = 8) Then
        '    RadioButton8.Checked = True
        'ElseIf (Asc(active_string) = 9) Then
        '    RadioButton9.Checked = True
        'Else
        '    '0 or any other value
        '    RadioButton0.Checked = True
        'End If
        pollingactivestring = False
        Return True
    End Function

    Private Sub But_monitor_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Dim goodread As Boolean

        goodread = read_device()
        'read device read all the strings from the device
        'returns true is succesfull, false otherwise
        'Try
        'myprogressform.Close()
        '   occasionally fails because certain sequences of events leave form not initilized
        'Catch ex As Exception
        '
        '       End Try
        If (Not goodread) Then
            MsgBox("Unable to monitor because of communication error")
            Return
        End If
        showmonitor()
        If (Not getactivestring()) Then
            showmonitor_commerror()
        End If
        Timer_pole_active_string.Start()


    End Sub



    Private Sub CB_live_edit_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs)
        If sender.checked = True Then
            Pan_tb.Enabled = True
        Else
            Pan_tb.Enabled = False
        End If

    End Sub

    Private Sub Timer_pole_active_string_Tick(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Timer_pole_active_string.Tick
        'this timer is not currently in use. 
        'the purpose is that if we ever get a button on the sign to change the dispaly patters 
        'we would then have to pole for changes while in monitor mode


        'MsgBox(Me.Parent.Name)

        Timer_pole_active_string.Stop()
        'MsgBox("poletimmerticked")
        Return
        If (Not getactivestring()) Then
            'Dim echoerror As Integer = 0 '0-no error 1-time out 2-line not terminated 3-unexpected line 4-error echo 5-wrong address echoed back 6-wrong character echoed back 7-comunication exception

            Dim message As String = "their was a communication error " + Constants.vbCrLf
            If (echoerror = 1) Then
                message += "time out"
                message += "make sure the correct comport is selected" + Constants.vbCrLf
                message += "and that TiniDisco is plugged in" + Constants.vbCrLf
            ElseIf (echoerror = 2) Then
                message += "echo not terminated with in allowed length"
                message += "make sure the correct comport is selected" + Constants.vbCrLf
            ElseIf (echoerror = 3) Then
                message += "unrecognised echo"
                message += "make sure the correct comport is selected" + Constants.vbCrLf
            ElseIf (echoerror = 4) Then
                message += "error signal echoed back"
                message += "this is probably due to a software or hardware issue" + Constants.vbCrLf
                message += "However please make sure the correct comport is selected" + Constants.vbCrLf
            ElseIf (echoerror = 7) Then
                message += "communication exception" + Constants.vbCrLf
                message += "this could result from the device being unplugged durring comunication" + Constants.vbCrLf
                message += "this also could be a software or hardware issue" + Constants.vbCrLf
            End If

            MsgBox(message)
            Timer_pole_active_string.Stop()
            showmonitor_commerror()

        End If
        Timer_pole_active_string.Start()


        'Dim oldactivetrick As Integer = activetrick
        'If (readparameterfromdevice(activetrick, ADDRESS_ACTIVETRICK)) Then
        '    'Dim echoerror As Integer = 0 '0-no error 1-time out 2-line not terminated 3-unexpected line 4-error echo 5-wrong address echoed back 6-wrong character echoed back 7-comunication exception
        '    Dim message As String = "their was a communication error " + Constants.vbCrLf
        '    If (echoerror = 1) Then
        '        message += "time out"
        '        message += "make sure the correct comport is selected" + Constants.vbCrLf
        '        message += "and that TiniDisco is plugged in" + Constants.vbCrLf
        '    ElseIf (echoerror = 2) Then
        '        message += "echo not terminated with in allowed length"
        '        message += "make sure the correct comport is selected" + Constants.vbCrLf
        '    ElseIf (echoerror = 3) Then
        '        message += "unrecognised echo"
        '        message += "make sure the correct comport is selected" + Constants.vbCrLf
        '    ElseIf (echoerror = 4) Then
        '        message += "error signal echoed back"
        '        message += "this is probably due to a software or hardware issue" + Constants.vbCrLf
        '        message += "However please make sure the correct comport is selected" + Constants.vbCrLf
        '    ElseIf (echoerror = 7) Then
        '        message += "communication exception" + Constants.vbCrLf
        '        message += "this could result from the device being unplugged durring comunication" + Constants.vbCrLf
        '        message += "this also could be a software or hardware issue" + Constants.vbCrLf
        '    End If

        '    MsgBox(message)
        '    Timer_pole_active_string.Stop()
        '    showmonitor_commerror()
        'Else
        '    Timer_pole_active_string.Start()
        'End If
        'If (oldactivetrick <> activetrick) Then
        '    send_CB_monitor_active_trick_SelectedIndexChanged_todevice = False
        '    CB_monitor_active_trick.SelectedIndex = activetrick
        '    send_CB_monitor_active_trick_SelectedIndexChanged_todevice = True
        'End If
    End Sub
    Private Function read_EEPROM(ByVal map_type As Int16, Optional ByRef readlinelength As Int16 = 0)
        If map_type = 0 Then
            'this memory map was implemeted when J.P. misunderstood what was agreed on

            'create local variables with old values to hide new values without overwriting
            Dim ADDRESS_STARTOFTEXTDATA As Integer = 2
            'Dim ADDRESS_STARTOFtrickDATA As Integer

            'Dim readlinelength As Int16
            Dim addressptr As Int16 = 2
            Dim loopcounter As Int16 = 0
            Dim trickcount As Int16
            Dim selectedtrick As Int16

            readparameterfromdevice(linecount, ADDRESS_LINECOUNT)
            readparameterfromdevice(readlinelength, ADDRESS_LINELENGTH)

            Dim address_trickcount = 2 + linecount * readlinelength

            readparameterfromdevice(trickcount, address_trickcount)
            progresform_StepCount = linecount + trickcount + 1





            'decided to test compatibility latter 
            'at this point a big value could be due to wrong memory map type

            'If (this_linelength > LINELENGTH) Then
            '    MsgBox("Your sign contains data that is not supported by this version of TiniWindow")
            '    Return False
            'End If
            update_progress_form("Configuration data read")

            textdata = New ArrayList
            While loopcounter < linecount
                Dim this_line As String = ""
                Dim this_line_walker As Int16 = 0
                this_line = ""
                While (this_line_walker < readlinelength)
                    Dim this_char As String
                    this_char = ""
                    readcharacterfromdevice(this_char, addressptr)
                    this_line += this_char
                    addressptr += 1
                    If addressptr > 511 Then
                        Return False
                    End If
                    this_line_walker += 1
                End While
                While (this_line_walker < settings(settingsindex.linelength))
                    this_line += " "
                End While

                textdata.Add(this_line)
                update_progress_form("line " + (loopcounter + 1).ToString + " of " + linecount.ToString + " read")

                loopcounter += 1
            End While

            trickdata = New ArrayList


            trickdata.Add(trickcount)
            'update_progress_form("display pattern count read")

            addressptr += 1
            If addressptr > 511 Then
                Return False
            End If
            readparameterfromdevice(selectedtrick, addressptr)
            trickdata.Add(selectedtrick)
            'update_progress_form("selected display pattern read")

            addressptr += 1
            If addressptr > 511 Then
                Return False
            End If
            loopcounter = 0
            While loopcounter < trickcount
                Dim trickbytes As Int16
                readparameterfromdevice(trickbytes, addressptr)
                trickdata.Add(trickbytes)
                addressptr += 1
                If addressptr > 511 Then
                    Return False
                End If
                Dim trickwalker As Int16 = 0
                While trickwalker < trickbytes
                    Dim this_parameter As Int16
                    readparameterfromdevice(this_parameter, addressptr)
                    trickdata.Add(this_parameter)

                    addressptr += 1
                    If addressptr > 511 Then
                        Return False
                    End If
                    trickwalker += 1
                End While
                update_progress_form("display pattern " + (loopcounter + 1).ToString + " of " + trickcount.ToString + " read")


                loopcounter += 1
            End While
            update_progress_form("finished geting data")

            progresform_complete = True
            progresform_successful = True
            deviceandmemorymatch = False

            deviceandmemorymatch = True

            Return True




        ElseIf map_type = 1 Then
            'correct new memory map


            Dim this_linelength As Int16
            Dim addressptr As Int16 = 2
            Dim loopcounter As Int16 = 0
            Dim trickcount As Int16
            Dim selectedtrick As Int16

            readparameterfromdevice(linecount, ADDRESS_LINECOUNT)
            readparameterfromdevice(this_linelength, ADDRESS_LINELENGTH)

            readlinelength = this_linelength
            ADDRESS_STARTOFTEXTDATA = 500 - (linecount * this_linelength)


            Dim address_trickcount = 2

            readparameterfromdevice(trickcount, address_trickcount)
            progresform_StepCount = linecount + trickcount + 1





            'update_progress_form("line count read")


            'update_progress_form("line length read")

            'If (this_linelength > LINELENGTH) Then
            '    MsgBox("Your sign contains data that is not supported by this version of TiniWindow")
            '    Return False
            'End If
            update_progress_form("Configuration data read")

            'erase old text data
            textdata = New ArrayList

            'read new tesx data from EEprom
            addressptr = ADDRESS_STARTOFTEXTDATA
            If addressptr > 511 Then
                Return False
            End If
            While loopcounter < linecount
                Dim this_line As String = ""
                Dim this_line_walker As Int16 = 0
                this_line = ""
                While (this_line_walker < this_linelength)
                    Dim this_char As String
                    this_char = ""
                    readcharacterfromdevice(this_char, addressptr)
                    this_line += this_char
                    addressptr += 1
                    If addressptr > 511 Then
                        Return False
                    End If
                    this_line_walker += 1
                End While
                While (this_line.Length < settings(settingsindex.linelength))
                    'if the line read is shorter then it should be, pad it
                    this_line += " "
                End While

                textdata.Add(this_line)
                update_progress_form("line " + (loopcounter + 1).ToString + " of " + linecount.ToString + " read")

                loopcounter += 1
            End While

            'clear old trick data
            trickdata = New ArrayList

            'read new trick data from EEprom
            addressptr = address_startoftrickdata
            If addressptr > 511 Then
                Return False
            End If
            trickdata.Add(trickcount)

            addressptr += 1
            If addressptr > 511 Then
                Return False
            End If
            readparameterfromdevice(selectedtrick, addressptr)
            trickdata.Add(selectedtrick)

            addressptr += 1
            If addressptr > 511 Then
                Return False
            End If
            loopcounter = 0
            While loopcounter < trickcount
                Dim trickbytes As Int16
                readparameterfromdevice(trickbytes, addressptr)
                trickdata.Add(trickbytes)
                'point

                addressptr += 1
                If addressptr > 511 Then
                    Return False
                End If
                Dim trickwalker As Int16 = 0
                While trickwalker < trickbytes - 1
                    Dim this_parameter As Int16
                    readparameterfromdevice(this_parameter, addressptr)
                    trickdata.Add(this_parameter)

                    addressptr += 1
                    If addressptr > 511 Then
                        Return False
                    End If
                    trickwalker += 1
                End While
                update_progress_form("display pattern " + (loopcounter + 1).ToString + " of " + trickcount.ToString + " read")


                loopcounter += 1
            End While
            update_progress_form("finished geting data")

            progresform_complete = True
            progresform_successful = True
            deviceandmemorymatch = False

            deviceandmemorymatch = True

            Return True
        ElseIf map_type = 255 Then
            'old memory map
            linecount = 10
            Const ADDRESS_ACTIVE_STRING As Integer = 201
            Const ADDRESS_PARAM1_TRICK_TYPE1 = 203 'subsequent parameters increment by one
            Const ADDRESS_ACTIVETRICK = 202

            Dim this_linelength As Int16 = 20
            readlinelength = this_linelength

            Dim loopcounter As Int16 = 0
            Dim trickcount As Int16 = 2
            Dim selectedtrick As Int16

            progresform_StepCount = 13
            'Dim lineaddresses As ArrayList = New ArrayList
            Dim addressvalue As Int16 = 0
            Dim loopcnter As Int16 = 0
            textdata = New ArrayList
            update_progress_form("Configuration data read")

            While loopcnter < 10
                Dim thisline As String = ""
                If (Not readLineFromDevice(addressvalue, thisline)) Then

                    read_write_error("reading line " + loopcnter.ToString)
                    Return False

                End If
                If (thisline.Length > settings(settingsindex.linelength)) Then
                    thisline = thisline.Substring(0, settings(settingsindex.linelength))
                End If

                textdata.Add(thisline)
                update_progress_form("line " + (loopcnter + 1).ToString + " of 10 read")

                addressvalue += 20
                loopcnter += 1
            End While


            'Const ADDRESS_ACTIVE_STRING As Integer = 201
            'Const ADDRESS_PARAM1_TRICK_TYPE1 = 203 'subsequent parameters increment by one
            'Const ADDRESS_ACTIVETRICK = 202

            update_progress_form("Getting display patterns")

            readparameterfromdevice(selectedtrick, ADDRESS_ACTIVETRICK)

            Dim trick0parameter As Int16
            readparameterfromdevice(trick0parameter, ADDRESS_ACTIVE_STRING)


            Dim PARAM1_TRICK1 As Int16
            Dim PARAM2_TRICK1 As Int16
            Dim PARAM3_TRICK1 As Int16
            readparameterfromdevice(PARAM1_TRICK1, ADDRESS_PARAM1_TRICK_TYPE1)
            readparameterfromdevice(PARAM2_TRICK1, ADDRESS_PARAM1_TRICK_TYPE1 + 1)
            readparameterfromdevice(PARAM3_TRICK1, ADDRESS_PARAM1_TRICK_TYPE1 + 2)
            tricks.Initialize()
            tricks_append_showoneline(trick0parameter)

            tricks_append_rotatethroughlines(PARAM1_TRICK1, PARAM2_TRICK1, PARAM3_TRICK1)


            'loopcnter = 0

            update_progress_form("Finished")

            progresform_complete = True
            progresform_successful = True
            deviceandmemorymatch = False

            deviceandmemorymatch = True

            Return True

        Else
            'unrecognised memory map
            MsgBox("Your sign uses an unrecognised data format!")
            progresform_status = "unable to get data from sign"
            progresform_complete = True
            progresform_successful = True
            deviceandmemorymatch = False

            deviceandmemorymatch = True


            Return False
        End If





    End Function
    Private Function isprintablechar(ByVal ch As Char) As Boolean

        Dim ascii_value As Int16 = AscW(ch)

        'If (ascii_value = 2) Then
        '    'this condition should be removed as soon as the bug with line 11 on the sign is corrected
        '    '2 is the value currently read from this eeprom address
        '    Return True
        'End If

        If AscW(ch) >= 32 And AscW(ch) <= 126 Then
            Return True

        End If
        If AscW(ch) = 128 Then
            Return True
        End If
        If AscW(ch) >= 103 And AscW(ch) <= 255 Then
            If AscW(ch) = 141 Then
                Return False
            End If
            If AscW(ch) = 143 Then
                Return False
            End If
            If AscW(ch) = 144 Then
                Return False
            End If
            If AscW(ch) = 157 Then
                Return False
            End If
            Return True
        End If
        Return False
    End Function
    Private Function textdatamakessence(ByVal _linelenth As Int16) As Boolean
        Dim loopcounter As Int16 = 0
        While loopcounter < textdata.Count
            Dim loopcounter2 As Int16 = 0
            Dim thisline As String = textdata(loopcounter)
            While loopcounter2 < thisline.Length And loopcounter2 < _linelenth

                If loopcounter = linecount - 30 And loopcounter2 = 0 Then
                    'this conditio gets around the bugg with first character in line 11

                    'replace invalid character with space
                    textdata(loopcounter) = " " + thisline.Substring(1)
                    loopcounter2 += 1
                    Continue While
                End If

                If Not isprintablechar(thisline(loopcounter2)) Then
                    'at least one char is not printable
                    Return False
                End If
                loopcounter2 += 1
            End While

            loopcounter += 1

        End While
        'all chars printable
        Return True
    End Function



    Private Function textdatamakessence() As Boolean
        Dim loopcounter As Int16 = 0
        While loopcounter < textdata.Count
            Dim loopcounter2 As Int16 = 0
            Dim thisline As String = textdata(loopcounter)
            While loopcounter2 < thisline.Length

                If loopcounter = linecount - 30 And loopcounter2 = 0 Then
                    'this conditio gets around the bugg with first character in line 11

                    'replace invalid character with space
                    textdata(loopcounter) = " " + thisline.Substring(1)
                    loopcounter2 += 1
                    Continue While
                End If
                If Not isprintablechar(thisline(loopcounter2)) Then
                    'at least one char is not printable
                    Return False
                End If
                loopcounter2 += 1
            End While

            loopcounter += 1

        End While
        'all chars printable
        Return True
    End Function
    Private Sub truncatetext(ByVal length)
        Dim loopcounter As Int16 = 0
        Dim spaces As String = ""
        Dim spacecount As Int16 = settings(settingsindex.linelength) - length
        While loopcounter < spacecount
            spaces += " "
            loopcounter += 1
        End While

        loopcounter = 0
        While loopcounter < textdata.Count
            textdata(loopcounter) = textdata(loopcounter).substring(0, length) + spaces
            loopcounter += 1
        End While
    End Sub

    Public Sub sincronizelinelength(ByVal readlinelength As Integer)
        'this function set the linelenght on tiniwindow to reflect the linelenght read from the sign

        If readlinelength = settings(settingsindex.linelength) Then
            'the line length read from sign matches current settings
            'nothing needs to be done
            Return

        ElseIf readlinelength > MAX_LINELENGTH Then

            set_linelenth(MAX_LINELENGTH, line_configuration.add_or_truncate_position._end, False, False)
            Dim message As String = "The sign contains data for lines of " & readlinelength & " letters" + Constants.vbCrLf
            message &= "But this version of TiniWindow supports a maximum of " + MAX_LINELENGTH + " letters" + Constants.vbCrLf
            message &= "Extra letters have been truncated" + Constants.vbCrLf

            MsgBox(message)

        ElseIf readlinelength < MIN_LINELENGTH Then
            set_linelenth(MIN_LINELENGTH, line_configuration.add_or_truncate_position._end, False, False)
            Dim message As String = "The sign contains data for lines of " & readlinelength & " letters" + Constants.vbCrLf
            message &= "But this version of TiniWindow supports a minimum length of " & MIN_LINELENGTH & " letters" & Constants.vbCrLf
            message &= "line have been padded with space to bring them up to " & MIN_LINELENGTH & " letters"

            MsgBox(message)
        Else

            set_linelenth(readlinelength, line_configuration.add_or_truncate_position._end, False, False)
            'characters truncated from the end should be all spaces that were padded while reading from device
            'if readlinelength is greater then the current setting, the read process leaves the array with line longer then the old settings
            Dim message As String = "The sign contains data for lines of " & readlinelength & " letters" + Constants.vbCrLf
            message &= "TiniWindow settings have been adjusted to reflect this"


            'MsgBox(message)
            'taken out in version 1.09.002 because jp decided not to give this user a prompt
            'also in the version the call to this function was moved to right after reading the parameter
            'as opposed to the end of the process

        End If





    End Sub

    'Private Sub BGW_readdevice_DoWork(ByVal sender As System.Object, ByVal e As System.ComponentModel.DoWorkEventArgs) Handles BGW_read_device.DoWork


    '    'progresform_StepCount
    '    timer_monitor_ifdoubleclickmanuel.Stop()


    '    cancelopenfile(cancelopenfileflags.saveCurrentState)
    '    Try

    '        Dim readlinelength As Int16 = 0
    '        Dim EEprom_memory_map_type As Short

    '        'read a single byte of data from EEprom
    '        'the data is the memory map version value
    '        readparameterfromdevice(EEprom_memory_map_type, ADDRESS_EEPROM_MAP_TYPE)
    '        'update_progress_form("memory map read")
    '        While (True)
    '            'the purpose of the loop is so we can start over trying memory map 255 if other map failes
    '            If EEprom_memory_map_type = 0 Or EEprom_memory_map_type = 1 Then
    '                'show_filerestrictions()
    '                If Not read_EEPROM(EEprom_memory_map_type, readdevice_readlinelength) Then
    '                    'read failed 
    '                    'try reading old dataformat
    '                    EEprom_memory_map_type = 255
    '                    Continue While

    '                Else

    '                    'deviceandmemorymatch = True
    '                    'progresform_status = "Finished"
    '                    'progresform_complete = True
    '                    'progresform_successful = True
    '                    'deviceandmemorymatch = False

    '                    'Return


    '                End If

    '                deviceandmemorymatch = True


    '                If tricks_datavalid() Then
    '                    If Not textdatamakessence() Then
    '                        EEprom_memory_map_type = 255
    '                        Continue While
    '                    End If

    '                    If tricks_makecompatible_with_1_003() Then
    '                        'done

    '                        hide_filerestrictions()
    '                        progresform_status = "Finished"
    '                        progresform_complete = True
    '                        progresform_successful = True
    '                        'deviceandmemorymatch = False
    '                        'deviceandmemorymatch = True





    '                        Return

    '                    Else
    '                        attempttogetunsuporteddatafromsign.ShowDialog()
    '                        If attempttogetunsuporteddatafromsign.DialogResult = Windows.Forms.DialogResult.OK Then
    '                            'discard unsuported tricks
    '                            tricks_makecompatible_with_1_003(True)

    '                            sincronizelinelength(readlinelength)
    '                            progresform_status = "Finished"
    '                            progresform_complete = True
    '                            progresform_successful = True
    '                            deviceandmemorymatch = False

    '                            Return

    '                        ElseIf attempttogetunsuporteddatafromsign.DialogResult = Windows.Forms.DialogResult.Yes Then
    '                            'continue with restrictions
    '                            sincronizelinelength(readlinelength)
    '                            show_filerestrictions()
    '                            progresform_status = "Finished (with restrictions)"
    '                            progresform_complete = True
    '                            progresform_successful = True
    '                            deviceandmemorymatch = True

    '                            Return
    '                        ElseIf attempttogetunsuporteddatafromsign.DialogResult = Windows.Forms.DialogResult.Cancel Then

    '                            cancelopenfile(cancelopenfileflags.restoreStoredState)
    '                            progresform_status = "process cancled"
    '                            progresform_complete = True
    '                            progresform_successful = False
    '                            'deviceandmemorymatch = False
    '                            'deviceandmemorymatch = True

    '                            Return
    '                        End If


    '                    End If
    '                Else
    '                    'attempting to read data stored in 255 format as data in other format
    '                    'may result in invalid trick data
    '                    EEprom_memory_map_type = 255
    '                    Continue While
    '                End If

    '                MsgBox("bug while reading from sign")
    '                Return
    '            ElseIf EEprom_memory_map_type = 255 Then
    '                'old memory map
    '                read_EEPROM(255)
    '                If tricks_datavalid() Then
    '                    If textdatamakessence() Then
    '                        progresform_status = "Finished"
    '                        progresform_complete = True
    '                        progresform_successful = True
    '                        deviceandmemorymatch = False
    '                        Return

    '                    Else
    '                        'the 6 char versions sometimes leaves invalid chars in remaining chars 
    '                        Dim lengthtested As Int16 = settings(settingsindex.linelength)
    '                        While lengthtested > 0
    '                            If textdatamakessence(lengthtested) Then
    '                                Exit While
    '                            End If

    '                            lengthtested -= 1
    '                        End While

    '                        If lengthtested > 0 Then
    '                            truncatetext(lengthtested)
    '                            progresform_status = "Finished"
    '                            progresform_complete = True
    '                            progresform_successful = True
    '                            deviceandmemorymatch = False
    '                            Return
    '                        End If


    '                        cancelopenfile(cancelopenfileflags.restoreStoredState)

    '                        MsgBox("unrecognised data format !")
    '                        progresform_status = "Unable to get data from sign"
    '                        progresform_complete = True
    '                        progresform_successful = False
    '                        'deviceandmemorymatch = False 
    '                        'deviceandmemorymatch = True
    '                        Return

    '                    End If
    '                Else
    '                    cancelopenfile(cancelopenfileflags.restoreStoredState)

    '                    Dim message As String = "unable to read data from sign!" + Constants.vbCrLf
    '                    message += "The data is either corrupt or in a format" + Constants.vbCrLf
    '                    message += "not recognized by this version of TiniWindow"
    '                    MsgBox("message")
    '                    progresform_status = "Unable to get data from sign"
    '                    progresform_complete = True
    '                    progresform_successful = False
    '                    'deviceandmemorymatch = False 
    '                    'deviceandmemorymatch = True
    '                    Return
    '                End If

    '                Return

    '            Else
    '                'unrecognised memory map
    '                'try old version
    '                EEprom_memory_map_type = 255
    '                Continue While
    '            End If

    '            'should not get this point
    '            MsgBox("bug in program")
    '            Return
    '        End While

    '    Catch ex As AppDomainUnloadedException
    '        'exception thrown when user cancels process

    '        cancelopenfile(cancelopenfileflags.restoreStoredState)
    '        backgroundworkerdebugvalue = "007"
    '        progresform_status = "Process Cancled"
    '        progresform_complete = True
    '        progresform_successful = False
    '        deviceandmemorymatch = False

    '        deviceandmemorymatch = False
    '        '  myprogressform.setprogress("process cancled")
    '        ' myprogressform.But_ok.Visible() = True
    '        'myprogressform.But_cancle.Visible() = False
    '        backgroundworkerdebugvalue = "008"

    '        Dim dummy As String = ""

    '        While readline(dummy)
    '            'this clears any echo info reamining in buffer

    '        End While
    '        backgroundworkerdebugvalue = "aa18"
    '    End Try
    '    backgroundworkerdebugvalue = "aa19"
    'End Sub

    Private Sub read_write_error(ByRef activity As String)
        MsgBox("error " + echoerror.ToString + " while " + activity)
    End Sub
    Private Sub update_progress_form(ByRef message As String)
        progresform_status = message
        progresform_updatestatus = True
        backgroundworkerdebugvalue = "125"
        If (progresform_cancel) Then
            cancel_read_or_write() 'confirms cancle and throws argument exception
            backgroundworkerdebugvalue = "126"
        End If

    End Sub


    Private Sub BGW_write_device_DoWork(ByVal sender As System.Object, ByVal e As System.ComponentModel.DoWorkEventArgs) Handles BGW_write_device.DoWork
        'timer_monitor_pan_morelines.Stop()

        'mySerialPort.WriteTimeout = 100
        backgroundworkerdebugvalue = "001"
        Dim trickcount As Integer = tricks_get_trickcount()
        'progress_form.setstepcount(linecount + trickcount + 1)
        Dim trickstartpointers As ArrayList = tricks_get_startpointers()
        Dim trickstartpointersindex As Int16 = 0

        progresform_StepCount = linecount + trickcount

        Try

            Dim textdatawalker As Integer = 0
            ADDRESS_STARTOFTEXTDATA = 500 - (linecount * settings(settingsindex.linelength))
            Dim address_ptr As Integer = ADDRESS_STARTOFTEXTDATA
            backgroundworkerdebugvalue = "110"


            If (Not writeparametertodevice(1, ADDRESS_EEPROM_MAP_TYPE)) Then
                read_write_error("sending line count")
                Return
            End If

            If (Not writeparametertodevice(linecount, ADDRESS_LINECOUNT)) Then
                read_write_error("sending line count")
                Return
            End If




            If (Not writeparametertodevice(settings(settingsindex.linelength), ADDRESS_LINELENGTH)) Then
                read_write_error("sending line lenght")
                Return
            End If
            update_progress_form("configuration data sent")

            While (textdatawalker < textdata.Count)
                'MsgBox(address_ptr)
                If (Not writeToDevice(address_ptr, textdata(textdatawalker))) Then
                    read_write_error("sending line " + (textdatawalker + 1).ToString)
                    Return


                End If
                update_progress_form("line " + textdatawalker.ToString + " of " + linecount.ToString + " sent")
                textdatawalker += 1
                address_ptr += settings(settingsindex.linelength)

            End While


            'If (address_ptr <> ADDRESS_STARTOFTEXTDATA + (linecount * LINELENGTH)) Then
            '    MsgBox("indexing error sending data to device")
            '    Return

            'End If




            'address_startoftrickdata = address_ptr
            address_ptr = address_startoftrickdata

            If (progresform_cancel) Then
                cancel_read_or_write() 'confirms cancle and throws argument exception
                backgroundworkerdebugvalue = "116"
            End If


            Dim trickswalker As Integer = 0
            'Dim trickstartpointers As ArrayList = tricks_get_startpointers()
            trickstartpointersindex = 1


            While trickswalker < trickdata.Count


                writeparametertodevice(trickdata(trickswalker), address_ptr)
                'update_progress_form("trick data intem #" + trickswalker.ToString + " sent")
                If trickstartpointersindex < trickstartpointers.Count Then
                    If (trickswalker = trickstartpointers(trickstartpointersindex)) Then
                        update_progress_form("display pattern " + trickstartpointersindex.ToString + "of " + trickcount.ToString + " sent")
                        trickstartpointersindex += 1
                    End If

                End If

                trickswalker += 1
                address_ptr += 1
            End While
            'update_progress_form("display pattern " + trickstartpointersindex + "of " + trickcount + " sent")

            update_progress_form("Finished sending data")
            progresform_complete = True
            progresform_successful = True
            deviceandmemorymatch = True

        Catch ex As AppDomainUnloadedException


            backgroundworkerdebugvalue = "007"
            progresform_status = "Process Cancled"
            progresform_complete = True
            progresform_successful = False
            deviceandmemorymatch = False

            deviceandmemorymatch = False
            '  myprogressform.setprogress("process cancled")
            ' myprogressform.But_ok.Visible() = True
            'myprogressform.But_cancle.Visible() = False
            backgroundworkerdebugvalue = "008"
            Dim dummy As String = ""
            While readline(dummy)
                'this clears any echo info reamining in buffer

            End While
        End Try

        'If Pan_morelines.Visible Then
        'timer_monitor_pan_morelines.Start()
        'End If
    End Sub


    Private Function gettricksfromdevice() As Boolean
        'Enum ttricks2_2nd_demention_index
        'trick_parameters is an 2 dementional array of arraylists


        'description 'arraylist contains strings that describe parameter to user 
        'minimumvalue 'arraylist contains integer giving the lowest valid interger value for parameter
        'maximumvalue 'arraylist contains integers givning the highers valid integer value for parameter  
        'address 'arraylist of integers noting the address on EEProm the parameter is sent to
        'actualvalue 'arraylist contaning the actualvalues of the user selects
        'End Enum

        'Dim ttricks2(tricktypecount -1, 4) As ArrayList 'initialized in form load
        backgroundworkerdebugvalue = "aa2"
        Dim unsupportedvaluesdetected As Boolean = False
        Dim loopcounter As Integer = 0
        While (loopcounter < tricktypecount)
            'outer loop determines which trick
            'inner loop determines which parameter of the trick
            Dim loopcounter2 As Integer = 0
            While (loopcounter2 < (tricks(loopcounter, tricks_2nd_demention_index.actualvalue).Count))
                Dim address = tricks(loopcounter, tricks_2nd_demention_index.address)(loopcounter2)
                If (Not readparameterfromdevice(tricks(loopcounter, tricks_2nd_demention_index.actualvalue)(loopcounter2), address)) Then
                    Return False
                End If

                'MsgBox(loopcounter.ToString + "," + loopcounter2.ToString + "," + tricks(loopcounter, tricks_2nd_demention_index.address)(loopcounter2).ToString + "," + tricks(loopcounter, tricks_2nd_demention_index.actualvalue)(loopcounter2).ToString)
                If tricks(loopcounter, tricks_2nd_demention_index.actualvalue)(loopcounter2) < tricks(loopcounter, tricks_2nd_demention_index.minimumvalue)(loopcounter2) Then
                    tricks(loopcounter, tricks_2nd_demention_index.actualvalue)(loopcounter2) = tricks(loopcounter, tricks_2nd_demention_index.minimumvalue)(loopcounter2)
                    'MsgBox("lower reset")
                End If

                If tricks(loopcounter, tricks_2nd_demention_index.actualvalue)(loopcounter2) > tricks(loopcounter, tricks_2nd_demention_index.maximumvalue)(loopcounter2) Then
                    tricks(loopcounter, tricks_2nd_demention_index.actualvalue)(loopcounter2) = tricks(loopcounter, tricks_2nd_demention_index.maximumvalue)(loopcounter2)
                    'MsgBox("upper reset")
                End If
                loopcounter2 += 1
            End While
            loopcounter += 1
        End While
        backgroundworkerdebugvalue = "aa3"
        If (Not readparameterfromdevice(activetrick, ADDRESS_ACTIVETRICK)) Then
            Return False
        End If
        backgroundworkerdebugvalue = "aa4"


        If (activetrick > tricktypecount) Then
            'MsgBox("activetric changes")
            activetrick = 0
            'unsupportedvaluesdetected = True
        End If
        backgroundworkerdebugvalue = "aa5"
        ''''''fffffffffffff

        Dim tricktypwalker As Integer = 0
        While tricktypwalker < tricktypecount
            Dim second_demen_sionwalker As Integer = 0
            While second_demen_sionwalker < tricks(tricktypwalker, tricks_2nd_demention_index.controlltype).count

                If tricks(tricktypwalker, tricks_2nd_demention_index.controlltype)(second_demen_sionwalker) = controlltype.none Then

                    Dim valueinfile = tricks(tricktypwalker, tricks_2nd_demention_index.actualvalue)(second_demen_sionwalker)
                    Dim defaultvalue = defaulttricks(tricktypwalker, tricks_2nd_demention_index.actualvalue)(second_demen_sionwalker)
                    If valueinfile <> defaultvalue Then

                        unsupportedvaluesdetected = True
                    End If
                End If
                'mmmmmm()
                second_demen_sionwalker += 1
            End While
            tricktypwalker += 1
        End While
        backgroundworkerdebugvalue = "aa6"
        If (unsupportedvaluesdetected) Then

            attempttogetunsuporteddatafromsign.ShowDialog()
            If (attempttogetunsuporteddatafromsign.DialogResult = Windows.Forms.DialogResult.Yes) Then
                'pan_filerestrictions.Visible = True
                backgroundworker_showfileerror = True 'cross thread issues prevent the background worker thread from doing this

                backgroundworkerdebugvalue = "aa7"
            ElseIf (attempttogetunsuporteddatafromsign.DialogResult = Windows.Forms.DialogResult.OK) Then

                tricktypwalker = 0
                While tricktypwalker < tricktypecount
                    Dim second_demen_sionwalker As Integer = 0
                    While second_demen_sionwalker < tricks(tricktypwalker, tricks_2nd_demention_index.controlltype).count

                        If tricks(tricktypwalker, tricks_2nd_demention_index.controlltype)(second_demen_sionwalker) = controlltype.none Then

                            Dim valueinfile = tricks(tricktypwalker, tricks_2nd_demention_index.actualvalue)(second_demen_sionwalker)
                            Dim defaultvalue = defaulttricks(tricktypwalker, tricks_2nd_demention_index.actualvalue)(second_demen_sionwalker)
                            If valueinfile <> defaultvalue Then
                                tricks(tricktypwalker, tricks_2nd_demention_index.actualvalue)(second_demen_sionwalker) = defaulttricks(tricktypwalker, tricks_2nd_demention_index.actualvalue)(second_demen_sionwalker)

                            End If
                        End If

                        second_demen_sionwalker += 1
                    End While
                    tricktypwalker += 1
                End While

            ElseIf (attempttogetunsuporteddatafromsign.DialogResult = Windows.Forms.DialogResult.Cancel) Then

                Throw (New AppDomainUnloadedException) 'this is the axception that was chosen to be used for canceling
                'there is no logical reason for picking this particlar exception other then it is unlikely to be thrown by programming bugs 
            End If
        End If
        backgroundworkerdebugvalue = "aa8"
        ''''''ffffffffffffff''''''''






        If (Not backgroundworker_showfileerror) Then
            CB_monitor_active_trick.SelectedIndex = activetrick
        End If
        backgroundworkerdebugvalue = "aa9"
        Return True

        'Dim RDchecked As Int16 = tricks(activetrick, tricks_2nd_demention_index.actualvalue)(0)
        'Try

        '    If RDchecked = 0 Then
        '        RadioButton0.Checked = True
        '    ElseIf RDchecked = 1 Then
        '        RadioButton1.Checked = True
        '    ElseIf RDchecked = 2 Then
        '        RadioButton2.Checked = True
        '    ElseIf RDchecked = 3 Then
        '        RadioButton3.Checked = True
        '    ElseIf RDchecked = 4 Then
        '        RadioButton4.Checked = True
        '    ElseIf RDchecked = 5 Then

        '        Dim truecopy As Boolean = True
        '        Dim RDcheckedcopy As Int16 = RDchecked
        '        RadioButton5.Checked = truecopy
        '    ElseIf RDchecked = 6 Then
        '        RadioButton6.Checked = True
        '    ElseIf RDchecked = 7 Then
        '        RadioButton7.Checked = True
        '    ElseIf RDchecked = 8 Then
        '        RadioButton8.Checked = True
        '    ElseIf RDchecked = 9 Then
        '        RadioButton9.Checked = True
        '    End If
        'Catch ex As NullReferenceException
        '    MsgBox("null reference exception caught")
        'End Try

    End Function


    Private Function sendtrickstodevice() As Boolean
        '''''
        'send active trick
        '''''


        'Enum ttricks2_2nd_demention_index
        'trick_parameters is an 2 dementional array of arraylists


        'description 'arraylist contains strings that describe parameter to user 
        'minimumvalue 'arraylist contains integer giving the lowest valid interger value for parameter
        'maximumvalue 'arraylist contains integers givning the highers valid integer value for parameter  
        'address 'arraylist of integers noting the address on EEProm the parameter is sent to
        'actualvalue 'arraylist contaning the actualvalues of the user selects
        'End Enum

        'Dim ttricks2(tricktypecount -1, 4) As ArrayList 'initialized in form load


        Dim loopcounter As Integer = 0
        While (loopcounter < tricktypecount)
            'outer loop determines which trick
            'inner loop determines which parameter of the trick
            Dim loopcounter2 As Integer = 0
            While (loopcounter2 < (tricks(loopcounter, tricks_2nd_demention_index.actualvalue).Count))
                If (Not writeparametertodevice(tricks(loopcounter, tricks_2nd_demention_index.actualvalue)(loopcounter2), tricks(loopcounter, tricks_2nd_demention_index.address)(loopcounter2))) Then
                    Return False
                End If
                'MsgBox(loopcounter.ToString + "," + loopcounter2.ToString + "," + tricks(loopcounter, tricks_2nd_demention_index.address)(loopcounter2).ToString + "," + tricks(loopcounter, tricks_2nd_demention_index.actualvalue)(loopcounter2).ToString)
                loopcounter2 += 1
            End While

            loopcounter += 1

        End While

        If (Not writeparametertodevice(activetrick, ADDRESS_ACTIVETRICK)) Then
            Return False
        End If
        Return True
    End Function




    'Private Sub MonitorToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
    '    ''comented out when combined with functions handling other menue item
    '    Dim goodread As Boolean
    '    progresform_AutoCloseAtCompletion = True
    '    goodread = read_device()
    '    'read device read all the strings from the device
    '    'returns true is succesfull, false otherwise

    '    If (Not goodread) Then
    '        MsgBox("Unable to monitor because of communication error")
    '        Return
    '    End If
    '    showmonitor()
    '    If (Not getactivestring()) Then
    '        showmonitor_commerror()
    '    End If
    '    Timer_pole_active_string.Start()

    'End Sub

    Private Sub men_exit_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles men_exit.Click
        Me.Close()
    End Sub

    Private Sub men_editmode_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        showEdit()
    End Sub



    Private Sub men_help_go_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        'Dim myhelp As New help
        help.Show()
    End Sub

    Private Sub Men_monitor_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)


        If (deviceandmemorymatch) Then


            Dim dummy As ArrayList = New ArrayList
            If getversion(dummy, dummy) Then 'used to test if device has been unplugged
                InMonitorMode = True


                showmonitor()

            End If

            showmainhelp()
            Return

        Else

            ConfirmEnterMonitorMode.ShowDialog()

            If ConfirmEnterMonitorMode.DialogResult = Windows.Forms.DialogResult.Cancel Then
                showmainhelp()
                Return
            ElseIf ConfirmEnterMonitorMode.DialogResult = Windows.Forms.DialogResult.Yes Then
                'get from sign
                If (comportselected) Then
                    Dim dummy As ArrayList = New ArrayList
                    getversion(dummy, dummy) 'used to test if device has been unplugged
                End If
                If (Not comportselected) Then
                    'TB_beginners_help.Clear()
                    select_comport_form.clear_help_at_load = False

                    appendrichtext("Before data can be gotten from the sign, The sign must be plugged into the ", 12, FontStyle.Bold)
                    appendrichtext("USB port and the comport must be selected" + Constants.vbCrLf + Constants.vbCrLf, 12, FontStyle.Bold)
                    If (Not selectcomport()) Then
                        Return
                    End If
                End If
                'InMonitorMode = True
                'showtooltipppppp = False
                'ToolTip1.Hide(sender)
                Dim goodread As Boolean

                'TB_beginners_help.Clear()
                appendrichtext("Data is being read from the sign." + Constants.vbCrLf, 12, FontStyle.Bold)
                appendrichtext("You are about to enter monitor mode" + Constants.vbCrLf, 12, FontStyle.Bold)
                appendrichtext(Constants.vbCrLf + "To cancel press 'Cancel' on the progress form" + Constants.vbCrLf, 10)


                progresform_AutoCloseAtCompletion = True
                Timer_demo.Stop()
                goodread = read_device()
                'read device read all the strings from the device
                'returns true is succesfull, false otherwise
                'Try
                'myprogressform.Close()
                '   occasionally fails because certain sequences of events leave form not initilized
                'Catch ex As Exception
                '
                '       End Try
                If (Not goodread) Then
                    MsgBox("Unable to monitor because of communication error")
                    InMonitorMode = False
                    showmainhelp()
                    Return
                End If

                If (backgroundworker_showfileerror) Then
                    pan_filerestrictions.Visible = True
                Else

                    refresh_Pan_trick_parameters()

                    showmonitor()
                    showmainhelp()
                End If


            ElseIf ConfirmEnterMonitorMode.DialogResult = Windows.Forms.DialogResult.OK Then
                'send to sign

                If (Not comportselected) Then
                    'TB_beginners_help.Clear()
                    select_comport_form.clear_help_at_load = False
                    appendrichtext("Before data can be gotten from the sign, The sign must be plugged into the ", 12, FontStyle.Bold)
                    appendrichtext("USB port and the comport must be selected" + Constants.vbCrLf + Constants.vbCrLf, 12, FontStyle.Bold)

                    If (Not selectcomport()) Then

                        Return
                    End If
                End If

                'TB_beginners_help.Clear()
                appendrichtext("Data is being sent to the sign." + Constants.vbCrLf, 12, FontStyle.Bold)
                appendrichtext("You are about to enter monitor mode" + Constants.vbCrLf, 12, FontStyle.Bold)
                appendrichtext(Constants.vbCrLf + "To cancel press 'Cancel' on the progress form" + Constants.vbCrLf, 10)


                progresform_AutoCloseAtCompletion = True

                'myprogressform = New progress_form()

                progresform_process = "write" 'used with cancle

                'myprogressform.setheader("Sending data to device")


                backgroundworkerdebugvalue = "00"

                BGW_write_device.RunWorkerAsync()



                oldprogress_form.ShowDialog()
                deviceandmemorymatch = True

                showmonitor()
                showmainhelp()
            End If

        End If

    End Sub


    Private Sub men_select_comport_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Return
        'disabled when mulitple classes structure added
        'will soon be removed
        selectcomportclicked = True
        selectcomport()
        selectcomportclicked = False
    End Sub

    Private Sub men_monitorsettings_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        settings_form.ShowDialog()
    End Sub



    Private Sub men_file_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)

    End Sub

    Private Sub Timer_footer_change_Tick(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Timer_footer_change.Tick
        Static index As Integer = 0

        'displays the value determined from last tick
        lbl_footer.Text = footertext(index)


        'from here down sets up for next tick
        index += 1
        If index > footertextcount Then

            index = 0
        End If



        If mysignconnections(signconnectionindex.USB).connected Then
            footertext(1) = "You are connected to sign via USB port"

        ElseIf mysignconnections(signconnectionindex.wireless).connected Then
            footertext(1) = "You are connected to sign via Zigbee Wireless"
        Else
            footertext(1) = "You are not curently connected to a sign"
        End If




        If (pathofopenfile = "") Then
            footertext(2) = "No file open"
        Else
            Dim pathdisplayed As String = pathofopenfile
            If pathdisplayed.Length > 69 Then
                pathdisplayed = pathdisplayed.Substring(0, 33) & "..." & pathdisplayed.Substring(pathdisplayed.Length - 33)
            End If
            'Dim compyofpath As String = pathofopenfile
            'Dim pathdisplayed As String = ""
            'While compyofpath.Length > 60
            '    pathdisplayed += compyofpath.Substring(0, 60) + Constants.vbCrLf
            '    compyofpath = compyofpath.Substring(60)

            'End While
            'pathdisplayed += compyofpath

            footertext(2) = pathdisplayed

        End If

    End Sub

    'Private Sub But_new_trick_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
    '    Pan_select_trick_type.Dock = DockStyle.Fill
    '    Pan_select_trick_type.Visible = True
    '    'Pan_trick_options.Visible = False
    'End Sub

    'Private Sub But_nes_trick_cancel_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
    '    Pan_select_trick_type.Visible = False
    '    'Pan_trick_options.Visible = True
    'End Sub

    'Private Sub But_select_trick_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
    '    ' Dim namecount As Integer = trickscount + 1
    '    Dim timesthroughloop As Integer = tricks(CB_select_trick_type.SelectedIndex, tricks_2nd_demention_index.description).Count




    '    trickcodinglables = New ArrayList()

    '    trickcodingcontrolls = New ArrayList()
    '    Pan_code_trick.Visible = True
    '    Pan_select_trick_type.Visible = False


    '    trickcodinglables.Add(New Label())


    '    trickcodinglables(0).Location = New Drawing.Point(30, 0)
    '    'MsgBox(trickcodinglables(loopcounter).Location.ToString())
    '    trickcodinglables(0).Text = "Trick Name "
    '    trickcodinglables(0).Parent = Pan_code_trick

    '    trickcodingcontrolls.Add(New Label)
    '    trickcodingcontrolls(0).Parent = Pan_code_trick
    '    'countofeachtrictype()
    '    trickcodingcontrolls(0).text = tricktypenames(CB_select_trick_type.SelectedIndex)
    '    trickcodingcontrolls(0).size = New Drawing.Size(trickcodingcontrolls(0).Size.Width + 20, trickcodingcontrolls(0).Size.Height)
    '    'Dim temp As TextBox
    '    'temp.Size = New Drawing.Size(temp.Size.Width + 20, temp.Size.Height)
    '    trickcodingcontrolls(0).enabled = False
    '    'If (namecount > 1) Then
    '    'trickcodingcontrolls(0).text += namecount.ToString
    '    'End If
    '    trickcodingcontrolls(0).Location = New Drawing.Point(30, 23)
    '    Dim loopcounter As Integer = 0

    '    While (loopcounter < timesthroughloop)


    '        Dim labletext As String = tricks(CB_select_trick_type.SelectedIndex, tricks_2nd_demention_index.description)(loopcounter)
    '        Dim minvalue = tricks(CB_select_trick_type.SelectedIndex, tricks_2nd_demention_index.minimumvalue)(loopcounter)
    '        Dim maxvalue = tricks(CB_select_trick_type.SelectedIndex, tricks_2nd_demention_index.maximumvalue)(loopcounter)
    '        Dim valueoffset = tricks(CB_select_trick_type.SelectedIndex, tricks_2nd_demention_index.valueoffset)(loopcounter)
    '        'value added to what user is shown and subtracted when storing in memory
    '        ' primairily to convert between base 0 and base1

    '        trickcodinglables.Add(New Label())
    '        Dim templable As Label = New Label

    '        trickcodinglables(loopcounter + 1).Location = New Drawing.Point(30, 60 * (loopcounter + 1))
    '        'MsgBox(trickcodinglables(loopcounter).Location.ToString())
    '        trickcodinglables(loopcounter + 1).Text = labletext
    '        trickcodinglables(loopcounter + 1).Parent = Pan_code_trick

    '        If (minvalue.Equals(DBNull.Value) Or maxvalue.Equals(DBNull.Value)) Then

    '            trickcodingcontrolls.Add(New TextBox())
    '            trickcodingcontrolls(loopcounter + 1).Parent = Pan_code_trick


    '        Else
    '            trickcodingcontrolls.Add(New ComboBox())
    '            trickcodingcontrolls(loopcounter + 1).Parent = Pan_code_trick
    '            Dim loopcounter2 As Integer = minvalue
    '            Dim indextoselect As Integer
    '            While (loopcounter2 <= maxvalue)

    '                trickcodingcontrolls(loopcounter + 1).Items.Add(loopcounter2 + valueoffset)

    '                If (loopcounter2 = tricks(CB_select_trick_type.SelectedIndex, tricks_2nd_demention_index.actualvalue)(loopcounter)) Then
    '                    indextoselect = trickcodingcontrolls(loopcounter + 1).Items.Count - 1

    '                End If


    '                loopcounter2 += 1
    '            End While
    '            trickcodingcontrolls(loopcounter + 1).SelectedIndex = indextoselect



    '        End If
    '        trickcodingcontrolls(loopcounter + 1).Location = New Drawing.Point(30, 60 * (loopcounter + 1) + 23)
    '        loopcounter += 1
    '    End While
    '    But_coding_ok.Location = New Drawing.Point(But_coding_ok.Location.X, 60 * (loopcounter + 1) + 23)
    '    But_coding_cancel.Location = New Drawing.Point(But_coding_cancel.Location.X, 60 * (loopcounter + 1) + 23)
    '    'But_export_trick.Location = New Drawing.Point(But_export_trick.Location.X, 60 * (loopcounter + 2) + 23)
    '    'But_import_trick.Location = New Drawing.Point(But_import_trick.Location.X, 60 * (loopcounter + 2) + 23)
    'End Sub

    'Private Sub Pan_code_trick_Paint(ByVal sender As System.Object, ByVal e As System.Windows.Forms.PaintEventArgs)

    'End Sub

    'Private Sub But_coding_cancel_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
    '    Pan_code_trick.Visible = False
    '    Pan_select_trick_type.Visible = False
    '    pan_maintrickoptions.Visible = True
    '    Dim loopcounter As Integer = 0
    '    While (loopcounter < trickcodinglables.Count)
    '        trickcodinglables(loopcounter).Dispose()
    '        trickcodingcontrolls(loopcounter).Dispose()
    '        loopcounter += 1
    '    End While
    'End Sub

    'Private Sub But_coding_ok_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
    '    Dim loopcounter = 1
    '    Dim mytricknumber = CB_select_trick_type.SelectedIndex
    '    Dim parameterfromform As Int16

    '    deviceandmemorymatch = False
    '    change = True
    '    While (loopcounter < trickcodingcontrolls.Count)
    '        Dim valueoffset = tricks(CB_select_trick_type.SelectedIndex, tricks_2nd_demention_index.valueoffset)(loopcounter - 1)
    '        parameterfromform = trickcodingcontrolls(loopcounter).text
    '        tricks(mytricknumber, tricks_2nd_demention_index.actualvalue)(loopcounter - 1) = parameterfromform - valueoffset


    '        loopcounter += 1
    '    End While



    '    Pan_code_trick.Visible = False
    '    Pan_select_trick_type.Visible = False
    '    pan_maintrickoptions.Visible = True
    '    loopcounter = 0
    '    While (loopcounter < trickcodinglables.Count)
    '        trickcodinglables(loopcounter).Dispose()
    '        trickcodingcontrolls(loopcounter).Dispose()
    '        loopcounter += 1
    '    End While
    '    simulator_form._refresh()
    '    refresh_demo()


    'End Sub

    'Private Sub But_set_active_trick_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)




    '    CB_select_active_trick.SelectedIndex = activetrick
    '    CB_monitor_active_trick.SelectedIndex = activetrick
    '    Pan_select_active_trick.Dock = DockStyle.Fill
    '    Pan_select_active_trick.Visible = True
    '    pan_maintrickoptions.Visible = False

    'End Sub

    'Private Sub But_select_active_trick_cancel_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
    '    Pan_select_active_trick.Visible = False
    '    pan_maintrickoptions.Visible = True

    'End Sub

    'Private Sub But_make_Trick_active_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)


    '    activetrick = CB_select_active_trick.SelectedIndex

    '    'CB_monitor_active_trick.SelectedIndex = activetrick
    '    Pan_select_active_trick.Visible = False
    '    pan_maintrickoptions.Visible = True
    '    simulator_form._refresh()
    '    refresh_demo()
    'End Sub

    'Private Sub Pan_tricks_VisibleChanged(ByVal sender As System.Object, ByVal e As System.EventArgs)

    '    Pan_select_active_trick.Dock = DockStyle.Fill
    '    Pan_code_trick.Dock = DockStyle.Fill
    '    Pan_select_active_trick.Dock = DockStyle.Fill
    '    Pan_select_trick_type.Dock = DockStyle.Fill
    '    'Pan_trick_options.Dock = DockStyle.Fill

    'End Sub

    'Private Sub TrickModeToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles TrickModeToolStripMenuItem.Click
    '    showtricks()
    'End Sub

    Private Sub But_sendtricktodevice_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        sendtrickstodevice()
    End Sub

    'Private Sub But_modify_tricks_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
    '    Pan_select_trick_type.Visible = True
    '    pan_maintrickoptions.Visible = False
    'End Sub

    'Private Sub But_select_active_trick_cancel_Click_1(ByVal sender As System.Object, ByVal e As System.EventArgs)
    '    Pan_select_active_trick.Visible = False
    '    pan_maintrickoptions.Visible = True
    'End Sub



    'Private Sub But_select_trick_cancel_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
    '    Pan_select_trick_type.Visible = False
    '    pan_maintrickoptions.Visible = True
    'End Sub

    Private Sub But_send_trick_to_device_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        If (Not comportselected) Then

            If (Not selectcomport()) Then
                Return
            End If
        End If

        If Not (sendtrickstodevice()) Then
            MsgBox("FAILED")
        Else
            MsgBox("tricks succesfully sent")

        End If
    End Sub

    'Private Sub But_get_trick_from_device_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
    '    If (Not comportselected) Then

    '        If (Not selectcomport()) Then
    '            Return
    '        End If
    '    End If

    '    If Not (gettricksfromdevice()) Then
    '        MsgBox("FAILED")
    '    Else
    '        simulator_form._refresh()
    '        refresh_demo()
    '        'MsgBox("tricks succesfully gotten")
    '    End If

    'End Sub
    'Function parseeditfieldhighlite(ByVal value As String) As System.Drawing.Point
    '    Dim arr As String() = value.Split("-")
    '    If arr.Length = 1 Then
    '        return new Point (arr[0], 
    '    End If



    'End Function



    'Sub refresh_Pan_edit_and_pan_demo()
    '    'tricks(activetrick, tricks_2nd_demention_index.editfieldhighlite)
    '    'Dim range As System.Drawing.Point = parseeditfieldhighlite(tricks(activetrick, tricks_2nd_demention_index.editfieldhighlite))



    '    'Labl_from0.Text = ""

    '    'Labl_from1.Text = ""
    '    'Labl_from2.Text = ""
    '    'Labl_from3.Text = ""
    '    'Labl_from4.Text = ""
    '    'Labl_from5.Text = ""
    '    'Labl_from6.Text = ""
    '    'Labl_from7.Text = ""
    '    'Labl_from8.Text = ""
    '    'Labl_from9.Text = ""


    '    lbl_to0.Text = ""

    '    lbl_to1.Text = ""
    '    lbl_to2.Text = ""
    '    lbl_to3.Text = ""
    '    lbl_to4.Text = ""
    '    lbl_to5.Text = ""
    '    lbl_to6.Text = ""
    '    lbl_to7.Text = ""
    '    lbl_to8.Text = ""
    '    lbl_to9.Text = ""


    '    Dim arr As String() = tricks(activetrick, tricks_2nd_demention_index.editfieldhighlite).Split("-")
    '    If arr.Length = 1 Then

    '        Pan_totaltime.Visible = False
    '        mark_unselected(TB0)
    '        mark_unselected(TB1)
    '        mark_unselected(TB2)
    '        mark_unselected(TB3)
    '        mark_unselected(TB4)
    '        mark_unselected(TB5)
    '        mark_unselected(TB6)
    '        mark_unselected(TB7)
    '        mark_unselected(TB8)
    '        mark_unselected(TB9)


    '        Txt_demoline0.Visible = False
    '        Txt_demoline1.Visible = False
    '        Txt_demoline2.Visible = False
    '        Txt_demoline3.Visible = False
    '        Txt_demoline4.Visible = False
    '        Txt_demoline5.Visible = False
    '        Txt_demoline6.Visible = False
    '        Txt_demoline7.Visible = False
    '        Txt_demoline8.Visible = False
    '        Txt_demoline9.Visible = False









    '        Dim highlitedline As Integer = tricks(activetrick, tricks_2nd_demention_index.actualvalue)(Convert.ToInt32(arr(0), 10))
    '        If highlitedline = 0 Then
    '            mark_selected(TB0)
    '            Txt_demoline0.Visible = True
    '            'Labl_from0.Text = "always"
    '            lbl_to0.Text = "always on"
    '        ElseIf highlitedline = 1 Then
    '            mark_selected(TB1)
    '            Txt_demoline1.Visible = False
    '            'Labl_from1.Text = "always"
    '            lbl_to1.Text = "always on"

    '        ElseIf highlitedline = 2 Then
    '            mark_selected(TB2)
    '            Txt_demoline2.Visible = False
    '            'Labl_from2.Text = "always"
    '            lbl_to2.Text = "always on"

    '        ElseIf highlitedline = 3 Then
    '            mark_selected(TB3)
    '            Txt_demoline3.Visible = False
    '            'Labl_from3.Text = "always"
    '            lbl_to3.Text = "always on"

    '        ElseIf highlitedline = 4 Then
    '            mark_selected(TB4)
    '            Txt_demoline4.Visible = False
    '            'Labl_from4.Text = "always"
    '            lbl_to4.Text = "always on"

    '        ElseIf highlitedline = 5 Then
    '            mark_selected(TB5)
    '            Txt_demoline5.Visible = False
    '            'Labl_from5.Text = "always"
    '            lbl_to5.Text = "always on"

    '        ElseIf highlitedline = 6 Then
    '            mark_selected(TB6)
    '            Txt_demoline6.Visible = False
    '            'Labl_from6.Text = "always"
    '            lbl_to6.Text = "always on"

    '        ElseIf highlitedline = 7 Then
    '            mark_selected(TB7)
    '            Txt_demoline7.Visible = False
    '            'Labl_from7.Text = "always"
    '            lbl_to7.Text = "always on"

    '        ElseIf highlitedline = 8 Then
    '            mark_selected(TB8)
    '            Txt_demoline8.Visible = False
    '            'Labl_from8.Text = "always"
    '            lbl_to8.Text = "always on"

    '        ElseIf highlitedline = 9 Then
    '            mark_selected(TB9)
    '            Txt_demoline9.Visible = False
    '            'Labl_from9.Text = "always"
    '            lbl_to9.Text = "always on"


    '        End If


    '        'MsgBox(highlitedline)

    '    ElseIf arr.Length = 2 Then
    '        mark_unselected(TB0)
    '        mark_unselected(TB1)
    '        mark_unselected(TB2)
    '        mark_unselected(TB3)
    '        mark_unselected(TB4)
    '        mark_unselected(TB5)
    '        mark_unselected(TB6)
    '        mark_unselected(TB7)
    '        mark_unselected(TB8)
    '        mark_unselected(TB9)



    '        Txt_demoline0.Visible = False
    '        Txt_demoline1.Visible = False
    '        Txt_demoline2.Visible = False
    '        Txt_demoline3.Visible = False
    '        Txt_demoline4.Visible = False
    '        Txt_demoline5.Visible = False
    '        Txt_demoline6.Visible = False
    '        Txt_demoline7.Visible = False
    '        Txt_demoline8.Visible = False
    '        Txt_demoline9.Visible = False

    '        Dim min As Integer = tricks(activetrick, tricks_2nd_demention_index.actualvalue)(Convert.ToInt32(arr(0), 10))
    '        Dim max As Integer = tricks(activetrick, tricks_2nd_demention_index.actualvalue)(Convert.ToInt32(arr(1), 10)) - 1
    '        'the time line does not work in this circumstance
    '        If (min > max) Then
    '            Dim loopcounter As Integer = max
    '            While (loopcounter <= min)

    '                If loopcounter = 0 Then
    '                    Txt_demoline0.Visible = True
    '                    mark_selected(TB0)
    '                ElseIf loopcounter = 1 Then
    '                    mark_selected(TB1)
    '                    Txt_demoline1.Visible = True
    '                ElseIf loopcounter = 2 Then
    '                    mark_selected(TB2)
    '                    Txt_demoline2.Visible = True
    '                ElseIf loopcounter = 3 Then
    '                    mark_selected(TB3)
    '                    Txt_demoline3.Visible = True
    '                ElseIf loopcounter = 4 Then
    '                    mark_selected(TB4)
    '                    Txt_demoline4.Visible = True
    '                ElseIf loopcounter = 5 Then
    '                    mark_selected(TB5)
    '                    Txt_demoline5.Visible = True

    '                ElseIf loopcounter = 6 Then
    '                    mark_selected(TB6)
    '                    Txt_demoline6.Visible = True
    '                ElseIf loopcounter = 7 Then
    '                    mark_selected(TB7)
    '                    Txt_demoline7.Visible = True
    '                ElseIf loopcounter = 8 Then
    '                    mark_selected(TB8)
    '                    Txt_demoline8.Visible = True
    '                ElseIf loopcounter = 9 Then
    '                    mark_selected(TB9)
    '                    Txt_demoline9.Visible = True

    '                End If
    '                loopcounter += 1
    '            End While

    '        Else
    '            Dim loopcounter As Integer = min

    '            Dim interval = tricks(1, Form1.tricks_2nd_demention_index.actualvalue)(2) / 10
    '            Dim decimalpoints As Boolean
    '            If Convert.ToInt32(interval) = interval Then
    '                decimalpoints = False
    '            Else
    '                decimalpoints = True
    '            End If


    '            While (loopcounter <= max)

    '                If loopcounter = 0 Then
    '                    Txt_demoline0.Visible = True
    '                    mark_selected(TB0)


    '                    'Labl_from0.Text = (loopcounter - min) * interval
    '                    If decimalpoints Then
    '                        Dim value As String = ((loopcounter - min + 1) * interval).ToString
    '                        If value.IndexOf(".") = -1 Then
    '                            value += ".0"


    '                        End If

    '                        lbl_to0.Text = "0.0  -->  " + value

    '                    Else
    '                        lbl_to0.Text = "0  -->  " + ((loopcounter - min + 1) * interval).ToString
    '                    End If


    '                    'lbl_totaltime.Top = Txt_demoline1.Top

    '                ElseIf loopcounter = 1 Then
    '                    mark_selected(TB1)
    '                    Txt_demoline1.Visible = True
    '                    'Labl_from1.Text = "   -" + ((loopcounter - min + 1) * interval).ToString




    '                    If decimalpoints Then
    '                        Dim value As String = ((loopcounter - min + 1) * interval).ToString
    '                        If value.IndexOf(".") = -1 Then
    '                            value += ".0"
    '                        End If

    '                        lbl_to1.Text = "       -->  " + value
    '                    Else
    '                        lbl_to1.Text = "    -->  " + ((loopcounter - min + 1) * interval).ToString
    '                    End If

    '                    'lbl_totaltime.Top = Txt_demoline2.Top
    '                ElseIf loopcounter = 2 Then
    '                    mark_selected(TB2)
    '                    Txt_demoline2.Visible = True
    '                    'Labl_from2.Text = "   -" '(loopcounter - min) * interval
    '                    If decimalpoints Then
    '                        Dim value As String = ((loopcounter - min + 1) * interval).ToString
    '                        If value.IndexOf(".") = -1 Then
    '                            value += ".0"
    '                        End If

    '                        lbl_to2.Text = "       -->  " + value
    '                    Else
    '                        lbl_to2.Text = "    -->  " + ((loopcounter - min + 1) * interval).ToString
    '                    End If

    '                    'lbl_totaltime.Top = Txt_demoline3.Top
    '                ElseIf loopcounter = 3 Then
    '                    mark_selected(TB3)
    '                    Txt_demoline3.Visible = True
    '                    'Labl_from3.Text = "-" ' (loopcounter - min) * interval
    '                    If decimalpoints Then
    '                        Dim value As String = ((loopcounter - min + 1) * interval).ToString
    '                        If value.IndexOf(".") = -1 Then
    '                            value += ".0"
    '                        End If

    '                        lbl_to3.Text = "       -->  " + value
    '                    Else
    '                        lbl_to3.Text = "    -->  " + ((loopcounter - min + 1) * interval).ToString
    '                    End If

    '                    'lbl_totaltime.Top = Txt_demoline4.Top
    '                ElseIf loopcounter = 4 Then
    '                    mark_selected(TB4)
    '                    Txt_demoline4.Visible = True
    '                    'Labl_from4.Text = "-" '(loopcounter - min) * interval
    '                    If decimalpoints Then
    '                        Dim value As String = ((loopcounter - min + 1) * interval).ToString
    '                        If value.IndexOf(".") = -1 Then
    '                            value += ".0"
    '                        End If

    '                        lbl_to4.Text = "       -->  " + value
    '                    Else
    '                        lbl_to4.Text = "    -->  " + ((loopcounter - min + 1) * interval).ToString
    '                    End If

    '                    'lbl_totaltime.Top = Txt_demoline5.Top
    '                ElseIf loopcounter = 5 Then
    '                    mark_selected(TB5)
    '                    Txt_demoline5.Visible = True
    '                    'Labl_from5.Text = "-" '(loopcounter - min) * interval
    '                    If decimalpoints Then
    '                        Dim value As String = ((loopcounter - min + 1) * interval).ToString
    '                        If value.IndexOf(".") = -1 Then
    '                            value += ".0"
    '                        End If

    '                        lbl_to5.Text = "       -->  " + value
    '                    Else
    '                        lbl_to5.Text = "    -->  " + ((loopcounter - min + 1) * interval).ToString
    '                    End If

    '                    'lbl_totaltime.Top = Txt_demoline6.Top

    '                ElseIf loopcounter = 6 Then
    '                    mark_selected(TB6)
    '                    Txt_demoline6.Visible = True
    '                    'Labl_from6.Text = "-" ' (loopcounter - min) * interval
    '                    If decimalpoints Then
    '                        Dim value As String = ((loopcounter - min + 1) * interval).ToString
    '                        If value.IndexOf(".") = -1 Then
    '                            value += ".0"
    '                        End If

    '                        lbl_to6.Text = "       -->  " + value
    '                    Else
    '                        lbl_to6.Text = "    -->  " + ((loopcounter - min + 1) * interval).ToString
    '                    End If

    '                    'lbl_totaltime.Top = Txt_demoline7.Top
    '                ElseIf loopcounter = 7 Then
    '                    mark_selected(TB7)
    '                    Txt_demoline7.Visible = True
    '                    'Labl_from7.Text = "-" '(loopcounter - min) * interval

    '                    If decimalpoints Then
    '                        Dim value As String = ((loopcounter - min + 1) * interval).ToString
    '                        If value.IndexOf(".") = -1 Then
    '                            value += ".0"
    '                        End If

    '                        lbl_to7.Text = "       -->  " + value
    '                    Else
    '                        lbl_to7.Text = "    -->  " + ((loopcounter - min + 1) * interval).ToString
    '                    End If

    '                    'lbl_totaltime.Top = Txt_demoline8.Top
    '                ElseIf loopcounter = 8 Then
    '                    mark_selected(TB8)
    '                    Txt_demoline8.Visible = True
    '                    'Labl_from8.Text = "-" '(loopcounter - min) * interval
    '                    If decimalpoints Then
    '                        Dim value As String = ((loopcounter - min + 1) * interval).ToString
    '                        If value.IndexOf(".") = -1 Then
    '                            value += ".0"
    '                        End If

    '                        lbl_to8.Text = "       -->  " + value
    '                    Else
    '                        lbl_to8.Text = "    -->  " + ((loopcounter - min + 1) * interval).ToString
    '                    End If

    '                    'lbl_totaltime.Top = Txt_demoline9.Top
    '                ElseIf loopcounter = 9 Then
    '                    mark_selected(TB9)
    '                    Txt_demoline9.Visible = True
    '                    'Labl_from9.Text = "-" '(loopcounter - min) * interval
    '                    If decimalpoints Then
    '                        Dim value As String = ((loopcounter - min + 1) * interval).ToString
    '                        If value.IndexOf(".") = -1 Then
    '                            value += ".0"
    '                        End If
    '                        lbl_to9.Text = "       -->  " + value
    '                    Else
    '                        lbl_to9.Text = "    -->  " + ((loopcounter - min + 1) * interval).ToString
    '                    End If
    '                    'lbl_totaltime.Top = Txt_demoline9.Top + (Txt_demoline9.Top - Txt_demoline8.Top)
    '                End If
    '                loopcounter += 1
    '            End While
    '            Pan_totaltime.Visible = True
    '            Pan_totaltime.Top = Txt_demoline0.Top - 7 + (Txt_demoline1.Top - Txt_demoline0.Top) * (max - min + 1)
    '            lbl_totaltime.Text = "Total Time    " + (interval * (max - min + 1)).ToString + "   Seconds"
    '        End If

    '    Else
    '        MsgBox("error in functions refresh_pan_Edit_and_pan_demo(): wrong number of members in arr")
    '    End If
    'End Sub


    Public Sub refresh_pan_morelines()

        Return
        'this function is no longer used since the panel was removed
        'in version 1.09.002 we made it so that the only option is to cycle through all lines
        If ProgressForm.active Then
            'thread issue occur when this is called while getting data from sign 
            Return
        End If

        timer_monitor_ifdoubleclickmanuel.Stop()

        'refresh speed textbox
        TB_pan_morelines_speed.Text = tricks_get_parameters(1)(2) / 10


        Dim selectedtobox = tricks_get_parameters(1)(1)
        'MsgBox(selectedtobox)

        Dim tolineboxes_walker As Integer = 0
        While tolineboxes_walker < tolineboxes.Count
            tolineboxes(tolineboxes_walker).dispose()
            tolineboxes_walker += 1
        End While
        tolineboxes = New ArrayList
        'lll()
        Dim loopctr = 1
        'MsgBox(tricks(activetrick, tricks_2nd_demention_index.actualvalue)(loopcounter))
        Const toboxhorizontalstart As Integer = 170
        While (loopctr < 15 And loopctr < linecount)

            Dim temppanel2 As Panel = New Panel
            Dim labletemp As Label = New Label

            If selectedtobox = loopctr + 1 Then

                'MsgBox(selectedtobox.ToString + " " + (loopctr + 1).ToString)
                mark_selected(temppanel2)

            Else
                mark_unselected(temppanel2)
            End If
            temppanel2.Tag = loopctr + 1
            labletemp.Text = loopctr + 1
            labletemp.Font = New Font(labletemp.Font.FontFamily, 5.5)

            labletemp.Size = New Drawing.Size(14, 13)
            If (loopctr < 9) Then
                labletemp.Location = New Drawing.Point(2, 6)
            Else
                labletemp.Location = New Drawing.Point(0, 6)
            End If

            labletemp.Parent = temppanel2

            temppanel2.Size = New Drawing.Size(14, 20)
            temppanel2.Location = New Drawing.Point(toboxhorizontalstart + 12 * (loopctr), 10)
            temppanel2.BorderStyle = BorderStyle.FixedSingle

            'temppanel2.Parent = pan_showmorelines
            'trickcodingcontrolls(loopcounter).size = New Drawing.Size(10 * (loopctr3 - minvalue), 20)
            tolineboxes.Add(temppanel2)
            loopctr += 1

        End While
        If (linecount <= 15) Then
            'done

            timer_monitor_ifdoubleclickmanuel.Start()
            Return
        End If

        If (linecount <= 30) Then

            While (loopctr < 30 And loopctr < linecount)

                Dim temppanel2 As Panel = New Panel
                Dim labletemp As Label = New Label
                If selectedtobox = loopctr + 1 Then
                    mark_selected(temppanel2)

                Else
                    mark_unselected(temppanel2)
                End If

                temppanel2.Tag = loopctr + 1
                labletemp.Text = loopctr + 1
                labletemp.Font = New Font(labletemp.Font.FontFamily, 5.5)

                labletemp.Size = New Drawing.Size(14, 13)
                If (loopctr < 9) Then
                    labletemp.Location = New Drawing.Point(2, 6)
                Else
                    labletemp.Location = New Drawing.Point(0, 6)
                End If

                labletemp.Parent = temppanel2

                temppanel2.Size = New Drawing.Size(14, 20)
                temppanel2.Location = New Drawing.Point(toboxhorizontalstart + 12 * (loopctr - 14), 30)
                temppanel2.BorderStyle = BorderStyle.FixedSingle
                'temppanel2.Parent = pan_showmorelines

                'trickcodingcontrolls(loopcounter).size = New Drawing.Size(10 * (loopctr3 - minvalue), 20)
                tolineboxes.Add(temppanel2)
                loopctr += 1

            End While

        Else
            loopctr = linecount - 1
            While (loopctr >= 15)

                Dim temppanel2 As Panel = New Panel
                Dim labletemp As Label = New Label
                If selectedtobox = loopctr + 1 Then
                    mark_selected(temppanel2)

                Else
                    mark_unselected(temppanel2)
                End If

                temppanel2.Tag = loopctr + 1
                labletemp.Text = loopctr + 1
                labletemp.Font = New Font(labletemp.Font.FontFamily, 5.5)

                labletemp.Size = New Drawing.Size(14, 13)
                If (loopctr < 10) Then
                    labletemp.Location = New Drawing.Point(2, 6)
                Else
                    labletemp.Location = New Drawing.Point(0, 6)
                End If

                labletemp.Parent = temppanel2

                temppanel2.Size = New Drawing.Size(14, 20)
                temppanel2.Location = New Drawing.Point((toboxhorizontalstart + 12 * 15) - 12 * (linecount - loopctr), 30)
                temppanel2.BorderStyle = BorderStyle.FixedSingle
                'temppanel2.BackColor = Color.White
                'If (loopctr + 1 = tricks_get_parameters(1)(2)) Then
                '    'mark_selected(labletemp)
                '    mark_selected(temppanel2)
                'Else
                '    'MsgBox(loopctr3)
                '    'mark_unselected(labletemp)
                '    mark_unselected(temppanel2)
                'End If
                'temppanel2.Parent = pan_showmorelines
                'trickcodingcontrolls(loopcounter).size = New Drawing.Size(10 * (loopctr3 - minvalue), 20)
                tolineboxes.Add(temppanel2)
                loopctr -= 1

            End While

        End If

        timer_monitor_ifdoubleclickmanuel.Start()

        ' trickcodingcontrolls(loopcounter).Location = New Drawing.Point(10 + trickcodingleftlables(loopcounter).width, 30 * (loopcounter - nonecontrollcount))

    End Sub


    Sub refresh_Pan_trick_parameters()

        'this function used to read trick parameters from an arraylist
        'it was abandoned for a more easy set up but may be revisited later with more display patterns added

        ''MsgBox("refresh pan trick")
        'Const charsInThinistlabel As Int16 = 2
        'Const WIDTHOFCHARACTER As Int16 = 7
        'Const MINIMUMLABELWIDTH As Int16 = 21

        'Dim style As FontStyle = FontStyle.Bold
        'Dim size As Single = 8.25
        'Dim lablefont = New Font(New FontFamily("Courier New"), size, style)


        'If (BGW_read_device.IsBusy) Then
        '    'this function will not work when called from other threads because of controll parenting issues

        '    Return

        'End If

        ''Const charsInThinistWindow As Int16 = 14
        ''MINIMUMFORMWIDTH + (templinelength - charsInThinistWindow) * WIDTHOFCHARACTER > Me.Width

        '''''''''''''''''''''''''''''''''''''''''''''''''''
        ''''''''Dispose of old labels and controlls''''''''
        '''''''''''''''''''''''''''''''''''''''''''''''''''

        'Dim parametercount As Integer = tricks(CB_monitor_active_trick.SelectedIndex, tricks_2nd_demention_index.description).Count

        'Dim loopctr As Integer = 0

        'While loopctr < trickcodingleftlables.Count
        '    trickcodingleftlables(loopctr).dispose()
        '    loopctr += 1
        'End While
        'loopctr = 0
        'While loopctr < trickcodingcontrolls.Count
        '    If (trickcodingcontrolls(loopctr).GetType.Name <> "DBNull") Then
        '        trickcodingcontrolls(loopctr).dispose()
        '    End If


        '    loopctr += 1
        'End While
        'loopctr = 0
        'While loopctr < trickcodingrightlables.Count
        '    trickcodingrightlables(loopctr).dispose()
        '    loopctr += 1
        'End While

        'trickcodingleftlables = New ArrayList()
        'trickcodingrightlables = New ArrayList()
        'trickcodingcontrolls = New ArrayList()
        'trickcodingdecimals = New ArrayList()


        '''''''''''''''''''''''''''''''''''''''''''''''''''
        '''''loop for creating new labels and controlls''''
        '''''''''''''''''''''''''''''''''''''''''''''''''''

        'Dim nonecontrollcount As Integer = 0
        'Dim loopcounter As Integer = 0
        'While (loopcounter < parametercount)


        '    ''''''''''''''''''''''''''''''''''''''''''''''''''
        '    ''''''''''Text of right and left lables'''''''''''
        '    ''''''''''''''''''''''''''''''''''''''''''''''''''

        '    Dim lablelefttext As String
        '    Dim lablerighttext As String
        '    If (tricks(activetrick, tricks_2nd_demention_index.description)(loopcounter).GetType.Name = "ArrayList") Then
        '        lablelefttext = (tricks(activetrick, tricks_2nd_demention_index.description)(loopcounter)(0))
        '        lablerighttext = (tricks(activetrick, tricks_2nd_demention_index.description)(loopcounter)(1))

        '    ElseIf (tricks(activetrick, tricks_2nd_demention_index.description)(loopcounter).GetType.Name = "String") Then
        '        lablelefttext = tricks(activetrick, tricks_2nd_demention_index.description)(loopcounter)
        '        lablerighttext = ""

        '    End If

        '    'value added to what user is shown and subtracted when storing in memory
        '    ' primairily to convert between base 0 and base1


        '    ''''''''''''''''''''''''''''''''''''''''''''''''''
        '    '''''''''''''''''left labels''''''''''''''''''''''
        '    ''''''''''''''''''''''''''''''''''''''''''''''''''

        '    trickcodingleftlables.Add(New Label())

        '    trickcodingleftlables(loopcounter).Location = New Drawing.Point(4, 30 * (loopcounter - nonecontrollcount) + 2)
        '    'MsgBox(trickcodinglables(loopcounter).Location.ToString())
        '    trickcodingleftlables(loopcounter).Text = lablelefttext

        '    trickcodingleftlables(loopcounter).Font = lablefont

        '    trickcodingleftlables(loopcounter).width = MINIMUMLABELWIDTH

        '    If trickcodingleftlables(loopcounter).text.length > charsInThinistlabel Then
        '        trickcodingleftlables(loopcounter).width += (trickcodingleftlables(loopcounter).text.length - charsInThinistlabel) * WIDTHOFCHARACTER
        '    End If

        '    If (tricks(CB_monitor_active_trick.SelectedIndex, tricks_2nd_demention_index.controlltype)(loopcounter) <> controlltype.none) Then
        '        trickcodingleftlables(loopcounter).Parent = Pan_trick_parameters
        '    End If





        '    ' trickcodingleftlables(loopcounter).Width -= 45
        '    ''''''''''
        '    'tricks(1, tricks_2nd_demention_index.decimals).Add(1) 'dummy
        '    'tricks(1, tricks_2nd_demention_index.controlltype).Add(controlltype.textbox) 'dummy
        '    '''''''''''

        '    ''''''''''''''''''''''''''''''''''''''''''''''''''
        '    '''''''''''''''''''Decimals'''''''''''''''''''''''
        '    ''''''''''''''''''''''''''''''''''''''''''''''''''

        '    'MsgBox(tricks(CB_monitor_active_trick.SelectedIndex, tricks_2nd_demention_index.decimals)(loopcounter))
        '    trickcodingdecimals.Add(tricks(CB_monitor_active_trick.SelectedIndex, tricks_2nd_demention_index.decimals)(loopcounter))



        '    ''''''''''''''''''''''''''''''''''''''''''''''''''
        '    '''''''''''''''''controlls''''''''''''''''''''''
        '    ''''''''''''''''''''''''''''''''''''''''''''''''''
        '    '= tricks(activetrick, tricks_2nd_demention_index.description)(loopcounter)
        '    Dim minvalue = tricks(activetrick, tricks_2nd_demention_index.minimumvalue)(loopcounter)
        '    Dim maxvalue = tricks(activetrick, tricks_2nd_demention_index.maximumvalue)(loopcounter)
        '    Dim valueoffset = tricks(activetrick, tricks_2nd_demention_index.valueoffset)(loopcounter)




        '    If (tricks(CB_monitor_active_trick.SelectedIndex, tricks_2nd_demention_index.controlltype)(loopcounter) = controlltype.none) Then
        '        'placed here so that a lable will not be inaproprately placed for controll.none 
        '        trickcodingcontrolls.Add(DBNull.Value)
        '        trickcodingrightlables.Add(New Label())
        '        loopcounter += 1
        '        nonecontrollcount += 1
        '        Continue While
        '    ElseIf (tricks(CB_monitor_active_trick.SelectedIndex, tricks_2nd_demention_index.controlltype)(loopcounter) = controlltype.textbox) Then
        '        trickcodingcontrolls.Add(New TextBox())
        '        trickcodingcontrolls(loopcounter).width = 30
        '        trickcodingcontrolls(loopcounter).Parent = Pan_trick_parameters
        '        trickcodingcontrolls(loopcounter).text = tricks(activetrick, tricks_2nd_demention_index.actualvalue)(loopcounter) / (10 ^ tricks(CB_monitor_active_trick.SelectedIndex, tricks_2nd_demention_index.decimals)(loopcounter))
        '        'MsgBox((tricks(CB_monitor_active_trick.SelectedIndex, tricks_2nd_demention_index.decimals)(loopcounter)))
        '    ElseIf (tricks(CB_monitor_active_trick.SelectedIndex, tricks_2nd_demention_index.controlltype)(loopcounter) = controlltype.dropdown) Then
        '        Dim temp As ComboBox = New ComboBox()
        '        temp.Width = (temp.Width / 2) * 3 / 4
        '        trickcodingcontrolls.Add(temp)
        '        trickcodingcontrolls(loopcounter).Parent = Pan_trick_parameters
        '        Dim loopcounter2 As Integer = minvalue
        '        Dim indextoselect As Integer
        '        While (loopcounter2 <= maxvalue)
        '            trickcodingcontrolls(loopcounter).Items.Add(loopcounter2 + valueoffset)
        '            If (loopcounter2 = tricks(activetrick, tricks_2nd_demention_index.actualvalue)(loopcounter)) Then
        '                indextoselect = trickcodingcontrolls(loopcounter).Items.Count - 1
        '            End If
        '            loopcounter2 += 1
        '        End While
        '        trickcodingcontrolls(loopcounter).SelectedIndex = indextoselect
        '    ElseIf (tricks(CB_monitor_active_trick.SelectedIndex, tricks_2nd_demention_index.controlltype)(loopcounter) = controlltype.boxes) Then
        '        Dim temppanel As Panel = New Panel
        '        temppanel.BackColor = Color.PaleTurquoise
        '        temppanel.Size = New Drawing.Size(15 * (maxvalue - minvalue + 1), 22)
        '        trickcodingcontrolls.Add(temppanel)
        '        trickcodingcontrolls(loopcounter).Parent = Pan_trick_parameters
        '        Dim loopctr3 = minvalue
        '        'MsgBox(tricks(activetrick, tricks_2nd_demention_index.actualvalue)(loopcounter))

        '        While (loopctr3 <= maxvalue)

        '            Dim temppanel2 As Panel = New Panel
        '            Dim labletemp As Label = New Label
        '            temppanel2.Tag = loopctr3
        '            labletemp.Text = loopctr3 + valueoffset
        '            labletemp.Font = New Font(labletemp.Font.FontFamily, 5.5)

        '            labletemp.Size = New Drawing.Size(14, 13)
        '            If (loopctr3 + valueoffset < 10) Then
        '                labletemp.Location = New Drawing.Point(2, 6)
        '            Else
        '                labletemp.Location = New Drawing.Point(0, 6)
        '            End If

        '            labletemp.Parent = temppanel2

        '            temppanel2.Size = New Drawing.Size(14, 20)
        '            temppanel2.Location = New Drawing.Point(12 * (loopctr3 - minvalue), 0)
        '            temppanel2.BorderStyle = BorderStyle.FixedSingle
        '            temppanel2.BackColor = Color.White
        '            If (loopctr3 = tricks(activetrick, tricks_2nd_demention_index.actualvalue)(loopcounter)) Then
        '                'mark_selected(labletemp)
        '                mark_selected(temppanel2)
        '            Else
        '                'MsgBox(loopctr3)
        '                'mark_unselected(labletemp)
        '                mark_unselected(temppanel2)
        '            End If
        '            temppanel2.Parent = trickcodingcontrolls(loopcounter)
        '            'trickcodingcontrolls(loopcounter).size = New Drawing.Size(10 * (loopctr3 - minvalue), 20)

        '            loopctr3 += 1

        '        End While



        '    End If
        '    trickcodingcontrolls(loopcounter).Location = New Drawing.Point(10 + trickcodingleftlables(loopcounter).width, 30 * (loopcounter - nonecontrollcount))


        '    ''''''''''''''''''''''''''''''''''''''''''''''''''
        '    '''''''''''''''''right labels''''''''''''''''''''''
        '    ''''''''''''''''''''''''''''''''''''''''''''''''''


        '    trickcodingrightlables.Add(New Label())
        '    'MsgBox(trickcodingrightlables.Count.ToString + " " + loopcounter.ToString)
        '    'Dim templable As Label = New Label
        '    Dim tempdrawpoint As Drawing.Point = New Drawing.Point(trickcodingcontrolls(loopcounter).location.x + trickcodingcontrolls(loopcounter).width + 5, 30 * (loopcounter - nonecontrollcount) + 2)
        '    trickcodingrightlables(loopcounter).Location = tempdrawpoint
        '    'MsgBox(trickcodinglables(loopcounter).Location.ToString())
        '    trickcodingrightlables(loopcounter).Text = lablerighttext
        '    trickcodingrightlables(loopcounter).Font = lablefont
        '    ''''''''''''
        '    trickcodingrightlables(loopcounter).Font = lablefont

        '    trickcodingrightlables(loopcounter).width = MINIMUMLABELWIDTH

        '    If trickcodingrightlables(loopcounter).text.length > charsInThinistlabel Then
        '        trickcodingrightlables(loopcounter).width += (trickcodingrightlables(loopcounter).text.length - charsInThinistlabel) * WIDTHOFCHARACTER
        '    End If
        '    ''''''''''''''''''
        '    If (tricks(CB_monitor_active_trick.SelectedIndex, tricks_2nd_demention_index.controlltype)(loopcounter) <> controlltype.none) Then
        '        trickcodingrightlables(loopcounter).Parent = Pan_trick_parameters
        '    End If



        '    loopcounter += 1
        'End While
        'refresh_demo()
        ''Tim_trickcontrolls.Start()
        'refresh_Pan_edit_and_pan_demo()
    End Sub

    Private Sub CB_monitor_active_trick_SelectedIndexChanged(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Static recursive As Boolean = False


        If (Not recursive) Then
            Dim prev_activetrick = activetrick
            deviceandmemorymatch = False
            activetrick = CB_monitor_active_trick.SelectedIndex


            If (InMonitorMode) Then
                ' MsgBox("sending trick " + activetrick.ToString)
                While (Not writeparametertodevice(activetrick, ADDRESS_ACTIVETRICK))

                    If Not (Attempt_reestablish_communication()) Then
                        activetrick = prev_activetrick
                        recursive = True
                        CB_monitor_active_trick.SelectedIndex = prev_activetrick
                        recursive = False
                        showmonitor_commerror()
                        Return
                    End If


                End While
            End If

            recursive = True
            If (CB_monitor_active_trick.SelectedIndex = 0) Then

                oneline_Click(New System.Object, New System.Windows.Forms.MouseEventArgs(Windows.Forms.MouseButtons.Right, 0, 0, 0, 0))

            ElseIf (CB_monitor_active_trick.SelectedIndex = 1) Then
                morelines_Click(New System.Object, New System.Windows.Forms.MouseEventArgs(Windows.Forms.MouseButtons.Right, 0, 0, 0, 0))
            End If
            recursive = False


            refresh_Pan_trick_parameters()

            'If (CB_monitor_active_trick.SelectedIndex = 0) Then
            '    Pan_active_string.Visible = True
            'Else
            '    Pan_active_string.Visible = False
            'End If
            simulator_form._refresh()
            refresh_demo()
        End If ' not recursive

    End Sub

    'Private Sub Pan_monitor_active_trick_VisibleChanged(ByVal sender As System.Object, ByVal e As System.EventArgs)
    '    If (Pan_monitor_active_trick.Visible) Then
    '        send_CB_monitor_active_trick_SelectedIndexChanged_todevice = True
    '    Else
    '        send_CB_monitor_active_trick_SelectedIndexChanged_todevice = False
    '    End If

    'End Sub

    Private Sub CB_showclock_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs)
        'Static activestringtoreset As Int16
        'If (CB_showclock.Checked) Then
        '    Pan_selectactivetrick2.Visible = False
        '    Pan_showclock.Visible = True
        '    CB_live_edit.Visible = False
        '    '   activestringtoreset = 

        '    clock_stringused = New Random().Next(0, 10)

        '    readparameterfromdevice(clock_activestringtoreturnto, ADDRESS_ACTIVE_STRING)
        '    writeparametertodevice(clock_stringused, ADDRESS_ACTIVE_STRING)

        '    If (clock_stringused = 0) Then
        '        While (Not readLineFromDevice(ADDRESS0, clock_stringtowriteback))
        '            If (Not Attempt_reestablish_communication()) Then
        '                showmonitor_commerror()
        '                Tim_clock.Stop()
        '                Return
        '            End If

        '        End While

        '    ElseIf (clock_stringused = 1) Then
        '        While (Not readLineFromDevice(ADDRESS1, clock_stringtowriteback))
        '            If (Not Attempt_reestablish_communication()) Then
        '                showmonitor_commerror()
        '                Tim_clock.Stop()
        '                Return
        '            End If
        '        End While
        '    ElseIf (clock_stringused = 2) Then
        '        While (Not readLineFromDevice(ADDRESS2, clock_stringtowriteback))
        '            If (Not Attempt_reestablish_communication()) Then
        '                showmonitor_commerror()
        '                Tim_clock.Stop()
        '                Return
        '            End If
        '        End While
        '    ElseIf (clock_stringused = 3) Then
        '        While (Not readLineFromDevice(ADDRESS3, clock_stringtowriteback))
        '            If (Not Attempt_reestablish_communication()) Then
        '                showmonitor_commerror()
        '                Tim_clock.Stop()
        '                Return
        '            End If
        '        End While

        '    ElseIf (clock_stringused = 4) Then
        '        While (Not readLineFromDevice(ADDRESS4, clock_stringtowriteback))
        '            If (Not Attempt_reestablish_communication()) Then
        '                showmonitor_commerror()
        '                Tim_clock.Stop()
        '                Return
        '            End If
        '        End While

        '    ElseIf (clock_stringused = 5) Then
        '        While (Not readLineFromDevice(ADDRESS5, clock_stringtowriteback))
        '            If (Not Attempt_reestablish_communication()) Then
        '                showmonitor_commerror()
        '                Tim_clock.Stop()
        '                Return
        '            End If
        '        End While

        '    ElseIf (clock_stringused = 6) Then
        '        While (Not readLineFromDevice(ADDRESS6, clock_stringtowriteback))
        '            If (Not Attempt_reestablish_communication()) Then
        '                showmonitor_commerror()
        '                Tim_clock.Stop()
        '                Return
        '            End If
        '        End While

        '    ElseIf (clock_stringused = 7) Then
        '        While (Not readLineFromDevice(ADDRESS7, clock_stringtowriteback))
        '            If (Not Attempt_reestablish_communication()) Then
        '                showmonitor_commerror()
        '                Tim_clock.Stop()
        '                Return
        '            End If
        '        End While

        '    ElseIf (clock_stringused = 8) Then
        '        While (Not readLineFromDevice(ADDRESS8, clock_stringtowriteback))
        '            If (Not Attempt_reestablish_communication()) Then
        '                showmonitor_commerror()
        '                Tim_clock.Stop()
        '                Return
        '            End If
        '        End While

        '    ElseIf (clock_stringused = 9) Then
        '        While (Not readLineFromDevice(ADDRESS9, clock_stringtowriteback))
        '            If (Not Attempt_reestablish_communication()) Then
        '                showmonitor_commerror()
        '                Tim_clock.Stop()
        '                Return
        '            End If
        '        End While

        '    End If
        '    Tim_clock.Start()
        'Else
        '    Tim_clock.Stop()
        '    Pan_selectactivetrick2.Visible = True
        '    Pan_showclock.Visible = False
        '    CB_live_edit.Visible = True
        '    writeparametertodevice(clock_stringused, ADDRESS_ACTIVE_STRING)
        '    If (clock_stringused = 0) Then
        '        While (Not writeToDevice(ADDRESS0, clock_stringtowriteback))
        '            If (Not Attempt_reestablish_communication()) Then
        '                showmonitor_commerror()
        '                Tim_clock.Stop()
        '                Return
        '            End If
        '        End While

        '    ElseIf (clock_stringused = 1) Then
        '        While (Not writeToDevice(ADDRESS1, clock_stringtowriteback))
        '            If (Not Attempt_reestablish_communication()) Then
        '                showmonitor_commerror()
        '                Tim_clock.Stop()
        '                Return
        '            End If
        '        End While
        '    ElseIf (clock_stringused = 2) Then
        '        While (Not writeToDevice(ADDRESS2, clock_stringtowriteback))
        '            If (Not Attempt_reestablish_communication()) Then
        '                showmonitor_commerror()
        '                Tim_clock.Stop()
        '                Return
        '            End If
        '        End While
        '    ElseIf (clock_stringused = 3) Then
        '        While (Not writeToDevice(ADDRESS3, clock_stringtowriteback))
        '            If (Not Attempt_reestablish_communication()) Then
        '                showmonitor_commerror()
        '                Tim_clock.Stop()
        '                Return
        '            End If
        '        End While

        '    ElseIf (clock_stringused = 4) Then
        '        While (Not writeToDevice(ADDRESS4, clock_stringtowriteback))
        '            If (Not Attempt_reestablish_communication()) Then
        '                showmonitor_commerror()
        '                Tim_clock.Stop()
        '                Return
        '            End If
        '        End While

        '    ElseIf (clock_stringused = 5) Then
        '        While (Not writeToDevice(ADDRESS5, clock_stringtowriteback))
        '            If (Not Attempt_reestablish_communication()) Then
        '                showmonitor_commerror()
        '                Tim_clock.Stop()
        '                Return
        '            End If
        '        End While

        '    ElseIf (clock_stringused = 6) Then
        '        While (Not writeToDevice(ADDRESS6, clock_stringtowriteback))
        '            If (Not Attempt_reestablish_communication()) Then
        '                showmonitor_commerror()
        '                Tim_clock.Stop()
        '                Return
        '            End If
        '        End While

        '    ElseIf (clock_stringused = 7) Then
        '        While (Not writeToDevice(ADDRESS7, clock_stringtowriteback))
        '            If (Not Attempt_reestablish_communication()) Then
        '                showmonitor_commerror()
        '                Tim_clock.Stop()
        '                Return
        '            End If
        '        End While

        '    ElseIf (clock_stringused = 8) Then
        '        While (Not writeToDevice(ADDRESS8, clock_stringtowriteback))
        '            If (Not Attempt_reestablish_communication()) Then
        '                showmonitor_commerror()
        '                Tim_clock.Stop()
        '                Return
        '            End If
        '        End While

        '    ElseIf (clock_stringused = 9) Then
        '        While (Not writeToDevice(ADDRESS9, clock_stringtowriteback))
        '            If (Not Attempt_reestablish_communication()) Then
        '                showmonitor_commerror()
        '                Tim_clock.Stop()
        '                Return
        '            End If
        '        End While

        '    End If
        '    writeparametertodevice(clock_activestringtoreturnto, ADDRESS_ACTIVE_STRING)
        'End If
    End Sub

    Private Sub Tim_clock_Tick(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Tim_clock.Tick
        Const NUMOFTIMESSTRINGUSED As Int16 = 5

        Static i As Integer = 0


        If (i > NUMOFTIMESSTRINGUSED) Then

            i = 0
            If (clock_stringused = 0) Then
                If (Not writeToDevice(ADDRESS0, clock_stringtowriteback)) Then
                    showmonitor_commerror()
                    Tim_clock.Stop()
                    Return
                End If

            ElseIf (clock_stringused = 1) Then
                If (Not writeToDevice(ADDRESS1, clock_stringtowriteback)) Then
                    showmonitor_commerror()
                    Tim_clock.Stop()
                    Return
                End If
            ElseIf (clock_stringused = 2) Then
                If (Not writeToDevice(ADDRESS2, clock_stringtowriteback)) Then
                    showmonitor_commerror()
                    Tim_clock.Stop()
                    Return
                End If
            ElseIf (clock_stringused = 3) Then
                If (Not writeToDevice(ADDRESS3, clock_stringtowriteback)) Then
                    showmonitor_commerror()
                    Tim_clock.Stop()
                    Return
                End If

            ElseIf (clock_stringused = 4) Then
                If (Not writeToDevice(ADDRESS4, clock_stringtowriteback)) Then
                    showmonitor_commerror()
                    Tim_clock.Stop()
                    Return
                End If

            ElseIf (clock_stringused = 5) Then
                If (Not writeToDevice(ADDRESS5, clock_stringtowriteback)) Then
                    showmonitor_commerror()
                    Tim_clock.Stop()
                    Return
                End If

            ElseIf (clock_stringused = 6) Then
                If (Not writeToDevice(ADDRESS6, clock_stringtowriteback)) Then
                    showmonitor_commerror()
                    Tim_clock.Stop()
                    Return
                End If

            ElseIf (clock_stringused = 7) Then
                If (Not writeToDevice(ADDRESS7, clock_stringtowriteback)) Then
                    showmonitor_commerror()
                    Tim_clock.Stop()
                    Return
                End If

            ElseIf (clock_stringused = 8) Then
                If (Not writeToDevice(ADDRESS8, clock_stringtowriteback)) Then
                    showmonitor_commerror()
                    Tim_clock.Stop()
                    Return
                End If

            ElseIf (clock_stringused = 9) Then
                If (Not writeToDevice(ADDRESS9, clock_stringtowriteback)) Then
                    showmonitor_commerror()
                    Tim_clock.Stop()
                    Return
                End If

            End If

            clock_stringused = New Random().Next(0, 10)
            writeparametertodevice(clock_stringused, ADDRESS_ACTIVE_STRING)


            If (clock_stringused = 0) Then
                If (Not readLineFromDevice(ADDRESS0, clock_stringtowriteback)) Then
                    showmonitor_commerror()
                    Tim_clock.Stop()
                    Return
                End If

            ElseIf (clock_stringused = 1) Then
                If (Not readLineFromDevice(ADDRESS1, clock_stringtowriteback)) Then
                    showmonitor_commerror()
                    Tim_clock.Stop()
                    Return
                End If
            ElseIf (clock_stringused = 2) Then
                If (Not readLineFromDevice(ADDRESS2, clock_stringtowriteback)) Then
                    showmonitor_commerror()
                    Tim_clock.Stop()
                    Return
                End If
            ElseIf (clock_stringused = 3) Then
                If (Not readLineFromDevice(ADDRESS3, clock_stringtowriteback)) Then
                    showmonitor_commerror()
                    Tim_clock.Stop()
                    Return
                End If

            ElseIf (clock_stringused = 4) Then
                If (Not readLineFromDevice(ADDRESS4, clock_stringtowriteback)) Then
                    showmonitor_commerror()
                    Tim_clock.Stop()
                    Return
                End If

            ElseIf (clock_stringused = 5) Then
                If (Not readLineFromDevice(ADDRESS5, clock_stringtowriteback)) Then
                    showmonitor_commerror()
                    Tim_clock.Stop()
                    Return
                End If

            ElseIf (clock_stringused = 6) Then
                If (Not readLineFromDevice(ADDRESS6, clock_stringtowriteback)) Then
                    showmonitor_commerror()
                    Tim_clock.Stop()
                    Return
                End If

            ElseIf (clock_stringused = 7) Then
                If (Not readLineFromDevice(ADDRESS7, clock_stringtowriteback)) Then
                    showmonitor_commerror()
                    Tim_clock.Stop()
                    Return
                End If

            ElseIf (clock_stringused = 8) Then
                If (Not readLineFromDevice(ADDRESS8, clock_stringtowriteback)) Then
                    showmonitor_commerror()
                    Tim_clock.Stop()
                    Return
                End If

            ElseIf (clock_stringused = 9) Then
                If (Not readLineFromDevice(ADDRESS9, clock_stringtowriteback)) Then
                    showmonitor_commerror()
                    Tim_clock.Stop()
                    Return
                End If

            End If
        Else

        End If

        Dim time = Now.ToShortTimeString()
        Dim _date = Now.ToShortDateString
        Dim day = Now.DayOfWeek
        Static oldtime = ""
        Dim display As String = ""
        If (time = oldtime) Then
            Return
        End If
        oldtime = time
        i += 1
        If (CB_clockoptions.SelectedIndex = 0) Then
            display = time
        ElseIf (CB_clockoptions.SelectedIndex = 1) Then
            display = time + " " + _date
        ElseIf (CB_clockoptions.SelectedIndex = 2) Then
            display = time + " " + _date
            If (day = 0) Then
                display += " Sunday"
            ElseIf (day = 1) Then
                display += " Monday"
            ElseIf (day = 2) Then
                display += " Tuesday"
            ElseIf (day = 3) Then
                display += " Wednesday"
            ElseIf (day = 4) Then
                display += " Thursday"
            ElseIf (day = 5) Then
                display += " Friday"
            ElseIf (day = 6) Then
                display += " Saturday"

            End If
        End If


        If (clock_stringused = 0) Then
            If (Not writeToDevice(ADDRESS0, display)) Then
                showmonitor_commerror()
                Tim_clock.Stop()
                Return
            End If

        ElseIf (clock_stringused = 1) Then
            If (Not writeToDevice(ADDRESS1, display)) Then
                showmonitor_commerror()
                Tim_clock.Stop()
                Return
            End If
        ElseIf (clock_stringused = 2) Then
            If (Not writeToDevice(ADDRESS2, display)) Then
                showmonitor_commerror()
                Tim_clock.Stop()
                Return
            End If
        ElseIf (clock_stringused = 3) Then
            If (Not writeToDevice(ADDRESS3, display)) Then
                showmonitor_commerror()
                Tim_clock.Stop()
                Return
            End If

        ElseIf (clock_stringused = 4) Then
            If (Not writeToDevice(ADDRESS4, display)) Then
                showmonitor_commerror()
                Tim_clock.Stop()
                Return
            End If

        ElseIf (clock_stringused = 5) Then
            If (Not writeToDevice(ADDRESS5, display)) Then
                showmonitor_commerror()
                Tim_clock.Stop()
                Return
            End If

        ElseIf (clock_stringused = 6) Then
            If (Not writeToDevice(ADDRESS6, display)) Then
                showmonitor_commerror()
                Tim_clock.Stop()
                Return
            End If

        ElseIf (clock_stringused = 7) Then
            If (Not writeToDevice(ADDRESS7, display)) Then
                showmonitor_commerror()
                Tim_clock.Stop()
                Return
            End If

        ElseIf (clock_stringused = 8) Then
            If (Not writeToDevice(ADDRESS8, display)) Then
                showmonitor_commerror()
                Tim_clock.Stop()
                Return
            End If

        ElseIf (clock_stringused = 9) Then
            If (Not writeToDevice(ADDRESS9, display)) Then
                showmonitor_commerror()
                Tim_clock.Stop()
                Return
            End If

        End If
    End Sub

    Private Sub Pan_showclock_Paint(ByVal sender As System.Object, ByVal e As System.Windows.Forms.PaintEventArgs)

    End Sub

    Private Sub Pan_showclock_VisibleChanged(ByVal sender As System.Object, ByVal e As System.EventArgs)
        If (Pan_showclock.Visible) Then
            If (CB_clockoptions.SelectedIndex <> 0 And CB_clockoptions.SelectedIndex <> 1 And CB_clockoptions.SelectedIndex <> 2) Then
                CB_clockoptions.SelectedIndex = 0
            End If
        End If
    End Sub

    Private Sub But_retrycommunication_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles But_retrycommunication.Click
        If (Attempt_reestablish_communication()) Then

        End If

    End Sub
    Private Sub But_export_trick_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Dim result As Boolean = True
        Dim answer As DialogResult

        With SFD
            .Filter = trickfilter
            answer = .ShowDialog
            If answer = Windows.Forms.DialogResult.Cancel Then
                result = False
            Else

                Dim SW As IO.StreamWriter = IO.File.CreateText(.FileName)
                Dim outputstring As String = ""

                If (currenttrickcodingversion = 1.2) Then

                    outputstring += "[trick coding version 1.2]" + Constants.vbCrLf
                    outputstring += Chr(activetrick)

                    Dim loopcounter = 0
                    While (loopcounter < tricktypecount)
                        Dim loopcounter2 = 0
                        Dim loop2max As Integer = tricks(loopcounter, tricks_2nd_demention_index.actualvalue).Count
                        'MsgBox(loop2max)
                        While (loopcounter2 < loop2max)
                            Dim parameter As Int16 = tricks(loopcounter, tricks_2nd_demention_index.actualvalue)(loopcounter2)
                            'MsgBox(parameter)
                            outputstring += Chr(parameter)
                            loopcounter2 += 1
                        End While
                        outputstring += Constants.vbCrLf
                        loopcounter += 1

                    End While
                    'outputstring += Constants.vbCrLf
                    outputstring += "[end trick data]"
                ElseIf (currenttrickcodingversion = -1) Then
                    outputstring += unrecognisedtrickdata
                End If

                SW.Write(outputstring)
                SW.Close()
                change = False
            End If
        End With
    End Sub

    Private Sub importtricks(ByRef FileName As String)

        ''this function has not been modified to work beyond TRICKCODINGVERSION_LINESONLY_PRE_20110310
        ''because it is not currently being used


        deviceandmemorymatch = False
        Dim oldtricks(tricktypecount - 1, 8)

        copytrickdata(tricks, oldtricks)
        Dim oldactivetrick = activetrick
        Dim oldtrickcodingversion = currenttrickcodingversion
        Dim trickline As String = "                              "
        Dim SR As IO.StreamReader = IO.File.OpenText(FileName)
        While (True)
            If (trickline.Length > 21) Then
                If (trickline.Substring(0, 21) = "[trick coding version") Then
                    Exit While
                End If
            End If
            If Not readline(SR, trickline) Then
                Dim message As String
                message = "unable to import tricks" + Constants.vbCrLf
                message += "No trick data found in file!"
                MsgBox(message)
                Return
            End If
        End While

        If (trickline = "[trick coding version 1.2]") Then

            'currenttrickcodingversion = 1
            activetrick = SR.Read
            Dim loopcounter = 0
            While (loopcounter < tricktypecount)
                Dim loopcounter2 = 0


                Dim loop2max As Integer = tricks(loopcounter, tricks_2nd_demention_index.actualvalue).Count
                While (loopcounter2 < loop2max)
                    Dim parameter As Int16 = SR.Read

                    'MsgBox(parameter)
                    tricks(loopcounter, tricks_2nd_demention_index.actualvalue)(loopcounter2) = parameter
                    loopcounter2 += 1
                End While
                If (Chr(SR.Read) + Chr(SR.Read) <> Constants.vbCrLf) Then
                    MsgBox("unable to import tricks" + Constants.vbCrLf + "trick data in file is corrupt!")
                    copytrickdata(oldtricks, tricks)
                    Exit While
                End If

                loopcounter += 1
            End While
            change = True

        ElseIf (trickline = "[trick coding version 1]") Then
            'the file only contains data for trick 1 
            'since no software was released with version 1 files will be updated to first released version  
            currenttrickcodingversion = TRICKCODINGVERSION_LINESONLY_PRE_20110310
            activetrick = SR.Read
            Dim loopcounter = 1
            While (loopcounter < tricktypecount)
                Dim loopcounter2 = 0


                Dim loop2max As Integer = tricks(loopcounter, tricks_2nd_demention_index.actualvalue).Count
                While (loopcounter2 < loop2max)
                    Dim parameter As Int16 = SR.Read

                    tricks(loopcounter, tricks_2nd_demention_index.actualvalue)(loopcounter2) = parameter
                    loopcounter2 += 1
                End While
                If (Chr(SR.Read) + Chr(SR.Read) <> Constants.vbCrLf) Then
                    MsgBox("Unable to import tricks." + Constants.vbCrLf + "trick data in file is corrupt!")
                    copytrickdata(oldtricks, tricks)

                    Exit While
                End If
                loopcounter += 1

            End While


        ElseIf (trickline.Substring(0, 21) = "[trick coding version") Then

            'currenttrickcodingversion = -1
            Dim message As String
            message = "unable to import tricks" + Constants.vbCrLf
            message += "This file uses unrecognized trick coding method '" + (trickline.Substring(21, trickline.Length - 22)) + "'"
            MsgBox(message)
            'unrecognisedtrickdata = trickline + SR.ReadToEnd

        End If
        ';;;;;;;;;;;;


        'check for discplay patters that have values that this version of TiniWindow does not support editing
        'trickcoding version of -1 means file is open with restrictions and unrecognized trick data written back verbatem
        Dim unsupportedvaluesdetected As Boolean = False
        Dim tricktypwalker As Integer = 0
        While tricktypwalker < tricktypecount
            Dim second_demen_sionwalker As Integer = 0
            While second_demen_sionwalker < tricks(tricktypwalker, tricks_2nd_demention_index.controlltype).count

                If tricks(tricktypwalker, tricks_2nd_demention_index.controlltype)(second_demen_sionwalker) = controlltype.none Then

                    Dim valueinfile = tricks(tricktypwalker, tricks_2nd_demention_index.actualvalue)(second_demen_sionwalker)
                    Dim defaultvalue = defaulttricks(tricktypwalker, tricks_2nd_demention_index.actualvalue)(second_demen_sionwalker)
                    If valueinfile <> defaultvalue Then

                        unsupportedvaluesdetected = True
                    End If
                End If
                'mmmmmm()
                second_demen_sionwalker += 1
            End While
            tricktypwalker += 1
        End While

        If (unsupportedvaluesdetected) Then

            attemptimporttrickswithunsupporteddata.ShowDialog()
            If (attemptimporttrickswithunsupporteddata.DialogResult = Windows.Forms.DialogResult.Yes) Then
                pan_filerestrictions.Visible = True
                enable_savefile()
            ElseIf (attemptimporttrickswithunsupporteddata.DialogResult = Windows.Forms.DialogResult.OK) Then
                pan_filerestrictions.Visible = False
                enable_savefile()
                tricktypwalker = 0
                While tricktypwalker < tricktypecount
                    Dim second_demen_sionwalker As Integer = 0
                    While second_demen_sionwalker < tricks(tricktypwalker, tricks_2nd_demention_index.controlltype).count

                        If tricks(tricktypwalker, tricks_2nd_demention_index.controlltype)(second_demen_sionwalker) = controlltype.none Then

                            Dim valueinfile = tricks(tricktypwalker, tricks_2nd_demention_index.actualvalue)(second_demen_sionwalker)
                            Dim defaultvalue = defaulttricks(tricktypwalker, tricks_2nd_demention_index.actualvalue)(second_demen_sionwalker)
                            If valueinfile <> defaultvalue Then
                                tricks(tricktypwalker, tricks_2nd_demention_index.actualvalue)(second_demen_sionwalker) = defaulttricks(tricktypwalker, tricks_2nd_demention_index.actualvalue)(second_demen_sionwalker)

                            End If
                        End If

                        second_demen_sionwalker += 1
                    End While
                    tricktypwalker += 1
                End While
            ElseIf (attemptimporttrickswithunsupporteddata.DialogResult = Windows.Forms.DialogResult.Retry) Then
                importtricks()
                Return
            ElseIf (attemptimporttrickswithunsupporteddata.DialogResult = Windows.Forms.DialogResult.Cancel) Then


                copytrickdata(oldtricks, tricks)


                activetrick = oldactivetrick

                CB_monitor_active_trick.SelectedIndex = activetrick
                currenttrickcodingversion = oldtrickcodingversion
                If (Not pan_filerestrictions.Visible) Then
                    refresh_Pan_trick_parameters()
                End If
                Return

            End If
        Else
            enable_savefile()
            pan_filerestrictions.Visible = False
        End If
        ';;;;;;;;;;
        SR.Close()
        If (Not pan_filerestrictions.Visible) Then
            CB_monitor_active_trick.SelectedIndex = activetrick
        End If

        simulator_form._refresh()
        refresh_demo()

    End Sub
    Private Sub But_import_trick_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Dim path As String
        Dim result As DialogResult

        With OFD


            .Filter = trickfilter

            path = IO.Directory.GetCurrentDirectory

            result = .ShowDialog
            If result = Windows.Forms.DialogResult.Cancel Then
                Return
            End If
            '    pathofopenfile = IO.Directory.GetCurrentDirectory 'used in timer_update_footer

            importtricks(.FileName)
            IO.Directory.SetCurrentDirectory(path)
        End With
    End Sub


    Private Sub SignSimulatorToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        simulator_form.Show()
        refresh_demo()
        Me.Focus()
    End Sub

    Private Sub men_products_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        If My.Computer.Network.IsAvailable = True Then
            Dim websiteProcess As System.Diagnostics.Process = System.Diagnostics.Process.Start("http://www.tinilite.net/products.php")


        Else
            Dim message As String = "sorry, " + Constants.vbCrLf
            message += "You must have an internet connections to buy product from your computer" + Constants.vbCrLf
            message += "To buy latter go to www.tinilite.net/products.php" + Constants.vbCrLf
            message += "For other buying options contact the vender you got this software from"
            MsgBox(message)
        End If
    End Sub

    Private Sub ReportAProblemToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        If My.Computer.Network.IsAvailable = True Then
            System.Diagnostics.Process.Start("http://www.tinilite.net/reportproblem.php")
        Else
            Dim message As String = "sorry, " + Constants.vbCrLf
            message += "You must have an internet connections to report a problem from your computer" + Constants.vbCrLf
            message += "To Report the problem latter go to www.tinilite.net/reportproblem.php" + Constants.vbCrLf
            message += "For other options contact the vender you got this software from"
            MsgBox(message)
        End If
        'reportproblem_form.Show()
    End Sub

    Private Function myescapechars(ByVal str As String) As String

        Dim i As Int16 = str.IndexOf("%")
        While (i <> -1)
            str = str.Substring(0, i) + "%37%" + str.Substring(i + 1)
            i = str.IndexOf("%")
        End While

        i = str.IndexOf(":")
        While (i <> -1)
            str = str.Substring(0, i) + "%58%" + str.Substring(i + 1)
            i = str.IndexOf(":")
        End While

        Return str

    End Function

    Private Function myunescapechars(ByVal str As String) As String


        Dim i As Int16 = str.IndexOf("%58%")
        While (i <> -1)
            str = str.Substring(0, i) + ":" + str.Substring(i + 4)
            i = str.IndexOf("%58%")
        End While

        i = str.IndexOf("%37%")
        While (i <> -1)
            str = str.Substring(0, i) + "%" + str.Substring(i + 4)
            i = str.IndexOf("%37%")
        End While


        Return str

    End Function

    Public Sub CheckForUpdatesToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)

        Const argumentseperator As Char = ":"

        If My.Computer.Network.IsAvailable = True Then


            If (change) Then
                If (Not saveit()) Then

                    Return
                End If

                change = False
            End If

            If InMonitorMode Then
                Dim result2 As DialogResult = MsgBox("you must exit monitor mode to check for updates" + Constants.vbCrLf + "click ok to continue. Click cancel to remain in monitor mode", MsgBoxStyle.OkCancel)

                If result2 = Windows.Forms.DialogResult.Cancel Then
                    Return
                ElseIf result2 = Windows.Forms.DialogResult.OK Then
                    showEdit()
                Else
                    MsgBox("bug in funtion CheckForUpdatesToolStripMenuItem_Click")
                End If
            End If








            Dim commandline As String = "" '"TiniDiskMajorVersion=" + TiniDiskMajorVersion.ToString + ":"

            'commandline += "TiniDiskMinorVersion=" + TiniDiskMajorVersion.ToString + argumentseperator
            'commandline += "TiniDiskVersion=" + TiniDiskMajorVersion.ToString + "." + TiniDiskMinorVersion.ToString + argumentseperator

            commandline += "settingsfilename=" + settingsfilename.ToString + argumentseperator
            commandline += "userdatafilename=" + userdatafilename.ToString + argumentseperator
            commandline += "filter=" + filter.ToString + argumentseperator
            commandline += "trickfilter=" + trickfilter.ToString + argumentseperator
            commandline += "DEFAULTTRICKCODINGVERSION=" + TRICKCODINGVERSION_LINESONLY_CURRENT.ToString + argumentseperator
            commandline += "TiniWindowVersionStandard=" + TiniWindowVersionStandard.ToString + argumentseperator
            commandline += "TiniWindowMajorVersion=" + TiniWindowMajorVersion.ToString + argumentseperator
            commandline += "TiniWindowMinorVersion=" + TiniWindowMinorVersion.ToString + argumentseperator
            commandline += "TiniWindowVersion=" + TiniWindowVersion.ToString + argumentseperator





            commandline += "TiniWindoCompileDate=" + TiniWindoCompileDate.ToString + argumentseperator

            'TiniWindoCompileDate


            'MsgBox(updatetinidisk.ToString)
            commandline += "CallingApplication=" + ApplicationName + argumentseperator
            commandline += "updatetinidisk=" + updatetinidisk.ToString + argumentseperator


            'this section does not make sence with new sign selection setup in version 1.09
            'Try
            '    'untill a comport is selected, myserialPort = null which causes an exception
            '    If mySerialPort.IsOpen Then
            '        commandline += "comport=" + mySerialPort.PortName + argumentseperator
            '    End If

            'Catch ex As Exception

            'End Try

            'current version of TiniWindow and update instructions does not support reopening same file but future versions might
            If FileName <> NOFILE Then
                'passed back when TiniWindow reopened
                commandline += "OpenFile=" + myescapechars(FileName) + argumentseperator

            End If
            Try
                System.Diagnostics.Process.Start("TiniWindowUpdate.exe", commandline)
            Catch ex As Exception
                MsgBox("There was an error, Unable to check for updates")
                Return
            End Try

            Me.Close()

            'MsgBox(result.ToString)

            'Dim socketInformation As System.Net.Sockets.SocketInformation

            'Dim instance As New System.Net.Sockets.Socket(socketInformation)


        Else
            Dim message As String = "sorry, " + Constants.vbCrLf
            message += "You must have an internet connections check for updates" + Constants.vbCrLf
            message += "For other update options, contact the vender where you purchased your TiniLite"
            MsgBox(message)
        End If
    End Sub




    Private Sub setprev_selectionifo(ByRef prev_selectionindex As ArrayList, ByRef prev_selectionlength As ArrayList)
        'this function is intended to be used called by 'Tim_trickcontrolls_Tick ()
        'to create a pince point for things that are done a couple different places 

        prev_selectionindex = New ArrayList
        prev_selectionlength = New ArrayList

        Dim loopcounter As Integer = 0
        While loopcounter < trickcodingcontrolls.Count
            If (trickcodingcontrolls(loopcounter).GetType.Name = "TextBox" Or trickcodingcontrolls(loopcounter).GetType.Name = "ComboBox") Then

                'Dim tt As ComboBox
                'tt.SelectionLength
                prev_selectionindex.Add((trickcodingcontrolls(loopcounter).SelectionStart))
                prev_selectionlength.Add((trickcodingcontrolls(loopcounter).SelectionLength))


            Else
                'these values only have meaning in any controlls other then textbox and dropdown menue
                prev_selectionindex.Add(DBNull.Value)
                prev_selectionlength.Add(DBNull.Value)


            End If

            loopcounter += 1
        End While

    End Sub
    Private Function getrelativecoordinates(ByVal absolute_point As System.Drawing.Point, ByVal reference_component As System.Object) As System.Drawing.Point
        'this function takes a point expressed in absolute coordinates (relative to form one) and returns a point with corresponding coordinates relative to the passed controll


        'adjustment values are initialized to values that take into account the controll box and borders of form1
        Dim xadjustment As Integer = 8
        Dim yadjustment As Integer = 28

        Dim testpan As Panel = New Panel
        Dim current_component = reference_component


        While (current_component.Name <> "Form1")

            'MsgBox(current_component.Name)

            xadjustment += current_component.Location.X
            yadjustment += current_component.Location.Y

            current_component = current_component.Parent
        End While
        xadjustment += Me.Location.X
        yadjustment += Me.Location.Y


        Return New System.Drawing.Point(absolute_point.X - xadjustment, absolute_point.Y - yadjustment)

    End Function

    Private Sub importtricks()
        Dim path As String
        Dim result As DialogResult
        Dim message As String = ""
        'Tim_trickcontrolls.Stop()
        With OFD
            .Reset() 'changing the initial directory doesnt work otherwise
            .Filter = trickfilter
            path = IO.Directory.GetCurrentDirectory

            message += userdata(userdataindex.OpenTrickPath) + Constants.vbCrLf
            IO.Directory.SetCurrentDirectory(userdata(userdataindex.OpenTrickPath))
            .InitialDirectory = userdata(userdataindex.OpenTrickPath)

            message += userdata(userdataindex.OpenTrickPath) + Constants.vbCrLf
            message += IO.Directory.GetCurrentDirectory + Constants.vbCrLf
            message += .InitialDirectory + Constants.vbCrLf

            result = .ShowDialog
            message += userdata(userdataindex.OpenTrickPath) + Constants.vbCrLf
            userdata(userdataindex.OpenTrickPath) = IO.Directory.GetCurrentDirectory
            message += userdata(userdataindex.OpenTrickPath) + Constants.vbCrLf

            'MsgBox(message)

            If result = Windows.Forms.DialogResult.Cancel Then

                IO.Directory.SetCurrentDirectory(path)
                Return
            End If
            '    pathofopenfile = IO.Directory.GetCurrentDirectory 'used in timer_update_footer


            If (InMonitorMode) Then
                ConfirmImportTricksInMonitorMode.ShowDialog()
                If ConfirmOpenFileInMonitorMode.DialogResult = Windows.Forms.DialogResult.Yes Then
                    'remain in monitor mode and import tricks

                    importtricks(.FileName)
                    sendtrickstodevice()

                ElseIf ConfirmOpenFileInMonitorMode.DialogResult = Windows.Forms.DialogResult.No Then
                    showEdit()
                    importtricks(.FileName)

                Else
                    'do nothing

                End If

            Else
                result = MsgBox("Are you sure you want to replace the current" + Constants.vbCrLf + "tricks with the ones you are importing?", MsgBoxStyle.YesNo)

                If (result = Windows.Forms.DialogResult.Yes) Then
                    importtricks(.FileName)
                End If
            End If



            IO.Directory.SetCurrentDirectory(path)
            If (Not pan_filerestrictions.Visible) Then
                refresh_Pan_trick_parameters()
                refresh_demo()
                simulator_form._refresh()
            End If
        End With
    End Sub
    Private Sub men_import_tricks_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        importtricks()
    End Sub

    Private Sub men_export_tricks_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Dim result As Boolean = True
        Dim answer As DialogResult

        With SFD
            Dim path As String
            .Reset() 'changing the initial directory doesnt work otherwise
            .Filter = trickfilter


            path = IO.Directory.GetCurrentDirectory

            IO.Directory.SetCurrentDirectory(userdata(userdataindex.SaveTrickPath))

            .InitialDirectory = userdata(userdataindex.SaveTrickPath)


            answer = .ShowDialog
            userdata(userdataindex.SaveTrickPath) = IO.Directory.GetCurrentDirectory
            If answer = Windows.Forms.DialogResult.Cancel Then
                IO.Directory.SetCurrentDirectory(path)
                result = False

            Else

                Dim SW As IO.StreamWriter = IO.File.CreateText(.FileName)
                Dim outputstring As String = ""

                If (currenttrickcodingversion = 1.2) Then

                    outputstring += "[trick coding version 1.2]" + Constants.vbCrLf
                    outputstring += Chr(activetrick)

                    Dim loopcounter = 0
                    While (loopcounter < tricktypecount)
                        Dim loopcounter2 = 0
                        Dim loop2max As Integer = tricks(loopcounter, tricks_2nd_demention_index.actualvalue).Count
                        'MsgBox(loop2max)
                        While (loopcounter2 < loop2max)
                            Dim parameter As Int16 = tricks(loopcounter, tricks_2nd_demention_index.actualvalue)(loopcounter2)
                            'MsgBox(parameter)
                            outputstring += Chr(parameter)
                            loopcounter2 += 1
                        End While
                        outputstring += Constants.vbCrLf
                        loopcounter += 1

                    End While
                    'outputstring += Constants.vbCrLf
                    outputstring += "[end trick data]"
                ElseIf (currenttrickcodingversion = -1) Then
                    outputstring += unrecognisedtrickdata
                End If

                SW.Write(outputstring)
                SW.Close()
                change = False
                IO.Directory.SetCurrentDirectory(path)

            End If
        End With
    End Sub

   

    Private Sub men_stocks_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        If My.Computer.Network.IsAvailable = True Then
            System.Diagnostics.Process.Start("http://www.tinilite.net/Stocks.php")
        Else
            Dim message As String = "sorry, " + Constants.vbCrLf
            message += "You must have an internet connections to buy stocks from your computer" + Constants.vbCrLf
            message += "For other options you may telephone (order phone number not yet established)"
            MsgBox(message)
        End If
    End Sub
    Public Function getCommandLineParameter(ByVal parameter As String) As String
        'format is [paramter]=[value]:
        If commandline.Contains(parameter) Then
            'MsgBox("contains " + parameter)
            Dim index As Integer = commandline.IndexOf(parameter) + parameter.Length
            'MsgBox(commandline.Substring(index, 1))
            If commandline.Substring(index, 1) = "=" Then
                Dim tempstring As String = commandline.Substring(index + 1)
                If tempstring.Contains(":") Then
                    Return (tempstring.Substring(0, tempstring.IndexOf(":")))

                End If
            End If
        End If
        Return ""

    End Function

    Private Sub TB0_commen_enter(ByVal sender As System.Object, ByVal e As System.EventArgs)  'tool tip stuff
        If ToolTip1.Active Then
            ToolTip1.Show(tooltipmessage, sender, -270, 0)


            '    'showtooltip = False
            '    'MsgBox(sender.ToString)
            '    ToolTip1.ShowAlways() = True

            '    'MsgBox(sender.ToString)
            '    'sender.ToString()
            '    ToolTip1.SetToolTip(sender, tooltipmessage)
            '    ToolTip1.Show(tooltipmessage, sender)

            'Else
            '    'ToolTip1.Hide(sender)
        End If

    End Sub
    Private Sub initialisetooltips()
        ToolTip1.Active = False

        ToolTip1.Show(tooltipmessage, TB0, -150, 0)
        ToolTip1.Show(tooltipmessage, TB1, -150, 0)
        ToolTip1.Show(tooltipmessage, TB2, -150, 0)
        ToolTip1.Show(tooltipmessage, TB3, -150, 0)
        ToolTip1.Show(tooltipmessage, TB4, -150, 0)
        ToolTip1.Show(tooltipmessage, TB5, -150, 0)
        ToolTip1.Show(tooltipmessage, TB6, -150, 0)
        ToolTip1.Show(tooltipmessage, TB7, -150, 0)
        ToolTip1.Show(tooltipmessage, TB8, -150, 0)
        ToolTip1.Show(tooltipmessage, TB9, -150, 0)
        ' ToolTip1.Show(tooltipmessage, TB10, -70, 0)
        'ToolTip1.Show(tooltipmessage, TB0, -70, 0)
        'ToolTip1.SetToolTip(TB0, tooltipmessage)


        'ToolTip1.SetToolTip(TB1, tooltipmessage)


        'ToolTip1.SetToolTip(TB2, tooltipmessage)


        'ToolTip1.SetToolTip(TB3, tooltipmessage)


        'ToolTip1.SetToolTip(TB4, tooltipmessage)


        'ToolTip1.SetToolTip(TB5, tooltipmessage)


        'ToolTip1.SetToolTip(TB6, tooltipmessage)


        'ToolTip1.SetToolTip(TB7, tooltipmessage)


        'ToolTip1.SetToolTip(TB8, tooltipmessage)


        'ToolTip1.SetToolTip(TB9, tooltipmessage)

    End Sub

    Private Sub showtooltip()
        ToolTip1.Active = True

    End Sub


    Private Sub hidetooltip()


        ToolTip1.Active = False

    End Sub

    Private Sub TB0_Leave(ByVal sender As System.Object, ByVal e As System.EventArgs)  'tool tip stuff
        If ToolTip1.Active Then
            ToolTip1.Hide(sender)
        End If
    End Sub

    Private Sub TB_beginners_help_KeyPress(ByVal sender As System.Object, ByVal e As System.Windows.Forms.KeyPressEventArgs)
        Dim controll_c As Char = Chr(3)

        If e.KeyChar <> controll_c Then
            e.Handled = True
        End If
    End Sub

    Private Sub But_hide_pan_beginners_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles But_hide_pan_beginners.Click
        'settings(settingsindex.showbeginnershelp) = Not CB_hide_beginners_help.Checked

        Pan_beginners_help.Visible = False

        ' CB_hide_beginners_help.Checked
    End Sub

    Private Sub GettingStartedToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        If Pan_beginners_help.Visible Then
            Dim message As String = "Getting started info is already displayed in a panel at the bottom of TiniWindow" + Constants.vbCrLf
            message += "For additional help press F1 (after pressing ok) or contact technical assiatance"

            MsgBox(message)
        Else
            Pan_beginners_help.Visible = True
        End If

    End Sub



    '''''''''''begginers help functions
    Public Sub appendrichtext(ByVal text As String, ByVal font As Font)

        'temporarily commented out when tb_beginners help removed
        'function left so that latter text could be shown on chalk board


        'If text = "" Then
        '    Return
        'End If
        'Dim selectionstart As Integer = TB_beginners_help.Text.Length
        'Dim selectionlength As Integer = text.Length

        'TB_beginners_help.AppendText(text)
        'TB_beginners_help.SelectionStart = selectionstart
        'TB_beginners_help.SelectionLength = selectionlength

        'TB_beginners_help.SelectionFont = font
        ''TB_beginners_help
    End Sub
    Public Sub appendrichtext(ByVal text As String, ByVal size As Single, ByVal style As FontStyle)

        'temporarily commented out when tb_beginners help removed
        'function left so that latter text could be shown on chalk board

        'If text = "" Then
        '    Return
        'End If
        'Dim newfont As Font = New Font(TB_beginners_help.Font.FontFamily, size, style)
        'Dim selectionstart As Integer = TB_beginners_help.Text.Length
        'Dim selectionlength As Integer = text.Length

        'TB_beginners_help.AppendText(text)
        'TB_beginners_help.SelectionStart = selectionstart
        'TB_beginners_help.SelectionLength = selectionlength

        'TB_beginners_help.SelectionFont = newfont

    End Sub
    Public Sub appendrichtext(ByVal text As String, ByVal size As Integer)

        'temporarily commented out when tb_beginners help removed
        'function left so that latter text could be shown on chalk board


        'If text = "" Then
        '    Return
        'End If
        'Dim newfont As Font = New Font(TB_beginners_help.Font.FontFamily, size)
        'Dim selectionstart As Integer = TB_beginners_help.Text.Length
        'Dim selectionlength As Integer = text.Length

        'TB_beginners_help.AppendText(text)
        'TB_beginners_help.SelectionStart = selectionstart
        'TB_beginners_help.SelectionLength = selectionlength

        'TB_beginners_help.SelectionFont = newfont

    End Sub


    Private Sub AboutTiniWindowToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles AboutTiniWindowToolStripMenuItem.Click
        about_form.Show()
    End Sub

    Private Sub ReportAProblemToolStripMenuItem_Click_1(ByVal sender As System.Object, ByVal e As System.EventArgs)
        If My.Computer.Network.IsAvailable = True Then
            Dim websiteProcess As System.Diagnostics.Process = System.Diagnostics.Process.Start("http://www.tinilite.net/reportproblem.php")


        Else
            Dim message As String = "sorry, " + Constants.vbCrLf
            message += "You must have an internet connections to buy product from your computer" + Constants.vbCrLf
            message += "To buy latter go to www.tinilite.net/products.php" + Constants.vbCrLf
            message += "For other buying options contact the vender you got this software from"
            MsgBox(message)
        End If
    End Sub

    Private Sub StockToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        If My.Computer.Network.IsAvailable = True Then
            Dim websiteProcess As System.Diagnostics.Process = System.Diagnostics.Process.Start("http://www.tinilite.net/index/stocks.php")


        Else


            Dim message As String = "As of 6/26/08 we have not yet set a date for the Initial Public offering" + Constants.vbCrLf + Constants.vbCrLf

            message += "sorry" + Constants.vbCrLf
            message += "You must have an inte.vrnet connection to check for updated information" + Constants.vbCrLf
            message += "To check latter go to www.tinilite.net/index/stocks.php" + Constants.vbCrLf
            MsgBox(message)

        End If
    End Sub

    Private Sub refresh_trickcontrols()
        If tricks_get_activetrick() = 0 Then
            select_oneline()
        ElseIf tricks_get_activetrick() = 1 Then
            select_morelines()
        Else
            MsgBox("error refreshing trick controls")
        End If
    End Sub
    Private Sub select_morelines()

        If Not tricks_set_activetrick(1) Then
            MsgBox("error")
            Return
        End If
        'mark_selected(Pan_morelines)
        'mark_unselected(Pan_oneline)
        'pan_showmorelines.Visible = True
        'pan_showoneline.Visible = False
        'refresh_pan_morelines()
        'timer_monitor_pan_morelines.Start()
        'change_Lbl_pattern_type()
    End Sub
    Private Sub select_oneline()


        'jp feb 13, 2011 removed this line. the only apparent bug 
        'was this message displaying. 
        'I forget exact changes that lead to placing this message
        'MsgBox("function select_oneline should not be called")

        timer_monitor_ifdoubleclickmanuel.Stop()
        If Not tricks_set_activetrick(0) Then
            MsgBox("error")
            Return
        End If
        'mark_selected(Pan_oneline)
        'mark_unselected(Pan_morelines)
        'pan_showmorelines.Visible = False
        'pan_showoneline.Visible = True
        change_Lbl_pattern_type()
        refresh_demo()
    End Sub
    Private Sub oneline_Click(ByVal sender As System.Object, ByVal e As System.Windows.Forms.MouseEventArgs)
        'If currenttrickcodingversion = TRICKCODINGVERSION_COMBOKEYWORDS_current And formloaded Then
        '    Dim message As String = "If you proceed with editing data in this tab you will not be able to return to combo tab!" + Constants.vbCrLf

        '    message += "Are you sure you want to proceed"

        '    Dim result As DialogResult = MsgBox(message, MsgBoxStyle.OkCancel)

        '    If result = Windows.Forms.DialogResult.Cancel Then

        '        Return
        '    Else
        '        currenttrickcodingversion = TRICKCODINGVERSION_LINESONLY

        '    End If
        'End If

        'select_oneline()
    End Sub

    Private Sub morelines_Click(ByVal sender As System.Object, ByVal e As System.Windows.Forms.MouseEventArgs)
        'CB_monitor_active_trick.SelectedIndex = 1

        'If linecount = 1 Then
        '    MsgBox("you must configure TiniWindow for at least 2 lines before selecting this pattern")
        '    Return
        'End If
        'select_morelines()
    End Sub

    'Private Sub mark_selected(ByRef lbl As Label)

    '    lbl.Font = New Font(lbl.Font.FontFamily, lbl.Font.Size, FontStyle.Bold)
    '    lbl.BackColor = Color.Khaki
    'End Sub
    'Private Sub mark_unselected(ByRef lbl As Label)
    '    lbl.Font = New Font(lbl.Font.FontFamily, lbl.Font.Size, FontStyle.Regular)
    '    lbl.BackColor = Color.White
    'End Sub
    'Private Sub mark_selected(ByRef pan As Panel)

    '    pan.Font = New Font(pan.Font.FontFamily, pan.Font.Size, FontStyle.Bold)
    '    pan.BackColor = Color.Khaki
    'End Sub
    'Private Sub mark_unselected(ByRef pan As Panel)
    '    pan.Font = New Font(pan.Font.FontFamily, pan.Font.Size, FontStyle.Regular)
    '    pan.BackColor = Color.White
    'End Sub

    Public Function is_selected(ByRef cont As Control) As Boolean

        If cont.Font.Style = FontStyle.Bold And cont.BackColor = Color.Khaki Then

            Return True
        ElseIf cont.Font.Style = FontStyle.Regular And cont.BackColor = Color.White Then

            Return False
        Else
            MsgBox("error in function 'is_selected()'")

        End If


    End Function
    Public Sub mark_selected(ByRef cont As Control)

        cont.Font = New Font(cont.Font.FontFamily, cont.Font.Size, FontStyle.Bold)
        cont.BackColor = Color.Khaki
    End Sub
    Public Sub mark_unselected(ByRef cont As Control)
        cont.Font = New Font(cont.Font.FontFamily, cont.Font.Size, FontStyle.Regular)
        cont.BackColor = Color.White
    End Sub
    Public Sub mark_disabled(ByRef cont As Control)
        cont.Font = New Font(cont.Font.FontFamily, cont.Font.Size, FontStyle.Italic)
        cont.BackColor = Color.LightGray
    End Sub



    Private Sub demooption_multiline_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)

        'there was a bug that when Pan_demo_oneline.visible is false
        'lite cards did not diaplay on simulator form 
        'to quicky get around this, I made it so this panel is covered over
        'rather then made invisible 

        mark_selected(Pan_demooption_multiline)
        mark_unselected(Pan_demooption_oneline)
        'mark_unselected(Pan_demooption_none)


        Pan_demo_multiline.Visible = True
        'Pan_demo_none.Visible = False

        Return
        Pan_demo_oneline.Visible = False

    End Sub

    Private Sub demooption_oneline_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        'there was a bug that when Pan_demo_oneline.visible was false
        'lite cards did not diaplay on simulator form 
        'initially to quicky get around this, I made it so this panel is covered over
        'rather then made invisible
        'latter on when the combo tab was added I fixed this correctly
        'the fix was easier then expecte. 
        ' The trick timer on the demo form made the lite cards visibilty match the visibilty of the corrisponding card on the demo_one_line pan
        'this was redundant because the function that hides and shows the cards already did so on both locations.




        mark_unselected(Pan_demooption_multiline)
        mark_selected(Pan_demooption_oneline)
        'mark_unselected(Pan_demooption_none)

        Pan_demo_multiline.Visible = False
        Pan_demo_oneline.Visible = True
        'Pan_demo_none.Visible = False
    End Sub

    'Private Sub Lbl_demooption_none_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
    'the option to turn the demo off was removed in version 1.09.002

    '    'there was a bug that when Pan_demo_oneline.visible is false
    '    'lite cards did not diaplay on simulator form 
    '    'to quicky get around this, I made it so this panel is covered over
    '    'rather then made invisible 

    '    mark_unselected(Pan_demooption_multiline)
    '    mark_unselected(Pan_demooption_oneline)
    '    mark_selected(Pan_demooption_none)

    '    Pan_demo_multiline.Visible = False
    '    'Pan_demo_none.Visible = True
    '    'MsgBox(Pan_demo_none.Dock.ToString)
    '    Return
    '    Pan_demo_oneline.Visible = False

    'End Sub

    ''''''''''''''''''''''''''
    ''''''demo fundtions'''''''''''
    ''''''''''''''''''''''''' 

    Public Sub demo_set_ratio()
        'demo is the small blue screen area on TiniWindow next to green 
        '122812:
        'oneline_simulator_ratio = Convert.ToSingle(simulator_form.Pan_cards.Width) / Convert.ToSingle(Pan_cardbackground.Width)

        oneline_simulator_ratio = Convert.ToSingle(simulator_form.Pan_cards.Width) / (Convert.ToSingle(Pan_cardbackground.Width) * 0.95)

        Pan_cardbackground.Height = simulator_form.Pan_cards.Height / oneline_simulator_ratio

    End Sub

    Private Sub demo_set_multilinescreen(ByVal screen As Int16)
        '0 bassed index
        If screen > linecount / 10 Then
            Exit Sub
        End If



        demo_mulitlinescreen = screen


        Txt_demoline0.Visible = True
        Lbl_demoline0.Visible = True
        Txt_demoline1.Visible = True
        Lbl_demoline1.Visible = True
        Txt_demoline2.Visible = True
        Lbl_demoline2.Visible = True
        Txt_demoline3.Visible = True
        Lbl_demoline3.Visible = True
        Txt_demoline4.Visible = True
        Lbl_demoline4.Visible = True
        Txt_demoline5.Visible = True
        Lbl_demoline5.Visible = True
        Txt_demoline6.Visible = True
        Lbl_demoline6.Visible = True
        Txt_demoline7.Visible = True
        Lbl_demoline7.Visible = True
        Txt_demoline8.Visible = True
        Lbl_demoline8.Visible = True
        Txt_demoline9.Visible = True
        Lbl_demoline9.Visible = True


        Dim index As Int16 = screen * 10

        If index < textdata.Count Then
            Txt_demoline0.Text = textdata(index)
            Lbl_demoline0.Text = index + 1

        Else
            Txt_demoline0.Visible = False
            Lbl_demoline0.Visible = False

        End If

        index += 1


        If index < textdata.Count Then
            Txt_demoline1.Text = textdata(index)
            Lbl_demoline1.Text = index + 1
        Else
            Txt_demoline1.Visible = False
            Lbl_demoline1.Visible = False

        End If

        index += 1

        If index < textdata.Count Then
            Txt_demoline2.Text = textdata(index)
            Lbl_demoline2.Text = index + 1
        Else
            Txt_demoline2.Visible = False
            Lbl_demoline2.Visible = False

        End If

        index += 1

        If index < textdata.Count Then
            Txt_demoline3.Text = textdata(index)
            Lbl_demoline3.Text = index + 1
        Else
            Txt_demoline3.Visible = False
            Lbl_demoline3.Visible = False

        End If

        index += 1

        If index < textdata.Count Then
            Txt_demoline4.Text = textdata(index)
            Lbl_demoline4.Text = index + 1
        Else
            Txt_demoline4.Visible = False
            Lbl_demoline4.Visible = False

        End If

        index += 1

        If index < textdata.Count Then
            Txt_demoline5.Text = textdata(index)
            Lbl_demoline5.Text = index + 1
        Else
            Txt_demoline5.Visible = False
            Lbl_demoline5.Visible = False

        End If

        index += 1

        If index < textdata.Count Then
            Txt_demoline6.Text = textdata(index)
            Lbl_demoline6.Text = index + 1
        Else
            Txt_demoline6.Visible = False
            Lbl_demoline6.Visible = False

        End If

        index += 1

        If index < textdata.Count Then
            Txt_demoline7.Text = textdata(index)
            Lbl_demoline7.Text = index + 1
        Else
            Txt_demoline7.Visible = False
            Lbl_demoline7.Visible = False

        End If

        index += 1

        If index < textdata.Count Then
            Txt_demoline8.Text = textdata(index)
            Lbl_demoline8.Text = index + 1
        Else
            Txt_demoline8.Visible = False
            Lbl_demoline8.Visible = False

        End If

        index += 1

        If index < textdata.Count Then
            Txt_demoline9.Text = textdata(index)
            Lbl_demoline9.Text = index + 1
        Else
            Txt_demoline9.Visible = False
            Lbl_demoline9.Visible = False

        End If

        index += 1



    End Sub
    Public Sub refresh_demo()


        demo_refreshindexintimer = True 'informs the timer to reset its static index to 0 

        If (tricks_get_tricktype(tricks_get_activetrick(), True) = 0) Then
            demo_stringstocyclethrough = New ArrayList
            Try
                demo_stringstocyclethrough.Add(tricks_get_parameters(tricks_get_activetrick())(0))
            Catch ex As NullReferenceException

            End Try

            Timer_demo.Interval = 10
            Timer_demo.Start()
            Lbl_easy_linetime.Text = "STILL"
            Lbl_easy_sequencetime.Text = ""

            Lbl_combo_linetime.Text = "STILL"
            Lbl_combo_sequencetime.Text = ""

            Lbl_lines_linetime.Text = "STILL"
            Lbl_lines_sequencetime.Text = ""

            Lbl_freestyle_linetime.Text = "STILL"
            Lbl_freestyle_sequencetime.Text = ""

        ElseIf (tricks_get_tricktype(tricks_get_activetrick(), True) = 1) Then


            demo_stringstocyclethrough = New ArrayList

            'parameter 0 is start line
            Dim loopcounter As Integer = tricks_get_parameters(tricks_get_activetrick())(0)

            'loopindex wraps back to line 0 if needed where as loopcounter keeps incrementing
            Dim loopindex As Integer = loopcounter

            'parameter 1 is lines to cycle through
            Dim maxloopcounter = loopcounter + tricks_get_parameters(tricks_get_activetrick())(1)

            While (loopcounter < maxloopcounter)
                demo_stringstocyclethrough.Add(loopindex)
                loopcounter += 1
                loopindex += 1
                If (loopindex > linecount - 1) Then
                    loopindex = 0
                End If

            End While

            'if the time is greater then 0 set and start demo timer
            Dim time As Int16 = tricks_get_parameters(tricks_get_activetrick())(2)
            If time > 0 Then
                Timer_demo.Interval = 100 * time 'VB timer tick is milisecond but our tick is 1/10 second
                Timer_demo.Start()

                Dim timeinseconds As Single = time / 10

                Lbl_easy_linetime.Text = timeinseconds.ToString + "   sec/line"
                Lbl_easy_sequencetime.Text = "Total  " + (timeinseconds * linecount).ToString + "  sec/cycle"
                Lbl_combo_linetime.Text = timeinseconds.ToString + "   sec/line"
                Lbl_combo_sequencetime.Text = "Total  " + (timeinseconds * linecount).ToString + "  sec/cycle"

                Lbl_lines_linetime.Text = timeinseconds.ToString + "   sec/line"
                Lbl_lines_sequencetime.Text = "Total  " + (timeinseconds * linecount).ToString + "  sec/cycle"

                Lbl_freestyle_linetime.Text = timeinseconds.ToString + "   sec/line"
                Lbl_freestyle_sequencetime.Text = "Total  " + (timeinseconds * linecount).ToString + "  sec/cycle"
            Else
                'error condition no simulation
                Txt_demo_oneline.Text = ""
                Lbl_easy_linetime.Text = "internal error"
                Lbl_easy_sequencetime.Text = "internal error" + Constants.vbCrLf + "Please report this bug"
                Lbl_combo_linetime.Text = "internal error"
                Lbl_combo_sequencetime.Text = "internal error" + Constants.vbCrLf + "Please report this bug"
                Lbl_lines_linetime.Text = "internal error"
                Lbl_lines_sequencetime.Text = "internal error" + Constants.vbCrLf + "Please report this bug"

                Lbl_freestyle_linetime.Text = "internal error"
                Lbl_freestyle_sequencetime.Text = "internal error" + Constants.vbCrLf + "Please report this bug"

            End If

        End If


        'set time lables


        'Me.Focus()
    End Sub

    Private Sub Timer_demo_Tick(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Timer_demo.Tick


        'lite cards are change via the              Txt_demo_oneline_TextChanged event

        Static i As Integer = 0
        Static defaultbackcolor As Color = Txt_demoline0.BackColor
        Static highlightedbackcolor As Color = Color.Lime
        If (demo_refreshindexintimer) Then
            i = 0

        End If
        If i >= demo_stringstocyclethrough.Count Then
            i = 0
        End If
        If (demo_stringstocyclethrough.Count = 0) Then
            Timer_demo.Stop()
            MsgBox(activetrick.ToString + ",bug stringstocyclethrough.Count = 0 in simulator timer tick")

            Return
        End If


        'determins and set screen on mulitline panel

        Dim screen_needed As Int16

        If i <= 9 Then
            screen_needed = 0
        ElseIf i <= 19 Then
            screen_needed = 1
        ElseIf i <= 29 Then
            screen_needed = 2
        ElseIf i <= 39 Then
            screen_needed = 3
        ElseIf i <= 49 Then
            screen_needed = 4
        ElseIf i <= 59 Then
            screen_needed = 5
        Else
            'truncate additional lines in unlikely event they have more
            'current software only support 40 lines 
            screen_needed = 6
        End If


        If screen_needed <> demo_mulitlinescreen Or demo_refreshindexintimer Then

            demo_set_multilinescreen(screen_needed)
        End If

        Dim activedemoline As Int16 = i - (10 * demo_mulitlinescreen)


        Txt_demoline0.BackColor = defaultbackcolor
        Txt_demoline1.BackColor = defaultbackcolor
        Txt_demoline2.BackColor = defaultbackcolor
        Txt_demoline3.BackColor = defaultbackcolor
        Txt_demoline4.BackColor = defaultbackcolor
        Txt_demoline5.BackColor = defaultbackcolor
        Txt_demoline6.BackColor = defaultbackcolor
        Txt_demoline7.BackColor = defaultbackcolor
        Txt_demoline8.BackColor = defaultbackcolor
        Txt_demoline9.BackColor = defaultbackcolor

        Txt_demoline0.Enabled = False
        Txt_demoline1.Enabled = False
        Txt_demoline2.Enabled = False
        Txt_demoline3.Enabled = False
        Txt_demoline4.Enabled = False
        Txt_demoline5.Enabled = False
        Txt_demoline6.Enabled = False
        Txt_demoline7.Enabled = False
        Txt_demoline8.Enabled = False
        Txt_demoline9.Enabled = False

        If activedemoline = 0 Then
            Txt_demoline0.Enabled = True
            Txt_demoline0.BackColor = highlightedbackcolor
        ElseIf activedemoline = 1 Then
            Txt_demoline1.Enabled = True
            Txt_demoline1.BackColor = highlightedbackcolor
        ElseIf activedemoline = 2 Then
            Txt_demoline2.Enabled = True
            Txt_demoline2.BackColor = highlightedbackcolor
        ElseIf activedemoline = 3 Then
            Txt_demoline3.Enabled = True
            Txt_demoline3.BackColor = highlightedbackcolor
        ElseIf activedemoline = 4 Then
            Txt_demoline4.Enabled = True
            Txt_demoline4.BackColor = highlightedbackcolor
        ElseIf activedemoline = 5 Then
            Txt_demoline5.Enabled = True
            Txt_demoline5.BackColor = highlightedbackcolor
        ElseIf activedemoline = 6 Then
            Txt_demoline6.Enabled = True
            Txt_demoline6.BackColor = highlightedbackcolor
        ElseIf activedemoline = 7 Then
            Txt_demoline7.Enabled = True
            Txt_demoline7.BackColor = highlightedbackcolor
        ElseIf activedemoline = 8 Then
            Txt_demoline8.Enabled = True
            Txt_demoline8.BackColor = highlightedbackcolor
        ElseIf activedemoline = 9 Then
            Txt_demoline9.Enabled = True
            Txt_demoline9.BackColor = highlightedbackcolor
        End If

        'demo_stringstocyclethrough is an arralist of indexes
        Dim lineindex As Int16 = demo_stringstocyclethrough(i)

        If Txt_demo_oneline.Text <> textdata(lineindex).padright(settings(settingsindex.linelength)) Then
            'this condition prevents demo cards from flickering
            Txt_demo_oneline.Text = textdata(lineindex).padright(settings(settingsindex.linelength))


        End If


        i += 1
        demo_refreshindexintimer = False
        simulator_form._refresh()
        ' Timer_demo.Start()

    End Sub







    Private Sub ToolStripMenuItem3_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        userdata(userdataindex.defaultfile) = FileName
    End Sub

    Private Sub ToolStripMenuItem4_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        'OpenFile(userdata(userdataindex.defaultfile))
    End Sub

    Private Sub Label15_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)

    End Sub

    Private Sub WatchVideoToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        If My.Computer.Network.IsAvailable = True Then
            Dim websiteProcess As System.Diagnostics.Process = System.Diagnostics.Process.Start("http://www.tinilite.net/products.php")


        Else
            Dim message As String = "sorry, " + Constants.vbCrLf
            message += "You must have an internet connections to watch video" + Constants.vbCrLf

            MsgBox(message)
        End If
    End Sub

    Private Sub Pan_bluetabs_Paint(ByVal sender As System.Object, ByVal e As System.Windows.Forms.PaintEventArgs)

    End Sub

    Private Sub lbl_to1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)

    End Sub


    Private Sub TextBox1_KeyPress(ByVal sender As System.Object, ByVal e As System.Windows.Forms.KeyPressEventArgs)
        Const control_c As Char = Chr(3)
        If e.KeyChar <> control_c Then
            e.Handled = True
        End If

    End Sub



    Private Sub But_selectvideo_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles But_selectvideo.Click
        Static recursive As Boolean = False



        Dim fileindex As Int16 = CB_videolist.SelectedIndex

        Dim categoryindex As Int16


        If (is_selected(Pan_cat1)) Then
            categoryindex = (Convert.ToInt16(Pan_cat1.Tag))
        ElseIf (is_selected(pan_cat2)) Then
            categoryindex = (Convert.ToInt16(pan_cat2.Tag))

        End If


        'MsgBox(categoryindex.ToString + " " + fileindex.ToString)
        'Dim file As String = CB_videolist.Text

        Dim url As String = IO.Directory.GetCurrentDirectory + "/" + videos(vidoes_index.Video_files)(categoryindex)(fileindex)
        'MsgBox(url)
        WebBrowser1.Url = New System.Uri(url)
        'WebBrowser1.Refresh()

        'If Not recursive Then
        '    recursive = True
        '    But_selectvideo_Click(sender, e)
        '    recursive = False
        'End If

    End Sub


    Private Sub cat_common_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)

        'MsgBox(sender.tag)
        If (sender.name = "Lbl_cat1" Or sender.name = "Pan_cat1") Then
            mark_selected(Lbl_cat1)
            mark_selected(Pan_cat1)
            mark_unselected(Lbl_cat2)
            mark_unselected(pan_cat2)
        ElseIf (sender.name = "Lbl_cat2" Or sender.name = "Pan_cat2") Then
            mark_selected(Lbl_cat2)
            mark_selected(pan_cat2)
            mark_unselected(Lbl_cat1)
            mark_unselected(Pan_cat1)


        End If
        ''mark_selected(sender.tag)
        selected_Category = Convert.ToInt16(sender.tag)

        load_CB_videolist(Convert.ToInt16(sender.tag))
    End Sub

    Private Sub LBL_catup_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Lbl_cat1.Tag = Convert.ToInt16(Lbl_cat1.Tag) - 1
        Pan_cat1.Tag = Convert.ToInt16(Pan_cat1.Tag) - 1
        Lbl_cat2.Tag = Convert.ToInt16(Lbl_cat2.Tag) - 1
        pan_cat2.Tag = Convert.ToInt16(pan_cat2.Tag) - 1

        'If (is_selected(Pan_cat1)) Then

        '    mark_selected(Lbl_cat2)
        '    mark_selected(pan_cat2)
        '    mark_unselected(Lbl_cat1)
        '    mark_unselected(Pan_cat1)

        'End If
        load_videoscreen()

    End Sub

    Private Sub Lbl_catdown_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Lbl_cat1.Tag = Convert.ToInt16(Lbl_cat1.Tag) + 1
        Pan_cat1.Tag = Convert.ToInt16(Pan_cat1.Tag) + 1
        Lbl_cat2.Tag = Convert.ToInt16(Lbl_cat2.Tag) + 1
        pan_cat2.Tag = Convert.ToInt16(pan_cat2.Tag) + 1


        'If (is_selected(pan_cat2)) Then

        '    mark_selected(Lbl_cat1)
        '    mark_selected(Pan_cat1)
        '    mark_unselected(Lbl_cat2)
        '    mark_unselected(pan_cat2)

        'End If

        load_videoscreen()
    End Sub






    Private Sub pan_showmorelines_Paint(ByVal sender As System.Object, ByVal e As System.Windows.Forms.PaintEventArgs)

    End Sub



    Private Sub monitor_TB_pan_morelines_speed()
        'called from timer_monitor_pan_morelines_Tick
        'this is no longer used since the text box replaced with slidder


        Static oldtext As String = ""
        Static oldselectionstart As Integer = 0
        Static oldselectionlength As Integer = 0
        Dim loopcounter2 = 0
        Dim decimalencountered As Boolean = False
        Dim correctedvalue As String = ""
        Dim indexofdecimal As Int16 = -1

        'if nothing has been typed nothing needs to be checked
        'also prevents refreshing the simulations
        If TB_pan_morelines_speed.Text = oldtext Then
            Return
        End If

        '
        While (loopcounter2 < TB_pan_morelines_speed.Text.Length)



            If (TB_pan_morelines_speed.Text(loopcounter2) >= "0" And TB_pan_morelines_speed.Text(loopcounter2) <= "9") Then
                correctedvalue += TB_pan_morelines_speed.Text(loopcounter2)
                loopcounter2 += 1
                Continue While
            End If
            If (TB_pan_morelines_speed.Text(loopcounter2) = ".") Then

                If (decimalencountered) Then
                    'MsgBox("Only one decimal point is allowed")
                    'MsgBox(2)

                    TB_pan_morelines_speed.Text = oldtext

                    TB_pan_morelines_speed.SelectionStart = oldselectionstart
                    TB_pan_morelines_speed.SelectionLength = oldselectionlength
                    Beep()
                    Return
                End If
                'the location of the decimal is recorded and the decimal point is removed
                indexofdecimal = loopcounter2

                decimalencountered = True
                loopcounter2 += 1
                Continue While
            End If

            'gets here if something other then a number is typed
            'MsgBox(3)
            TB_pan_morelines_speed.Text = oldtext

            TB_pan_morelines_speed.SelectionStart = oldselectionstart
            TB_pan_morelines_speed.SelectionLength = oldselectionlength
            Beep()

            Return
            loopcounter2 += 1
        End While

        If (correctedvalue.Length = 0) Then
            'not ready to process this feild 
            'user has either typed nothing or typed only a decimal point

            oldtext = TB_pan_morelines_speed.Text

            oldselectionstart = TB_pan_morelines_speed.SelectionStart
            oldselectionlength = TB_pan_morelines_speed.SelectionLength
            Return
        End If



        If indexofdecimal = -1 Then
            'no decimal typed
            'remember value stored is 1/10 seconds
            Dim value As Int16 = Convert.ToInt16(correctedvalue) * 10
            If value = 0 Then
                'cheeting hack but it is difficult to stop using from typing 0 
                'because this would prevent entering decimal values
                value = 1
            End If
            'paramter value can not exceed 255 (1byte)
            If value > 255 Then
                TB_pan_morelines_speed.Text = oldtext

                TB_pan_morelines_speed.SelectionStart = oldselectionstart
                TB_pan_morelines_speed.SelectionLength = oldselectionlength
                Beep()
                Return
            End If
            Dim invertedvalue = 255 - value + 1
            If invertedvalue >= 156 Then
                'the speed controll on easy tab is limited to 10 seconds/line 
                HSB_speed_easytab.Value = invertedvalue
                tricks_set_parameter(1, 2, value)
            Else
                tricks_set_parameter(1, 2, value)
            End If


            change_Lbl_pattern_type()
            refresh_demo()

        ElseIf indexofdecimal = TB_pan_morelines_speed.Text.Length - 2 Then

            'one decimal place 
            'rember decimal has been removed
            Dim value As Int16 = Convert.ToInt16(correctedvalue)

            'paramter value can not exceed 255 (1byte)
            If value > 255 Then
                TB_pan_morelines_speed.Text = oldtext

                TB_pan_morelines_speed.SelectionStart = oldselectionstart
                TB_pan_morelines_speed.SelectionLength = oldselectionlength
                Beep()
                Return
            End If

            tricks_set_parameter(1, 2, value)
            change_Lbl_pattern_type()
            refresh_demo()
        ElseIf indexofdecimal < TB_pan_morelines_speed.Text.Length - 2 Then
            '2 or more digits typed after decimal
            TB_pan_morelines_speed.Text = oldtext

            TB_pan_morelines_speed.SelectionStart = oldselectionstart
            TB_pan_morelines_speed.SelectionLength = oldselectionlength
            Beep()

            Return

        ElseIf indexofdecimal = TB_pan_morelines_speed.Text.Length - 1 Then
            'not ready to process this feild 
            'user has typed a decimal point at the end of the number


        End If

        oldtext = TB_pan_morelines_speed.Text

        oldselectionstart = TB_pan_morelines_speed.SelectionStart
        oldselectionlength = TB_pan_morelines_speed.SelectionLength

    End Sub
    Private Sub monitor_tolineboxes()

        'called from timer_monitor_pan_morelines_Tick
        Dim testpan As Panel = New Panel
        If (Control.MouseButtons = Windows.Forms.MouseButtons.Left) Then
            'they are clicking anywere on form 1

            Dim tolineboxes_walker As Integer = 0
            While (tolineboxes_walker < tolineboxes.Count)
                'make x and y of the rectangle 0 because the relative coordinates of point tested assume this
                Dim controllrectangle As Drawing.Rectangle = New Rectangle(0, 0, tolineboxes(tolineboxes_walker).Width, tolineboxes(tolineboxes_walker).Height)

                Dim mouselocation As System.Drawing.Point = getrelativecoordinates(Control.MousePosition, tolineboxes(tolineboxes_walker))

                If (controllrectangle.Contains(mouselocation)) Then
                    'user has clicked on box

                    If currenttrickcodingversion = TRICKCODINGVERSION_COMBOKEYWORDS_PRE_20110310 Or currenttrickcodingversion = TRICKCODINGVERSION_COMBOKEYWORDS_CURRENT Then
                        Dim message As String = "If you proceed with editing data in this tab you will not be able to return to combo tab!" + Constants.vbCrLf

                        message += "Are you sure you want to proceed"

                        Dim result As DialogResult = MsgBox(message, MsgBoxStyle.OkCancel)

                        If result = Windows.Forms.DialogResult.Cancel Then

                            Return
                        Else
                            If currenttrickcodingversion = TRICKCODINGVERSION_COMBOKEYWORDS_PRE_20110310 Then

                                currenttrickcodingversion = TRICKCODINGVERSION_LINESONLY_PRE_20110310
                            Else
                                currenttrickcodingversion = TRICKCODINGVERSION_LINESONLY_CURRENT
                            End If


                        End If
                    End If


                    Dim selectedvalue As Integer = Convert.ToInt16(tolineboxes(tolineboxes_walker).tag)

                    If Not tricks_set_parameter(1, 1, selectedvalue) Then
                        MsgBox("error setting trick parameter")
                    End If
                    ' MsgBox(selectedvalue)

                    'MsgBox(tricks_get_parameters(1)(1))
                    Dim loopcounter As Int16 = 0
                    While loopcounter < tolineboxes.Count
                        'mark all boxes unselected
                        mark_unselected(tolineboxes(loopcounter))
                        loopcounter += 1
                    End While

                    'mark correct box selected
                    mark_selected(tolineboxes(tolineboxes_walker))
                    change_Lbl_pattern_type()
                    refresh_demo()
                End If
                tolineboxes_walker += 1
            End While


        End If




    End Sub
    Private Sub monitor_ifusermanueldoubleclick()

        
        



    End Sub



    Private Sub timer_monitor_pan_morelines_Tick(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles timer_monitor_ifdoubleclickmanuel.Tick

        'MsgBox("tick")
        'double click if...
        'the mouse is held down for 3 ticks or less followed by pause less then  10 ticks then held down again less then 3 ticks

        Static counter As Int16 = 0
        Static state As Int16 = 0
        '0 = default 
        '       if mouse down increase counter
        '       if moues up and counter is 1-3 switch to state 1 and reset counter to 0
        '       if mouse up and counter > 3 reset counter to 0 and stay in state 0

        '1 = first click
        '    if mouse up and counter < 10  increase counter
        '    if mouse up and counter >=10 reset state to 0 and reset counter to 0  
        '    if mouse down and counter <= 10 switch to state 2 and reset counter to 0

        '2 = in second click
        '      if mouse down increase counter
        '      if mouse up and counter <= 3 switch to state 3 
        '      if mouse up and counter > 3 reset state and counter to 0

        '3 = user has double clicked -> show form






        If (Control.MouseButtons <> Windows.Forms.MouseButtons.None) Then

            'MsgBox(Control.MousePosition.ToString)
            'they are clicking anywere on (or off) form 1
            'MsgBox("Click")
            Dim tolineboxes_walker As Integer = 0

            Dim mouselocation As System.Drawing.Point = getrelativecoordinates(Control.MousePosition, PDFview_usermanuel_small)


            Dim controllrectangle As Drawing.Rectangle = New Rectangle(0, 0, PDFview_usermanuel_small.Width, PDFview_usermanuel_small.Height)
            If (controllrectangle.Contains(mouselocation)) Then
                'mouse down within the PDF viewer


                Dim subregion As Drawing.Rectangle

                'regions of controlls the user might click on

                '7,32
                '7,62
                '27,62
                '27,32
                '----------

                '32,32
                '32,62
                '53,62
                '53,32
                '---------

                '
                '60,36
                '60,59
                '117,36
                '117,59
                '-----

                '129,32
                '129,64
                '163,32
                '163,64

                '------
                '167,32
                '167,63
                '199,32
                '199,63
                '-------
                '213,36
                '213,59
                '341,36
                '341,59
                '-----
                '180,0
                '180,28
                '206,0
                '206,28

                '------
                '210,0

                '210,28
                '236,0
                '236,28

                '------
                '0,70
                '38,70
                '0,114
                '38,114

                '-------
                '0,119
                '0,164
                '38,119
                '38.164
                '----
                '245,0
                '245,25
                '270,0
                '270,25









                'zoom out button
                subregion = New Rectangle(7, 32, 20, 30)
                If subregion.Contains(mouselocation) Then
                    state = 0
                    counter = 0
                    Return
                End If


                'zoom in button
                subregion = New Rectangle(32, 32, 20, 30)
                If subregion.Contains(mouselocation) Then
                    state = 0
                    counter = 0
                    Return
                End If

                subregion = New Rectangle(60, 36, 57, 23)
                If subregion.Contains(mouselocation) Then
                    state = 0
                    counter = 0
                    Return
                End If

                subregion = New Rectangle(129, 32, 34, 32)
                If subregion.Contains(mouselocation) Then
                    state = 0
                    counter = 0
                    Return
                End If

                subregion = New Rectangle(167, 32, 32, 31)
                If subregion.Contains(mouselocation) Then
                    state = 0
                    counter = 0
                    Return
                End If

                subregion = New Rectangle(213, 36, 128, 23)
                If subregion.Contains(mouselocation) Then
                    state = 0
                    counter = 0
                    Return
                End If

                subregion = New Rectangle(180, 0, 26, 28)
                If subregion.Contains(mouselocation) Then
                    state = 0
                    counter = 0
                    Return
                End If

                subregion = New Rectangle(210, 0, 26, 28)
                If subregion.Contains(mouselocation) Then
                    state = 0
                    counter = 0
                    Return
                End If


                subregion = New Rectangle(0, 70, 38, 44)

                If subregion.Contains(mouselocation) Then
                    state = 0
                    counter = 0
                    Return
                End If

                subregion = New Rectangle(0, 119, 38, 45)
                If subregion.Contains(mouselocation) Then
                    state = 0
                    counter = 0
                    Return
                End If

                subregion = New Rectangle(245, 0, 25, 25)
                If subregion.Contains(mouselocation) Then
                    state = 0
                    counter = 0
                    Return
                End If


                'MsgBox(mouselocation.ToString)

                If state = 0 Then
                    counter += 1
                ElseIf state = 1 Then
                    'if mouse down and counter <= 10 switch to state 2 and reset counter to 0

                    If counter <= 40 Then
                        state = 2
                        counter = 0
                    End If


                ElseIf state = 2 Then
                    counter += 1
                ElseIf state = 3 Then


                    If Not UserManuelViewer.Visible Then
                        UserManuelViewer.Show()
                    End If
                    state = 0
                    counter = 0
                End If


            Else
                'mouse down outside of viewer
                state = 0
                counter = 0

            End If

        Else
            'mouse up

            If state = 0 Then
                'if moues up and counter is 1-3 switch to state 1 and reset counter to 0
                'if mouse up and counter > 3 reset counter to 0 and stay in state 0

                If counter > 0 And counter <= 10 Then
                    state = 1
                    counter = 0
                Else
                    'state remains 0
                    counter = 0
                End If


            ElseIf state = 1 Then

                '    if mouse up and counter < 10  increase counter
                '    if mouse up and counter >=10 reset state to 0 and reset counter to 0  

                If counter < 40 Then
                    counter += 1
                Else
                    counter = 0
                    state = 0
                End If
            ElseIf state = 2 Then
                'if mouse up and counter <= 3 switch to state 3 
                'if mouse up and counter > 3 reset state and counter to 0

                If counter > 10 Then
                    state = 0
                    counter = 0
                Else
                    state = 3
                End If

            ElseIf state = 3 Then

                If Not UserManuelViewer.Visible Then
                    UserManuelViewer.Show()
                End If
                state = 0
                counter = 0
            End If
        End If
    End Sub



    Private Sub Button2_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button2.Click
        writeparametertodevice(255, ADDRESS_EEPROM_MAP_TYPE)

    End Sub

    Private Sub ShowTrickdataToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)

        show_trick_data.Show()

    End Sub
    Public Sub hide_filerestrictions()
        pan_filerestrictions.Visible = False
        If currenttrickcodingversion = -1 Then
            currenttrickcodingversion = TRICKCODINGVERSION_LINESONLY_CURRENT
        End If
        men_write_device.Enabled = True
        'men_monitormode.Enabled = True
    End Sub

    Public Sub show_filerestrictions()
        pan_filerestrictions.Visible = True
        If currenttrickcodingversion = -1 Then
            men_write_device.Enabled = False
            men_monitormode.Enabled = False
        End If
    End Sub

    Private Sub Button_discard_tricks_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Dim result As DialogResult = MsgBox("Are you sure you want to discard display patterns", MsgBoxStyle.OkCancel)
        If result = Windows.Forms.DialogResult.OK Then
            tricks_makecompatible_with_1_003(True)
            hide_filerestrictions()
        End If
    End Sub

    Private Sub picture_select_buttons_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Pan_pictureselect_buttons1.Visible = True
        Pan_pictureselect_buttons2.Visible = True
        Pan_pictureselect_menu.Visible = False

        mark_selected(lbl_picture_select_menu)
        mark_selected(pan_picture_select_menu)

        mark_unselected(lbl_picture_select_buttons)
        mark_unselected(pan_picture_select_buttons)

    End Sub

    Private Sub picture_select_menu_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Pan_pictureselect_buttons1.Visible = False
        Pan_pictureselect_buttons2.Visible = False
        Pan_pictureselect_menu.Visible = True

        mark_selected(lbl_picture_select_menu)
        mark_selected(pan_picture_select_menu)

        mark_unselected(lbl_picture_select_buttons)
        mark_unselected(pan_picture_select_buttons)

    End Sub

    Private Sub But_prev_picture_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        CB_pictures.SelectedIndex -= 1
        'MsgBox("prev")
    End Sub

    Private Sub But_next_picture_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        'MsgBox("next")
        CB_pictures.SelectedIndex += 1
    End Sub
    Private Sub CB_pictures_SelectedIndexChanged(ByVal sender As System.Object, ByVal e As System.EventArgs)


        If CB_pictures.SelectedIndex = -1 Then
            Return
        End If


        PictureBox.Image = Image.FromFile(IO.Directory.GetCurrentDirectory + "/pictures/" + CB_pictures.SelectedItem + ".JPG")
        If CB_pictures.SelectedIndex = 0 Then
            But_prev_picture.Visible = False
        Else
            But_prev_picture.Visible = True
        End If

        If CB_pictures.SelectedIndex = CB_pictures.Items.Count - 1 Then

            But_next_picture.Visible = False
        Else
            But_next_picture.Visible = True
            'But_next_picture.Enabled = True
            'Pan_pictureselect_buttons2.Enabled = True
        End If



    End Sub


    Private Sub Panel33_Paint(ByVal sender As System.Object, ByVal e As System.Windows.Forms.PaintEventArgs)

    End Sub

    Private Sub Button7_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        MsgBox("functionality not yet implimented")
    End Sub

    Private Sub But_next_picture_EnabledChanged(ByVal sender As System.Object, ByVal e As System.EventArgs)
        If But_next_picture.Enabled Then
            MsgBox("next enable")
        Else
            MsgBox("next disable")
        End If
    End Sub

    Private Sub Pan_edit_Paint(ByVal sender As System.Object, ByVal e As System.Windows.Forms.PaintEventArgs)

    End Sub


    ''''''''''''''''''''''''''''''''''''''''''''''''''''
    ''''''easy pattern functions''''''''''''''''''''
    ''''''''''''''''''''''''''''''''''''''''''''''''''''

    Dim selected_easy_pattern_type As Int16 = 0
    Enum easy_pattern_types
        constant = 0
        flow_right = 2
        flow_left = 3
        join_in = 4
        split_out = 5
        dance = 6
        blink_slow = 7
        blink_fast = 8
        add_on = 9
        zoom = 10
        random = 11
        disabled = -1
    End Enum

    Private Sub add_pattern_constant(ByRef arr As ArrayList, ByVal keyword As String)
        arr.Add(keyword)
    End Sub
    Private Sub add_pattern_flowright(ByRef arr As ArrayList, ByVal keyword As String)
        keyword = keyword.Trim.PadRight(settings(settingsindex.linelength))
        Dim loopcounter As Int16 = 0


        While loopcounter < settings(settingsindex.linelength)
            'move last char to beginning
            arr.Add(keyword)
            keyword = keyword.Substring(keyword.Length - 1) + keyword.Substring(0, keyword.Length - 1)

            loopcounter += 1
        End While

    End Sub


    Private Sub easytablegacy_add_pattern_flowright(ByRef arr As ArrayList, ByVal keyword As String)
        keyword = keyword.PadRight(settings(settingsindex.linelength))
        Dim loopcounter As Int16 = 0

        While loopcounter < settings(settingsindex.linelength)
            'move last char to beginning
            keyword = keyword.Substring(keyword.Length - 1) + keyword.Substring(0, keyword.Length - 1)
            arr.Add(keyword)
            loopcounter += 1
        End While

    End Sub

    Private Sub add_pattern_flowleft(ByRef arr As ArrayList, ByVal keyword As String)

        keyword = keyword.Trim.PadLeft(settings(settingsindex.linelength))
        Dim loopcounter As Int16 = 0
        While loopcounter < settings(settingsindex.linelength)
            'textdata.Add(keyword)
            arr.Add(keyword)
            keyword = keyword.Substring(1, keyword.Length - 1) + keyword.Substring(0, 1)
            loopcounter += 1
        End While


    End Sub

    Private Sub add_pattern_joinin(ByRef arr As ArrayList, ByVal keyword As String)
        'Dim lefthalf As String = keyword.Substring(0, keyword.Length / 2).PadLeft(settings(settingsindex.linelength) / 2)
        'Dim righthalf As String = keyword.Substring(keyword.Length / 2).PadRight(settings(settingsindex.linelength) / 2)

        Dim lefthalf As String = keyword.Trim.Substring(0, keyword.Trim.Length / 2).PadLeft(settings(settingsindex.linelength) / 2)
        Dim righthalf As String = keyword.Trim.Substring(keyword.Trim.Length / 2).PadRight(settings(settingsindex.linelength) / 2)

        Dim line As String


        Dim loopcounter As Int16 = 0
        While loopcounter <= settings(settingsindex.linelength) / 2
            Dim cebterspacescount As Int16 = settings(settingsindex.linelength) - 2 * (loopcounter)
            If settings(settingsindex.linelength) Mod 2 = 1 Then
                'if line count is odd one less space is needed
                'determined empirically
                'cebterspacescount -= 1
            End If
            Dim ceterspaces As String = ""

            Dim loopcounter2 As Int16 = 0
            While loopcounter2 < cebterspacescount

                ceterspaces += " "

                loopcounter2 += 1
            End While


            line = lefthalf.Substring(lefthalf.Length - loopcounter) + ceterspaces + righthalf.Substring(0, loopcounter)

            arr.Add(line)
            'keyword = keyword.Substring(1, keyword.Length - 1) + keyword.Substring(0, 1)
            loopcounter += 1


        End While

        arr.Add(line)
        arr.Add(line)
        arr.Add(line)

    End Sub
    Private Sub add_pattern_splitout(ByRef arr As ArrayList, ByVal keyword As String)
        'Dim lefthalf As String = keyword.Substring(0, keyword.Length / 2).PadLeft(settings(settingsindex.linelength) / 2)
        'Dim righthalf As String = keyword.Substring(keyword.Length / 2).PadRight(settings(settingsindex.linelength) / 2)

        Dim lefthalf As String = keyword.Trim.Substring(0, keyword.Trim.Length / 2).PadLeft(settings(settingsindex.linelength) / 2)
        Dim righthalf As String = keyword.Trim.Substring(keyword.Trim.Length / 2).PadRight(settings(settingsindex.linelength) / 2)


        Dim loopcounter As Int16 = settings(settingsindex.linelength) / 2

        If 2 * loopcounter > settings(settingsindex.linelength) Then
            'sometimes happends because of wierd rounding with odd sign size
            loopcounter -= 1

        End If
        'this first line is shown trice - done once outside loop and once in
        '= settings(settingsindex.linelength) - 2 * (loopcounter)
        Dim line As String = lefthalf.Substring(lefthalf.Length - loopcounter) + righthalf.Substring(0, loopcounter)

        arr.Add(line)
        arr.Add(line)
        arr.Add(line)
        While loopcounter >= 0
            Dim cebterspacescount As Int16 = settings(settingsindex.linelength) - 2 * (loopcounter)
            If settings(settingsindex.linelength) Mod 2 = 1 Then
                'if line count is odd one less space is needed
                'determined empirically
                'cebterspacescount -= 1
            End If

            'If cebterspacescount < 0 Then
            '    'sometimes happens with odd sized signs because of weird division
            '    loopcounter -= 1
            '    Continue While
            'End If
            Dim ceterspaces As String = ""

            Dim loopcounter2 As Int16 = 0
            While loopcounter2 < cebterspacescount

                ceterspaces += " "

                loopcounter2 += 1
            End While


            line = lefthalf.Substring(lefthalf.Length - loopcounter) + ceterspaces + righthalf.Substring(0, loopcounter)

            arr.Add(line)
            'keyword = keyword.Substring(1, keyword.Length - 1) + keyword.Substring(0, 1)
            loopcounter -= 1


        End While

    End Sub
    Private Sub add_pattern_zoom(ByRef arr As ArrayList, ByVal keyword As String)
        Dim lefthalf As String = keyword.Trim.Substring(0, keyword.Trim.Length / 2).PadLeft(settings(settingsindex.linelength) / 2)
        Dim righthalf As String = keyword.Trim.Substring(keyword.Trim.Length / 2).PadRight(settings(settingsindex.linelength) / 2)

        'If settings(settingsindex.linelength) Mod 2 = 0 Then
        '    'even linelength
        '    lefthalf = lefthalf.PadLeft(settings(settingsindex.linelength) / 2)
        '    righthalf = 
        'Else

        ' End If

        Dim loopcounter As Int16 = settings(settingsindex.linelength) / 2
        Dim line As String = ""

        While loopcounter >= 0
            Dim cebterspacescount As Int16 = settings(settingsindex.linelength) - 2 * (loopcounter)
            If settings(settingsindex.linelength) Mod 2 = 1 Then
                'if line count is odd one less space is needed
                'determined empirically
                'cebterspacescount -= 1
            End If
            Dim ceterspaces As String = ""

            Dim loopcounter2 As Int16 = 0
            While loopcounter2 < cebterspacescount

                ceterspaces += " "

                loopcounter2 += 1
            End While


            line = lefthalf.Substring(lefthalf.Length - loopcounter) + ceterspaces + righthalf.Substring(0, loopcounter)

            arr.Add(line)

            'keyword = keyword.Substring(1, keyword.Length - 1) + keyword.Substring(0, 1)
            loopcounter -= 1


        End While

        arr.Add(line)
        loopcounter = 0
        Dim looptovalue As Integer = settings(settingsindex.linelength) / 2
        If linelength Mod 2 = 1 Then
            'looptovalue += 1
        End If
        While loopcounter <= looptovalue
            Dim cebterspacescount As Int16 = settings(settingsindex.linelength) - 2 * (loopcounter)
            If settings(settingsindex.linelength) Mod 2 = 1 Then
                'if line count is odd one less space is needed
                'determined empirically
                'cebterspacescount -= 1
            End If
            Dim ceterspaces As String = ""

            Dim loopcounter2 As Int16 = 0
            While loopcounter2 < cebterspacescount

                ceterspaces += " "

                loopcounter2 += 1
            End While


            line = lefthalf.Substring(lefthalf.Length - loopcounter) + ceterspaces + righthalf.Substring(0, loopcounter)

            arr.Add(line)
            'keyword = keyword.Substring(1, keyword.Length - 1) + keyword.Substring(0, 1)
            loopcounter += 1


        End While

        'arr.Add(line)
        arr.Add(line)


    End Sub
    Private Sub add_pattern_blinkfast(ByRef arr As ArrayList, ByVal keyword As String)

        arr.Add(keyword)
        arr.Add(" ")

    End Sub
    Private Sub add_pattern_blinkslow(ByRef arr As ArrayList, ByVal keyword As String)

        arr.Add(keyword)
        arr.Add(keyword)
        arr.Add(keyword)
        arr.Add(keyword)
        arr.Add(keyword)

        arr.Add(" ")
        arr.Add(" ")
        arr.Add(" ")
        arr.Add(" ")
        arr.Add(" ")



    End Sub

    Private Sub add_pattern_addon(ByRef arr As ArrayList, ByVal keyword As String)

        Dim loopcounter As Int16 = keyword.Length - keyword.TrimStart.Length

        'arr.Add("")
        While loopcounter <= keyword.TrimEnd.Length
            arr.Add(keyword.Substring(0, loopcounter))
            loopcounter += 1
        End While
        arr.Add(keyword)
    End Sub

    Private Sub create_pattern(ByVal keyword As String, ByVal pattern_num As Int16)
        Timer_demo.Stop()
        'keyword = keyword.TrimEnd()
        Dim invertedvalue = 255 - HSB_speed_easytab.Value + 1
        'Dim kewwordlength As Int16 = keyword.Length
        Dim loopcounter As Int16 = 0
        If pattern_num = easy_pattern_types.constant Then
            textdata = New ArrayList
            add_pattern_constant(textdata, keyword)
            linecount = 1 'can not move to below
            tricks_set_default()
            tricks_set_activetrick(0)
            tricks_set_parameter(1, 2, invertedvalue) 'set speed
        ElseIf pattern_num = easy_pattern_types.flow_right Then
            textdata = New ArrayList
            add_pattern_flowright(textdata, keyword)

            linecount = textdata.Count 'can not move to below
            tricks_set_default()

            tricks_set_parameter(1, 2, invertedvalue)
            tricks_set_activetrick(1) 'trick 0 is active by default
            tricks_set_parameter(1, 2, invertedvalue) 'set speed

        ElseIf pattern_num = easy_pattern_types.flow_left Then


            textdata = New ArrayList

            add_pattern_flowleft(textdata, keyword)
            linecount = textdata.Count 'can not move to below
            tricks_set_default()
            tricks_set_parameter(1, 2, invertedvalue) 'set time
            tricks_set_activetrick(1) 'trick 0 is active by default

        ElseIf pattern_num = easy_pattern_types.join_in Then
            textdata = New ArrayList
            add_pattern_joinin(textdata, keyword)



            linecount = textdata.Count 'can not move to below

            tricks_set_default() 'this function set the number of lines roatated through = linecount
            'amoung other things   
            tricks_set_parameter(1, 2, invertedvalue) 'set the time parameter 
            tricks_set_activetrick(1) 'trick 0 is active by default
        ElseIf pattern_num = easy_pattern_types.split_out Then

            textdata = New ArrayList
            add_pattern_splitout(textdata, keyword)
            linecount = textdata.Count 'can not move to below

            tricks_set_default() 'this function set the number of lines roatated through = linecount
            'amoung other things   
            tricks_set_parameter(1, 2, invertedvalue) 'set the time parameter 
            tricks_set_activetrick(1) 'trick 0 is active by default

        ElseIf pattern_num = easy_pattern_types.zoom Then
            textdata = New ArrayList

            add_pattern_zoom(textdata, keyword)

            linecount = textdata.Count 'can not move to below

            tricks_set_default() 'this function set the number of lines roatated through = linecount
            'amoung other things   
            tricks_set_parameter(1, 2, invertedvalue) 'set the time parameter 
            tricks_set_activetrick(1) 'trick 0 is active by default


        ElseIf pattern_num = easy_pattern_types.dance Then


            add_pattern_dance(textdata, keyword)

            linecount = textdata.Count 'can not move to below

            tricks_set_default() 'this function set the number of lines roatated through = linecount
            'amoung other things   
            'tricks_set_parameter(1, 2, num_speed.Value) 'set the time parameter 
            tricks_set_parameter(1, 2, invertedvalue) 'set speed
            tricks_set_activetrick(1) 'trick 0 is active by default
        ElseIf pattern_num = easy_pattern_types.blink_fast Then
            textdata = New ArrayList
            add_pattern_blinkfast(textdata, keyword)
            linecount = textdata.Count 'can not move to below
            tricks_set_default() 'this function set the number of lines roatated through = linecount
            'amoung other things   
            'tricks_set_parameter(1, 2, num_speed.Value) 'set the time parameter
            tricks_set_parameter(1, 2, invertedvalue) 'set speed
            tricks_set_activetrick(1) 'trick 0 is active by default

        ElseIf pattern_num = easy_pattern_types.blink_slow Then

            textdata = New ArrayList
            add_pattern_blinkslow(textdata, keyword)

            linecount = textdata.Count 'can not move to below
            tricks_set_default() 'this function set the number of lines roatated through = linecount
            'amoung other things   
            'tricks_set_parameter(1, 2, Num_speed.Value) 'set the time parameter
            tricks_set_activetrick(1) 'trick 0 is active by default
            tricks_set_parameter(1, 2, invertedvalue) 'set speed
        ElseIf pattern_num = easy_pattern_types.add_on Then


            textdata = New ArrayList

            add_pattern_addon(textdata, keyword)

            linecount = textdata.Count 'can not move to below
            tricks_set_default() 'this function set the number of lines roatated through = linecount
            'amoung other things   
            tricks_set_parameter(1, 2, invertedvalue) 'set the time parameter 
            tricks_set_activetrick(1) 'trick 0 is active by default
        ElseIf pattern_num = easy_pattern_types.random Then

            create_pattern_random(textdata, keyword)

            linecount = textdata.Count 'can not move to below
            tricks_set_default() 'this function set the number of lines roatated through = linecount
            'amoung other things   
            tricks_set_parameter(1, 2, invertedvalue) 'set the time parameter 
            tricks_set_activetrick(1) 'trick 0 is active by default
        End If


        databeinginternallymanipulated = True
        linecount = textdata.Count 'this redundant of above. setting this above can not be removed with out introducing bugs
        NUD_linestab_liinecounts.Value = linecount
        databeinginternallymanipulated = False

        textdata_top()
        refresh_demo()
        simulator_form._refresh()


    End Sub

    Private Sub add_pattern_dance(ByRef arr As ArrayList, ByVal keyword As String)

        arr = New ArrayList
        keyword = keyword.TrimEnd

        If keyword.Trim.Length = linelength Then
            arr.Add(keyword.Trim.Substring(1))
            arr.Add(keyword.Trim)
            arr.Add((" " & keyword.Trim).Substring(0, linelength))
            arr.Add(keyword.Trim)

        ElseIf keyword.Trim.Length = linelength - 1 Then


            arr.Add(keyword.Trim)
            arr.Add(" " & keyword.Trim)
        Else


            Dim loopcounter = keyword.Length
            While loopcounter < settings(settingsindex.linelength)
                'move right



                arr.Add(keyword.PadLeft(loopcounter))
                loopcounter += 2

            End While

            If loopcounter > settings(settingsindex.linelength) Then

                'with out this the last char could hang past edge
                loopcounter -= 4
            End If

            While loopcounter > keyword.Length
                'move left


                arr.Add(keyword.PadLeft(loopcounter))
                loopcounter -= 2

            End While
        End If

    End Sub
    Private Sub create_pattern_random(ByRef arr As ArrayList, ByVal keyword As String)

        keyword = keyword.TrimEnd 'space at beginning or center will be treated as any other character

        Dim numberofspaces = settings(settingsindex.linelength) - keyword.Length


        'get center keyword   
        Dim centeredkeyword As String = keyword.TrimEnd

        While centeredkeyword.Length < (settings(settingsindex.linelength))
            centeredkeyword = " " + centeredkeyword + " "

        End While
        If centeredkeyword.Length > (settings(settingsindex.linelength)) Then
            'happens if odd sized sign
            'remove from end
            centeredkeyword = centeredkeyword.Substring(0, centeredkeyword.Length - 1)
        End If

        'create  randomlines
        Dim randomlinearray As ArrayList = New ArrayList
        If keyword.Length > 8 Then
            MsgBox("this display pattern is not defined for more then 10 characters")
            Return
        ElseIf keyword.Length = 8 Then
            'create 22 10 char string    
            Dim word As String


            word = " " + " " + " " + keyword(3) + keyword(4) + " " + " " + " " + " " + " "  '1
            randomlinearray.Add(word)
            word = keyword(7) + " " + " " + " " + " " + " " + " " + " " + " " + " " '2
            randomlinearray.Add(word)
            word = " " + " " + " " + " " + " " + keyword(5) + " " + keyword(7) + " " + " " '3
            randomlinearray.Add(word)
            word = " " + " " + keyword(5) + keyword(6) + " " + " " + " " + " " + " " + " " '4
            randomlinearray.Add(word)
            word = " " + " " + " " + " " + keyword(0) + keyword(1) + " " + " " + " " + " " '5
            randomlinearray.Add(word)
            word = keyword(2) + " " + " " + " " + " " + " " + " " + " " + keyword(6) + keyword(7) '6
            randomlinearray.Add(word)
            word = " " + " " + " " + " " + " " + keyword(3) + keyword(4) + " " + " " + " " '7
            randomlinearray.Add(word)
            word = " " + keyword(0) + " " + " " + " " + " " + " " + " " + keyword(6) + " "
            randomlinearray.Add(word)
            word = " " + keyword(1) + " " + " " + " " + " " + " " + " " + " " + " " '9
            randomlinearray.Add(word)
            word = " " + keyword(5) + keyword(6) + " " + " " + " " + " " + " " + " " + " "
            randomlinearray.Add(word)
            word = " " + " " + keyword(1) + " " + " " + " " + " " + " " + keyword(6) + " " '11
            randomlinearray.Add(word)
            word = keyword(1) + " " + " " + " " + keyword(3) + keyword(4) + " " + " " + " " + " "
            randomlinearray.Add(word)
            word = " " + " " + " " + " " + " " + " " + " " + keyword(2) + " " + keyword(4) '13
            randomlinearray.Add(word)
            word = " " + " " + " " + " " + keyword(0) + " " + " " + " " + " " + " "
            randomlinearray.Add(word)
            word = " " + " " + " " + keyword(5) + " " + " " + " " + " " + " " + " " '15
            randomlinearray.Add(word)
            word = " " + keyword(3) + " " + " " + " " + " " + " " + " " + " " + " "
            randomlinearray.Add(word)
            word = keyword(0) + " " + keyword(2) + " " + " " + " " + " " + " " + " " + " " '17
            randomlinearray.Add(word)
            word = keyword(4) + " " + " " + keyword(7) + " " + " " + " " + " " + " " + " "
            randomlinearray.Add(word)
            word = " " + " " + " " + " " + " " + " " + keyword(2) + " " + " " + " " '19
            randomlinearray.Add(word)
            word = " " + " " + " " + keyword(1) + " " + keyword(3) + " " + keyword(5) + " " + " "
            randomlinearray.Add(word)
            word = " " + keyword(2) + " " + " " + " " + " " + " " + " " + keyword(6) + keyword(7) '21
            randomlinearray.Add(word)
            word = " " + keyword(0) + keyword(1) + " " + " " + " " + " " + " " + " " + " "
            randomlinearray.Add(word)
        ElseIf keyword.Length = 7 Then
            'create 22 8 char string    
            Dim word As String


            word = " " + " " + keyword(3) + keyword(4) + " " + " " + " " + " " + " "  '1
            randomlinearray.Add(word)
            word = keyword(6) + " " + " " + " " + " " + " " + " " + " " + " " '2
            randomlinearray.Add(word)
            word = " " + " " + " " + " " + " " + keyword(5) + " " + " " + " " '3
            randomlinearray.Add(word)
            word = " " + " " + keyword(5) + keyword(6) + " " + " " + " " + " " + " " '4
            randomlinearray.Add(word)
            word = " " + " " + " " + keyword(0) + keyword(1) + " " + " " + " " + " " '5
            randomlinearray.Add(word)
            word = keyword(2) + " " + " " + " " + " " + " " + " " + " " + keyword(6)  '6
            randomlinearray.Add(word)
            word = " " + " " + " " + " " + keyword(3) + keyword(4) + " " + " " + " " '7
            randomlinearray.Add(word)
            word = " " + keyword(0) + " " + " " + " " + " " + " " + keyword(6) + " "
            randomlinearray.Add(word)
            word = " " + keyword(1) + " " + " " + " " + " " + " " + " " + " " '9
            randomlinearray.Add(word)
            word = " " + keyword(5) + keyword(6) + " " + " " + " " + " " + " " + " "
            randomlinearray.Add(word)
            word = " " + " " + " " + " " + " " + " " + keyword(4) + " " + " " '11
            randomlinearray.Add(word)
            word = keyword(1) + " " + " " + " " + keyword(3) + " " + " " + " " + " "
            randomlinearray.Add(word)
            word = " " + " " + " " + " " + " " + " " + keyword(2) + " " + keyword(4) '13
            randomlinearray.Add(word)
            word = " " + " " + " " + keyword(0) + " " + " " + " " + " " + " "
            randomlinearray.Add(word)
            word = " " + " " + keyword(5) + " " + " " + " " + " " + " " + " " '15
            randomlinearray.Add(word)
            word = " " + keyword(3) + " " + " " + " " + " " + " " + " " + " "
            randomlinearray.Add(word)
            word = keyword(0) + " " + keyword(2) + " " + " " + " " + " " + " " + " " '17
            randomlinearray.Add(word)
            word = keyword(4) + " " + " " + " " + " " + " " + " " + " " + " "
            randomlinearray.Add(word)
            word = " " + " " + " " + " " + " " + keyword(2) + " " + " " + " " '19
            randomlinearray.Add(word)
            word = " " + " " + keyword(1) + " " + keyword(3) + " " + keyword(5) + " " + " "
            randomlinearray.Add(word)
            word = " " + keyword(2) + " " + " " + " " + " " + " " + " " + keyword(6)  '21
            randomlinearray.Add(word)
            word = " " + keyword(0) + keyword(1) + " " + " " + " " + " " + " " + " "
            randomlinearray.Add(word)


        ElseIf keyword.Length = 6 Then
            'create 22 9 char string    
            Dim word As String


            word = " " + keyword(3) + keyword(4) + " " + " " + " " + " " + " "  '1
            randomlinearray.Add(word)
            word = " " + " " + " " + " " + keyword(3) + " " + " " + " " '2
            randomlinearray.Add(word)
            word = " " + " " + " " + " " + keyword(5) + " " + " " + " " '3
            randomlinearray.Add(word)
            word = " " + " " + keyword(5) + " " + " " + " " + " " + " " '4
            randomlinearray.Add(word)
            word = " " + " " + " " + keyword(0) + keyword(1) + " " + " " + " " '5
            randomlinearray.Add(word)
            word = keyword(2) + " " + " " + " " + " " + " " + " " + " "   '6
            randomlinearray.Add(word)
            word = " " + " " + " " + " " + keyword(3) + keyword(4) + " " + " " '7
            randomlinearray.Add(word)
            word = " " + keyword(0) + " " + " " + " " + " " + " " + " "
            randomlinearray.Add(word)
            word = " " + keyword(1) + " " + " " + " " + " " + " " + " " '9
            randomlinearray.Add(word)
            word = " " + keyword(5) + " " + " " + " " + " " + " " + " "
            randomlinearray.Add(word)
            word = " " + " " + " " + " " + " " + keyword(4) + " " + " " '11
            randomlinearray.Add(word)
            word = keyword(1) + " " + keyword(3) + " " + " " + " " + " " + " "
            randomlinearray.Add(word)
            word = " " + " " + " " + " " + " " + keyword(2) + " " + keyword(4) '13
            randomlinearray.Add(word)
            word = " " + " " + keyword(0) + " " + " " + " " + " " + " "
            randomlinearray.Add(word)
            word = " " + " " + keyword(5) + " " + " " + " " + " " + " " '15
            randomlinearray.Add(word)
            word = " " + keyword(3) + " " + " " + " " + " " + " " + " "
            randomlinearray.Add(word)
            word = keyword(0) + " " + keyword(2) + " " + " " + " " + " " + " " '17
            randomlinearray.Add(word)
            word = keyword(4) + " " + " " + " " + " " + " " + " " + " "
            randomlinearray.Add(word)
            word = " " + " " + " " + " " + keyword(2) + " " + " " + " " '19
            randomlinearray.Add(word)
            word = " " + keyword(1) + " " + " " + " " + keyword(5) + " " + " "
            randomlinearray.Add(word)
            word = " " + keyword(2) + " " + " " + " " + " " + " " + keyword(5)  '21
            randomlinearray.Add(word)
            word = " " + keyword(0) + keyword(1) + " " + " " + " " + " " + " "
            randomlinearray.Add(word)


        ElseIf keyword.Length = 5 Then
            'create 22 9 char string    
            Dim word As String


            word = " " + keyword(3) + keyword(4) + " " + " " + " " + " "  '1
            randomlinearray.Add(word)
            word = " " + " " + " " + keyword(3) + " " + " " + " " '2
            randomlinearray.Add(word)
            word = " " + keyword(2) + keyword(3) + " " + " " + " " + " " '3
            randomlinearray.Add(word)
            word = " " + " " + " " + " " + keyword(4) + " " + " " '4
            randomlinearray.Add(word)
            word = " " + " " + keyword(0) + keyword(1) + " " + " " + " " '5
            randomlinearray.Add(word)
            word = keyword(2) + " " + " " + " " + " " + " " + " "   '6
            randomlinearray.Add(word)
            word = " " + " " + " " + keyword(3) + keyword(4) + " " + " " '7
            randomlinearray.Add(word)
            word = " " + keyword(0) + " " + " " + " " + " " + " "
            randomlinearray.Add(word)
            word = " " + keyword(1) + " " + " " + " " + " " + " " '9
            randomlinearray.Add(word)
            word = " " + " " + " " + keyword(3) + " " + " " + " "
            randomlinearray.Add(word)
            word = " " + " " + " " + " " + keyword(4) + " " + " " '11
            randomlinearray.Add(word)
            word = keyword(1) + " " + " " + " " + " " + " " + " "
            randomlinearray.Add(word)
            word = " " + " " + " " + " " + keyword(2) + " " + keyword(4) '13
            randomlinearray.Add(word)
            word = " " + " " + keyword(0) + keyword(1) + " " + " " + " "
            randomlinearray.Add(word)
            word = " " + keyword(0) + " " + " " + " " + " " + " " '15
            randomlinearray.Add(word)
            word = " " + keyword(3) + " " + " " + " " + " " + " "
            randomlinearray.Add(word)
            word = keyword(0) + " " + keyword(2) + " " + " " + " " + " " '17
            randomlinearray.Add(word)
            word = keyword(4) + " " + " " + " " + " " + " " + " "
            randomlinearray.Add(word)
            word = " " + " " + " " + keyword(2) + " " + " " + " " '19
            randomlinearray.Add(word)
            word = " " + keyword(1) + " " + " " + " " + " " + " "
            randomlinearray.Add(word)
            word = " " + keyword(2) + " " + " " + " " + " " + " "   '21
            randomlinearray.Add(word)
            word = " " + keyword(0) + keyword(1) + " " + " " + " " + " "
            randomlinearray.Add(word)


        ElseIf keyword.Length = 4 Then
            'create 22 9 char string    
            Dim word As String


            word = " " + keyword(3) + " " + " " + " " + " "  '1
            randomlinearray.Add(word)
            word = " " + " " + keyword(3) + " " + " " + " " '2
            randomlinearray.Add(word)
            word = " " + keyword(2) + keyword(3) + " " + " " + " " '3
            randomlinearray.Add(word)
            word = " " + " " + " " + " " + " " + " " '4
            randomlinearray.Add(word)
            word = " " + keyword(0) + " " + " " + " " + " " '5
            randomlinearray.Add(word)
            word = keyword(2) + " " + " " + " " + " " + " " '6
            randomlinearray.Add(word)
            word = " " + " " + " " + keyword(3) + " " + " " '7
            randomlinearray.Add(word)
            word = " " + keyword(0) + " " + " " + " " + " "
            randomlinearray.Add(word)
            word = " " + keyword(1) + " " + " " + " " + " " '9
            randomlinearray.Add(word)
            word = " " + " " + keyword(3) + " " + " " + " "
            randomlinearray.Add(word)
            word = " " + " " + " " + keyword(1) + " " + " " '11
            randomlinearray.Add(word)
            word = keyword(1) + " " + " " + " " + " " + " "
            randomlinearray.Add(word)
            word = " " + " " + " " + " " + keyword(2) + " "  '13
            randomlinearray.Add(word)
            word = " " + " " + keyword(0) + keyword(1) + " " + " "
            randomlinearray.Add(word)
            word = " " + keyword(0) + " " + " " + " " + " " '15
            randomlinearray.Add(word)
            word = " " + keyword(3) + " " + " " + " " + " "
            randomlinearray.Add(word)
            word = keyword(0) + " " + keyword(2) + " " + " " + " " '17
            randomlinearray.Add(word)
            word = " " + " " + " " + " " + " " + " "
            randomlinearray.Add(word)
            word = " " + " " + keyword(2) + " " + " " + " " '19
            randomlinearray.Add(word)
            word = " " + keyword(1) + " " + " " + " " + " "
            randomlinearray.Add(word)
            word = " " + keyword(2) + " " + " " + " " + " "   '21
            randomlinearray.Add(word)
            word = " " + keyword(0) + keyword(1) + " " + " " + " "
            randomlinearray.Add(word)

        ElseIf keyword.Length = 3 Then
            'create 22 9 char string    
            Dim word As String


            word = " " + " " + " " + keyword(2) + " "  '1
            randomlinearray.Add(word)
            word = " " + keyword(0) + keyword(1) + " " + " " '2
            randomlinearray.Add(word)
            word = " " + keyword(2) + " " + " " + " " '3
            randomlinearray.Add(word)
            word = " " + " " + " " + keyword(1) + " " '4
            randomlinearray.Add(word)
            word = " " + keyword(0) + " " + keyword(2) + " " '5
            randomlinearray.Add(word)
            word = keyword(2) + " " + " " + " " + " "   '6
            randomlinearray.Add(word)
            word = keyword(0) + " " + " " + " " + " " '7
            randomlinearray.Add(word)
            word = " " + keyword(0) + " " + " " + " "
            randomlinearray.Add(word)
            word = " " + keyword(1) + " " + " " + " " '9
            randomlinearray.Add(word)
            word = " " + " " + " " + keyword(2) + " "
            randomlinearray.Add(word)
            word = " " + " " + keyword(1) + " " + " " '11
            randomlinearray.Add(word)
            word = keyword(1) + " " + " " + " " + " "
            randomlinearray.Add(word)
            word = " " + " " + " " + keyword(2) + " "  '13
            randomlinearray.Add(word)
            word = " " + " " + keyword(0) + keyword(1) + " "
            randomlinearray.Add(word)
            word = " " + keyword(0) + " " + " " + " " '15
            randomlinearray.Add(word)
            word = " " + " " + " " + keyword(1) + " "
            randomlinearray.Add(word)
            word = keyword(0) + " " + keyword(2) + " " + " " '17
            randomlinearray.Add(word)
            word = " " + keyword(0) + " " + " " + " "
            randomlinearray.Add(word)
            word = " " + " " + keyword(2) + " " + " " '19
            randomlinearray.Add(word)
            word = " " + keyword(1) + " " + " " + " "
            randomlinearray.Add(word)
            word = " " + keyword(2) + " " + " " + " "   '21
            randomlinearray.Add(word)
            word = " " + keyword(0) + keyword(1) + " " + " "
            randomlinearray.Add(word)






        ElseIf keyword.Length = 2 Then
            'create 22 9 char string    
            Dim word As String






            word = " " + keyword(0) + " " + " "  '1
            randomlinearray.Add(word)
            word = " " + " " + keyword(1) + " " '2
            randomlinearray.Add(word)
            word = keyword(0) + " " + " " + " " '3
            randomlinearray.Add(word)
            word = " " + " " + " " + keyword(1)  '4
            randomlinearray.Add(word)
            word = keyword(0) + " " + " " + " " '5
            randomlinearray.Add(word)
            word = " " + " " + " " + keyword(1)   '6
            randomlinearray.Add(word)
            word = keyword(0) + " " + " " + " " '7
            randomlinearray.Add(word)
            word = " " + keyword(0) + " " + " "
            randomlinearray.Add(word)
            word = " " + " " + keyword(1) + " " '9
            randomlinearray.Add(word)
            word = keyword(0) + " " + " " + " "
            randomlinearray.Add(word)
            word = " " + keyword(1) + " " + " " '11
            randomlinearray.Add(word)
            word = " " + " " + keyword(1) + " "
            randomlinearray.Add(word)
            word = " " + " " + " " + keyword(1) '13
            randomlinearray.Add(word)
            word = " " + " " + keyword(1) + " "
            randomlinearray.Add(word)
            word = " " + keyword(0) + " " + " " '15
            randomlinearray.Add(word)
            word = " " + " " + keyword(1) + " "
            randomlinearray.Add(word)
            word = keyword(0) + " " + " " + " " '17
            randomlinearray.Add(word)
            word = " " + keyword(0) + " " + " "
            randomlinearray.Add(word)
            word = " " + " " + " " + keyword(1) '19
            randomlinearray.Add(word)
            word = " " + keyword(1) + " " + " "
            randomlinearray.Add(word)
            word = keyword(0) + " " + " " + " "   '21
            randomlinearray.Add(word)
            word = " " + keyword(0) + " " + " "
            randomlinearray.Add(word)



        End If




        'padd to sign size
        Dim loopcounter As Int16 = 0
        'Dim returnvalue As Boolean = True
        While loopcounter < randomlinearray.Count
            If randomlinearray(loopcounter).length <> keyword.Length + 2 Then
                'check that I typed in correct number of letters

                MsgBox("programming bug in patterns " + loopcounter.ToString)
                'returnvalue = False
            End If

            'pad to sign size
            While randomlinearray(loopcounter).length < settings(settingsindex.linelength)
                randomlinearray(loopcounter) = " " + randomlinearray(loopcounter) + " "
            End While
            If randomlinearray(loopcounter).length < settings(settingsindex.linelength) Then
                'happens with odd sized sign
                randomlinearray(loopcounter) = randomlinearray(loopcounter).substring(0, randomlinearray(loopcounter).length - 1)
            End If



            loopcounter += 1
        End While

        ''''''''''''''

        arr = New ArrayList

        '5 lines blinking centered keyword
        arr.Add(centeredkeyword)
        arr.Add(centeredkeyword)
        arr.Add("")
        arr.Add(centeredkeyword)
        arr.Add(centeredkeyword)


        '6 lines random
        arr.Add(randomlinearray(0))
        arr.Add(randomlinearray(1))
        arr.Add(randomlinearray(2))
        arr.Add(randomlinearray(3))
        arr.Add(randomlinearray(4))
        arr.Add(randomlinearray(5))



        '4lines all on
        arr.Add(centeredkeyword)
        arr.Add(centeredkeyword)
        arr.Add(centeredkeyword)
        arr.Add(centeredkeyword)

        '6 lines random
        arr.Add(randomlinearray(6))
        arr.Add(randomlinearray(7))
        arr.Add(randomlinearray(8))
        arr.Add(randomlinearray(9))
        arr.Add(randomlinearray(10))
        arr.Add(randomlinearray(11))



        '5 lines blinking 
        arr.Add(centeredkeyword)
        arr.Add(centeredkeyword)
        arr.Add("")
        arr.Add(centeredkeyword)
        arr.Add(centeredkeyword)

        '6 lines random
        arr.Add(randomlinearray(12))
        arr.Add(randomlinearray(13))
        arr.Add(randomlinearray(14))
        arr.Add(randomlinearray(15))
        arr.Add(randomlinearray(16))
        arr.Add(randomlinearray(17))


        '4lines all on
        arr.Add(centeredkeyword)
        arr.Add(centeredkeyword)
        arr.Add(centeredkeyword)
        arr.Add(centeredkeyword)


        '4 lines random
        arr.Add(randomlinearray(18))
        arr.Add(randomlinearray(19))
        arr.Add(randomlinearray(20))
        arr.Add(randomlinearray(21))





    End Sub


    Private Function validaterandomarraylist(ByRef randomlinearray As ArrayList, ByVal keyword_Length As Int16) As Boolean
        Dim loopcounter As Int16 = 0
        'Dim returnvalue As Boolean = True
        While loopcounter < randomlinearray.Count
            If randomlinearray(loopcounter).length <> keyword_Length + 2 Then
                'check that I typed in correct number of letters

                MsgBox(loopcounter.ToString)
                'returnvalue = False
            End If

            'pad to sign size



            loopcounter += 1
        End While

        'Return returnvalue
    End Function


    '''''''''''''''''''''''''''''''''''''''''''''
    '''''''random pattern generating functions'''
    'Private Sub ran_initialize_letters_used_array(ByRef array As ArrayList)

    '    Dim loopcounter As Int16 = 0
    '    While loopcounter < Txt_keyword.Text.Length
    '        If Txt_keyword.Text(loopcounter) = " " Then
    '            array.Add(-1)
    '        Else
    '            array.Add(0)
    '        End If

    '        loopcounter += 1
    '    End While
    'End Sub


    Public Function possible_to_view_file_in_easytab() As Boolean
        Dim dummystring As String = ""
        Dim dummyint As Int16 = 0

        Return determine_easy_pattern_type_from_text(dummystring, dummyint)
    End Function
    Private Function determine_easy_pattern_type_from_text(ByRef keyword As String, ByRef easy_pattern As Int16) As Boolean





        Dim testarr As ArrayList


        Dim linecountshouldbe As Int16
        'some patterns require formulas that need to be done multiple part 
        'to avoid weird rounding

        Dim line_Time As Int16 = tricks_get_parameters(1)(2)

        If textdata.Count = 0 Then
            Return False
        End If
        Dim prevline As String = textdata(0)
        Dim loopcounter As Int16 = 1
        Dim test_succeeed_flag As Boolean

        'test for constant
        If textdata.Count = 1 Then
            keyword = textdata(0).trimend.padright(settings(settingsindex.linelength)) 'the one and only entry
            easy_pattern = easy_pattern_types.constant
            Return True
        End If



        If tricks_get_activetrick() <> 1 Then

            'all tricks except constant have trick 1 (rotate through lines ) selected
            Return False

        End If

        If tricks_get_linecount_of_trick1() <> linecount Then
            'all easy patterns except still rotate through all lines 

            Return False
        End If

        If tricks_get_speed_of_trick1() > 100 Then
            'speed bar on easy patterns tab limits speed to 10 seconds 

            Return False
        End If


        'test for addon
        keyword = textdata(textdata.Count - 1).trimend.padright(settings(settingsindex.linelength) - 2) 'the last entry
        testarr = New ArrayList
        add_pattern_addon(testarr, keyword)

        If arraycompare(testarr, textdata) Then

            easy_pattern = easy_pattern_types.add_on
            Return True

        End If






        'If textdata.Count = keyword.Length + 1 Then


        '    test_succeeed_flag = True 'suceeed if not fail


        '    loopcounter = 0

        '    While loopcounter <= keyword.Length
        '        Dim line As String = textdata(loopcounter)


        '        If line <> keyword.Substring(0, loopcounter) Then
        '            test_succeeed_flag = False
        '        End If
        '        loopcounter += 1

        '    End While


        '    If test_succeeed_flag Then


        '        easy_pattern = easy_pattern_types.add_on
        '        Return True


        '    End If


        'End If







        'test for flow right
        If textdata.Count = settings(settingsindex.linelength) Then
            keyword = textdata(0) ' first entry
            'if we later chose to test for legacy flow right use the last entry for keyword

            'kewy word must be 2 spaces less then linelength 
            'keyword = keyword.TrimEnd.PadRight(settings(settingsindex.linelength) - 2)

            'keyword = keyword.Substring(0, keyword.Length - 2)

            'MsgBox("[" + keyword + "]")
            prevline = textdata(0)
            loopcounter = 1 'starts the second line
            test_succeeed_flag = True 'suceeed if not fail 


            While loopcounter < textdata.Count
                Dim thisline As String = textdata(loopcounter)
                If thisline = prevline.Substring(prevline.Length - 1) + prevline.Substring(0, prevline.Length - 1) Then
                    prevline = thisline
                Else
                    test_succeeed_flag = False
                    Exit While
                End If

                loopcounter += 1
            End While

            If test_succeeed_flag Then


                easy_pattern = easy_pattern_types.flow_right
                Return True


            End If




        End If

        'test for flow left
        keyword = textdata(0)

        If textdata.Count = settings(settingsindex.linelength) Then
            prevline = textdata(0)
            loopcounter = 1 'every case starts the second line
            test_succeeed_flag = True 'suceeed if not fail
            test_succeeed_flag = True 'suceeed if not fail 
            While loopcounter < textdata.Count
                Dim thisline As String = textdata(loopcounter)
                If thisline = prevline.Substring(1, prevline.Length - 1) + prevline.Substring(0, 1) Then
                    prevline = thisline
                Else
                    test_succeeed_flag = False
                    Exit While
                End If

                loopcounter += 1
            End While

            If test_succeeed_flag Then


                easy_pattern = easy_pattern_types.flow_left
                Return True


            End If
        End If


        'test for join in
        'linecountshouldbe = settings(settingsindex.linelength) / 2

        'linecountshouldbe = linecountshouldbe + 1
        If textdata.Count = linecountshouldbe Or True Then

            keyword = textdata(textdata.Count - 1).trim.padright(settings(settingsindex.linelength)) 'the last entry
            'I now make it so that it starts out with padding at the beggining up to linelength
            'I do not know why I did the complicated way pertaining to old notes



            ''old notes
            'because it is difficult to calculate how many spaces to trim in order to get 
            'back a keyword that may itself start with a space
            'I test every combination of trimming 1 or more space from begining.
            ''end old notes

            Dim anotherkeyword As Boolean = True


            ''this code pertains to old notes
            'trim 2 spaces because keyword box is 2 less then linelength
            'If keyword.EndsWith("  ") Then
            '    '2 spaces on end
            '    keyword = keyword.Substring(0, keyword.Length - 2)
            '    'truncate last 2 spaces
            'ElseIf keyword.EndsWith(" ") And keyword.StartsWith(" ") Then
            '    '1 spaces on either end
            '    keyword = keyword.Substring(1, keyword.Length - 2)
            '    'truncate one space on either end
            'Else
            '    test_succeeed_flag = False
            '    anotherkeyword = False
            '    'test for this pattern fails
            '    'skip over loops
            'End If


            While (anotherkeyword)

                If keyword.Trim = "" Then
                    'if the last entry is blank the pattern is not join in
                    'this loop is infinate with empty keyword
                    Exit While
                End If

                test_succeeed_flag = True 'suceeed if not fail


                If keyword.Trim = "" Then
                    'if the first entry is blank the pattern is not splitout
                    'this loop is infinate with empty keyword
                    Exit While
                End If

                test_succeeed_flag = True 'succed if not fail
                testarr = New ArrayList

                add_pattern_joinin(testarr, keyword)

                If Not arraycompare(testarr, textdata) Then
                    test_succeeed_flag = False

                End If






                If test_succeeed_flag Then
                    'must exitwhile before removing another space from keyword

                    'attempting to avoid this by adding a space before loop doesn't work 
                    'because keyword would then either have too may chars or would loose the last letter
                    Exit While



                End If

                If keyword.StartsWith(" ") Then
                    keyword = keyword.Substring(1) + " "
                Else
                    anotherkeyword = False
                End If

            End While


            If test_succeeed_flag Then

                easy_pattern = easy_pattern_types.join_in
                Return True



            End If


        End If


        'test for blink fast
        If textdata.Count = 2 Then
            keyword = textdata(0) 'the first entry
            If textdata(1).trim = "" And tricks_get_activetrick() = 1 Then


                easy_pattern = easy_pattern_types.blink_fast
                Return True
            End If


        End If



        'test for split out
        linecountshouldbe = settings(settingsindex.linelength) / 2

        linecountshouldbe = linecountshouldbe + 1
        If textdata.Count = linecountshouldbe Or True Then





            '''''old notes
            'because it is difficult to calculate how many spaces to trim in order to get 

            'back a keyword that may itself start with a space
            'I test every combination of trimming 1 or more space from begining.


            '''''formula kept for future referece
            'the text in textdata(0) is the keyword padded with spaces
            'the number of spaces is linelength/2 - keyword.length/2 
            'including funny rounding
            ''''''old notes

            Dim anotherkeyword As Boolean = True
            test_succeeed_flag = False 'set false to go through loop at least once

            keyword = textdata(1).trim.padright(settings(settingsindex.linelength)) 'the 2nd entry trimed to keyword size 



            '''''pertaining to old notes
            ''trim 2 spaces because keyword box is 2 less then linelength
            'If keyword.EndsWith("  ") Then
            '    '2 spaces on end
            '    keyword = keyword.Substring(0, keyword.Length - 2)
            '    'truncate last 2 spaces
            'ElseIf keyword.EndsWith(" ") And keyword.StartsWith(" ") Then
            '    '1 spaces on either end
            '    keyword = keyword.Substring(1, keyword.Length - 2)
            '    'truncate one space on either end
            'Else

            '    test_succeeed_flag = False
            '    anotherkeyword = False
            '    'test for this pattern fails
            'End If


            'Dim lenghtofuntrimedkeyword = keyword.Length
            'keyword = keyword.TrimStart
            'Dim keyword_loopcounter = keyword.Length
            While (anotherkeyword)



                test_succeeed_flag = True 'suceeed if not fail


                If keyword.Trim = "" Then
                    'if the first entry is blank the pattern is not splitout
                    'this loop is infinate with empty keyword
                    test_succeeed_flag = False
                    Exit While
                End If

                test_succeeed_flag = True 'succed if not fail
                testarr = New ArrayList

                add_pattern_splitout(testarr, keyword)

                If Not arraycompare(testarr, textdata) Then
                    test_succeeed_flag = False

                End If





                If test_succeeed_flag Then
                    'must exitwhile before removing another space from keyword

                    'attempting to avoid this by adding a space before loop doesn't work 
                    'because keyword would then either have too may chars or would loose the last letter
                    Exit While



                End If

                If keyword.StartsWith(" ") Then
                    keyword = keyword.Substring(1) + " "
                Else
                    anotherkeyword = False
                End If
            End While


            If test_succeeed_flag Then
                easy_pattern = easy_pattern_types.split_out
                Return True

            End If


        End If





        'test for zoom

        linecountshouldbe = settings(settingsindex.linelength) + 2
        If textdata.Count = linecountshouldbe Or True Then





            'because it is difficult to calculate how many spaces to trim in order to get 
            'back a keyword that may itself start with a space
            'I test every combination of trimming 1 or more space from begining.


            Dim anotherkeyword As Boolean = True
            test_succeeed_flag = False 'set false to go through loop at least once
            keyword = textdata(textdata.Count - 1).trim.padright(settings(settingsindex.linelength)) 'the last entry

            ''trim 2 spaces because keyword box is 2 less then linelength
            'If keyword.EndsWith("  ") Then
            '    '2 spaces on end
            '    keyword = keyword.Substring(0, keyword.Length - 2)
            '    'truncate last 2 spaces
            'ElseIf keyword.EndsWith(" ") And keyword.StartsWith(" ") Then
            '    '1 spaces on either end
            '    keyword = keyword.Substring(1, keyword.Length - 2)
            '    'truncate one space on either end
            'Else

            '    test_succeeed_flag = False
            '    anotherkeyword = False
            '    'test for this pattern fails
            'End If


            While (anotherkeyword)
                If keyword.Trim = "" Then
                    'if the last entry is blank the pattern is not splitout
                    'this loop is infinate with empty keyword
                    Exit While
                End If
                test_succeeed_flag = True 'succed if not fail
                testarr = New ArrayList

                add_pattern_zoom(testarr, keyword)

                If Not arraycompare(testarr, textdata) Then
                    test_succeeed_flag = False

                End If






                If test_succeeed_flag Then
                    'must exitwhile before removing another space from keyword

                    'attempting to avoid this by adding a space before loop doesn't work 
                    'because keyword would then either have too may chars or would loose the last letter
                    Exit While



                End If

                If keyword.StartsWith(" ") Then
                    keyword = keyword.Substring(1) + " "
                Else
                    anotherkeyword = False
                End If

            End While





            If test_succeeed_flag Then

                easy_pattern = easy_pattern_types.zoom
                Return True



            End If

        End If




        'test for dance
        keyword = textdata(0) 'the first entry
        'works with keyword anything but linelength  


        testarr = New ArrayList

        add_pattern_dance(testarr, keyword)

        If arraycompare(testarr, textdata) Then
            'if test arr is not identical to textdata, the test failed
            'in other words if the lines in the testarray in wich we stored data from the pattern creating routine
            'are not identical to the lines in the file we are converting, this test fails
            easy_pattern = easy_pattern_types.dance
            Return True

        End If

        keyword = textdata(1) 'the second entry
        'works if the keyword is exactly linelength long


        testarr = New ArrayList

        add_pattern_dance(testarr, keyword)

        If arraycompare(testarr, textdata) Then
            'if test arr is not identical to textdata, the test failed
            'in other words if the lines in the testarray in wich we stored data from the pattern creating routine
            'are not identical to the lines in the file we are converting, this test fails
            easy_pattern = easy_pattern_types.dance
            Return True

        End If












        'test for blink slow
        If textdata.Count = 10 Then
            keyword = textdata(0) 'the first entry
            testarr = New ArrayList

            add_pattern_blinkslow(testarr, keyword)

            If arraycompare(testarr, textdata) Then

                easy_pattern = easy_pattern_types.blink_slow
                Return True

            End If

        End If
        'test for random
        If textdata.Count = 40 Then


            'because it is difficult to calculate how many spaces to trim in order to get 
            'back a keyword that may itself start with a space
            'I test every combination of trimming 1 or more space from begining.


            Dim anotherkeyword As Boolean = True
            test_succeeed_flag = False 'set false to go through loop at least once
            keyword = textdata(0) 'the first entry

            'trim 2 spaces because keyword box is 2 less then linelength
            If keyword.EndsWith(" ") And keyword.StartsWith(" ") Then
                '1 spaces on either end
                keyword = keyword.Substring(1, keyword.Length - 1)
                'truncate one space on either end
            Else
                'test for this pattern fails
                'the centered keyword always one space on either end
                test_succeeed_flag = False
                anotherkeyword = False

            End If


            While (anotherkeyword)

                If keyword.Trim = "" Then
                    'if the first entry is blank the pattern is not zoom
                    'this loop is infinate with empty keyword
                    Exit While
                End If
                test_succeeed_flag = True 'suceeed if not fail
                testarr = New ArrayList

                create_pattern_random(testarr, keyword)

                If Not arraycompare(testarr, textdata) Then
                    'if test arr is not identical to textdata, the test failed
                    'in other words if the lines in the testarray in wich we stored data from the pattern creating routine
                    'are not identical to the lines in the file we are converting, this test fails
                    test_succeeed_flag = False
                End If




                If test_succeeed_flag Then
                    'must exitwhile before removing another space from keyword

                    'attempting to avoid this by adding a space before loop doesn't work 
                    'because keyword would then either have too may chars or would loose the last letter
                    Exit While



                End If

                If keyword.StartsWith(" ") Then
                    keyword = keyword.Substring(1) + " "
                Else
                    anotherkeyword = False
                End If

            End While





            If test_succeeed_flag Then

                easy_pattern = easy_pattern_types.random
                Return True



            End If




        End If
        'all tests failed
        Return False

    End Function

    Public Function arraycompare(ByVal array1 As ArrayList, ByVal array2 As ArrayList) As Boolean
        If array1.Count <> array2.Count Then
            Return False

        End If

        Dim loopcounter = 0
        While loopcounter < array1.Count
            Dim value1 = array1(loopcounter)
            Dim value2 = array2(loopcounter)
            If value1.trimend <> value2.trimend Then
                Return False
            End If

            loopcounter += 1
        End While

        'comparison didn't fail so it must have succeded   
        Return True

    End Function
    Private Sub RBpattern_common_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles RB_pat_zoom.CheckedChanged, RB_pat_SplitOut.CheckedChanged, RB_pat_random.CheckedChanged, RB_pat_JoinIn.CheckedChanged, RB_pat_FlowRight.CheckedChanged, RB_pat_FlowLeft.CheckedChanged, RB_pat_Dance.CheckedChanged, RB_pat_Constant.CheckedChanged, RB_pat_BlinkSlow.CheckedChanged, RB_pat_BlinkFast.CheckedChanged, RB_pat_AddOn.CheckedChanged
        If sender.checked Then


            Dim style As FontStyle = RB_pat_Constant.Font.Style
            'If sender.Font Is RB_pat_Constant.Font Then
            '    MsgBox("match")
            'End If
            font_functions.changestyle(sender, FontStyle.Bold)

            'If sender.Font Is RB_pat_Constant.Font Then
            '    MsgBox("match")
            'End If
            selected_easy_pattern_type = Convert.ToInt16(sender.tag)
            style = RB_pat_Constant.Font.Style

            easytab_process_data_change()
            'Dim patternnum As Int16 = 

        Else

            'mark font of deselected chechbox regular (not bold)
            font_functions.changestyle(sender, FontStyle.Regular)
        End If

    End Sub

    Private Function easytab_pattern_type_enabled(ByVal patterntype As Int16) As Boolean
        If patterntype = easy_pattern_types.add_on And RB_pat_AddOn.Enabled Then
            Return True
        ElseIf patterntype = easy_pattern_types.blink_fast And RB_pat_BlinkFast.Enabled Then
            Return True
        ElseIf patterntype = easy_pattern_types.blink_slow And RB_pat_BlinkSlow.Enabled Then
            Return True
        ElseIf patterntype = easy_pattern_types.constant And RB_pat_Constant.Enabled Then
            Return True
        ElseIf patterntype = easy_pattern_types.dance And RB_pat_Dance.Enabled Then
            Return True
        ElseIf patterntype = easy_pattern_types.flow_left And RB_pat_FlowLeft.Enabled Then
            Return True
        ElseIf patterntype = easy_pattern_types.flow_right And RB_pat_FlowRight.Enabled Then
            Return True
        ElseIf patterntype = easy_pattern_types.join_in And RB_pat_JoinIn.Enabled Then
            Return True
        ElseIf patterntype = easy_pattern_types.split_out And RB_pat_SplitOut.Enabled Then
            Return True
        ElseIf patterntype = easy_pattern_types.zoom And RB_pat_zoom.Enabled Then
            Return True
        ElseIf patterntype = easy_pattern_types.random And RB_pat_random.Enabled Then
            Return True
        Else
            Return False
        End If
    End Function
    Private Sub easytab_process_data_change()
        ''''
        'Dim speed As Int16 = 0
        'If selected_easy_pattern_type = easy_pattern_types.blink_fast Then
        '    speed = speed_blinkfast
        '    'MsgBox("fast")
        'ElseIf selected_easy_pattern_type = easy_pattern_types.blink_slow Then
        '    speed = speed_blinkslow
        '    'MsgBox("slow")
        'Else

        '    speed = speed_easydisplaypatterns

        'End If

        If easytab_pattern_type_enabled(selected_easy_pattern_type) Then
            create_pattern(Txt_keyword.Text, selected_easy_pattern_type)
        Else
            create_pattern(Txt_keyword.Text, easy_pattern_types.constant)
        End If


    End Sub









    Private Sub But_prev_picture_Click_1(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles But_prev_picture.Click
        CB_pictures.SelectedIndex -= 1
    End Sub

    Private Sub But_next_picture_Click_1(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles But_next_picture.Click
        CB_pictures.SelectedIndex += 1
    End Sub

    Private Sub lbl_picture_select_buttons_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Pan_pictureselect_buttons1.Visible = True
        Pan_pictureselect_buttons2.Visible = True
        Pan_pictureselect_menu.Visible = False

        mark_selected(lbl_picture_select_menu)
        mark_selected(pan_picture_select_menu)

        mark_unselected(lbl_picture_select_buttons)
        mark_unselected(pan_picture_select_buttons)

    End Sub

    Private Sub lbl_picture_select_menu_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Pan_pictureselect_buttons1.Visible = False
        Pan_pictureselect_buttons2.Visible = False
        Pan_pictureselect_menu.Visible = True

        mark_selected(lbl_picture_select_menu)
        mark_selected(pan_picture_select_menu)

        mark_unselected(lbl_picture_select_buttons)
        mark_unselected(pan_picture_select_buttons)
    End Sub

    Private Sub Button_discard_tricks_Click_1(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button_discard_tricks.Click
        Dim result As DialogResult = MsgBox("Are you sure you want to discard display patterns", MsgBoxStyle.OkCancel)
        If result = Windows.Forms.DialogResult.OK Then
            tricks_makecompatible_with_1_003(True)
            hide_filerestrictions()
        End If
    End Sub




    Private Function refresh_easy_tab() As Boolean
        Dim keyword As String = ""
        Dim pattern As Int16 = 0

        If Not determine_easy_pattern_type_from_text(keyword, pattern) Then

            If TabControl1.SelectedTab Is Me.Tab_Easy Then
                TabControl1.SelectedTab = Tab_Lines
                LineConfigurationToolStripMenuItem.Enabled = True
            End If


            Return False

        End If


        Txt_keyword.Text = keyword

        If pattern = easy_pattern_types.constant Then
            RB_pat_Constant.Checked = True
        ElseIf pattern = easy_pattern_types.flow_left Then
            RB_pat_FlowLeft.Checked = True

        ElseIf pattern = easy_pattern_types.flow_right Then
            RB_pat_FlowRight.Checked = True
        ElseIf pattern = easy_pattern_types.split_out Then
            RB_pat_SplitOut.Checked = True
        ElseIf pattern = easy_pattern_types.join_in Then
            RB_pat_JoinIn.Checked = True
        ElseIf pattern = easy_pattern_types.blink_fast Then
            RB_pat_BlinkFast.Checked = True
        ElseIf pattern = easy_pattern_types.blink_slow Then
            RB_pat_BlinkSlow.Checked = True

        ElseIf pattern = easy_pattern_types.dance Then
            RB_pat_Dance.Checked = True
        ElseIf pattern = easy_pattern_types.add_on Then
            RB_pat_AddOn.Checked = True
        ElseIf pattern = easy_pattern_types.zoom Then
            RB_pat_zoom.Checked = True

        ElseIf pattern = easy_pattern_types.random Then
            RB_pat_random.Checked = True
        Else
            MsgBox("Error no pattern selected in refresh_easy_tab")
        End If
        Dim numvalue As Int16 = 255 - tricks_get_parameters(1)(2) + 1
        HSB_speed_easytab.Value = numvalue

        Return True
    End Function


    'Private Function convert_to_stillpattern() As Boolean
    '    Dim loopcounter As Int16 = 0
    '    Dim onelineindex As Int16 = -1 '-1 means no lines -2 means multiple lines
    '    While loopcounter < textdata.Count
    '        If textdata(loopcounter).trim <> "" Then
    '            'notext = False
    '            If onelineindex = -1 Then
    '                onelineindex = loopcounter
    '            Else
    '                Return False
    '                onelineindex = -2
    '                Exit While
    '            End If
    '        End If
    '        loopcounter += 1
    '    End While
    '    If onelineindex = -1 Then
    '        'no(lines)
    '        set_linecount(1, line_configuration.add_or_truncate_position._end)
    '    ElseIf onelineindex = -2 Then
    '        'multiple line do nothing

    '        Return False
    '    Else

    '        'one line
    '        If textdata.Count = 2 Then
    '            'blink - do nothing
    '            Return False
    '        Else
    '            Dim newlinecount = linecount


    '            'truncate lines from begining
    '            newlinecount = linecount - onelineindex
    '            set_linecount(newlinecount, line_configuration.add_or_truncate_position._beginning)

    '            '1234-6
    '            'trucate lines from beginning
    '            set_linecount(1, line_configuration.add_or_truncate_position._end)


    '        End If

    '    End If
    '    Return True
    'End Function

    Public Function nonemptylinecount() As Int16
        Dim loopcounter As Int16 = 0
        Dim count As Int16 = 0
        While loopcounter < textdata.Count
            If textdata(loopcounter).trim <> "" Then
                count += 1

            End If

            loopcounter += 1
        End While
        Return count
    End Function

    Private Sub refresh_freestyle_text()
        Dim restorevalue = databeinginternallymanipulated

        databeinginternallymanipulated = True

        TxtFreeStyle.Text = ""
        For Each line As String In Me.textdata
            TxtFreeStyle.Text &= line & Constants.vbCrLf
        Next
        If Me.textdata.Count >= 1 Then
            'remove last 2 characters because for loop adds extra crlf
            TxtFreeStyle.Text = TxtFreeStyle.Text.Substring(0, TxtFreeStyle.Text.Length - 2)

        End If
      
        databeinginternallymanipulated = restorevalue


    End Sub
    Private Sub TabControl1_SelectedIndexChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles TabControl1.SelectedIndexChanged
        'MsgBox(Pan_bluetabs.Parent.Name)
        'MsgBox(Panel32.Parent.Name)

        Dim restorevalue = databeinginternallymanipulated
        'databeinginternallymanipulated = True


        Static recursive As Boolean = False
        Static previoustab As Windows.Forms.TabPage
        'TabControl1.SelectedTab Is Tab_lines Or TabControl1.SelectedTab Is Tab_easy


        'we used to hide getdata menu otion when the combo tab was visible
        'If TabControl1.SelectedTab Is Tab_lines Or TabControl1.SelectedTab Is Tab_easy Then

        '    men_read_device.Visible = True
        'ElseIf TabControl1.SelectedTab Is Tab_combo Then

        '    men_read_device.Visible = False
        'Else
        '    MsgBox("error programmer added a tab and forgot to set value for men_read_device.visible when selected tab changes")

        'End If



        If Not recursive Then


            recursive = True


            If TabControl1.SelectedTab Is Tab_Lines Then


                'line  tab

                If previoustab Is Tab_Easy Then
                    'previous tab was easy





                    If Txt_keyword.Text.Trim = "" And Not databeinginternallymanipulated Then
                        databeinginternallymanipulated = True
                        'set_linecount(Me.totallines, line_configuration.add_or_truncate_position._end)
                    End If
                    databeinginternallymanipulated = True

                    If selected_easy_pattern_type = easy_pattern_types.add_on And RB_pat_AddOn.Enabled Then
                        Lbl_pattern_type.Text = "Add On"
                    ElseIf selected_easy_pattern_type = easy_pattern_types.blink_fast And RB_pat_BlinkFast.Enabled Then
                        Lbl_pattern_type.Text = "Blink Fast"
                    ElseIf selected_easy_pattern_type = easy_pattern_types.blink_slow And RB_pat_BlinkSlow.Enabled Then
                        Lbl_pattern_type.Text = "Blink Slow"
                    ElseIf selected_easy_pattern_type = easy_pattern_types.constant And RB_pat_Constant.Enabled Then
                        Lbl_pattern_type.Text = "Still"
                    ElseIf selected_easy_pattern_type = easy_pattern_types.dance And RB_pat_Dance.Enabled Then
                        Lbl_pattern_type.Text = "Dance"
                    ElseIf selected_easy_pattern_type = easy_pattern_types.flow_left And RB_pat_FlowLeft.Enabled Then
                        Lbl_pattern_type.Text = "Flow Left"
                    ElseIf selected_easy_pattern_type = easy_pattern_types.flow_right And RB_pat_FlowRight.Enabled Then
                        Lbl_pattern_type.Text = "Flow Right"
                    ElseIf selected_easy_pattern_type = easy_pattern_types.join_in And RB_pat_JoinIn.Enabled Then
                        Lbl_pattern_type.Text = "Join In"
                    ElseIf selected_easy_pattern_type = easy_pattern_types.split_out And RB_pat_SplitOut.Enabled Then
                        Lbl_pattern_type.Text = "Split Out"
                    ElseIf selected_easy_pattern_type = easy_pattern_types.zoom And RB_pat_zoom.Enabled Then
                        Lbl_pattern_type.Text = "Zoom In/Out"
                    ElseIf selected_easy_pattern_type = easy_pattern_types.random And RB_pat_random.Enabled Then
                        Lbl_pattern_type.Text = "Random"
                    Else
                        Lbl_pattern_type.Text = "(No Pattern)"
                    End If


                    'MsgBox(1)
                    'ElseIf previoustab Is Tab_FreeStyle Then




                End If
                'Pan_bluetabs.Parent = Tab_Lines
                'Pan_demooption_multiline.Visible = True
                'pan_dialog.Parent = Tab_Lines


                'reset data displayed
                Me.textdata_top()


                LineConfigurationToolStripMenuItem.Enabled = True

                refresh_trickcontrols()
                'textdata_top()

            ElseIf TabControl1.SelectedTab Is Tab_Easy Then
                'easy tab
                'MsgBox(2)
                databeinginternallymanipulated = True
                'Pan_bluetabs.Parent = Tab_Easy
                'Pan_demooption_multiline.Visible = False

                'If Pan_demo_multiline.Visible Then
                '    demooption_oneline_Click(Lbl_demooption_oneline, New EventArgs)
                'End If
                'LineConfigurationToolStripMenuItem.Enabled = False
                If formloaded Then
                    'Dim notext As Boolean = True
                    'Dim oneline As Boolean = False

                    Dim nonemptyline As Int16 = nonemptylinecount()
                    If nonemptyline = 0 And tricks_get_activetrick() = 0 Then
                        set_linecount(1, line_configuration.add_or_truncate_position._end)
                    ElseIf nonemptyline = 1 And textdata(0).trim <> "" And tricks_get_activetrick() = 0 Then
                        'If linecount = 2 Then
                        'blink do not convert 
                        If tricks_get_activetrick() <> 0 Then
                            'trick 0 not active do not convert
                        Else
                            'only the first line has text and show first line trick is selected
                            set_linecount(1, line_configuration.add_or_truncate_position._end)
                        End If
                    End If

                    If Not refresh_easy_tab() Then
                        'sequence of setting panels must be correct because 
                        'newfile works slightly different bassed on which panel is showing
                        'also setting blue tabs parent is done explicitly because recursive flag is set

                        TabControl1.SelectedTab = previoustab
                        'Pan_bluetabs.Parent = previoustab
                        Dim restorevalue2 = databeinginternallymanipulated
                        databeinginternallymanipulated = False 'prevent tripping wqatchdog timmer

                        dialog_unable_to_display_easy_tab.ShowDialog()
                        databeinginternallymanipulated = restorevalue2
                        If dialog_unable_to_display_easy_tab.DialogResult = Windows.Forms.DialogResult.OK Then

                            'Pan_bluetabs.Parent = Tab_Easy

                            TabControl1.SelectedTab = Tab_Easy



                            If Not newfile() Then

                                'recursive = True
                                TabControl1.SelectedTab = previoustab
                                'Pan_bluetabs.Parent = Tab_Lines
                                'refresh_easy_tab()
                            End If

                            'recursive = True
                        ElseIf dialog_unable_to_display_easy_tab.DialogResult = Windows.Forms.DialogResult.Cancel Then
                            'do nothing
                            'ie leave pevious ttab  showing
                        ElseIf dialog_unable_to_display_easy_tab.DialogResult = Windows.Forms.DialogResult.Yes Then

                            'restore a previously stored version of the file and then show the easy tab
                            dialog_unable_to_display_easy_tab.backupfile(dialog_unable_to_display_easy_tab.backupfileflags.restoreStoredState)
                            'Pan_bluetabs.Parent = Tab_Easy

                            TabControl1.SelectedTab = Tab_Easy


                        End If


                    Else

                        'succesfully switched to easy tab
                        'clear backup to save memory space
                        'dialog_unable_to_display_easy_tab.backupfile(dialog_unable_to_display_easy_tab.backupfileflags.clear)
                    End If
                End If



            ElseIf TabControl1.SelectedTab Is Tab_Combo Then



                'combo tab    
                If currenttrickcodingversion = TRICKCODINGVERSION_LINESONLY_PRE_20110310 Or currenttrickcodingversion = TRICKCODINGVERSION_LINESONLY_CURRENT Then
                    'unable to view this file in combo tab

                    TabControl1.SelectedTab = previoustab


                    'Dim restorevalue2 = databeinginternallymanipulated
                    'databeinginternallymanipulated = False 'prevent tripping wqatchdog timmer


                    Dim restorevalue3 = databeinginternallymanipulated
                    databeinginternallymanipulated = False 'prevent tripping watchdog timmer
                    Dim result = dialog_unable_to_display_combo_tab.ShowDialog()
                    databeinginternallymanipulated = restorevalue3
                    If result = Windows.Forms.DialogResult.OK Then

                        'Pan_bluetabs.Parent = Tab_easy

                        TabControl1.SelectedTab = Tab_Combo

                        'recursive = False
                        'some of the newfile functionality requires setting panels without recursive flag set

                        'Pan_bluetabs.Parent = Tab_Combo
                        If Not newfile() Then

                            'recursive = True
                            TabControl1.SelectedTab = previoustab
                            'Pan_bluetabs.Parent = previoustab

                        End If

                        'recursive = True
                    ElseIf result = Windows.Forms.DialogResult.Cancel Then
                        'do nothing
                        'ie previous tab showing
                    ElseIf result = Windows.Forms.DialogResult.Yes Then

                        'restore a previously stored version of the file and then show the easy tab
                        dialog_unable_to_display_combo_tab.backupfile(dialog_unable_to_display_easy_tab.backupfileflags.restoreStoredState)


                        TabControl1.SelectedTab = Tab_Combo
                        'Pan_bluetabs.Parent = Tab_Combo

                    End If


                Else
                    'Pan_bluetabs.Parent = Tab_Combo
                End If


            ElseIf TabControl1.SelectedTab Is Tab_FreeStyle Then

                If previoustab Is Tab_Easy Then
                    'previous tab was easy





                    If Txt_keyword.Text.Trim = "" And Not databeinginternallymanipulated Then
                        databeinginternallymanipulated = True
                        'set_linecount(Me.totallines, line_configuration.add_or_truncate_position._end)
                    End If
                    databeinginternallymanipulated = True

                    If selected_easy_pattern_type = easy_pattern_types.add_on And RB_pat_AddOn.Enabled Then
                        Lbl_pattern_type.Text = "Add On"
                    ElseIf selected_easy_pattern_type = easy_pattern_types.blink_fast And RB_pat_BlinkFast.Enabled Then
                        Lbl_pattern_type.Text = "Blink Fast"
                    ElseIf selected_easy_pattern_type = easy_pattern_types.blink_slow And RB_pat_BlinkSlow.Enabled Then
                        Lbl_pattern_type.Text = "Blink Slow"
                    ElseIf selected_easy_pattern_type = easy_pattern_types.constant And RB_pat_Constant.Enabled Then
                        Lbl_pattern_type.Text = "Still"
                    ElseIf selected_easy_pattern_type = easy_pattern_types.dance And RB_pat_Dance.Enabled Then
                        Lbl_pattern_type.Text = "Dance"
                    ElseIf selected_easy_pattern_type = easy_pattern_types.flow_left And RB_pat_FlowLeft.Enabled Then
                        Lbl_pattern_type.Text = "Flow Left"
                    ElseIf selected_easy_pattern_type = easy_pattern_types.flow_right And RB_pat_FlowRight.Enabled Then
                        Lbl_pattern_type.Text = "Flow Right"
                    ElseIf selected_easy_pattern_type = easy_pattern_types.join_in And RB_pat_JoinIn.Enabled Then
                        Lbl_pattern_type.Text = "Join In"
                    ElseIf selected_easy_pattern_type = easy_pattern_types.split_out And RB_pat_SplitOut.Enabled Then
                        Lbl_pattern_type.Text = "Split Out"
                    ElseIf selected_easy_pattern_type = easy_pattern_types.zoom And RB_pat_zoom.Enabled Then
                        Lbl_pattern_type.Text = "Zoom In/Out"
                    ElseIf selected_easy_pattern_type = easy_pattern_types.random And RB_pat_random.Enabled Then
                        Lbl_pattern_type.Text = "Random"
                    Else
                        Lbl_pattern_type.Text = "(No Pattern)"
                    End If


                    'MsgBox(1)
                    'ElseIf previoustab Is Tab_FreeStyle Then




                End If

                databeinginternallymanipulated = True
                refresh_freestyle_text()

            End If


            previoustab = TabControl1.SelectedTab
            recursive = False
            databeinginternallymanipulated = restorevalue
        End If

    End Sub

    Private Sub Txt_keyword_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Txt_keyword.TextChanged
        Static Dim recursive As Boolean = False
        Static Dim previous_keyword As String
        If Not formloaded Then
            Return
        End If

        Dim junk As Int16 = 9

        If (Not recursive) Then

            recursive = True



            If (currenttrickcodingversion = TRICKCODINGVERSION_COMBOKEYWORDS_PRE_20110310 Or currenttrickcodingversion = TRICKCODINGVERSION_COMBOKEYWORDS_CURRENT) And Not databeinginternallymanipulated Then

                If promptbeforedisablingstandadtab Then



                    Dim message As String = " If you proceed with editing data in this tab you will not be able to return to combo tab!" + Constants.vbCrLf

                    message += "Are you sure you want to proceed"

                    Dim result As DialogResult = MsgBox(message, MsgBoxStyle.OkCancel)

                    If result = Windows.Forms.DialogResult.Cancel Then

                        sender.text = previous_keyword

                        recursive = False
                        Return
                    Else
                        If (currenttrickcodingversion = TRICKCODINGVERSION_COMBOKEYWORDS_PRE_20110310) Then

                            'assume they want to continue using old file format
                            currenttrickcodingversion = TRICKCODINGVERSION_LINESONLY_PRE_20110310
                        Else
                            currenttrickcodingversion = TRICKCODINGVERSION_LINESONLY_CURRENT

                        End If



                    End If
                Else

                    'make change with no prompt or option to cancle

                    If (currenttrickcodingversion = TRICKCODINGVERSION_COMBOKEYWORDS_PRE_20110310) Then

                        'assume they want to continue using old file format
                        currenttrickcodingversion = TRICKCODINGVERSION_LINESONLY_PRE_20110310
                    Else
                        currenttrickcodingversion = TRICKCODINGVERSION_LINESONLY_CURRENT

                    End If

                End If
            End If
            hidetooltip()




            'Dim index As Integer = sender.tag

            Dim cursor_pos As Integer = sender.SelectionStart
            'Dim highlite_length As Integer = sender.SelectionLength

            Dim dummystring As String = ""
            dummystring.StartsWith(" ")

            'if test lenght is to short pad end with space
            While (sender.text.length <= settings(settingsindex.linelength))

                sender.text += " "
                sender.SelectionStart = cursor_pos
            End While




            'if text lenght is too long
            If (sender.Text.Length > settings(settingsindex.linelength)) Then
                Dim startinglength As Integer = sender.Text.Length
                While (sender.Text.Length > settings(settingsindex.linelength) And sender.Text.EndsWith(" "))
                    'trim trailing white space
                    sender.Text = sender.Text.Substring(0, sender.Text.Length - 1)
                End While

                While (sender.Text.Length > settings(settingsindex.linelength) And sender.Text.StartsWith(" "))
                    'trim leading white space especially since we have aout centering
                    sender.Text = sender.Text.Substring(1)
                    cursor_pos -= 1
                End While

                If cursor_pos < 0 Then
                    cursor_pos = 0
                    'this is a cheeting solution to a bug that occured 
                    'when the get data from sign process changed the linelength
                End If




                If (sender.Text.Length > settings(settingsindex.linelength)) Then
                    sender.Text = previous_keyword

                    If cursor_pos - (startinglength - sender.Text.Length) < 0 Then
                        'MsgBox(cursor_pos - (startinglength - sender.Text.Length))
                        sender.SelectionStart = 0

                    Else
                        sender.SelectionStart = cursor_pos - (startinglength - sender.Text.Length)
                    End If

                    recursive = False

                    Return
                End If
            End If


            deviceandmemorymatch = False
            sender.text = sender.text.ToUpper
            sender.SelectionStart = cursor_pos


            If sender.text.trim = "" Then
                RB_pat_FlowRight.Enabled = False
                RB_pat_FlowLeft.Enabled = False
                RB_pat_JoinIn.Enabled = False
                RB_pat_SplitOut.Enabled = False
                RB_pat_Dance.Enabled = False
                RB_pat_BlinkSlow.Enabled = False
                RB_pat_BlinkFast.Enabled = False
                RB_pat_AddOn.Enabled = False
                RB_pat_zoom.Enabled = False
                RB_pat_random.Enabled = False

            ElseIf sender.text.trim.length < 2 Then

                RB_pat_FlowRight.Enabled = True
                RB_pat_FlowLeft.Enabled = True
                RB_pat_JoinIn.Enabled = False
                RB_pat_SplitOut.Enabled = False
                RB_pat_Dance.Enabled = True
                RB_pat_BlinkSlow.Enabled = True
                RB_pat_BlinkFast.Enabled = True
                RB_pat_AddOn.Enabled = False
                RB_pat_zoom.Enabled = False
                RB_pat_random.Enabled = False
            Else
                RB_pat_FlowRight.Enabled = True
                RB_pat_FlowLeft.Enabled = True
                RB_pat_JoinIn.Enabled = True
                RB_pat_SplitOut.Enabled = True
                RB_pat_Dance.Enabled = True
                RB_pat_BlinkSlow.Enabled = True
                RB_pat_BlinkFast.Enabled = True
                RB_pat_AddOn.Enabled = True
                RB_pat_zoom.Enabled = True
                RB_pat_random.Enabled = True
            End If


            easytab_process_data_change()


            If Not databeinginternallymanipulated Then
                change = True 'this is a global variable used for prompting to save file
            End If
            'change = True 'this is a global variable used for prompting to save file






            If (InMonitorMode) Then



            End If



            'Dim temparray() As String = {TB0.Text, TB1.Text, TB2.Text, TB3.Text, TB4.Text, TB5.Text, TB6.Text, TB7.Text, TB8.Text, TB9.Text}



            'fix demo_multiline text
            'Dim textdata_index As Integer = Convert.ToInt32(sender.tag)
            'Dim screen_oftextdata As Int16

            'If textdata_index <= 9 Then
            '    screen_oftextdata = 0
            'ElseIf textdata_index <= 19 Then
            '    screen_oftextdata = 1
            'ElseIf textdata_index <= 29 Then
            '    screen_oftextdata = 2
            'ElseIf textdata_index <= 39 Then
            '    screen_oftextdata = 3
            'ElseIf textdata_index <= 49 Then
            '    screen_oftextdata = 4
            'ElseIf textdata_index <= 59 Then
            '    screen_oftextdata = 5
            'Else
            '    screen_oftextdata = 100
            '    'a high number that eill not be showing
            'End If

            'If screen_oftextdata = demo_mulitlinescreen Then



            'End If




            previous_keyword = sender.text


            'textdata(index) = sender.text
            'demo_set_multilinescreen(demo_mulitlinescreen)


            recursive = False
        End If
    End Sub

    Public Function get_longest_linelength() As Int16

        Dim returnvalue As Int16 = 0
        Dim loopcounter = 0
        While loopcounter < textdata.Count


            If textdata(loopcounter).length > returnvalue Then
                returnvalue = textdata(loopcounter).length
            End If
            loopcounter += 1
        End While

        Return returnvalue






        'If TabControl1.SelectedTab Is TabPage2 Then
        '    Return Txt_keyword.Text.Trim.Length

        'ElseIf TabControl1.SelectedTab Is TabPage1 Then

        '    If refresh_easy_tab() Then

        '        Dim returnvalue As Int16 = Txt_keyword.Text.Trim.Length
        '        TabControl1.SelectedTab = TabPage1
        '        Return returnvalue
        '    Else
        '        'file open does not fit into easy tab
        '        Dim returnvalue As Int16 = 0
        '        Dim loopcounter = 0
        '        While loopcounter < textdata.Count


        '            If textdata(loopcounter).length > returnvalue Then
        '                returnvalue = textdata(loopcounter).length
        '            End If
        '            loopcounter += 1
        '        End While

        '        Return returnvalue
        '    End If
        'Else
        '    MsgBox("error")

        'End If

        'MsgBox("bug")
    End Function

    Public Function set_linecount(ByVal value As Int16, ByVal truncate_position As Int16) As Boolean
        'this function appends or removes lines from textdata arraylist
        'and changes linecount constant


        If currentlychanginglinecount Then
            Return False
        End If
        currentlychanginglinecount = True
        If value = linecount Then
            'setting line count to its current value
            'no need to do anything
            currentlychanginglinecount = False
            Return True
        End If

        Timer_demo.Stop()

        Dim activetab = TabControl1.SelectedTab
        
        'If refresh_easy_tab() Then
        '    'if it is possible to change to easy tab before changing line count
        '    'warn user that it will not be possible after

        '    TabControl1.SelectedTab = activetab
        '    Dim message As String = "If you change the line count" + Constants.vbCrLf
        '    message += "you will no longer be able to" + Constants.vbCrLf
        '    message += "view this file on the easy tab" + Constants.vbCrLf + Constants.vbCrLf

        '    message += "Are you sure you want to change line the count?" + Constants.vbCrLf

        '    Dim answer As DialogResult = MsgBox(message, MsgBoxStyle.YesNo)

        '    If answer = Windows.Forms.DialogResult.No Then
        '        Return False

        '    End If
        'End If

        If value < linecount Then
            Dim loopcounter = linecount
            While loopcounter > value

                If truncate_position = line_configuration.add_or_truncate_position._beginning Then
                    textdata.RemoveAt(0)
                ElseIf truncate_position = line_configuration.add_or_truncate_position._end Then

                    'MsgBox(value & " : " & loopcounter & " : " & textdata.Count)
                    textdata.RemoveAt(textdata.Count - 1)

                Else
                    MsgBox("unsuported value for truncate position")
                    currentlychanginglinecount = False
                    Return False
                End If
                loopcounter -= 1
            End While
        ElseIf value > linecount Then
            'add lines
            Dim loopcounter = linecount
            While loopcounter < value

                If truncate_position = line_configuration.add_or_truncate_position._beginning Then
                    textdata.Insert(0, "".PadLeft(settings(settingsindex.linelength)))
                ElseIf truncate_position = line_configuration.add_or_truncate_position._end Then

                    textdata.Add("".PadLeft(settings(settingsindex.linelength)))

                Else
                    MsgBox("unsuported value for truncate position")
                    currentlychanginglinecount = False
                    Return False

                End If
                loopcounter += 1
            End While
        ElseIf value = linecount Then
            'do nothing
        Else
            MsgBox("bug in set_linecount()")
        End If

        linecount = value

        NUD_linestab_liinecounts.Value = value

        'Me.refresh_pan_morelines()

        If activetab Is Me.Tab_Lines Or activetab Is Me.Tab_FreeStyle Then

            tricks_set_parameter(1, 1, value)
            Me.tricks_set_activetrick(1)
            refresh_demo()


        End If
        refresh_demo()
        textdata_top()

        currentlychanginglinecount = False
        Return True
    End Function


    Public Function set_cardCount(ByVal value As Int16) As Boolean

        'this fuction is not executed before all forms are initialized
        'it is called from simulator_form.Timer_formloaded_Tick() so that the cards are made visible 
        'late - without jumping around
        'of course it continues to be executed mid program like it was before this modification was made
        If Not formloaded Then
            Exit Function
        End If
        If Not simulator_form.initialized Then
            Exit Function
        End If

        'this function is called by set_linelength to set the number of lite cards in the demo

        'hide all
        LiteCard0.Visible = False
        LiteCard1.Visible = False
        LiteCard2.Visible = False
        LiteCard3.Visible = False
        LiteCard4.Visible = False
        LiteCard5.Visible = False
        LiteCard6.Visible = False
        LiteCard7.Visible = False
        LiteCard8.Visible = False
        LiteCard9.Visible = False
        LiteCard10.Visible = False
        LiteCard11.Visible = False
        LiteCard12.Visible = False
        LiteCard13.Visible = False
        LiteCard14.Visible = False
        LiteCard15.Visible = False
        LiteCard16.Visible = False
        LiteCard17.Visible = False
        LiteCard18.Visible = False
        LiteCard19.Visible = False
        'CFM-


        simulator_form.LiteCard0.Visible = False
        simulator_form.LiteCard1.Visible = False
        simulator_form.LiteCard2.Visible = False
        simulator_form.LiteCard3.Visible = False
        simulator_form.LiteCard4.Visible = False
        simulator_form.LiteCard5.Visible = False
        simulator_form.LiteCard6.Visible = False
        simulator_form.LiteCard7.Visible = False
        simulator_form.LiteCard8.Visible = False
        simulator_form.LiteCard9.Visible = False
        simulator_form.LiteCard10.Visible = False
        simulator_form.LiteCard11.Visible = False
        simulator_form.LiteCard12.Visible = False
        simulator_form.LiteCard13.Visible = False
        simulator_form.LiteCard14.Visible = False
        simulator_form.LiteCard15.Visible = False
        simulator_form.LiteCard16.Visible = False
        simulator_form.LiteCard17.Visible = False
        simulator_form.LiteCard18.Visible = False
        simulator_form.LiteCard19.Visible = False
        'CMF-



        'show cards as appropriate
        If value > 0 Then
            simulator_form.LiteCard0.Visible = True
            LiteCard0.Visible = True
        End If

        If value > 1 Then
            simulator_form.LiteCard1.Visible = True
            LiteCard1.Visible = True
        End If

        If value > 2 Then
            simulator_form.LiteCard2.Visible = True
            LiteCard2.Visible = True
        End If

        If value > 3 Then
            simulator_form.LiteCard3.Visible = True
            LiteCard3.Visible = True
        End If

        If value > 4 Then
            simulator_form.LiteCard4.Visible = True
            LiteCard4.Visible = True
        End If

        If value > 5 Then
            simulator_form.LiteCard5.Visible = True
            LiteCard5.Visible = True
        End If

        If value > 6 Then
            simulator_form.LiteCard6.Visible = True
            LiteCard6.Visible = True
        End If

        If value > 7 Then
            simulator_form.LiteCard7.Visible = True
            LiteCard7.Visible = True
        End If

        If value > 8 Then
            simulator_form.LiteCard8.Visible = True
            LiteCard8.Visible = True
        End If

        If value > 9 Then
            simulator_form.LiteCard9.Visible = True
            LiteCard9.Visible = True
        End If
        If value > 10 Then
            simulator_form.LiteCard10.Visible = True
            LiteCard10.Visible = True
        End If

        If value > 11 Then
            simulator_form.LiteCard11.Visible = True
            LiteCard11.Visible = True
        End If

        If value > 12 Then
            simulator_form.LiteCard12.Visible = True
            LiteCard12.Visible = True
        End If

        If value > 13 Then
            simulator_form.LiteCard13.Visible = True
            LiteCard13.Visible = True
        End If

        If value > 14 Then
            simulator_form.LiteCard14.Visible = True
            LiteCard14.Visible = True
        End If

        If value > 15 Then
            simulator_form.LiteCard15.Visible = True
            LiteCard15.Visible = True
        End If

        If value > 16 Then
            simulator_form.LiteCard16.Visible = True
            LiteCard16.Visible = True
        End If

        '---
        If value > 17 Then
            simulator_form.LiteCard17.Visible = True
            LiteCard17.Visible = True
        End If

        If value > 18 Then
            simulator_form.LiteCard18.Visible = True
            LiteCard18.Visible = True
        End If

        If value > 19 Then
            simulator_form.LiteCard19.Visible = True
            LiteCard19.Visible = True
        End If

        'CMF-
        'Changming 122612
        ' Const MAX_LINELENGTH

        'jp 122612 suspects that 16 may have been hardcoded because of TiniWindow having problems with 17 or more cards)
        'If value > 16 Then
        If value > Me.MAX_LINELENGTH Then
            MsgBox("Error this version of TiniWindow supports a maximum of " + Me.MAX_LINELENGTH + " lite cards in demo")

            'LiteCard0.Visible = True
        End If

        simulator_form.Repositioncardsafterchangingcount()

        'this is needed to get around blocking concerns 
        'the light cards need to be moved before the paint functions draws the connecting lines
        simulator_form.Timer_delayed_invalidate.Start()
    End Function
    Public Function set_linelenth(ByVal value As Int16, ByVal truncate_position As Int16, Optional ByVal workineasypan As Boolean = False, Optional ByVal promptbeforetruncating As Boolean = True) As Boolean


        Dim oldvalue As Int16 = settings(settingsindex.linelength)

        If currentlychanginglinelength Then
            Return False
        End If

        currentlychanginglinelength = True


        Dim tabworkingin As Windows.Forms.TabPage = TabControl1.SelectedTab
        If workineasypan Then
            'this is for backwardscompatibility for some hacks to work
            tabworkingin = Tab_Easy
        End If

        'TabControl1.SelectedTab Is Tab_lines Or TabControl1.SelectedTab Is Tab_easy
        'TabControl1.SelectedTab Is Tab_lines Or TabControl1.SelectedTab Is Tab_easy

        If settings(settingsindex.linelength) = value And formloaded Then
            'setting line length to its current value
            'do nothing

            'the exception is that durring formload we want everything set up correctly
            currentlychanginglinelength = False
            Return True
        End If

        If value < 4 Then
            MsgBox("error can not set sign to less then 4 letters")
            currentlychanginglinelength = False
            Return False
        End If


        Dim longestlinelength As Int16 = get_longest_linelength()
        If tabworkingin Is Tab_Easy Then
            'this is a hack, remember that easy keyword is USED TO BE 2 chars less then linelength
            longestlinelength = Txt_keyword.Text.TrimEnd.Length '+ 2
        ElseIf tabworkingin Is Tab_Lines Or tabworkingin Is Tab_FreeStyle Then

            longestlinelength = get_longest_linelength()

        ElseIf tabworkingin Is Tab_Combo Then
            'longestlinelength is irrelivent
        Else
            MsgBox("error - programmer has added another tab and not accounted for it in set_linelength()")
        End If



        If tabworkingin Is Tab_Combo Then

            settings(settingsindex.linelength) = value

            If Not combotab_generatelines() Then
                settings(settingsindex.linelength) = oldvalue
                currentlychanginglinelength = False
                Return False
            End If

            combotab_refreshlinedata()

        Else




            If longestlinelength > value Then

                Dim numoftruncatedchar As Int16 = settings(settingsindex.linelength) - value

                'If workineasypan Then

                '    numoftruncatedchar = Txt_keyword.Text.TrimEnd.Length + 2 - value
                'Else
                numoftruncatedchar = longestlinelength - value
                'End If

                If truncate_position = line_configuration.add_or_truncate_position._prompt Then

                    Dim message As String

                    'If workineasypan Then
                    '    message = "Before you can configure your TiniWindow to work with " + value.ToString + " light cards" + Constants.vbCrLf
                    '    message += "you must reduce the length of your keyword to " + (value - 2).ToString + " letters"

                    'Else

                    message = "Before you can configure your TiniWindow to work with " + value.ToString + " light cards" + Constants.vbCrLf
                    message += "you must reduce the length all " & linecount & " lines to" & (value).ToString & " letters"

                    'End If


                    'MsgBox(message)
                    Dim controlls_array As ArrayList = New ArrayList
                    controlls_array = New ArrayList

                    controlls_array.Add(New ArrayList)
                    controlls_array.Add(New ArrayList)
                    controlls_array.Add(New ArrayList)

                    controlls_array(mymsg.parameterArrayIndex.ControllType).add("label2")
                    controlls_array(mymsg.parameterArrayIndex.ControllValue).add("")
                    controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("")


                    controlls_array(mymsg.parameterArrayIndex.ControllType).add("button25")
                    controlls_array(mymsg.parameterArrayIndex.ControllValue).add("Discard first " + numoftruncatedchar.ToString + " letters")
                    controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("beg")


                    controlls_array(mymsg.parameterArrayIndex.ControllType).add("label2")
                    controlls_array(mymsg.parameterArrayIndex.ControllValue).add("")
                    controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("")

                    controlls_array(mymsg.parameterArrayIndex.ControllType).add("button25")
                    controlls_array(mymsg.parameterArrayIndex.ControllValue).add("Discard last " + numoftruncatedchar.ToString + " letters")
                    controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("end")

                    controlls_array(mymsg.parameterArrayIndex.ControllType).add("label2")
                    controlls_array(mymsg.parameterArrayIndex.ControllValue).add("")
                    controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("")

                    controlls_array(mymsg.parameterArrayIndex.ControllType).add("newrow")
                    controlls_array(mymsg.parameterArrayIndex.ControllValue).add("")
                    controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("")

                    controlls_array(mymsg.parameterArrayIndex.ControllType).add("label2")
                    controlls_array(mymsg.parameterArrayIndex.ControllValue).add("")
                    controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("")

                    controlls_array(mymsg.parameterArrayIndex.ControllType).add("button25")
                    controlls_array(mymsg.parameterArrayIndex.ControllValue).add("Cancel")
                    controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("cancel")






                    Dim restorevalue As Boolean = databeinginternallymanipulated
                    databeinginternallymanipulated = False

                    Dim selection_array As ArrayList = mymsg.showform(message, controlls_array)

                    databeinginternallymanipulated = restorevalue

                    Dim pressed_button As String = selection_array(mymsg.returnArrayIndex.button)(mymsg.returnArraySecondDimention.identifyer)

                    If pressed_button = "beg" Then
                        truncate_position = line_configuration.add_or_truncate_position._beginning
                    ElseIf pressed_button = "end" Then
                        truncate_position = line_configuration.add_or_truncate_position._end

                    ElseIf pressed_button = "cancel" Then
                        currentlychanginglinelength = False
                        Return False
                    Else

                        Dim restorevalue2 As Boolean = databeinginternallymanipulated
                        databeinginternallymanipulated = False

                        MsgBox("error in function set_linelength()")
                        databeinginternallymanipulated = restorevalue2
                        Return False
                    End If


                End If




                If truncate_position = line_configuration.add_or_truncate_position._beginning Then
                    If promptbeforetruncating Then

                        Dim message As String = "Are you sure you want to discard the first " + numoftruncatedchar.ToString + " letters "

                        Dim restorevalue2 As Boolean = databeinginternallymanipulated
                        databeinginternallymanipulated = False 'prevent tripping watchdog timmer

                        Dim result = MsgBox(message, MsgBoxStyle.YesNo)
                        databeinginternallymanipulated = restorevalue2
                        If result = DialogResult.No Then
                            currentlychanginglinelength = False
                            Return False
                        End If

                    End If

                    If workineasypan Then
                        Txt_keyword.Text = Txt_keyword.Text.Substring(numoftruncatedchar)

                    Else
                        Dim loopcounter = 0
                        While loopcounter < textdata.Count
                            textdata(loopcounter) = textdata(loopcounter).Substring(numoftruncatedchar)
                            loopcounter += 1
                        End While
                    End If

                ElseIf truncate_position = line_configuration.add_or_truncate_position._end Then
                    If promptbeforetruncating Then

                        Dim message As String = "Are you sure you want to discard the last " + numoftruncatedchar.ToString + " letters "
                        Dim restorevalue2 As Boolean = databeinginternallymanipulated
                        databeinginternallymanipulated = False 'prevent tripping watchdog timmer

                        Dim result = MsgBox(message, MsgBoxStyle.YesNo)
                        databeinginternallymanipulated = restorevalue2
                        If result = Windows.Forms.DialogResult.No Then
                            currentlychanginglinelength = False
                            Return False
                        End If

                    End If

                    If workineasypan Then
                        Txt_keyword.Text = Txt_keyword.Text.Substring(0, value) ' - 2)

                    Else
                        Dim loopcounter = 0
                        While loopcounter < textdata.Count
                            'padright was added because some older files have lines with shorter length
                            'that generate exceptions when truncating


                            Dim step1 As String = textdata(loopcounter)
                            Dim step2 As String = textdata(loopcounter).padright(value)
                            Dim step3 As String = textdata(loopcounter).padright(value).Substring(0, value)
                            textdata(loopcounter) = textdata(loopcounter).padright(value).Substring(0, value)
                            loopcounter += 1
                        End While
                    End If

                End If



            End If
            settings(settingsindex.linelength) = value
        End If









        If tabworkingin Is Tab_Easy Then


            Txt_keyword.Text += " " 'the textchange event will pad the correct number of trailing spaces
            'trailing space padding must be done after setting linelength and before calling process_data_change 


            easytab_process_data_change()
        End If

        Txt_demo_oneline.Width = 13 + 7 * (settings(settingsindex.linelength) - 1)
        'Txt_keyword.MaxLength = linelength - 2
        Txt_keyword.Width = 16 + 10 * (settings(settingsindex.linelength) - 1)

        TB0.Width = 13 + 7 * (settings(settingsindex.linelength) - 1)
        TB1.Width = 13 + 7 * (settings(settingsindex.linelength) - 1)
        TB2.Width = 13 + 7 * (settings(settingsindex.linelength) - 1)
        TB3.Width = 13 + 7 * (settings(settingsindex.linelength) - 1)
        TB4.Width = 13 + 7 * (settings(settingsindex.linelength) - 1)
        TB5.Width = 13 + 7 * (settings(settingsindex.linelength) - 1)
        TB6.Width = 13 + 7 * (settings(settingsindex.linelength) - 1)
        TB7.Width = 13 + 7 * (settings(settingsindex.linelength) - 1)
        TB8.Width = 13 + 7 * (settings(settingsindex.linelength) - 1)
        TB9.Width = 13 + 7 * (settings(settingsindex.linelength) - 1)

        Txt_demoline0.Width = 13 + 8 * (settings(settingsindex.linelength) - 1)
        Txt_demoline1.Width = 13 + 8 * (settings(settingsindex.linelength) - 1)
        Txt_demoline2.Width = 13 + 8 * (settings(settingsindex.linelength) - 1)
        Txt_demoline3.Width = 13 + 8 * (settings(settingsindex.linelength) - 1)
        Txt_demoline4.Width = 13 + 8 * (settings(settingsindex.linelength) - 1)
        Txt_demoline5.Width = 13 + 8 * (settings(settingsindex.linelength) - 1)
        Txt_demoline6.Width = 13 + 8 * (settings(settingsindex.linelength) - 1)
        Txt_demoline7.Width = 13 + 8 * (settings(settingsindex.linelength) - 1)
        Txt_demoline8.Width = 13 + 8 * (settings(settingsindex.linelength) - 1)
        Txt_demoline9.Width = 13 + 8 * (settings(settingsindex.linelength) - 1)

        NUD_cardcount_easytab.Value = value
        NUD_lines_cardcount.Value = value
        NUD_combo_cardcount.Value = value
        NUD_cardcount_freestyletab.Value = value

        'Num_linelength value change event will call this function recursively
        'this is ok because the call will be setting line length to its (now) current value
        'which will do nothing

        set_cardCount(value)
        refresh_testscreen() 'lines tab
        refresh_freestyle_text() 'freestyle tab

        Lbl_MyKeyword.Text = "" ' "Key Word(s)  " & (value - 2) & "   Letters"
        currentlychanginglinelength = False
        Return True

    End Function



    Private Sub Num_linelength_ValueChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles NUD_lines_cardcount.ValueChanged, NUD_combo_cardcount.ValueChanged, NUD_cardcount_freestyletab.ValueChanged, NUD_cardcount_easytab.ValueChanged
        'this functions handles the value change event for the controll on all 3 tabs


        Static recursive = False
        Static oldvalue = 4


        If sender.Value < 4 Then
            recursive = True
            sender.Value = oldvalue
            recursive = False
            Return
        End If













        If Not recursive Then


            Dim testarr As ArrayList = textdata



            If Not formloaded Then

                recursive = True
                NUD_combo_cardcount.Value = sender.value
                NUD_cardcount_easytab.Value = sender.value
                NUD_lines_cardcount.Value = sender.value
                NUD_cardcount_freestyletab.Value = sender.value
            End If

            recursive = True

            If databeinginternallymanipulated Then


                'the note below was made before the flag fileopening was combined with another flag

                'there was a subtle bug that occurs when this value of this numberbox is changed in the middle of opening 
                'a file.
                'occurs when truncating characters from files that are too long
                'because the wrong keyword is in the text box, all the lines are changed. 

                oldvalue = sender.value
                recursive = False
                Return
            End If

            If currentlychanginglinelength Then

                recursive = False
                Return
            End If




            databeinginternallymanipulated = True

            recursive = True



            If formloaded Then

                If Me.currenttrickcodingversion = TRICKCODINGVERSION_COMBOKEYWORDS_PRE_20110310 Then
                    'Dim longestkeyword As Integer = TBkw00.Text.Trim.Length
                    Dim countoftruncatedkeywords As Integer = 0

                    If TBkw00.Text.Trim.Length > sender.value Then

                        countoftruncatedkeywords += 1
                    End If

                    If TBkw01.Text.Trim.Length > sender.value Then

                        countoftruncatedkeywords += 1
                    End If

                    If TBkw02.Text.Trim.Length > sender.value Then

                        countoftruncatedkeywords += 1
                    End If
                    If TBkw03.Text.Trim.Length > sender.value Then

                        countoftruncatedkeywords += 1
                    End If
                    If TBkw04.Text.Trim.Length > sender.value Then

                        countoftruncatedkeywords += 1
                    End If
                    If TBkw05.Text.Trim.Length > sender.value Then

                        countoftruncatedkeywords += 1
                    End If
                    If TBkw06.Text.Trim.Length > sender.value Then

                        countoftruncatedkeywords += 1
                    End If
                    If TBkw07.Text.Trim.Length > sender.value Then

                        countoftruncatedkeywords += 1
                    End If
                    If TBkw08.Text.Trim.Length > sender.value Then

                        countoftruncatedkeywords += 1
                    End If
                    If TBkw09.Text.Trim.Length > sender.value Then

                        countoftruncatedkeywords += 1
                    End If



                    If countoftruncatedkeywords > 0 Then

                        Dim controlls_array As ArrayList = New ArrayList
                        controlls_array = New ArrayList

                        controlls_array.Add(New ArrayList)
                        controlls_array.Add(New ArrayList)
                        controlls_array.Add(New ArrayList)


                        controlls_array(mymsg.parameterArrayIndex.ControllType).add("button")
                        controlls_array(mymsg.parameterArrayIndex.ControllValue).add("Continue")
                        controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("Continue")


                        controlls_array(mymsg.parameterArrayIndex.ControllType).add("label5")
                        controlls_array(mymsg.parameterArrayIndex.ControllValue).add("")
                        controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("")


                        controlls_array(mymsg.parameterArrayIndex.ControllType).add("button")
                        controlls_array(mymsg.parameterArrayIndex.ControllValue).add("Cancel")
                        controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("Cancel")

                        Dim message As String = "If you proceed with changing to " & sender.value.ToString & " cards" & Constants.vbCrLf
                        message &= countoftruncatedkeywords & " keywords will loose letters"




                        Dim selection_array As ArrayList = mymsg.showform(message, controlls_array)
                        Dim pressed_button As String = selection_array(mymsg.returnArrayIndex.button)(mymsg.returnArraySecondDimention.identifyer)

                        If pressed_button.ToLower = "cancel" Then

                            NUD_combo_cardcount.Value = oldvalue
                            NUD_cardcount_easytab.Value = oldvalue
                            NUD_lines_cardcount.Value = oldvalue
                            NUD_cardcount_freestyletab.Value = oldvalue

                            databeinginternallymanipulated = False
                            recursive = False
                            Return

                        ElseIf pressed_button.ToLower = "continue" Then

                            'Txt_keyword.Text = Txt_keyword.Text.Trim 'remove spaces from beginning or word before truncating from end

                            TBkw00.Text = TBkw00.Text.TrimEnd
                            If TBkw00.Text.TrimEnd.Length > sender.value Then
                                TBkw00.Text = TBkw00.Text.TrimStart
                                If TBkw00.Text.TrimEnd.Length > sender.value Then
                                    TBkw00.Text = TBkw00.Text.Substring(0, sender.value)
                                End If
                            End If

                            TBkw01.Text = TBkw01.Text.TrimEnd
                            If TBkw01.Text.TrimEnd.Length > sender.value Then
                                TBkw01.Text = TBkw01.Text.TrimStart
                                If TBkw01.Text.TrimEnd.Length > sender.value Then
                                    TBkw01.Text = TBkw01.Text.Substring(0, sender.value)
                                End If
                            End If

                            TBkw02.Text = TBkw02.Text.TrimEnd
                            If TBkw02.Text.TrimEnd.Length > sender.value Then
                                TBkw02.Text = TBkw02.Text.TrimStart
                                If TBkw02.Text.TrimEnd.Length > sender.value Then
                                    TBkw02.Text = TBkw02.Text.Substring(0, sender.value)
                                End If
                            End If

                            TBkw03.Text = TBkw03.Text.TrimEnd
                            If TBkw03.Text.TrimEnd.Length > sender.value Then
                                TBkw03.Text = TBkw03.Text.TrimStart
                                If TBkw03.Text.TrimEnd.Length > sender.value Then
                                    TBkw03.Text = TBkw03.Text.Substring(0, sender.value)
                                End If
                            End If

                            TBkw04.Text = TBkw04.Text.TrimEnd
                            If TBkw04.Text.TrimEnd.Length > sender.value Then
                                TBkw04.Text = TBkw04.Text.TrimStart
                                If TBkw04.Text.TrimEnd.Length > sender.value Then
                                    TBkw04.Text = TBkw04.Text.Substring(0, sender.value)
                                End If
                            End If

                            TBkw05.Text = TBkw05.Text.TrimEnd
                            If TBkw05.Text.TrimEnd.Length > sender.value Then
                                TBkw05.Text = TBkw05.Text.TrimStart
                                If TBkw05.Text.TrimEnd.Length > sender.value Then
                                    TBkw05.Text = TBkw05.Text.Substring(0, sender.value)
                                End If
                            End If

                            TBkw06.Text = TBkw06.Text.TrimEnd
                            If TBkw06.Text.TrimEnd.Length > sender.value Then
                                TBkw06.Text = TBkw06.Text.TrimStart
                                If TBkw06.Text.TrimEnd.Length > sender.value Then
                                    TBkw06.Text = TBkw06.Text.Substring(0, sender.value)
                                End If
                            End If

                            TBkw07.Text = TBkw07.Text.TrimEnd
                            If TBkw07.Text.TrimEnd.Length > sender.value Then
                                TBkw07.Text = TBkw07.Text.TrimStart
                                If TBkw07.Text.TrimEnd.Length > sender.value Then
                                    TBkw07.Text = TBkw07.Text.Substring(0, sender.value)
                                End If
                            End If

                            TBkw08.Text = TBkw08.Text.TrimEnd
                            If TBkw08.Text.TrimEnd.Length > sender.value Then
                                TBkw08.Text = TBkw08.Text.TrimStart
                                If TBkw08.Text.TrimEnd.Length > sender.value Then
                                    TBkw08.Text = TBkw08.Text.Substring(0, sender.value)
                                End If
                            End If

                            TBkw09.Text = TBkw09.Text.TrimEnd
                            If TBkw09.Text.TrimEnd.Length > sender.value Then
                                TBkw09.Text = TBkw09.Text.TrimStart
                                If TBkw09.Text.TrimEnd.Length > sender.value Then
                                    TBkw09.Text = TBkw09.Text.Substring(0, sender.value)
                                End If
                            End If

                            'Me.set_linelenth(sender.value, line_configuration.add_or_truncate_position._end, False, False)
                            'bypass the normal set linelight function
                            Me.linelength = sender.value
                            combotab_refreshlinedata()
                            Me.combotab_generatelines()

                            NUD_combo_cardcount.Value = sender.value
                            NUD_cardcount_easytab.Value = sender.value
                            NUD_lines_cardcount.Value = sender.value
                            NUD_cardcount_freestyletab.Value = oldvalue

                            databeinginternallymanipulated = False
                            recursive = False

                            oldvalue = sender.value
                            Return

                        End If

                    Else
                        'the change will not result is keywords being truncated
                        'Me.linelength = sender.value
                        Me.set_linelenth(sender.value, line_configuration.add_or_truncate_position._end, False, False)

                        combotab_refreshlinedata()
                        Me.combotab_generatelines()

                        NUD_combo_cardcount.Value = sender.value
                        NUD_cardcount_easytab.Value = sender.value
                        NUD_lines_cardcount.Value = sender.value
                        NUD_cardcount_freestyletab.Value = sender.value
                        databeinginternallymanipulated = False
                        recursive = False
                        oldvalue = sender.value
                        Return



                    End If


                ElseIf Me.possible_to_view_file_in_easytab Then 'Me.TabControl1.SelectedTab Is Me.Tab_easy Then
                    refresh_easy_tab()
                    If Txt_keyword.Text.Trim.Length > sender.value Then
                        '''''''
                        Dim controlls_array As ArrayList = New ArrayList
                        controlls_array = New ArrayList

                        controlls_array.Add(New ArrayList)
                        controlls_array.Add(New ArrayList)
                        controlls_array.Add(New ArrayList)


                        controlls_array(mymsg.parameterArrayIndex.ControllType).add("button")
                        controlls_array(mymsg.parameterArrayIndex.ControllValue).add("Continue")
                        controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("Continue")


                        controlls_array(mymsg.parameterArrayIndex.ControllType).add("label5")
                        controlls_array(mymsg.parameterArrayIndex.ControllValue).add("")
                        controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("")


                        controlls_array(mymsg.parameterArrayIndex.ControllType).add("button")
                        controlls_array(mymsg.parameterArrayIndex.ControllValue).add("Cancel")
                        controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("Cancel")

                        Dim message As String = "If you proceed with changing to " & sender.value.ToString & "cards" & Constants.vbCrLf
                        message &= "your keyword will be truncated to " & Txt_keyword.Text.Trim.Substring(0, sender.value)




                        Dim selection_array As ArrayList = mymsg.showform(message, controlls_array)
                        Dim pressed_button As String = selection_array(mymsg.returnArrayIndex.button)(mymsg.returnArraySecondDimention.identifyer)

                        If pressed_button.ToLower = "cancel" Then

                            NUD_combo_cardcount.Value = oldvalue
                            NUD_cardcount_easytab.Value = oldvalue
                            NUD_lines_cardcount.Value = oldvalue
                            NUD_cardcount_freestyletab.Value = oldvalue

                            databeinginternallymanipulated = False
                            recursive = False
                            Return

                        ElseIf pressed_button.ToLower = "continue" Then

                            Txt_keyword.Text = Txt_keyword.Text.Trim 'remove spaces from beginning or word before truncating from end

                            Me.set_linelenth(sender.value, line_configuration.add_or_truncate_position._end, True, False)
                            databeinginternallymanipulated = False
                            recursive = False

                            oldvalue = sender.value
                            Return

                        End If

                        '''''''

                    Else

                        Txt_keyword.Text = Txt_keyword.Text.Trim 'remove spaces from beginning of word before truncating from end
                        Me.set_linelenth(sender.value, line_configuration.add_or_truncate_position._end, True, False)
                        NUD_combo_cardcount.Value = sender.value
                        NUD_cardcount_easytab.Value = sender.value
                        NUD_lines_cardcount.Value = sender.value
                        NUD_cardcount_freestyletab.Value = sender.value

                        databeinginternallymanipulated = False
                        recursive = False
                        oldvalue = sender.value
                        Return

                    End If
                Else

                    'in lines tab with a file that can not be viewed in anyother tab
                    Dim countoftruncatedlines As Integer = 0
                    Dim loopcounter As Integer = 0

                    While loopcounter < textdata.Count

                        If textdata(loopcounter).trim.length > sender.value Then

                            countoftruncatedlines += 1
                        End If

                        loopcounter += 1
                    End While


                    If countoftruncatedlines > 0 Then

                        Dim controlls_array As ArrayList = New ArrayList
                        controlls_array = New ArrayList

                        controlls_array.Add(New ArrayList)
                        controlls_array.Add(New ArrayList)
                        controlls_array.Add(New ArrayList)


                        controlls_array(mymsg.parameterArrayIndex.ControllType).add("button")
                        controlls_array(mymsg.parameterArrayIndex.ControllValue).add("Continue")
                        controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("Continue")


                        controlls_array(mymsg.parameterArrayIndex.ControllType).add("label5")
                        controlls_array(mymsg.parameterArrayIndex.ControllValue).add("")
                        controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("")


                        controlls_array(mymsg.parameterArrayIndex.ControllType).add("button")
                        controlls_array(mymsg.parameterArrayIndex.ControllValue).add("Cancel")
                        controlls_array(mymsg.parameterArrayIndex.ControllIdentifier).add("Cancel")

                        Dim message As String = "If you proceed with changing to " & sender.value.ToString & " cards" & Constants.vbCrLf
                        message &= countoftruncatedlines & " Lines will loose letters"




                        Dim selection_array As ArrayList = mymsg.showform(message, controlls_array)
                        Dim pressed_button As String = selection_array(mymsg.returnArrayIndex.button)(mymsg.returnArraySecondDimention.identifyer)

                        If pressed_button.ToLower = "cancel" Then

                            NUD_combo_cardcount.Value = oldvalue
                            NUD_cardcount_easytab.Value = oldvalue
                            NUD_lines_cardcount.Value = oldvalue
                            NUD_cardcount_freestyletab.Value = oldvalue

                            databeinginternallymanipulated = False
                            recursive = False
                            Return

                        ElseIf pressed_button.ToLower = "continue" Then
                            loopcounter = 0
                            While loopcounter < textdata.Count

                                If textdata(loopcounter).length > sender.value Then
                                    'trim space from end
                                    textdata(loopcounter) = textdata(loopcounter).trimend

                                    While textdata(loopcounter).length > sender.value And textdata(loopcounter).startswith(" ")
                                        'trim one space at time from beginning

                                        textdata(loopcounter) = textdata(loopcounter).substring(1)


                                    End While
                                    If textdata(loopcounter).length > sender.value Then
                                        'still too long? truncate letters from end
                                        textdata(loopcounter) = textdata(loopcounter).substring(0, sender.value)
                                    End If
                                End If
                                loopcounter += 1
                            End While
                            set_linelenth(sender.value, line_configuration.add_or_truncate_position._end, False, False)
                            NUD_combo_cardcount.Value = sender.value
                            NUD_cardcount_easytab.Value = sender.value
                            NUD_lines_cardcount.Value = sender.value
                            NUD_cardcount_freestyletab.Value = sender.value

                            databeinginternallymanipulated = False
                            recursive = False
                            oldvalue = sender.value
                            Return


                        Else
                            MsgBox("BUG! invalid data about which button was pressed")
                            databeinginternallymanipulated = False
                            recursive = False
                            Return

                        End If

                    Else

                        'the change will not truncate lines
                        'note in some cases leading space may need to be trimed

                        loopcounter = 0
                        While loopcounter < textdata.Count

                            If textdata(loopcounter).length > sender.value Then
                                'trim space from end
                                textdata(loopcounter) = textdata(loopcounter).trimend

                                While textdata(loopcounter).length > sender.value And textdata(loopcounter).startswith(" ")
                                    'trim one space at time from beginning

                                    textdata(loopcounter) = textdata(loopcounter).substring(1)


                                End While
                                If textdata(loopcounter).length > sender.value Then
                                    MsgBox("bug line " & loopcounter & "appears to need truncating in non-trucating portion of code")
                                End If
                            End If
                            loopcounter += 1
                        End While
                        set_linelenth(sender.value, line_configuration.add_or_truncate_position._end, False, False)
                        NUD_combo_cardcount.Value = sender.value
                        NUD_cardcount_easytab.Value = sender.value
                        NUD_lines_cardcount.Value = sender.value
                        NUD_cardcount_freestyletab.Value = sender.value

                        databeinginternallymanipulated = False
                        recursive = False
                        oldvalue = sender.value
                        Return

                    End If


                End If

                If nonemptylinecount() <> 0 Then


                    Dim msg As String = "warning" & Constants.vbCrLf
                    msg &= "you are creating a new file with " & sender.value & " cards"
                    'Dim restorevalue = databeinginternallymanipulated 'prevent tripping watchdogtimer
                    databeinginternallymanipulated = False
                    Dim result As MsgBoxResult = MsgBox(msg, MsgBoxStyle.OkCancel)
                    databeinginternallymanipulated = True
                    If result <> MsgBoxResult.Ok Then
                        recursive = False

                        NUD_cardcount_easytab.Value = oldvalue
                        NUD_combo_cardcount.Value = oldvalue
                        NUD_lines_cardcount.Value = oldvalue
                        NUD_cardcount_freestyletab.Value = oldvalue

                        databeinginternallymanipulated = False

                        Return
                    End If
                    databeinginternallymanipulated = False
                    newfile()
                    databeinginternallymanipulated = True
                End If



                If Not set_linelenth(sender.Value, line_configuration.add_or_truncate_position._end, , False) Then
                    MsgBox("bug")
                End If



                If False Then
                    'old code from when we truncated letters instead of creating new file

                    ''Dim workingineasytab As Boolean

                    'If sender Is NUD_cardcount_easytab Then

                    '    txtbox_aligntext(Txt_keyword, txtbox_alignment_type._left, settings(settingsindex.linelength) - 2, True)
                    '    'workingineasytab = True 'passed to set_linelength. if true the keyword on the easy tab is truncated and all new lines are generated
                    'Else
                    '    'workingineasytab = False
                    'End If




                    'testarr = textdata


                    'If set_linelenth(sender.Value, line_configuration.add_or_truncate_position._end) Then

                    '    'easytab_process_data_change()
                    'Else



                    '    NUD_cardcount_easytab.Value = oldvalue
                    '    NUD_cardcount_combotab.Value = oldvalue
                    '    NUD_cardcount_linestab.Value = oldvalue
                    '    If sender Is NUD_cardcount_combotab Then
                    '        Dim message As String = "sorry, before you can increase the sign length, you must reduce the number of lines" + Constants.vbCrLf


                    '        databeinginternallymanipulated = False 'prevent tripping watchdog timer

                    '        MsgBox(message)


                    '        databeinginternallymanipulated = False
                    '        recursive = False
                    '        Return


                    '    End If


                    '    combotab_refreshlinedata()

                    'End If

                End If

            End If 'formloaded


            NUD_combo_cardcount.Value = sender.value
            NUD_cardcount_easytab.Value = sender.value
            NUD_lines_cardcount.Value = sender.value
            NUD_cardcount_freestyletab.Value = sender.value


            'If Num_linelength.Value = 10 Then
            '    'smaller(fontsize)
            '    font_functions.changesize(Num_linelength, Num_linelength.Font.Size * 4 / 5)

            'ElseIf oldvalue = 10 Then
            '    font_functions.changesize(Num_linelength, Num_linelength.Font.Size * 5 / 4)
            'End If

            oldvalue = sender.Value

            If sender Is NUD_cardcount_easytab And formloaded Then
                'the fomloaded flag test was added 1/05/10 to solve an inner exception during form load
                txtbox_aligntext(Txt_keyword, txtbox_alignment_type._center, settings(settingsindex.linelength) - 2, True)
            End If



            'simulator_form.Pan_cardbackground.Invalidate()

            'Timer_delayed_invalidate.Start()

            databeinginternallymanipulated = False
            'change = True 'removed when this was modified to create new file
            recursive = False
        End If

    End Sub


    Private Sub Timer_formloaded_Tick(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Timer_formloaded.Tick
        'this function runs once immediatly after form is loaded
        'it is needed because there are somethings that do not work correctly
        'when done in formload function

        'If Not formloaded Then
        '    MsgBox("not")
        'End If



        'position_cards_horLine()

        Timer_formloaded.Stop()

    End Sub


    Private Sub speed_common_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Dim change = Convert.ToInt16(sender.tag)
        If HSB_speed_easytab.Value + change > HSB_speed_easytab.Maximum Then
            HSB_speed_easytab.Value = HSB_speed_easytab.Maximum
        ElseIf HSB_speed_easytab.Value + change < HSB_speed_easytab.Minimum Then
            HSB_speed_easytab.Value = HSB_speed_easytab.Minimum
        Else
            HSB_speed_easytab.Value += change

        End If



    End Sub

    Private Sub HSB_speed_ValueChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles HSB_speed_linestab.ValueChanged, HSB_speed_freestyletab.ValueChanged, HSB_speed_easytab.ValueChanged, HSB_speed_combotab.ValueChanged

        Static recursive As Boolean = False




        TXTdebug.Text = HSB_speed_easytab.Value
        If formloaded And Not recursive Then
            recursive = True

            HSB_speed_easytab.Value = sender.value
            HSB_speed_combotab.Value = sender.value
            HSB_speed_linestab.Value = sender.value

            HSB_speed_freestyletab.Value = sender.value
            Dim invertedvalue = 255 - HSB_speed_easytab.Value + 1

            'Dim decimalvalue = invertedvalue / 100

            tricks_set_parameter(1, 2, invertedvalue)
            'tricks_set_parameter(1, 2, Num_speed.Value)
            refresh_demo()
            recursive = False
            change = True
        End If

    End Sub


    Private Sub Txt_keyword_Enter(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Txt_keyword.Enter

        'has to be done this way because the cursor position is reset by system after enter event
        Timer_setkeyword_cursor.Start()

    End Sub


    Private Sub Timer_setkeyword_cursor_Tick(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Timer_setkeyword_cursor.Tick

        'has to be done this way because the cursor position is reset by system after enter event
        Timer_setkeyword_cursor.Stop()

        If Txt_keyword.Text.Trim = "" Then

            txtbox_positioncurser(Txt_keyword, txtbox_cursor_position._begin_absolute)
            Txt_keyword.SelectionLength = 0

        End If

    End Sub

    Private Sub Txt_keyword_Leave(ByVal sender As System.Object, ByVal e As System.EventArgs)
        txtbox_aligntext(Txt_keyword, txtbox_alignment_type._center, settings(settingsindex.linelength) - 2, True)
    End Sub

    Private Sub Txt_keyword_KeyPress(ByVal sender As System.Object, ByVal e As System.Windows.Forms.KeyPressEventArgs)
        If e.KeyChar = Constants.vbCr Or e.KeyChar = Constants.vbLf Then
            txtbox_aligntext(Txt_keyword, txtbox_alignment_type._center, settings(settingsindex.linelength) - 2, True)
            e.Handled = True

        End If
    End Sub

    Private Sub Panel32_Paint(ByVal sender As System.Object, ByVal e As System.Windows.Forms.PaintEventArgs)

    End Sub

    Private Sub Txt_keyword_SizeChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Txt_keyword.SizeChanged

        'Pan_keyword_background.Width = 24 + Txt_keyword.Width

    End Sub

    Private Sub PB_snail_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles PB_snail_easytab.Click, PictureBox4.Click, PictureBox5.Click, PB_snail_freestyletab.Click
        HSB_speed_easytab.Value = HSB_speed_easytab.Minimum
    End Sub

    Private Sub PB_horse_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles PB_horse_easytab.Click, PictureBox3.Click, PictureBox2.Click, PB_horse_freestyletab.Click
        HSB_speed_easytab.Value = 255
    End Sub

    Private Sub TabPage2_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)

    End Sub




    Private Sub Txt_demo_oneline_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Txt_demo_oneline.TextChanged
        Dim loopcounter As Int16 = 0
        While loopcounter < settings(settingsindex.linelength) 'Txt_demo_oneline.Text.Length

            If loopcounter >= Txt_demo_oneline.Text.Length Then
                'append spaces as needed so that lite cards are turned off
                Txt_demo_oneline.Text += " "
            End If

            If loopcounter = 0 Then
                LiteCard0.character = Txt_demo_oneline.Text(loopcounter)
                'simulator_form.LiteCard0.character = Txt_demo_oneline.Text(loopcounter)
            ElseIf loopcounter = 1 Then
                LiteCard1.character = Txt_demo_oneline.Text(loopcounter)
            ElseIf loopcounter = 2 Then
                LiteCard2.character = Txt_demo_oneline.Text(loopcounter)
            ElseIf loopcounter = 3 Then
                LiteCard3.character = Txt_demo_oneline.Text(loopcounter)
            ElseIf loopcounter = 4 Then
                LiteCard4.character = Txt_demo_oneline.Text(loopcounter)
            ElseIf loopcounter = 5 Then
                LiteCard5.character = Txt_demo_oneline.Text(loopcounter)

            ElseIf loopcounter = 6 Then
                LiteCard6.character = Txt_demo_oneline.Text(loopcounter)

            ElseIf loopcounter = 7 Then
                LiteCard7.character = Txt_demo_oneline.Text(loopcounter)

            ElseIf loopcounter = 8 Then
                LiteCard8.character = Txt_demo_oneline.Text(loopcounter)

            ElseIf loopcounter = 9 Then
                LiteCard9.character = Txt_demo_oneline.Text(loopcounter)
            ElseIf loopcounter = 10 Then
                LiteCard10.character = Txt_demo_oneline.Text(loopcounter)
            ElseIf loopcounter = 11 Then
                LiteCard11.character = Txt_demo_oneline.Text(loopcounter)
            ElseIf loopcounter = 12 Then
                LiteCard12.character = Txt_demo_oneline.Text(loopcounter)
            ElseIf loopcounter = 13 Then
                LiteCard13.character = Txt_demo_oneline.Text(loopcounter)
            ElseIf loopcounter = 14 Then
                LiteCard14.character = Txt_demo_oneline.Text(loopcounter)
            ElseIf loopcounter = 15 Then
                LiteCard15.character = Txt_demo_oneline.Text(loopcounter)
            ElseIf loopcounter = 16 Then
                LiteCard16.character = Txt_demo_oneline.Text(loopcounter)


            ElseIf loopcounter = 17 Then
                LiteCard17.character = Txt_demo_oneline.Text(loopcounter)
            ElseIf loopcounter = 18 Then
                LiteCard18.character = Txt_demo_oneline.Text(loopcounter)
            ElseIf loopcounter = 19 Then
                LiteCard19.character = Txt_demo_oneline.Text(loopcounter)

                'CMF-


            End If



            loopcounter += 1
        End While
    End Sub


   
    Private Sub Timer_delayed_finish_pattern_line_Tick(ByVal sender As System.Object, ByVal e As System.EventArgs)

        Timer_delayed_finish_pattern_line.Stop()
        Dim x As Int16 = 2
        Dim y As Int16 = 7


        LiteCard0.location = New Drawing.Point(x, y)




        x += 1.1 * LiteCard0.Width
        LiteCard1.location = New Drawing.Point(x, y)




        x += 1.1 * LiteCard1.Width
        LiteCard2.location = New Drawing.Point(x, y)



        x += 1.1 * LiteCard2.Width
        LiteCard3.location = New Drawing.Point(x, y)


        x += 1.1 * LiteCard3.Width
        LiteCard4.location = New Drawing.Point(x, y)


        x += 1.1 * LiteCard4.Width
        LiteCard5.location = New Drawing.Point(x, y)



        x += 1.1 * LiteCard5.Width
        LiteCard6.location = New Drawing.Point(x, y)


        x += 1.1 * LiteCard6.Width
        LiteCard7.location = New Drawing.Point(x, y)

        x += 1.1 * LiteCard7.Width
        LiteCard8.location = New Drawing.Point(x, y)

        x += 1.1 * LiteCard8.Width
        LiteCard9.location = New Drawing.Point(x, y)

        x += 1.1 * LiteCard9.Width

        LiteCard10.location = New Drawing.Point(x, y)




        x += 1.1 * LiteCard10.Width
        LiteCard11.location = New Drawing.Point(x, y)




        x += 1.1 * LiteCard11.Width
        LiteCard12.location = New Drawing.Point(x, y)



        x += 1.1 * LiteCard12.Width
        LiteCard13.location = New Drawing.Point(x, y)


        x += 1.1 * LiteCard13.Width
        LiteCard14.location = New Drawing.Point(x, y)


        x += 1.1 * LiteCard14.Width
        LiteCard15.location = New Drawing.Point(x, y)


        x += 1.1 * LiteCard15.Width
        LiteCard16.location = New Drawing.Point(x, y)

        '--
        x += 1.1 * LiteCard16.Width
        LiteCard17.location = New Drawing.Point(x, y)


        x += 1.1 * LiteCard17.Width
        LiteCard18.location = New Drawing.Point(x, y)


        x += 1.1 * LiteCard18.Width
        LiteCard19.location = New Drawing.Point(x, y)

        '--

        Timer_delayed_invalidate.Start()
        simulator_form.positionandsizecards()


    End Sub
   
    Dim cardclicked As Int16 = -1

    Dim cardrightclicked As Int16 = -1

    Dim startmouselocation As Point

    Private Sub LiteCard_common_MouseDown(ByVal sender As System.Object, ByVal e As System.Windows.Forms.MouseEventArgs) _
        Handles _
 _
 _
 _
        LiteCard17.MouseDown, LiteCard18.MouseDown, LiteCard19.MouseDown

        'CMF-

        If simulator_form.cards_locked Then
            Return
        End If
        If e.Button = Windows.Forms.MouseButtons.Left Then
            cardclicked = Convert.ToInt16(sender.tag)

            'jp jan/1/2011 found this line in a search appear to be an old debugging line
            Lbl_easy_linetime.Text = cardclicked.ToString

            startmouselocation = Control.MousePosition
        ElseIf e.Button = Windows.Forms.MouseButtons.Right Then

            cardrightclicked = Convert.ToInt16(sender.tag)
            LiteCard0.ContextMenuStrip.Show()
            'ContextMen_litecards.Show()

        End If
        'MsgBox()
    End Sub

    Private Sub LiteCard_common_MouseUp(ByVal sender As System.Object, ByVal e As System.Windows.Forms.MouseEventArgs) _
        Handles LiteCard0.MouseUp, LiteCard9.MouseUp, LiteCard8.MouseUp, LiteCard7.MouseUp, _
        LiteCard6.MouseUp, LiteCard5.MouseUp, LiteCard4.MouseUp, LiteCard3.MouseUp, _
        LiteCard2.MouseUp, LiteCard1.MouseUp, LiteCard10.MouseUp, LiteCard11.MouseUp, _
        LiteCard12.MouseUp, LiteCard13.MouseUp, LiteCard14.MouseUp, LiteCard15.MouseUp, LiteCard16.MouseUp, _
        LiteCard17.MouseUp, LiteCard18.MouseUp, LiteCard19.MouseUp
        'CMF-

        If simulator_form.cards_locked Then
            Return
        End If

        If e.Button = Windows.Forms.MouseButtons.Left Then

            cardclicked = -1
            Lbl_easy_linetime.Text = cardclicked.ToString

            simulator_form.positionandsizecards()

            Pan_cardbackground.Invalidate(True)
        ElseIf e.Button = Windows.Forms.MouseButtons.Right Then



        End If

    End Sub

    Private Sub LiteCard_common_MouseMove(ByVal sender As System.Object, ByVal e As System.Windows.Forms.MouseEventArgs) _
        Handles LiteCard0.MouseMove, LiteCard6.MouseMove, LiteCard4.MouseMove, LiteCard1.MouseMove, _
        LiteCard9.MouseMove, LiteCard8.MouseMove, LiteCard7.MouseMove, LiteCard5.MouseMove, _
        LiteCard3.MouseMove, LiteCard2.MouseMove, LiteCard0.MouseMove, LiteCard10.MouseMove, _
        LiteCard11.MouseMove, LiteCard12.MouseMove, LiteCard13.MouseMove, _
        LiteCard14.MouseMove, LiteCard15.MouseMove, LiteCard16.MouseMove, _
        LiteCard17.MouseMove, LiteCard18.MouseMove, LiteCard19.MouseMove
        'CMF-

        If simulator_form.cards_locked Then
            Return
        End If
        Static counter As Integer = 0

        If e.Button = Windows.Forms.MouseButtons.Left Then





            If cardclicked = Convert.ToInt16(sender.tag) Then
                Lbl_easy_linetime.Text = "move"
                '= sender.location

                Dim currentmouselocation As Point = Control.MousePosition
                Dim currentlocation As Point = sender.location


                'If startmouselocation <> currentlocation Then

                '
                Dim newlocation As Point = New Point(currentlocation.X + currentmouselocation.X - startmouselocation.X, currentlocation.Y + currentmouselocation.Y - startmouselocation.Y)

                sender.location = newlocation
                startmouselocation = currentmouselocation

                'Timer_delayed_invalidate.START
                If counter > 30 Then

                    Timer_delayed_invalidate.Start()
                    counter = 0
                Else
                    counter += 1
                End If
                'End If
                '
            End If



        ElseIf e.Button = Windows.Forms.MouseButtons.Right Then
            'menue such as rotate etc




        End If


    End Sub


    Private Sub enlargecard(ByVal cardnum As Int16, ByVal amount As Int16)
        If cardnum = 0 Then

            LiteCard0.FontSize += amount


        ElseIf cardnum = 1 Then

            LiteCard1.FontSize += amount
        ElseIf cardnum = 2 Then

            LiteCard2.FontSize += amount

        ElseIf cardnum = 3 Then

            LiteCard3.FontSize += amount

        ElseIf cardnum = 4 Then

            LiteCard4.FontSize += amount

        ElseIf cardnum = 5 Then

            LiteCard5.FontSize += amount

        ElseIf cardnum = 6 Then

            LiteCard6.FontSize += amount

        ElseIf cardnum = 7 Then

            LiteCard7.FontSize += amount

        ElseIf cardnum = 8 Then

            LiteCard8.FontSize += amount

        ElseIf cardnum = 9 Then

            LiteCard9.FontSize += amount
        ElseIf cardnum = 10 Then

            LiteCard10.FontSize += amount


        ElseIf cardnum = 11 Then

            LiteCard11.FontSize += amount
        ElseIf cardnum = 12 Then

            LiteCard12.FontSize += amount

        ElseIf cardnum = 13 Then

            LiteCard13.FontSize += amount

        ElseIf cardnum = 14 Then

            LiteCard14.FontSize += amount

        ElseIf cardnum = 15 Then

            LiteCard15.FontSize += amount


        ElseIf cardnum = 16 Then

            LiteCard16.FontSize += amount

            '--
        ElseIf cardnum = 17 Then

            LiteCard17.FontSize += amount

        ElseIf cardnum = 18 Then

            LiteCard18.FontSize += amount


        ElseIf cardnum = 19 Then

            LiteCard19.FontSize += amount
            'CMF-



        End If
        Timer_delayed_invalidate.Start()
        simulator_form.positionandsizecards()


    End Sub
    Private Sub rotatecard(ByVal cardnum As Int16, ByVal angle As Int16)


        If cardnum = 0 Then

            LiteCard0.Angle += angle

        ElseIf cardnum = 1 Then

            LiteCard1.Angle += angle
        ElseIf cardnum = 2 Then

            LiteCard2.Angle += angle

        ElseIf cardnum = 3 Then

            LiteCard3.Angle += angle

        ElseIf cardnum = 4 Then

            LiteCard4.Angle += angle

        ElseIf cardnum = 5 Then

            LiteCard5.Angle += angle

        ElseIf cardnum = 6 Then

            LiteCard6.Angle += angle

        ElseIf cardnum = 7 Then

            LiteCard7.Angle += angle

        ElseIf cardnum = 8 Then

            LiteCard8.Angle += angle

        ElseIf cardnum = 9 Then

            LiteCard9.Angle += angle
        ElseIf cardnum = 10 Then

            LiteCard10.Angle += angle

        ElseIf cardnum = 11 Then

            LiteCard11.Angle += angle
        ElseIf cardnum = 12 Then

            LiteCard12.Angle += angle

        ElseIf cardnum = 13 Then

            LiteCard13.Angle += angle

        ElseIf cardnum = 14 Then

            LiteCard14.Angle += angle

        ElseIf cardnum = 15 Then

            LiteCard15.Angle += angle


        ElseIf cardnum = 16 Then

            LiteCard16.Angle += angle

        ElseIf cardnum = 17 Then

            LiteCard17.Angle += angle

        ElseIf cardnum = 18 Then

            LiteCard18.Angle += angle


        ElseIf cardnum = 19 Then

            LiteCard19.Angle += angle


            'CMF-




        End If
        Timer_delayed_invalidate.Start()
        simulator_form.positionandsizecards()

    End Sub

    Private Sub cmi_bigclockwise_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmi_bigclockwise.Click

        rotatecard(cardrightclicked, 10)




    End Sub

    Private Sub cmi_smallclockwise_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmi_smallclockwise.Click
        rotatecard(cardrightclicked, 1)
    End Sub

    Private Sub cmi_bigcounterclockwise_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmi_bigcounterclockwise.Click
        rotatecard(cardrightclicked, -10)
    End Sub

    Private Sub cmi_smallcounterclockwise_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmi_smallcounterclockwise.Click
        rotatecard(cardrightclicked, -1)
    End Sub



    'enlarge

    Private Sub cmi_bigenlarge_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        enlargecard(cardrightclicked, 10)

    End Sub

    Private Sub cmi_smallenlarge_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        enlargecard(cardrightclicked, 1)
    End Sub

    Private Sub cmi_bigsmaller_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        enlargecard(cardrightclicked, -10)
    End Sub

    Private Sub cmi_smallsmaller_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        enlargecard(cardrightclicked, -1)
    End Sub

    'Dim pan_cardbackground_graphics As System.Drawing.Graphics

    Private Sub Pan_cardbackground_Paint(ByVal sender As System.Object, ByVal e As System.Windows.Forms.PaintEventArgs) Handles Pan_cardbackground.Paint

        Dim end1 As Point
        Dim end2 As Point

        end1 = LiteCard0.rightconection
        end2 = LiteCard1.leftconection


        Dim mypen As Pen = New Pen(Color.AliceBlue, LiteCard0.FontSize / 10)
        'mypen.Width = LiteCard0.FontSize / 10
        If LiteCard0.Visible And LiteCard1.Visible Then
            e.Graphics.DrawLine(mypen, end1, end2)

        End If

        'end1 = LiteCard0.rightconection
        'end2 = LiteCard1.leftconection
        'e.Graphics.DrawLine(mypen, end1, end2)

        If LiteCard1.Visible And LiteCard2.Visible Then
            end1 = LiteCard1.rightconection
            end2 = LiteCard2.leftconection
            e.Graphics.DrawLine(mypen, end1, end2)
        End If

        If LiteCard2.Visible And LiteCard3.Visible Then
            end1 = LiteCard2.rightconection
            end2 = LiteCard3.leftconection
            e.Graphics.DrawLine(mypen, end1, end2)
        End If
        If LiteCard3.Visible And LiteCard4.Visible Then
            end1 = LiteCard3.rightconection
            end2 = LiteCard4.leftconection
            e.Graphics.DrawLine(mypen, end1, end2)
        End If
        If LiteCard4.Visible And LiteCard5.Visible Then
            end1 = LiteCard4.rightconection
            end2 = LiteCard5.leftconection
            e.Graphics.DrawLine(mypen, end1, end2)
        End If

        If LiteCard5.Visible And LiteCard6.Visible Then
            end1 = LiteCard5.rightconection
            end2 = LiteCard6.leftconection
            e.Graphics.DrawLine(mypen, end1, end2)
        End If

        If LiteCard6.Visible And LiteCard7.Visible Then
            end1 = LiteCard6.rightconection
            end2 = LiteCard7.leftconection
            e.Graphics.DrawLine(mypen, end1, end2)
        End If
        If LiteCard7.Visible And LiteCard8.Visible Then
            end1 = LiteCard7.rightconection
            end2 = LiteCard8.leftconection
            e.Graphics.DrawLine(mypen, end1, end2)
        End If
        If LiteCard8.Visible And LiteCard9.Visible Then
            end1 = LiteCard8.rightconection
            end2 = LiteCard9.leftconection
            e.Graphics.DrawLine(mypen, end1, end2)
        End If

        If LiteCard10.Visible And LiteCard11.Visible Then
            e.Graphics.DrawLine(mypen, end1, end2)

        End If

        'end1 = LiteCard0.rightconection
        'end2 = LiteCard1.leftconection
        'e.Graphics.DrawLine(mypen, end1, end2)

        If LiteCard11.Visible And LiteCard12.Visible Then
            end1 = LiteCard11.rightconection
            end2 = LiteCard12.leftconection
            e.Graphics.DrawLine(mypen, end1, end2)
        End If

        If LiteCard12.Visible And LiteCard13.Visible Then
            end1 = LiteCard12.rightconection
            end2 = LiteCard13.leftconection
            e.Graphics.DrawLine(mypen, end1, end2)
        End If
        If LiteCard13.Visible And LiteCard14.Visible Then
            end1 = LiteCard13.rightconection
            end2 = LiteCard14.leftconection
            e.Graphics.DrawLine(mypen, end1, end2)
        End If

        If LiteCard14.Visible And LiteCard15.Visible Then
            end1 = LiteCard14.rightconection
            end2 = LiteCard15.leftconection
            e.Graphics.DrawLine(mypen, end1, end2)
        End If

        If LiteCard15.Visible And LiteCard16.Visible Then
            end1 = LiteCard15.rightconection
            end2 = LiteCard16.leftconection
            e.Graphics.DrawLine(mypen, end1, end2)
        End If

        '--

        If LiteCard16.Visible And LiteCard17.Visible Then
            end1 = LiteCard16.rightconection
            end2 = LiteCard17.leftconection
            e.Graphics.DrawLine(mypen, end1, end2)
        End If

        If LiteCard17.Visible And LiteCard18.Visible Then
            end1 = LiteCard17.rightconection
            end2 = LiteCard18.leftconection
            e.Graphics.DrawLine(mypen, end1, end2)
        End If

        If LiteCard18.Visible And LiteCard19.Visible Then
            end1 = LiteCard18.rightconection
            end2 = LiteCard19.leftconection
            e.Graphics.DrawLine(mypen, end1, end2)
        End If

        'CMF-



        Return

        'below is old code
















        ''      Static recursive As Boolean = False

        ''Dim lines As ArrayList = New ArrayList

        ''Dim ends As PointF()


        ''pan_cardbackground_graphics = e.Graphics
        ''        Timer_delayed_invalidate.Start()
        ''       Return

        ''    If Not recursive Then
        ''recursive = True

        ''LiteCard1.Invalidate()
        ''LiteCard0.Invalidate()
        ''LiteCard2.Invalidate()
        ''LiteCard3.Invalidate()
        '' LiteCard4.Invalidate()
        ''LiteCard5.Invalidate()
        ''LiteCard6.Invalidate()
        ''LiteCard7.Invalidate()
        ''LiteCard8.Invalidate()
        ''LiteCard9.Invalidate()
        ''pan_cardbackground_graphics
        'Dim end1 As Point
        'Dim end2 As Point

        'end1 = LiteCard0.rightconection
        'end2 = LiteCard1.leftconection
        'e.Graphics.DrawLine(Pens.AliceBlue, end1, end2)



        'end1 = LiteCard0.rightconection
        'end2 = LiteCard1.leftconection
        'e.Graphics.DrawLine(Pens.AliceBlue, end1, end2)

        'end1 = LiteCard1.rightconection
        'end2 = LiteCard2.leftconection
        'e.Graphics.DrawLine(Pens.AliceBlue, end1, end2)

        'end1 = LiteCard2.rightconection
        'end2 = LiteCard3.leftconection
        'e.Graphics.DrawLine(Pens.AliceBlue, end1, end2)

        'end1 = LiteCard3.rightconection
        'end2 = LiteCard4.leftconection
        'e.Graphics.DrawLine(Pens.AliceBlue, end1, end2)

        'end1 = LiteCard4.rightconection
        'end2 = LiteCard5.leftconection
        'e.Graphics.DrawLine(Pens.AliceBlue, end1, end2)

        'end1 = LiteCard5.rightconection
        'end2 = LiteCard6.leftconection
        'e.Graphics.DrawLine(Pens.AliceBlue, end1, end2)

        'end1 = LiteCard6.rightconection
        'end2 = LiteCard7.leftconection
        'e.Graphics.DrawLine(Pens.AliceBlue, end1, end2)

        'end1 = LiteCard7.rightconection
        'end2 = LiteCard8.leftconection
        'e.Graphics.DrawLine(Pens.AliceBlue, end1, end2)


        'end1 = LiteCard8.rightconection
        'end2 = LiteCard9.leftconection
        'e.Graphics.DrawLine(Pens.AliceBlue, end1, end2)



    End Sub

    Private Sub Timer_delayed_drawlines_Tick(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Timer_delayed_invalidate.Tick, Timer_delayed_finish_pattern_line.Tick

        Timer_delayed_invalidate.Stop()


        Pan_cardbackground.Invalidate()
        Return
    End Sub

    Public Sub positionandsizecards()
        Static recursive As Boolean = False

        If Not recursive Then

            recursive = True

            oneline_simulator_ratio = Convert.ToSingle(simulator_form.Pan_cards.Width) / (Convert.ToSingle(Pan_cardbackground.Width) * 0.95)

            LiteCard0.FontSize = simulator_form.LiteCard0.FontSize / oneline_simulator_ratio
            LiteCard1.FontSize = simulator_form.LiteCard1.FontSize / oneline_simulator_ratio
            LiteCard2.FontSize = simulator_form.LiteCard2.FontSize / oneline_simulator_ratio
            LiteCard3.FontSize = simulator_form.LiteCard3.FontSize / oneline_simulator_ratio
            LiteCard4.FontSize = simulator_form.LiteCard4.FontSize / oneline_simulator_ratio
            LiteCard5.FontSize = simulator_form.LiteCard5.FontSize / oneline_simulator_ratio
            LiteCard6.FontSize = simulator_form.LiteCard6.FontSize / oneline_simulator_ratio
            LiteCard7.FontSize = simulator_form.LiteCard7.FontSize / oneline_simulator_ratio
            LiteCard8.FontSize = simulator_form.LiteCard8.FontSize / oneline_simulator_ratio
            LiteCard9.FontSize = simulator_form.LiteCard9.FontSize / oneline_simulator_ratio
            LiteCard10.FontSize = simulator_form.LiteCard10.FontSize / oneline_simulator_ratio
            LiteCard11.FontSize = simulator_form.LiteCard11.FontSize / oneline_simulator_ratio
            LiteCard12.FontSize = simulator_form.LiteCard12.FontSize / oneline_simulator_ratio
            LiteCard13.FontSize = simulator_form.LiteCard13.FontSize / oneline_simulator_ratio
            LiteCard14.FontSize = simulator_form.LiteCard14.FontSize / oneline_simulator_ratio
            LiteCard15.FontSize = simulator_form.LiteCard15.FontSize / oneline_simulator_ratio
            LiteCard16.FontSize = simulator_form.LiteCard16.FontSize / oneline_simulator_ratio
            LiteCard17.FontSize = simulator_form.LiteCard17.FontSize / oneline_simulator_ratio
            LiteCard18.FontSize = simulator_form.LiteCard18.FontSize / oneline_simulator_ratio
            LiteCard19.FontSize = simulator_form.LiteCard19.FontSize / oneline_simulator_ratio

            'CMF-



            LiteCard0.Angle = simulator_form.LiteCard0.Angle
            LiteCard1.Angle = simulator_form.LiteCard1.Angle

            LiteCard2.Angle = simulator_form.LiteCard2.Angle

            LiteCard3.Angle = simulator_form.LiteCard3.Angle

            LiteCard4.Angle = simulator_form.LiteCard4.Angle

            LiteCard5.Angle = simulator_form.LiteCard5.Angle

            LiteCard6.Angle = simulator_form.LiteCard6.Angle

            LiteCard7.Angle = simulator_form.LiteCard7.Angle

            LiteCard8.Angle = simulator_form.LiteCard8.Angle
            LiteCard9.Angle = simulator_form.LiteCard9.Angle
            LiteCard10.Angle = simulator_form.LiteCard10.Angle
            LiteCard11.Angle = simulator_form.LiteCard11.Angle

            LiteCard12.Angle = simulator_form.LiteCard12.Angle

            LiteCard13.Angle = simulator_form.LiteCard13.Angle

            LiteCard14.Angle = simulator_form.LiteCard14.Angle

            LiteCard15.Angle = simulator_form.LiteCard15.Angle

            LiteCard16.Angle = simulator_form.LiteCard16.Angle

            LiteCard17.Angle = simulator_form.LiteCard17.Angle

            LiteCard18.Angle = simulator_form.LiteCard18.Angle

            LiteCard19.Angle = simulator_form.LiteCard19.Angle


            'CMF-






            LiteCard0.Location = New Point(simulator_form.LiteCard0.Location.X / oneline_simulator_ratio, simulator_form.LiteCard0.Location.Y / oneline_simulator_ratio)
            LiteCard1.Location = New Point(simulator_form.LiteCard1.Location.X / oneline_simulator_ratio, simulator_form.LiteCard1.Location.Y / oneline_simulator_ratio)
            LiteCard2.Location = New Point(simulator_form.LiteCard2.Location.X / oneline_simulator_ratio, simulator_form.LiteCard2.Location.Y / oneline_simulator_ratio)
            LiteCard3.Location = New Point(simulator_form.LiteCard3.Location.X / oneline_simulator_ratio, simulator_form.LiteCard3.Location.Y / oneline_simulator_ratio)
            LiteCard4.Location = New Point(simulator_form.LiteCard4.Location.X / oneline_simulator_ratio, simulator_form.LiteCard4.Location.Y / oneline_simulator_ratio)
            LiteCard5.Location = New Point(simulator_form.LiteCard5.Location.X / oneline_simulator_ratio, simulator_form.LiteCard5.Location.Y / oneline_simulator_ratio)
            LiteCard6.Location = New Point(simulator_form.LiteCard6.Location.X / oneline_simulator_ratio, simulator_form.LiteCard6.Location.Y / oneline_simulator_ratio)
            LiteCard7.Location = New Point(simulator_form.LiteCard7.Location.X / oneline_simulator_ratio, simulator_form.LiteCard7.Location.Y / oneline_simulator_ratio)
            LiteCard8.Location = New Point(simulator_form.LiteCard8.Location.X / oneline_simulator_ratio, simulator_form.LiteCard8.Location.Y / oneline_simulator_ratio)
            LiteCard9.Location = New Point(simulator_form.LiteCard9.Location.X / oneline_simulator_ratio, simulator_form.LiteCard9.Location.Y / oneline_simulator_ratio)

            LiteCard10.location = New Point(simulator_form.LiteCard10.location.X / oneline_simulator_ratio, simulator_form.LiteCard10.location.Y / oneline_simulator_ratio)
            LiteCard11.location = New Point(simulator_form.LiteCard11.location.X / oneline_simulator_ratio, simulator_form.LiteCard11.location.Y / oneline_simulator_ratio)
            LiteCard12.location = New Point(simulator_form.LiteCard12.location.X / oneline_simulator_ratio, simulator_form.LiteCard12.location.Y / oneline_simulator_ratio)
            LiteCard13.location = New Point(simulator_form.LiteCard13.location.X / oneline_simulator_ratio, simulator_form.LiteCard13.location.Y / oneline_simulator_ratio)
            LiteCard14.location = New Point(simulator_form.LiteCard14.location.X / oneline_simulator_ratio, simulator_form.LiteCard14.location.Y / oneline_simulator_ratio)
            LiteCard15.location = New Point(simulator_form.LiteCard15.location.X / oneline_simulator_ratio, simulator_form.LiteCard15.location.Y / oneline_simulator_ratio)
            LiteCard16.location = New Point(simulator_form.LiteCard16.location.X / oneline_simulator_ratio, simulator_form.LiteCard16.location.Y / oneline_simulator_ratio)


            LiteCard17.location = New Point(simulator_form.LiteCard17.location.X / oneline_simulator_ratio, simulator_form.LiteCard17.location.Y / oneline_simulator_ratio)
            LiteCard18.location = New Point(simulator_form.LiteCard18.location.X / oneline_simulator_ratio, simulator_form.LiteCard18.location.Y / oneline_simulator_ratio)
            LiteCard19.location = New Point(simulator_form.LiteCard19.location.X / oneline_simulator_ratio, simulator_form.LiteCard19.location.Y / oneline_simulator_ratio)

            'CMF-

            Timer_delayed_invalidate.Start()




            recursive = False
        End If




    End Sub

    Private Sub LiteCard3_Paint(ByVal sender As System.Object, ByVal e As System.Windows.Forms.PaintEventArgs) Handles LiteCard3.Paint

    End Sub

    Private Sub CMI_colorpattern_common_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles CMI_colorpattern0.Click, CMI_colorpattern3.Click, CMI_colorpattern2.Click, CMI_colorpattern1.Click, CMI_mypattern9.Click, CMI_mypattern8.Click, CMI_mypattern7.Click, CMI_mypattern6.Click, CMI_mypattern5.Click, CMI_mypattern4.Click, CMI_mypattern3.Click, CMI_mypattern2.Click, CMI_mypattern1.Click, CMI_mypattern0.Click, CMI_colorpattern9.Click, CMI_colorpattern8.Click, CMI_colorpattern7.Click, CMI_colorpattern6.Click, CMI_colorpattern5.Click, CMI_colorpattern4.Click
        simulator_form.CMI_colorpattern_common_Click(sender, e)
    End Sub

    Private Sub CMI_openlibrary_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles CMI_openlibrary.Click
        simulator_form.CMI_openlibrary_Click(sender, e)
    End Sub


    Private Sub NumericUpDown2_ValueChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles NUD_linestab_liinecounts.ValueChanged

        If currentlychanginglinecount Then
            Return
        End If
        If Not formloaded Then
            Return
        End If

        If currenttrickcodingversion = TRICKCODINGVERSION_COMBOKEYWORDS_PRE_20110310 Or currenttrickcodingversion = TRICKCODINGVERSION_COMBOKEYWORDS_CURRENT Then
            If promptbeforedisablingstandadtab Then


                Dim message As String = "If you proceed with editing data in this tab you will not be able to return to combo tab!" + Constants.vbCrLf

                message += "Are you sure you want to proceed"

                Dim result As DialogResult = MsgBox(message, MsgBoxStyle.OkCancel)

                If result = Windows.Forms.DialogResult.Cancel Then

                    currentlychanginglinecount = True
                    NUD_linestab_liinecounts.Value = linecount
                    currentlychanginglinecount = False

                    Return
                Else

                    If currenttrickcodingversion = TRICKCODINGVERSION_COMBOKEYWORDS_PRE_20110310 Then
                        'assume they want to stick with old file format
                        currenttrickcodingversion = TRICKCODINGVERSION_LINESONLY_PRE_20110310
                    Else
                        currenttrickcodingversion = TRICKCODINGVERSION_LINESONLY_CURRENT
                    End If

                End If
            Else
                If currenttrickcodingversion = TRICKCODINGVERSION_COMBOKEYWORDS_PRE_20110310 Then
                    'assume they want to stick with old file format
                    currenttrickcodingversion = TRICKCODINGVERSION_LINESONLY_PRE_20110310
                Else
                    currenttrickcodingversion = TRICKCODINGVERSION_LINESONLY_CURRENT
                End If

            End If
        End If
        If Not set_linecount(NUD_linestab_liinecounts.Value, line_configuration.add_or_truncate_position._end) Then
            MsgBox("bug - error setting line count")
        End If
        change_Lbl_pattern_type()
        change = True
    End Sub

    Private Sub NumericUpDown1_ValueChanged(ByVal sender As System.Object, ByVal e As System.EventArgs)
        If Not formloaded Then
            Return
        End If

        If currentlychanginglinelength Then
            Return
        End If


        If Not set_linelenth(NUD_lines_cardcount.Value, line_configuration.add_or_truncate_position._prompt, False) Then

            MsgBox("bug - error setting count")
        End If
        change_Lbl_pattern_type()
    End Sub


    ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
    '''''''''''''''''''''''''''''''''''combo tab functions''''''''''''''''''''''''''''''
    ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
    Public Sub combotab_refresh()

        initialize_legacysettings()


        combotab_position_elements()
        combotab_initialize_keywordallignment()

        combotab_refreshpatterns()
        refresh_available_lines()

        combotab_refreshlinedata()

    End Sub

    Public Sub combotab_clear_data()

        combotab_initialize_keywordallignment(True)

        NUDfc00.Minimum = 0
        NUDfc01.Minimum = 0
        NUDfc02.Minimum = 0
        NUDfc03.Minimum = 0
        NUDfc04.Minimum = 0
        NUDfc05.Minimum = 0
        NUDfc06.Minimum = 0
        NUDfc07.Minimum = 0
        NUDfc08.Minimum = 0
        NUDfc09.Minimum = 0

        NUDfc00.Value = 0
        NUDfc01.Value = 0
        NUDfc02.Value = 0
        NUDfc03.Value = 0
        NUDfc04.Value = 0
        NUDfc05.Value = 0
        NUDfc06.Value = 0
        NUDfc07.Value = 0
        NUDfc08.Value = 0
        NUDfc09.Value = 0


        CBpattern00.SelectedIndex = 0
        CBpattern01.SelectedIndex = 0
        CBpattern02.SelectedIndex = 0
        CBpattern03.SelectedIndex = 0
        CBpattern04.SelectedIndex = 0
        CBpattern05.SelectedIndex = 0
        CBpattern06.SelectedIndex = 0
        CBpattern07.SelectedIndex = 0
        CBpattern08.SelectedIndex = 0
        CBpattern09.SelectedIndex = 0

        TBkw00.Text = ""
        TBkw01.Text = ""
        TBkw02.Text = ""
        TBkw03.Text = ""
        TBkw04.Text = ""
        TBkw05.Text = ""
        TBkw06.Text = ""
        TBkw07.Text = ""
        TBkw08.Text = ""
        TBkw09.Text = ""




        combotab_generatelines()
        combotab_refreshlinedata()


    End Sub

    Public Sub combotab_position_elements()


        If True Then

            'eventualy the condition will test if one sign configuration selected

            Dim ystep As Int16 = 21
            Dim ystart As Int16 = +Label78.Location.Y + Label78.Height + 5   ' 30 'Panel37.Height + Panel37.Location.Y + 30
            Dim spacebetweencontrolls As Int16 = 3

            'Dim LBLkw0_x As Int16 = 2 'horizontal location of all word  numbering lables 
            '                        'in this configuration only lables of first index 0 are visiblr

            Dim LBLkw00y As Int16 = ystart 'vertical location of first word  numbering lable 

            Dim LBLkw0_ystep As Int16 = ystep 'change in verticle location of eacc word  numbering lable after first



            Dim TBkw0_x As Int16 = 3 'horizontal location of all index 0 keyword text boxes
            'Dim TBkw1_x As Int16 = 35 'horizontal location of all index 1 keyword text boxes



            Dim TBkw00y As Int16 = ystart 'vertical location of first index 0 keyword text boxes 
            Dim cbpattern00y As Int16 = TBkw00y 'vertical location of first pattern selecting combobox 

            Dim NUDfc00y As Int16 = ystart 'vertical location of first linecount selecting combobox




            Dim TBkw__ystep As Int16 = ystep 'change in verticle location of eacc keyword text boxes after first






            Dim CBpattern__x As Int16 = TBkw0_x + TBkw00.Width + spacebetweencontrolls
            Dim CBpattern__ystep As Int16 = ystep 'change in verticle location of pattern combobox after first

            Dim NUDfc__x As Int16 = CBpattern__x + CBpattern00.Width + spacebetweencontrolls


            Dim NUDfc__ystep As Int16 = ystep 'change in verticle location of line count combobox after first



            Dim NUDreps__x As Int16 = NUDfc__x + NUDfc00.Width + spacebetweencontrolls
            Dim NUDreps00y As Int16 = ystart
            Dim NUDreps__ystep As Int16 = ystep

            'Dim TBtpf__x As Int16 = 0 'not used NUDreps__x + NUDreps00.Width + spacebetweencontrolls


            Dim TBtpf00y As Int16 = ystart
            Dim TBtpf__ystep As Int16 = ystep
            'TBtpf00



            If legacysettings(legacysettingsindex.showreps) = 0 Then

                'hide reps NUDs and line total boxes
                'note in the visibility change routine the value will be set to 1

                'Lbl_totalpatternframes.Visible = False
                'Lbl_patternreps.Visible = False

                ''NUDreps00.Visible = False
                ''NUDreps01.Visible = False
                ''NUDreps02.Visible = False
                ''NUDreps03.Visible = False
                ''NUDreps04.Visible = False
                ''NUDreps05.Visible = False
                ''NUDreps06.Visible = False
                ''NUDreps07.Visible = False
                ''NUDreps08.Visible = False
                ''NUDreps09.Visible = False




                'TBtpf00.Visible = False
                'TBtpf01.Visible = False
                'TBtpf02.Visible = False
                'TBtpf03.Visible = False
                'TBtpf04.Visible = False
                'TBtpf05.Visible = False
                'TBtpf06.Visible = False
                'TBtpf07.Visible = False
                'TBtpf08.Visible = False
                'TBtpf09.Visible = False



                'ystep = 30
                'ystart = 132
                'spacebetweencontrolls = 8

                'Dim LBLkw0_x As Int16 = 2 'horizontal location of all word  numbering lables 
                '                        'in this configuration only lables of first index 0 are visiblr

                LBLkw00y = ystart 'vertical location of first word  numbering lable 

                LBLkw0_ystep = ystep 'change in verticle location of eacc word  numbering lable after first



                'TBkw0_x = 10 'horizontal location of all index 0 keyword text boxes
                'Dim TBkw1_x As Int16 = 35 'horizontal location of all index 1 keyword text boxes



                TBkw00y = ystart 'vertical location of first index 0 keyword text boxes 
                cbpattern00y = TBkw00y 'vertical location of first pattern selecting combobox 

                NUDfc00y = ystart 'vertical location of first linecount selecting combobox




                TBkw__ystep = ystep 'change in verticle location of eacc keyword text boxes after first






                CBpattern__x = TBkw0_x + TBkw00.Width + spacebetweencontrolls
                CBpattern__ystep = ystep 'change in verticle location of pattern combobox after first

                NUDfc__x = CBpattern__x + CBpattern00.Width + spacebetweencontrolls


                NUDfc__ystep = ystep 'change in verticle location of line count combobox after first



                'NUDreps__x = NUDfc__x + NUDfc00.Width + spacebetweencontrolls
                'NUDreps00y = ystart
                'NUDreps__ystep = ystep

                'TBtpf__x = 'NUDreps__x + 'NUDreps00.Width + spacebetweencontrolls


                TBtpf00y = ystart
                TBtpf__ystep = ystep
                'TBtpf00




            ElseIf legacysettings(legacysettingsindex.showreps) = 1 Or legacysettings(legacysettingsindex.showreps) = 2 Then

                'section not currently used 
                'probably will be removed from subsequent versions because only released copy of version using this was to pitabite

                'these 2 labels deleted from panel to avoid clutter
                'if we decide to use this leagcy section we will have to put back
                'Lbl_totalpatternframes.Visible = True
                'Lbl_patternreps.Visible = True


                'NUDreps00.Visible = True
                'NUDreps01.Visible = True
                'NUDreps02.Visible = True
                'NUDreps03.Visible = True
                'NUDreps04.Visible = True
                'NUDreps05.Visible = True
                ''NUDreps06.Visible = True
                'NUDreps07.Visible = True
                'NUDreps08.Visible = True
                'NUDreps09.Visible = True




                'TBtpf00.Visible = True
                'TBtpf01.Visible = True
                'TBtpf02.Visible = True
                'TBtpf03.Visible = True
                'TBtpf04.Visible = True
                'TBtpf05.Visible = True
                'TBtpf06.Visible = True
                'TBtpf07.Visible = True
                'TBtpf08.Visible = True
                'TBtpf09.Visible = True




                ystep = 30
                ystart = 132
                spacebetweencontrolls = 8

                'Dim LBLkw0_x As Int16 = 2 'horizontal location of all word  numbering lables 
                '                        'in this configuration only lables of first index 0 are visiblr

                LBLkw00y = ystart 'vertical location of first word  numbering lable 

                LBLkw0_ystep = ystep 'change in verticle location of eacc word  numbering lable after first



                TBkw0_x = 10 'horizontal location of all index 0 keyword text boxes
                'Dim TBkw1_x As Int16 = 35 'horizontal location of all index 1 keyword text boxes



                TBkw00y = ystart 'vertical location of first index 0 keyword text boxes 
                cbpattern00y = TBkw00y 'vertical location of first pattern selecting combobox 

                NUDfc00y = ystart 'vertical location of first linecount selecting combobox




                TBkw__ystep = ystep 'change in verticle location of eacc keyword text boxes after first






                CBpattern__x = TBkw0_x + TBkw00.Width + spacebetweencontrolls
                CBpattern__ystep = ystep 'change in verticle location of pattern combobox after first

                NUDfc__x = CBpattern__x + CBpattern00.Width + spacebetweencontrolls


                NUDfc__ystep = ystep 'change in verticle location of line count combobox after first



                'NUDreps__x = NUDfc__x + NUDfc00.Width + spacebetweencontrolls
                'NUDreps00y = ystart
                'NUDreps__ystep = ystep

                'TBtpf__x = 'NUDreps__x + 'NUDreps00.Width + spacebetweencontrolls


                TBtpf00y = ystart
                TBtpf__ystep = ystep
                'TBtpf00




            End If




            Dim stepcounter As Int16 = 1




            'hide all first index = 1 controls (these will later be shown for second light)

            'TBkw10.Visible = False
            'TBkw11.Visible = False
            'TBkw12.Visible = False
            'TBkw13.Visible = False
            'TBkw14.Visible = False
            'TBkw15.Visible = False
            'TBkw16.Visible = False
            'TBkw17.Visible = False
            'TBkw18.Visible = False
            'TBkw19.Visible = False
            'CBpattern10.Visible = False
            'CBpattern11.Visible = False
            'CBpattern12.Visible = False
            'CBpattern13.Visible = False
            'CBpattern14.Visible = False
            'CBpattern15.Visible = False
            'CBpattern16.Visible = False
            'CBpattern17.Visible = False
            'CBpattern18.Visible = False
            'CBpattern19.Visible = False
            'NUDfc10.Visible = False
            ''NUDfc11.Visible = False
            'NUDfc12.Visible = False
            'NUDfc13.Visible = False
            'NUDfc14.Visible = False
            'NUDfc15.Visible = False
            'NUDfc16.Visible = False
            'NUDfc17.Visible = False
            'NUDfc18.Visible = False
            'NUDfc19.Visible = False




            'position kewword textboxes, repetition NUDs and total lines TBs
            'initially I did the first few controll seperately then realized that they can be combined
            'eventially I will move the controlls postitioning below into this section


            TBkw00.Location = New Point(TBkw0_x, TBkw00y)
            'NUDreps00.Location = New Point('NUDreps__x, 'NUDreps00y)

            ' TBtpf00.Location = New Point(TBtpf__x, TBtpf00y)

            stepcounter = 1

            TBkw01.Location = New Point(TBkw0_x, TBkw00y + stepcounter * TBkw__ystep)
            'NUDreps01.Location = New Point('NUDreps__x, 'NUDreps00y + stepcounter * 'NUDreps__ystep)
            'TBtpf01.Location = New Point(TBtpf__x, TBtpf00y + stepcounter * TBtpf__ystep)

            stepcounter += 1

            TBkw02.Location = New Point(TBkw0_x, TBkw00y + stepcounter * TBkw__ystep)
            'NUDreps02.Location = New Point('NUDreps__x, 'NUDreps00y + stepcounter * 'NUDreps__ystep)
            'TBtpf02.Location = New Point(TBtpf__x, TBtpf00y + stepcounter * TBtpf__ystep)

            stepcounter += 1


            TBkw03.Location = New Point(TBkw0_x, TBkw00y + stepcounter * TBkw__ystep)
            'NUDreps03.Location = New Point('NUDreps__x, 'NUDreps00y + stepcounter * 'NUDreps__ystep)
            'TBtpf03.Location = New Point(TBtpf__x, TBtpf00y + stepcounter * TBtpf__ystep)

            stepcounter += 1

            TBkw04.Location = New Point(TBkw0_x, TBkw00y + stepcounter * TBkw__ystep)
            'NUDreps04.Location = New Point('NUDreps__x, 'NUDreps00y + stepcounter * 'NUDreps__ystep)
            'TBtpf04.Location = New Point(TBtpf__x, TBtpf00y + stepcounter * TBtpf__ystep)

            stepcounter += 1

            TBkw05.Location = New Point(TBkw0_x, TBkw00y + stepcounter * TBkw__ystep)
            'NUDreps05.Location = New Point('NUDreps__x, 'NUDreps00y + stepcounter * 'NUDreps__ystep)
            'TBtpf05.Location = New Point(TBtpf__x, TBtpf00y + stepcounter * TBtpf__ystep)

            stepcounter += 1

            TBkw06.Location = New Point(TBkw0_x, TBkw00y + stepcounter * TBkw__ystep)
            ''NUDreps06.Location = New Point('NUDreps__x, 'NUDreps00y + stepcounter * 'NUDreps__ystep)
            'TBtpf06.Location = New Point(TBtpf__x, TBtpf00y + stepcounter * TBtpf__ystep)

            stepcounter += 1

            TBkw07.Location = New Point(TBkw0_x, TBkw00y + stepcounter * TBkw__ystep)
            'NUDreps07.Location = New Point('NUDreps__x, 'NUDreps00y + stepcounter * 'NUDreps__ystep)
            'TBtpf07.Location = New Point(TBtpf__x, TBtpf00y + stepcounter * TBtpf__ystep)

            stepcounter += 1

            TBkw08.Location = New Point(TBkw0_x, TBkw00y + stepcounter * TBkw__ystep)
            'NUDreps08.Location = New Point('NUDreps__x, 'NUDreps00y + stepcounter * 'NUDreps__ystep)
            'TBtpf08.Location = New Point(TBtpf__x, TBtpf00y + stepcounter * TBtpf__ystep)

            stepcounter += 1

            TBkw09.Location = New Point(TBkw0_x, TBkw00y + stepcounter * TBkw__ystep)
            'NUDreps09.Location = New Point('NUDreps__x, 'NUDreps00y + stepcounter * 'NUDreps__ystep)
            'TBtpf09.Location = New Point(TBtpf__x, TBtpf00y + stepcounter * TBtpf__ystep)





            'position patterncomoboxes
            CBpattern00.Location = New Point(CBpattern__x, cbpattern00y)
            stepcounter = 1
            'CBpattern10.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)


            'stepcounter += 1
            CBpattern01.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)

            stepcounter += 1
            'CBpattern11.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)

            'stepcounter += 1
            CBpattern02.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)

            stepcounter += 1
            'CBpattern12.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)
            'stepcounter += 1
            CBpattern03.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)

            stepcounter += 1
            'CBpattern13.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)
            'stepcounter += 1
            CBpattern04.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)

            stepcounter += 1
            'CBpattern14.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)
            'stepcounter += 1
            CBpattern05.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)

            stepcounter += 1
            'CBpattern15.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)
            'stepcounter += 1
            CBpattern06.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)

            stepcounter += 1
            'CBpattern16.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)
            'stepcounter += 1
            CBpattern07.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)

            stepcounter += 1
            'CBpattern17.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)
            'stepcounter += 1
            CBpattern08.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)

            stepcounter += 1
            'CBpattern18.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)
            'stepcounter += 1
            CBpattern09.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)

            'stepcounter += 1
            'CBpattern19.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)




            'positiion framcount comboboxes
            NUDfc00.Location = New Point(NUDfc__x, NUDfc00y)
            stepcounter = 1
            'NUDfc10.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)


            'stepcounter += 1
            NUDfc01.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)

            stepcounter += 1
            'NUDfc11.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)
            'stepcounter += 1
            NUDfc02.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)

            stepcounter += 1
            'NUDfc12.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)
            'stepcounter += 1
            NUDfc03.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)

            stepcounter += 1
            'NUDfc13.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)
            'stepcounter += 1
            NUDfc04.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)

            stepcounter += 1
            'NUDfc14.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)
            'stepcounter += 1
            NUDfc05.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)

            stepcounter += 1
            'NUDfc15.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)
            'stepcounter += 1
            NUDfc06.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)

            stepcounter += 1
            'NUDfc16.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)
            'stepcounter += 1
            NUDfc07.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)

            stepcounter += 1
            'NUDfc17.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)
            'stepcounter += 1
            NUDfc08.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)

            stepcounter += 1
            'NUDfc18.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)
            'stepcounter += 1
            NUDfc09.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)

            'stepcounter += 1
            'NUDfc19.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)

        End If
        If False Then
            'eventualy the condition will test if DNA pattern selected
            'commneted out when controlled deleted  from combo tab to reduce clutter
            'if we use this section we will have to put controlls back


            ''this condition is unfinished because I decided to postpone implementing functionality for multiple signs
            'Dim ystep As Int16 = 23

            'Dim LBLkw0_x As Int16 = 2 'horizontal location of all word  numbering lables 
            ''                        'in this configuration only lables of first index 0 are visiblr

            'Dim LBLkw00y As Int16 = 75 'vertical location of first word  numbering lable 

            'Dim LBLkw0_ystep As Int16 = ystep  'change in verticle location of eacc word  numbering lable after first



            'Dim TBkw0_x As Int16 = 25 'horizontal location of all index 0 keyword text boxes
            'Dim TBkw1_x As Int16 = 35 'horizontal location of all index 1 keyword text boxes



            'Dim TBkw00y As Int16 = 75 'vertical location of first index 0 keyword text boxes 
            'Dim cbpattern00y As Int16 = TBkw00y 'vertical location of first pattern selecting combobox 

            'Dim NUDfc00y As Int16 = TBkw00y 'vertical location of first linecount selecting combobox




            'Dim TBkw__ystep As Int16 = ystep 'change in verticle location of eacc keyword text boxes after first






            'Dim CBpattern__x As Int16 = TBkw1_x + TBkw10.Width + 25
            'Dim CBpattern__ystep As Int16 = ystep 'change in verticle location of pattern combobox after first

            'Dim NUDfc__x As Int16 = CBpattern__x + CBpattern00.Width + 25
            'Dim NUDfc__ystep As Int16 = ystep 'change in verticle location of line count combobox after first


            'Dim stepcounter As Int16 = 1


            ''position kewword textboxes
            'TBkw00.Location = New Point(TBkw0_x, TBkw00y)
            'TBkw10.Location = New Point(TBkw1_x, TBkw00y + stepcounter * TBkw__ystep)
            'stepcounter += 1
            'TBkw01.Location = New Point(TBkw0_x, TBkw00y + stepcounter * TBkw__ystep)
            'stepcounter += 1
            'TBkw11.Location = New Point(TBkw1_x, TBkw00y + stepcounter * TBkw__ystep)
            'stepcounter += 1
            'TBkw02.Location = New Point(TBkw0_x, TBkw00y + stepcounter * TBkw__ystep)
            'stepcounter += 1
            'TBkw12.Location = New Point(TBkw1_x, TBkw00y + stepcounter * TBkw__ystep)
            'stepcounter += 1
            'TBkw03.Location = New Point(TBkw0_x, TBkw00y + stepcounter * TBkw__ystep)
            'stepcounter += 1
            'TBkw13.Location = New Point(TBkw1_x, TBkw00y + stepcounter * TBkw__ystep)
            'stepcounter += 1
            'TBkw04.Location = New Point(TBkw0_x, TBkw00y + stepcounter * TBkw__ystep)
            'stepcounter += 1
            'TBkw14.Location = New Point(TBkw1_x, TBkw00y + stepcounter * TBkw__ystep)
            'stepcounter += 1
            'TBkw05.Location = New Point(TBkw0_x, TBkw00y + stepcounter * TBkw__ystep)
            'stepcounter += 1
            'TBkw15.Location = New Point(TBkw1_x, TBkw00y + stepcounter * TBkw__ystep)
            'stepcounter += 1
            'TBkw06.Location = New Point(TBkw0_x, TBkw00y + stepcounter * TBkw__ystep)
            'stepcounter += 1
            'TBkw16.Location = New Point(TBkw1_x, TBkw00y + stepcounter * TBkw__ystep)
            'stepcounter += 1
            'TBkw07.Location = New Point(TBkw0_x, TBkw00y + stepcounter * TBkw__ystep)
            'stepcounter += 1
            'TBkw17.Location = New Point(TBkw1_x, TBkw00y + stepcounter * TBkw__ystep)
            'stepcounter += 1
            'TBkw08.Location = New Point(TBkw0_x, TBkw00y + stepcounter * TBkw__ystep)
            'stepcounter += 1
            'TBkw18.Location = New Point(TBkw1_x, TBkw00y + stepcounter * TBkw__ystep)
            'stepcounter += 1
            'TBkw09.Location = New Point(TBkw0_x, TBkw00y + stepcounter * TBkw__ystep)
            'stepcounter += 1
            'TBkw19.Location = New Point(TBkw1_x, TBkw00y + stepcounter * TBkw__ystep)



            ''position patterncomoboxes
            'CBpattern00.Location = New Point(CBpattern__x, cbpattern00y)
            'stepcounter = 1
            'CBpattern10.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)


            'stepcounter += 1
            'CBpattern01.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)

            'stepcounter += 1
            'CBpattern11.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)

            'stepcounter += 1
            'CBpattern02.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)

            'stepcounter += 1
            'CBpattern12.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)
            'stepcounter += 1
            'CBpattern03.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)

            'stepcounter += 1
            'CBpattern13.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)
            'stepcounter += 1
            'CBpattern04.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)

            'stepcounter += 1
            'CBpattern14.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)
            'stepcounter += 1
            'CBpattern05.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)

            'stepcounter += 1
            'CBpattern15.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)
            'stepcounter += 1
            'CBpattern06.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)

            'stepcounter += 1
            'CBpattern16.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)
            'stepcounter += 1
            'CBpattern07.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)

            'stepcounter += 1
            'CBpattern17.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)
            'stepcounter += 1
            'CBpattern08.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)

            'stepcounter += 1
            'CBpattern18.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)
            'stepcounter += 1
            'CBpattern09.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)

            'stepcounter += 1
            'CBpattern19.Location = New Point(CBpattern__x, cbpattern00y + stepcounter * CBpattern__ystep)




            ''positiion framcount comboboxes
            'NUDfc00.Location = New Point(NUDfc__x, NUDfc00y)
            'stepcounter = 1
            'NUDfc10.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)


            'stepcounter += 1
            'NUDfc01.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)

            'stepcounter += 1
            'NUDfc11.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)
            'stepcounter += 1
            'NUDfc02.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)

            'stepcounter += 1
            'NUDfc12.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)
            'stepcounter += 1
            'NUDfc03.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)

            'stepcounter += 1
            'NUDfc13.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)
            'stepcounter += 1
            'NUDfc04.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)

            'stepcounter += 1
            'NUDfc14.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)
            'stepcounter += 1
            'NUDfc05.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)

            'stepcounter += 1
            'NUDfc15.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)
            'stepcounter += 1
            'NUDfc06.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)

            'stepcounter += 1
            'NUDfc16.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)
            'stepcounter += 1
            'NUDfc07.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)

            'stepcounter += 1
            'NUDfc17.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)
            'stepcounter += 1
            'NUDfc08.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)

            'stepcounter += 1
            'NUDfc18.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)
            'stepcounter += 1
            'NUDfc09.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)

            'stepcounter += 1
            'NUDfc19.Location = New Point(NUDfc__x, NUDfc00y + stepcounter * NUDfc__ystep)

        End If



    End Sub



    Public Sub combotab_refreshpatterns()


        Dim patternames As String() = System.Enum.GetNames(GetType(combotab_patterns))
        Dim loopcounter As Int16 = 0

        While loopcounter < patternames.Length
            Dim thispattername As String = patternames(loopcounter)
            thispattername = Me.combotabpatterns_dataname_to_displayname(thispattername)
            'thispattername = thispattername.Replace(" and ", " & ")

            'thispattername = jpstringsfunctions.capitolizewords(thispattername)

            CBpattern00.Items.Add(thispattername)
            CBpattern01.Items.Add(thispattername)
            CBpattern02.Items.Add(thispattername)
            CBpattern03.Items.Add(thispattername)
            CBpattern04.Items.Add(thispattername)
            CBpattern05.Items.Add(thispattername)
            CBpattern06.Items.Add(thispattername)
            CBpattern07.Items.Add(thispattername)
            CBpattern08.Items.Add(thispattername)
            CBpattern09.Items.Add(thispattername)
            'CBpattern10.Items.Add(thispattername)
            'CBpattern11.Items.Add(thispattername)
            'CBpattern12.Items.Add(thispattername)
            'CBpattern13.Items.Add(thispattername)
            'CBpattern14.Items.Add(thispattername)
            'CBpattern15.Items.Add(thispattername)
            'CBpattern16.Items.Add(thispattername)
            'CBpattern17.Items.Add(thispattername)
            'CBpattern18.Items.Add(thispattername)
            'CBpattern19.Items.Add(thispattername)


            loopcounter += 1
        End While

        CBpattern00.SelectedIndex = 0
        CBpattern01.SelectedIndex = 0
        CBpattern02.SelectedIndex = 0
        CBpattern03.SelectedIndex = 0
        CBpattern04.SelectedIndex = 0
        CBpattern05.SelectedIndex = 0
        CBpattern06.SelectedIndex = 0
        CBpattern07.SelectedIndex = 0
        CBpattern08.SelectedIndex = 0
        CBpattern09.SelectedIndex = 0
        'CBpattern10.SelectedIndex = 0
        'CBpattern11.SelectedIndex = 0
        'CBpattern12.SelectedIndex = 0
        'CBpattern13.SelectedIndex = 0
        'CBpattern14.SelectedIndex = 0
        'CBpattern15.SelectedIndex = 0
        'CBpattern16.SelectedIndex = 0
        'CBpattern17.SelectedIndex = 0
        'CBpattern18.SelectedIndex = 0
        'CBpattern19.SelectedIndex = 0




        Return

        'below is old code

        'commented out patterns have not yet been implimented


        combo_patterns.Clear()
        'combo_patterns.Add("(none)")
        combo_patterns.Add("Still")
        combo_patterns.Add("Scroll Left")
        combo_patterns.Add("Scroll Right")
        'combo_patterns.Add("Join In")
        combo_patterns.Add("Split Out")
        'combo_patterns.Add("Zoom In and Out")
        'combo_patterns.Add("Zoom Out and In")
        combo_patterns.Add("Add On")
        combo_patterns.Add("Subtract Off")
        combo_patterns.Add("Add and Subtract")
        'combo_patterns.Add("Subtract and Add")
        'combo_patterns.Add("Custom")


        'For Each id As Int32 In people_ids_temp

        CBpattern00.Items.Clear()
        CBpattern01.Items.Clear()
        CBpattern02.Items.Clear()
        CBpattern03.Items.Clear()
        CBpattern04.Items.Clear()
        CBpattern05.Items.Clear()
        CBpattern06.Items.Clear()
        CBpattern07.Items.Clear()
        CBpattern08.Items.Clear()
        CBpattern09.Items.Clear()
        'CBpattern10.Items.Clear()
        'CBpattern11.Items.Clear()
        'CBpattern12.Items.Clear()
        'CBpattern13.Items.Clear()
        'CBpattern14.Items.Clear()
        'CBpattern15.Items.Clear()
        'CBpattern16.Items.Clear()
        'CBpattern17.Items.Clear()
        'CBpattern18.Items.Clear()
        'CBpattern19.Items.Clear()


        For Each pattern As String In combo_patterns

            CBpattern00.Items.Add(pattern)
            CBpattern01.Items.Add(pattern)
            CBpattern02.Items.Add(pattern)
            CBpattern03.Items.Add(pattern)
            CBpattern04.Items.Add(pattern)
            CBpattern05.Items.Add(pattern)
            CBpattern06.Items.Add(pattern)
            CBpattern07.Items.Add(pattern)
            CBpattern08.Items.Add(pattern)
            CBpattern09.Items.Add(pattern)
            'CBpattern10.Items.Add(pattern)
            'CBpattern11.Items.Add(pattern)
            'CBpattern12.Items.Add(pattern)
            'CBpattern13.Items.Add(pattern)
            'CBpattern14.Items.Add(pattern)
            'CBpattern15.Items.Add(pattern)
            'CBpattern16.Items.Add(pattern)
            'CBpattern17.Items.Add(pattern)
            'CBpattern18.Items.Add(pattern)
            'CBpattern19.Items.Add(pattern)



        Next

        CBpattern00.SelectedIndex = 0
        CBpattern01.SelectedIndex = 0
        CBpattern02.SelectedIndex = 0
        CBpattern03.SelectedIndex = 0
        CBpattern04.SelectedIndex = 0
        CBpattern05.SelectedIndex = 0
        CBpattern06.SelectedIndex = 0
        CBpattern07.SelectedIndex = 0
        CBpattern08.SelectedIndex = 0
        CBpattern09.SelectedIndex = 0
        'CBpattern10.SelectedIndex = 0
        'CBpattern11.SelectedIndex = 0
        'CBpattern12.SelectedIndex = 0
        'CBpattern13.SelectedIndex = 0
        'CBpattern14.SelectedIndex = 0
        'CBpattern15.SelectedIndex = 0
        'CBpattern16.SelectedIndex = 0
        'CBpattern17.SelectedIndex = 0
        'CBpattern18.SelectedIndex = 0
        'CBpattern19.SelectedIndex = 0


    End Sub


    Public Sub refresh_available_lines()

        Const EEpromspace As Int16 = 512

        Dim EEpromconfigbytes As Int16 = 2 'linecount and line length
        Dim EEpromreservedbytes As Int16 = 11 'valid aplication, memory map and 9 reserved
        Dim EEpromtrickdata As Int16 = trickdata.Count

        'Dim maxlines As Int16
        Dim availableEEprom As Int16 = EEpromspace - EEpromconfigbytes - EEpromreservedbytes - EEpromtrickdata
        If settings(settingsindex.linelength) = 0 Then
            MsgBox("error linelentght = 0!")
            totallines = availableEEprom / 1

        Else
            totallines = availableEEprom / settings(settingsindex.linelength)
        End If

        If totallines > 30 Then
            'changming decided total lines should be no more then 30
            'jp does not agree but went along rather then argue
            totallines = 30
        End If

        usedlines = textdata.Count
        availablelines = totallines - usedlines

        NUD_linestab_liinecounts.Maximum = totallines

        'update lable listing line totals (for all patterns combined)
        LBL_linecount.Text = "Line Count:  "
        LBL_linecount.Text &= " " + usedlines.ToString & " used, " & availablelines.ToString & " available, " & totallines.ToString & " total"

        If availablelines < 10 Then

            Lbl_availablelines.Text = availablelines.ToString & " available,"
            Lbl_availablelines.Visible = True
        Else

            Lbl_availablelines.Visible = False
        End If


    End Sub
    Private Sub combotab_refreshlinedata()
        'this refreshed the fram data in the lable 
        'it also changes the max and min values for the line count and rep boxes


        'for NUDfc0x we set the minvalue to one step less then the actual minimum value for the pattern.
        'we set tag to the actual minimum value for the pattern.
        'elsewhere in the code if the value set is less then the value in tag, the value is set to 0. 


        'Dim unusedfont As Font = New Font(TBkw00.Font.FontFamily, TBkw00.Font.Size)

        Dim needtoregeneratelines As Boolean = False 'no line values have changed.. Ie not necceary to refresh lines


        Dim unshowncolor As Color = Color.LightGray
        Dim showncolor As Color = Color.Black

        Dim cursorposition As Int16
        Dim highlightedlength As Int16

        Dim restorevalue = databeinginternallymanipulated
        databeinginternallymanipulated = True

        refresh_available_lines()





        'go through each keyword line and update info

        Dim thispattern As String
        Dim thiskeyword As String
        Dim currentlinesinpattern As Int16
        Dim currentreps As Int16
        Dim currentpatterntotallines As Int16
        Dim linesusedbyotherpatterns As Int16
        Dim linesavailableforpattern As Int16

        'Dim hypotheticaltotallinesforvaluebeingtested As Int16

        Dim minlinesinpattern As Int16 '= get_minlinesforpattern(pattern, keyword)
        Dim maxlinesinpattern As Int16 '= get_maxlinesforpattern(pattern, keyword)
        Dim linestep As Int16 '= get_linescountstepforpattern(pattern, keyword)
        Dim maxwordlength As Int16

        'Dim newminlinesinpat As Int16
        'Dim newmaxlines As Int16
        Const newminreps As Int16 = 0
        Dim newmaxreps As Int16


        ''''''''line 0
        thispattern = combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern00.SelectedIndex))
        thiskeyword = TBkw00.Text
        currentlinesinpattern = NUDfc00.Value
        currentreps = 1 'NUDreps00.Value
        minlinesinpattern = get_minlinesforpattern(thispattern, thiskeyword)
        maxlinesinpattern = get_maxlinesforpattern(thispattern, thiskeyword, currentlinesinpattern)
        linestep = get_linescountstepforpattern(thispattern, thiskeyword)


        If NUDfc00.Value < minlinesinpattern Or NUDfc00.Value > maxlinesinpattern Then
            needtoregeneratelines = True
        End If
        currentpatterntotallines = currentlinesinpattern * currentreps
        linesusedbyotherpatterns = usedlines - currentpatterntotallines
        linesavailableforpattern = totallines - linesusedbyotherpatterns


        'make sure maxlines does not result exceed what is available

        While maxlinesinpattern * currentreps > linesavailableforpattern
            maxlinesinpattern -= 1
        End While

        'set the highest maxreps that does not exceed what is available


        If currentlinesinpattern = 0 Then

            newmaxreps = currentreps
        Else

            newmaxreps = 0

            While newmaxreps * currentlinesinpattern <= linesavailableforpattern

                newmaxreps += 1
            End While
            newmaxreps -= 1 'the loop ends with this value one too high



            NUDfc00.Minimum = minlinesinpattern - NUDfc00.Increment 'see note at top of function
        End If



        NUDfc00.Tag = minlinesinpattern

        NUDfc00.Maximum = maxlinesinpattern
        'NUDreps00.Minimum = newminreps
        'NUDreps00.Maximum = newmaxreps
        'TBtpf00.Text = currentpatterntotallines


        maxwordlength = get_maxlinelengthforpattern(thispattern, thiskeyword)
        cursorposition = TBkw00.SelectionStart
        highlightedlength = TBkw00.SelectionLength

        TBkw00.Select(0, maxwordlength)
        TBkw00.SelectionColor = showncolor
        TBkw00.Select(maxwordlength, TBkw00.Text.Length - maxwordlength)
        TBkw00.SelectionColor = unshowncolor

        TBkw00.SelectionStart = cursorposition
        TBkw00.SelectionLength = highlightedlength




        ''''''''''''''''''''''''''''''''''''
        ''''''''line 1
        '''''''''''''''''''''''''''''''''''''''''''''
        thispattern = combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern01.SelectedIndex))
        thiskeyword = TBkw01.Text
        currentlinesinpattern = NUDfc01.Value
        currentreps = 1 'NUDreps01.Value
        minlinesinpattern = get_minlinesforpattern(thispattern, thiskeyword)
        maxlinesinpattern = get_maxlinesforpattern(thispattern, thiskeyword, currentlinesinpattern)
        linestep = get_linescountstepforpattern(thispattern, thiskeyword)

        currentpatterntotallines = currentlinesinpattern * currentreps
        linesusedbyotherpatterns = usedlines - currentpatterntotallines
        linesavailableforpattern = totallines - linesusedbyotherpatterns


        If NUDfc01.Value < minlinesinpattern Or NUDfc01.Value > maxlinesinpattern Then
            needtoregeneratelines = True
        End If


        'make sure maxlines does not result exceed what is available

        While maxlinesinpattern * currentreps > linesavailableforpattern
            maxlinesinpattern -= 1
        End While

        'set the highest maxreps that exceed what is available
        If currentlinesinpattern = 0 Then

            newmaxreps = currentreps
        Else

            newmaxreps = 0

            While newmaxreps * currentlinesinpattern <= linesavailableforpattern

                newmaxreps += 1
            End While
            newmaxreps -= 1 'the loop ends with this value one too high

            NUDfc01.Minimum = minlinesinpattern - NUDfc01.Increment 'see note at top of function
        End If

        NUDfc01.Tag = minlinesinpattern 'see note at top of function

        NUDfc01.Maximum = maxlinesinpattern
        'NUDreps01.Minimum = newminreps
        'NUDreps01.Maximum = newmaxreps
        'TBtpf01.Text = currentpatterntotallines



        maxwordlength = get_maxlinelengthforpattern(thispattern, thiskeyword)
        cursorposition = TBkw01.SelectionStart
        highlightedlength = TBkw01.SelectionLength

        If currentreps = 0 Then
            TBkw01.SelectAll()
            TBkw01.SelectionColor = unshowncolor
            TBkw01.SelectionStart = cursorposition
            TBkw01.SelectionLength = highlightedlength

        Else

            TBkw01.Select(0, maxwordlength)
            TBkw01.SelectionColor = showncolor
            TBkw01.Select(maxwordlength, TBkw01.Text.Length - maxwordlength)
            TBkw01.SelectionColor = unshowncolor

            TBkw01.SelectionStart = cursorposition
            TBkw01.SelectionLength = highlightedlength

        End If

        '''''''''''''''''''''''''''''
        ''''''''line 2
        '''''''''''''''''''''''''''''''
        thispattern = combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern02.SelectedIndex))
        thiskeyword = TBkw02.Text
        currentlinesinpattern = NUDfc02.Value
        currentreps = 1 'NUDreps02.Value
        minlinesinpattern = get_minlinesforpattern(thispattern, thiskeyword)
        maxlinesinpattern = get_maxlinesforpattern(thispattern, thiskeyword, currentlinesinpattern)
        linestep = get_linescountstepforpattern(thispattern, thiskeyword)

        currentpatterntotallines = currentlinesinpattern * currentreps
        linesusedbyotherpatterns = usedlines - currentpatterntotallines
        linesavailableforpattern = totallines - linesusedbyotherpatterns

        If NUDfc02.Value < minlinesinpattern Or NUDfc02.Value > maxlinesinpattern Then
            needtoregeneratelines = True
        End If


        'make sure maxlines does not result exceed what is available

        While maxlinesinpattern * currentreps > linesavailableforpattern
            maxlinesinpattern -= 1
        End While

        If currentlinesinpattern = 0 Then

            newmaxreps = currentreps
        Else

            newmaxreps = 0

            While newmaxreps * currentlinesinpattern <= linesavailableforpattern

                newmaxreps += 1
            End While
            newmaxreps -= 1 'the loop ends with this value one too high

            NUDfc02.Minimum = minlinesinpattern - NUDfc02.Increment 'see note at top of function
        End If

        NUDfc02.Tag = minlinesinpattern 'see note at top of function
        NUDfc02.Maximum = maxlinesinpattern
        'NUDreps02.Minimum = newminreps
        'NUDreps02.Maximum = newmaxreps
        'TBtpf02.Text = currentpatterntotallines

        maxwordlength = get_maxlinelengthforpattern(thispattern, thiskeyword)
        cursorposition = TBkw02.SelectionStart
        highlightedlength = TBkw02.SelectionLength

        If currentreps = 0 Then
            TBkw02.SelectAll()
            TBkw02.SelectionColor = unshowncolor
            TBkw02.SelectionStart = cursorposition
            TBkw02.SelectionLength = highlightedlength
        Else

            TBkw02.Select(0, maxwordlength)
            TBkw02.SelectionColor = showncolor
            TBkw02.Select(maxwordlength, TBkw02.Text.Length - maxwordlength)
            TBkw02.SelectionColor = unshowncolor

            TBkw02.SelectionStart = cursorposition
            TBkw02.SelectionLength = highlightedlength
        End If
        ''''''''''''''''''''''''''''
        ''''''''line 3
        ''''''''''''''''''''''''''''
        thispattern = combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern03.SelectedIndex))
        thiskeyword = TBkw03.Text
        currentlinesinpattern = NUDfc03.Value
        currentreps = 1 'NUDreps03.Value
        minlinesinpattern = get_minlinesforpattern(thispattern, thiskeyword)
        maxlinesinpattern = get_maxlinesforpattern(thispattern, thiskeyword, currentlinesinpattern)
        linestep = get_linescountstepforpattern(thispattern, thiskeyword)

        currentpatterntotallines = currentlinesinpattern * currentreps
        linesusedbyotherpatterns = usedlines - currentpatterntotallines
        linesavailableforpattern = totallines - linesusedbyotherpatterns

        If NUDfc03.Value < minlinesinpattern Or NUDfc03.Value > maxlinesinpattern Then
            needtoregeneratelines = True
        End If

        'make sure maxlines does not result exceed what is available

        While maxlinesinpattern * currentreps > linesavailableforpattern
            maxlinesinpattern -= 1
        End While

        'set the highest maxreps that exceed what is available
        If currentlinesinpattern = 0 Then

            newmaxreps = currentreps
        Else

            newmaxreps = 0

            While newmaxreps * currentlinesinpattern <= linesavailableforpattern

                newmaxreps += 1
            End While
            newmaxreps -= 1 'the loop ends with this value one too high

            NUDfc03.Minimum = minlinesinpattern - NUDfc01.Increment 'see note at top of function
        End If

        NUDfc03.Tag = minlinesinpattern 'see note at top of function
        NUDfc03.Maximum = maxlinesinpattern
        'NUDreps03.Minimum = newminreps
        'NUDreps03.Maximum = newmaxreps
        'TBtpf03.Text = currentpatterntotallines

        maxwordlength = get_maxlinelengthforpattern(thispattern, thiskeyword)
        cursorposition = TBkw03.SelectionStart
        highlightedlength = TBkw03.SelectionLength

        If currentreps = 0 Then
            TBkw03.SelectAll()
            TBkw03.SelectionColor = unshowncolor
            TBkw03.SelectionStart = cursorposition
            TBkw03.SelectionLength = highlightedlength

        Else

            TBkw03.Select(0, maxwordlength)
            TBkw03.SelectionColor = showncolor
            TBkw03.Select(maxwordlength, TBkw03.Text.Length - maxwordlength)
            TBkw03.SelectionColor = unshowncolor

            TBkw03.SelectionStart = cursorposition
            TBkw03.SelectionLength = highlightedlength

        End If
        '''''''''''''''''''''''''''''''''''
        ''''''''line 4
        '''''''''''''''''''''''''''''''''''
        thispattern = combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern04.SelectedIndex))
        thiskeyword = TBkw04.Text
        currentlinesinpattern = NUDfc04.Value
        currentreps = 1 'NUDreps04.Value
        minlinesinpattern = get_minlinesforpattern(thispattern, thiskeyword)
        maxlinesinpattern = get_maxlinesforpattern(thispattern, thiskeyword, currentlinesinpattern)
        linestep = get_linescountstepforpattern(thispattern, thiskeyword)

        currentpatterntotallines = currentlinesinpattern * currentreps
        linesusedbyotherpatterns = usedlines - currentpatterntotallines
        linesavailableforpattern = totallines - linesusedbyotherpatterns

        If NUDfc04.Value < minlinesinpattern Or NUDfc04.Value > maxlinesinpattern Then
            needtoregeneratelines = True
        End If

        'make sure maxlines does not result exceed what is available

        While maxlinesinpattern * currentreps > linesavailableforpattern
            maxlinesinpattern -= 1
        End While

        'set the highest maxreps that exceed what is available
        If currentlinesinpattern = 0 Then

            newmaxreps = currentreps
        Else

            newmaxreps = 0

            While newmaxreps * currentlinesinpattern <= linesavailableforpattern

                newmaxreps += 1
            End While
            newmaxreps -= 1 'the loop ends with this value one too high

            NUDfc04.Minimum = minlinesinpattern - NUDfc04.Increment 'see note at top of function
        End If


        NUDfc04.Maximum = maxlinesinpattern
        NUDfc04.Tag = minlinesinpattern 'see note at top of function
        'NUDreps04.Minimum = newminreps
        'NUDreps04.Maximum = newmaxreps
        'TBtpf04.Text = currentpatterntotallines

        maxwordlength = get_maxlinelengthforpattern(thispattern, thiskeyword)

        cursorposition = TBkw04.SelectionStart
        highlightedlength = TBkw04.SelectionLength

        If currentreps = 0 Then
            TBkw04.SelectAll()
            TBkw04.SelectionColor = unshowncolor
            TBkw04.SelectionStart = cursorposition
            TBkw04.SelectionLength = highlightedlength

        Else

            TBkw04.Select(0, maxwordlength)
            TBkw04.SelectionColor = showncolor
            TBkw04.Select(maxwordlength, TBkw04.Text.Length - maxwordlength)
            TBkw04.SelectionColor = unshowncolor

            TBkw04.SelectionStart = cursorposition
            TBkw04.SelectionLength = highlightedlength

        End If


        '''''''''''''''''''''''''''''''''''
        ''''''''line 5
        '''''''''''''''''''''''''''''''''''
        thispattern = combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern05.SelectedIndex))
        thiskeyword = TBkw05.Text
        currentlinesinpattern = NUDfc05.Value
        currentreps = 1 'NUDreps05.Value
        minlinesinpattern = get_minlinesforpattern(thispattern, thiskeyword)
        maxlinesinpattern = get_maxlinesforpattern(thispattern, thiskeyword, currentlinesinpattern)
        linestep = get_linescountstepforpattern(thispattern, thiskeyword)

        currentpatterntotallines = currentlinesinpattern * currentreps
        linesusedbyotherpatterns = usedlines - currentpatterntotallines
        linesavailableforpattern = totallines - linesusedbyotherpatterns

        If NUDfc05.Value < minlinesinpattern Or NUDfc05.Value > maxlinesinpattern Then
            needtoregeneratelines = True
        End If

        'make sure maxlines does not result exceed what is available

        While maxlinesinpattern * currentreps > linesavailableforpattern
            maxlinesinpattern -= 1
        End While

        'set the highest maxreps that exceed what is available
        If currentlinesinpattern = 0 Then

            newmaxreps = currentreps
        Else

            newmaxreps = 0

            While newmaxreps * currentlinesinpattern <= linesavailableforpattern

                newmaxreps += 1
            End While
            newmaxreps -= 1 'the loop ends with this value one too high

            NUDfc05.Minimum = minlinesinpattern - NUDfc05.Increment 'see note at top of function
        End If


        NUDfc05.Maximum = maxlinesinpattern
        NUDfc05.Tag = minlinesinpattern 'see note at top of function
        'NUDreps05.Minimum = newminreps
        'NUDreps05.Maximum = newmaxreps
        'TBtpf05.Text = currentpatterntotallines

        maxwordlength = get_maxlinelengthforpattern(thispattern, thiskeyword)
        cursorposition = TBkw05.SelectionStart
        highlightedlength = TBkw05.SelectionLength

        If currentreps = 0 Then
            TBkw05.SelectAll()
            TBkw05.SelectionColor = unshowncolor
            TBkw05.SelectionStart = cursorposition
            TBkw05.SelectionLength = highlightedlength

        Else

            TBkw05.Select(0, maxwordlength)
            TBkw05.SelectionColor = showncolor
            TBkw05.Select(maxwordlength, TBkw05.Text.Length - maxwordlength)
            TBkw05.SelectionColor = unshowncolor

            TBkw05.SelectionStart = cursorposition
            TBkw05.SelectionLength = highlightedlength

        End If

        '''''''''''''''''''''''''''''''''
        ''''''''line 6
        ''''''''''''''''''''''''''''''''''
        thispattern = combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern06.SelectedIndex))
        thiskeyword = TBkw06.Text
        currentlinesinpattern = NUDfc06.Value
        currentreps = 1 ''NUDreps06.Value
        minlinesinpattern = get_minlinesforpattern(thispattern, thiskeyword)
        maxlinesinpattern = get_maxlinesforpattern(thispattern, thiskeyword, currentlinesinpattern)
        linestep = get_linescountstepforpattern(thispattern, thiskeyword)

        currentpatterntotallines = currentlinesinpattern * currentreps
        linesusedbyotherpatterns = usedlines - currentpatterntotallines
        linesavailableforpattern = totallines - linesusedbyotherpatterns

        If NUDfc06.Value < minlinesinpattern Or NUDfc06.Value > maxlinesinpattern Then
            needtoregeneratelines = True
        End If


        'make sure maxlines does not result exceed what is available

        While maxlinesinpattern * currentreps > linesavailableforpattern
            maxlinesinpattern -= 1
        End While

        'set the highest maxreps that exceed what is available
        If currentlinesinpattern = 0 Then

            newmaxreps = currentreps
        Else

            newmaxreps = 0

            While newmaxreps * currentlinesinpattern <= linesavailableforpattern

                newmaxreps += 1
            End While
            newmaxreps -= 1 'the loop ends with this value one too high

            NUDfc06.Minimum = minlinesinpattern - NUDfc06.Increment 'see note at top of function
        End If


        NUDfc06.Maximum = maxlinesinpattern
        NUDfc06.Tag = minlinesinpattern 'see note at top of function
        ''NUDreps06.Minimum = newminreps
        ''NUDreps06.Maximum = newmaxreps
        'TBtpf06.Text = currentpatterntotallines

        maxwordlength = get_maxlinelengthforpattern(thispattern, thiskeyword)
        cursorposition = TBkw06.SelectionStart
        highlightedlength = TBkw06.SelectionLength

        If currentreps = 0 Then
            TBkw06.SelectAll()
            TBkw06.SelectionColor = unshowncolor
            TBkw06.SelectionStart = cursorposition
            TBkw06.SelectionLength = highlightedlength
        Else

            TBkw06.Select(0, maxwordlength)
            TBkw06.SelectionColor = showncolor
            TBkw06.Select(maxwordlength, TBkw06.Text.Length - maxwordlength)
            TBkw06.SelectionColor = unshowncolor

            TBkw06.SelectionStart = cursorposition
            TBkw06.SelectionLength = highlightedlength
        End If

        ''''''''''''''''''''''''
        ''''''''line 7
        ''''''''''''''''''''''''''
        thispattern = combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern07.SelectedIndex))
        thiskeyword = TBkw07.Text
        currentlinesinpattern = NUDfc07.Value
        currentreps = 1 'NUDreps07.Value
        minlinesinpattern = get_minlinesforpattern(thispattern, thiskeyword)
        maxlinesinpattern = get_maxlinesforpattern(thispattern, thiskeyword, currentlinesinpattern)
        linestep = get_linescountstepforpattern(thispattern, thiskeyword)

        currentpatterntotallines = currentlinesinpattern * currentreps
        linesusedbyotherpatterns = usedlines - currentpatterntotallines
        linesavailableforpattern = totallines - linesusedbyotherpatterns

        If NUDfc07.Value < minlinesinpattern Or NUDfc07.Value > maxlinesinpattern Then
            needtoregeneratelines = True
        End If

        'make sure maxlines does not result exceed what is available

        While maxlinesinpattern * currentreps > linesavailableforpattern
            maxlinesinpattern -= 1
        End While

        'set the highest maxreps that exceed what is available
        If currentlinesinpattern = 0 Then

            newmaxreps = currentreps
        Else

            newmaxreps = 0

            While newmaxreps * currentlinesinpattern <= linesavailableforpattern

                newmaxreps += 1
            End While
            newmaxreps -= 1 'the loop ends with this value one too high

            NUDfc07.Minimum = minlinesinpattern - NUDfc07.Increment 'see note at top of function
        End If


        NUDfc07.Maximum = maxlinesinpattern
        NUDfc07.Tag = minlinesinpattern 'see note at top of function
        'NUDreps07.Minimum = newminreps
        'NUDreps07.Maximum = newmaxreps
        'TBtpf07.Text = currentpatterntotallines

        maxwordlength = get_maxlinelengthforpattern(thispattern, thiskeyword)
        cursorposition = TBkw07.SelectionStart
        highlightedlength = TBkw07.SelectionLength

        If currentreps = 0 Then
            TBkw07.SelectAll()
            TBkw07.SelectionColor = unshowncolor
            TBkw07.SelectionStart = cursorposition
            TBkw07.SelectionLength = highlightedlength
        Else

            TBkw07.Select(0, maxwordlength)
            TBkw07.SelectionColor = showncolor
            TBkw07.Select(maxwordlength, TBkw07.Text.Length - maxwordlength)
            TBkw07.SelectionColor = unshowncolor

            TBkw07.SelectionStart = cursorposition
            TBkw07.SelectionLength = highlightedlength
        End If

        '''''''''''''''''''''''''''''''''''''''
        ''''''''line 8
        ''''''''''''''''''''''''''''''''''''''''
        thispattern = combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern08.SelectedIndex))
        thiskeyword = TBkw08.Text
        currentlinesinpattern = NUDfc08.Value
        currentreps = 1 'NUDreps08.Value
        minlinesinpattern = get_minlinesforpattern(thispattern, thiskeyword)
        maxlinesinpattern = get_maxlinesforpattern(thispattern, thiskeyword, currentlinesinpattern)
        linestep = get_linescountstepforpattern(thispattern, thiskeyword)

        currentpatterntotallines = currentlinesinpattern * currentreps
        linesusedbyotherpatterns = usedlines - currentpatterntotallines
        linesavailableforpattern = totallines - linesusedbyotherpatterns

        If NUDfc08.Value < minlinesinpattern Or NUDfc08.Value > maxlinesinpattern Then
            needtoregeneratelines = True
        End If


        'make sure maxlines does not result exceed what is available

        While maxlinesinpattern * currentreps > linesavailableforpattern
            maxlinesinpattern -= 1
        End While

        'set the highest maxreps that exceed what is available
        If currentlinesinpattern = 0 Then

            newmaxreps = currentreps
        Else

            newmaxreps = 0

            While newmaxreps * currentlinesinpattern <= linesavailableforpattern

                newmaxreps += 1
            End While
            newmaxreps -= 1 'the loop ends with this value one too high

            NUDfc08.Minimum = minlinesinpattern - NUDfc08.Increment 'see note at top of function
        End If


        NUDfc08.Maximum = maxlinesinpattern
        NUDfc08.Tag = minlinesinpattern 'see note at top of function
        'NUDreps08.Minimum = newminreps
        'NUDreps08.Maximum = newmaxreps
        'TBtpf08.Text = currentpatterntotallines
        maxwordlength = get_maxlinelengthforpattern(thispattern, thiskeyword)
        cursorposition = TBkw08.SelectionStart
        highlightedlength = TBkw08.SelectionLength

        If currentreps = 0 Then
            TBkw08.SelectAll()
            TBkw08.SelectionColor = unshowncolor
            TBkw08.SelectionStart = cursorposition
            TBkw08.SelectionLength = highlightedlength
        Else

            TBkw08.Select(0, maxwordlength)
            TBkw08.SelectionColor = showncolor
            TBkw08.Select(maxwordlength, TBkw08.Text.Length - maxwordlength)
            TBkw08.SelectionColor = unshowncolor

            TBkw08.SelectionStart = cursorposition
            TBkw08.SelectionLength = highlightedlength
        End If
        '''''''''''''''''''''''''''''''''''''''
        ''''''''line 9
        '''''''''''''''''''''''''''''''''''''''
        thispattern = combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern09.SelectedIndex))
        thiskeyword = TBkw09.Text
        currentlinesinpattern = NUDfc09.Value
        currentreps = 1 'NUDreps09.Value
        minlinesinpattern = get_minlinesforpattern(thispattern, thiskeyword)
        maxlinesinpattern = get_maxlinesforpattern(thispattern, thiskeyword, currentlinesinpattern)
        linestep = get_linescountstepforpattern(thispattern, thiskeyword)

        currentpatterntotallines = currentlinesinpattern * currentreps
        linesusedbyotherpatterns = usedlines - currentpatterntotallines
        linesavailableforpattern = totallines - linesusedbyotherpatterns

        If NUDfc09.Value < minlinesinpattern Or NUDfc09.Value > maxlinesinpattern Then
            needtoregeneratelines = True
        End If


        'make sure maxlines does not result exceed what is available

        While maxlinesinpattern * currentreps > linesavailableforpattern
            maxlinesinpattern -= 1
        End While

        'set the highest maxreps that exceed what is available
        If currentlinesinpattern = 0 Then

            newmaxreps = currentreps
        Else

            newmaxreps = 0

            While newmaxreps * currentlinesinpattern <= linesavailableforpattern

                newmaxreps += 1
            End While
            newmaxreps -= 1 'the loop ends with this value one too high

            NUDfc09.Minimum = minlinesinpattern - NUDfc09.Increment 'see note at top of function
        End If


        NUDfc09.Maximum = maxlinesinpattern
        NUDfc09.Tag = minlinesinpattern 'see note at top of function
        'NUDreps09.Minimum = newminreps
        'NUDreps09.Maximum = newmaxreps
        'TBtpf09.Text = currentpatterntotallines

        maxwordlength = get_maxlinelengthforpattern(thispattern, thiskeyword)
        cursorposition = TBkw09.SelectionStart
        highlightedlength = TBkw09.SelectionLength

        If currentreps = 0 Then
            TBkw09.SelectAll()
            TBkw09.SelectionColor = unshowncolor
            TBkw09.SelectionStart = cursorposition
            TBkw09.SelectionLength = highlightedlength

        Else

            TBkw09.Select(0, maxwordlength)
            TBkw09.SelectionColor = showncolor
            TBkw09.Select(maxwordlength, TBkw09.Text.Length - maxwordlength)
            TBkw09.SelectionColor = unshowncolor

            TBkw09.SelectionStart = cursorposition
            TBkw09.SelectionLength = highlightedlength

        End If


        databeinginternallymanipulated = restorevalue

        If needtoregeneratelines Then

            combotab_generatelines()

        End If
    End Sub

    Private Function get_minlinesforpattern(ByVal pattern As String, ByVal keyword As String) As Int16


        keyword = jpstringsfunctions.truncateright(keyword, get_maxlinelengthforpattern(pattern)) 'if already short enough, no change




        refresh_available_lines()


        Dim returnvalue As Int16 = 0



        If pattern.ToLower = "(none)" Then
            returnvalue = 1
        ElseIf pattern.ToLower = "still" Then


            returnvalue = 1
        ElseIf pattern.ToLower = "scroll left" Then
            returnvalue = 2
        ElseIf pattern.ToLower = "scroll right" Then
            returnvalue = 2
        ElseIf pattern.ToLower = "join in" Then
            returnvalue = 3
        ElseIf pattern.ToLower = "split out" Then
            returnvalue = 3
        ElseIf pattern.ToLower = "zoom in and out" Then
            returnvalue = 6
        ElseIf pattern.ToLower = "zoom out and in" Then
            returnvalue = 6

        ElseIf pattern.ToLower = "add on" Then
            returnvalue = 3

        ElseIf pattern.ToLower = "subtract off" Then
            returnvalue = 3
        ElseIf pattern.ToLower = "add and subtract" Then
            returnvalue = 5

        ElseIf pattern.ToLower = "subtract and add" Then
            returnvalue = 5

        ElseIf pattern.ToLower = "blink slow" Then
            returnvalue = 5
        ElseIf pattern.ToLower = "blink fast" Then
            returnvalue = 2


        ElseIf pattern.ToLower = "custom" Then
            returnvalue = 2

        Else
            MsgBox("error - unrecongized pattern sent to get_minlinesforpattern" + Constants.vbCrLf + "please report this bug")
        End If

        Return returnvalue
    End Function

    Private Function get_keywordallignmentforpattern(ByVal pattern As String, Optional ByVal keyword As String = "", Optional ByVal currentlines As Int16 = -1) As Mod_textboxfunctions.txtbox_alignment_type

        refresh_available_lines()

        'If pattern.ToLower = "(none)" Then
        'Return 0
        If pattern.ToLower = "still" Then
            Return Mod_textboxfunctions.txtbox_alignment_type._center
        ElseIf pattern.ToLower = "scroll left" Then

            Return Mod_textboxfunctions.txtbox_alignment_type._left
        ElseIf pattern.ToLower = "scroll right" Then
            Return Mod_textboxfunctions.txtbox_alignment_type._left
        ElseIf pattern.ToLower = "join in" Then

            Return Mod_textboxfunctions.txtbox_alignment_type._center


        ElseIf pattern.ToLower = "split out" Then
            Return Mod_textboxfunctions.txtbox_alignment_type._center

        ElseIf pattern.ToLower = "zoom in and out" Then
            Return Mod_textboxfunctions.txtbox_alignment_type._center

        ElseIf pattern.ToLower = "zoom out and in" Then
            Return Mod_textboxfunctions.txtbox_alignment_type._center

        ElseIf pattern.ToLower = "add on" Then

            Return Mod_textboxfunctions.txtbox_alignment_type._none

        ElseIf pattern.ToLower = "subtract off" Then
            Return Mod_textboxfunctions.txtbox_alignment_type._none

        ElseIf pattern.ToLower = "add and subtract" Then
            Return Mod_textboxfunctions.txtbox_alignment_type._none



            'Return 2 * jpstringsfunctions.discardwhitespace(keyword).Length - 1

        ElseIf pattern.ToLower = "subtract and add" Then
            Return Mod_textboxfunctions.txtbox_alignment_type._none
        ElseIf pattern.ToLower = "blink slow" Then
            Return Mod_textboxfunctions.txtbox_alignment_type._none

        ElseIf pattern.ToLower = "blink fast" Then

            Return Mod_textboxfunctions.txtbox_alignment_type._none

        ElseIf pattern.ToLower = "custom" Then
            Return availablelines - currentlines

        Else
            MsgBox("error - unrecongized pattern sent to get_keywordallignmentforpatterm()" + Constants.vbCrLf + "please report this bug")
        End If



    End Function






    Private Function get_defaultlinesforpattern(ByVal pattern As String, ByVal keyword As String, Optional ByVal currentlines As Int16 = -1) As Int16

        refresh_available_lines()

        'If pattern.ToLower = "(none)" Then
        'Return 0
        If pattern.ToLower = "still" Then
            Return 1
        ElseIf pattern.ToLower = "scroll left" Then
            Dim returnvalue As Int16 = settings(settingsindex.linelength) - keyword.Trim.Length + 1
            If currentlines <> -1 And returnvalue > currentlines + availablelines Then
                returnvalue = currentlines + availablelines
            End If
            Return returnvalue
        ElseIf pattern.ToLower = "scroll right" Then

            Dim returnvalue As Int16 = settings(settingsindex.linelength) - keyword.Trim.Length + 1
            If currentlines <> -1 And returnvalue > currentlines + availablelines Then
                returnvalue = currentlines + availablelines
            End If
            Return returnvalue
        ElseIf pattern.ToLower = "join in" Then
            Dim returnvalue As Int16 = settings(settingsindex.linelength) / 2

            If returnvalue * 2 > settings(settingsindex.linelength) Then
                'if rounded up then round down
                returnvalue -= 1
            End If
            If currentlines <> -1 And returnvalue > currentlines + availablelines Then
                returnvalue = currentlines + availablelines
            End If
            Return returnvalue


        ElseIf pattern.ToLower = "split out" Then
            Dim returnvalue As Int16 = settings(settingsindex.linelength) / 2

            If returnvalue * 2 > settings(settingsindex.linelength) Then
                'if rounded up then round down
                returnvalue -= 1
            End If

            If currentlines <> -1 And returnvalue > currentlines + availablelines Then
                returnvalue = currentlines + availablelines
            End If

            Return returnvalue

        ElseIf pattern.ToLower = "zoom in and out" Then
            Dim returnvalue As Int16 = settings(settingsindex.linelength)

            If currentlines <> -1 And returnvalue > currentlines + availablelines Then
                returnvalue = currentlines + availablelines
            End If

            If returnvalue Mod 2 = 1 Then
                'this pattern must have even number of lines
                returnvalue -= 1
            End If

            Return returnvalue

        ElseIf pattern.ToLower = "zoom out and in" Then
            Dim returnvalue As Int16 = settings(settingsindex.linelength)

            If currentlines <> -1 And returnvalue > currentlines + availablelines Then
                returnvalue = currentlines + availablelines
            End If

            If returnvalue Mod 2 = 1 Then
                'this pattern must have even number of lines
                returnvalue -= 1
            End If

            Return returnvalue

        ElseIf pattern.ToLower = "add on" Then

            'the rule for adding on chars is that the count of number of chars to add on starts with the first nonspace character
            'in this case we discard all space because we are determining to add one char at a time
            Dim returnvalue As Int16 = jpstringsfunctions.discardwhitespace(keyword).Length
            If currentlines <> -1 And returnvalue > currentlines + availablelines Then
                returnvalue = currentlines + availablelines
            End If

            Return returnvalue

        ElseIf pattern.ToLower = "subtract off" Then
            'rules parellel to add on
            Dim returnvalue As Int16 = jpstringsfunctions.discardwhitespace(keyword).Length
            If currentlines <> -1 And returnvalue > currentlines + availablelines Then
                returnvalue = currentlines + availablelines
            End If

            Return returnvalue

        ElseIf pattern.ToLower = "add and subtract" Then

            Dim returnvalue As Int16 = 2 * jpstringsfunctions.discardwhitespace(keyword).Length - 1
            If currentlines <> -1 And returnvalue > currentlines + availablelines Then
                returnvalue = currentlines + availablelines
            End If

            Return returnvalue


            'Return 2 * jpstringsfunctions.discardwhitespace(keyword).Length - 1

        ElseIf pattern.ToLower = "subtract and add" Then
            Dim returnvalue As Int16 = 2 * jpstringsfunctions.discardwhitespace(keyword).Length - 1
            If currentlines <> -1 And returnvalue > currentlines + availablelines Then
                returnvalue = currentlines + availablelines
            End If

            Return returnvalue

        ElseIf pattern.ToLower = "blink slow" Then
            Dim returnvalue As Int16 = 5
            If currentlines <> -1 And returnvalue > currentlines + availablelines Then
                returnvalue = currentlines + availablelines
            End If


            Return returnvalue
        ElseIf pattern.ToLower = "blink fast" Then

            Dim returnvalue As Int16 = 2
            If currentlines <> -1 And returnvalue > availablelines - currentlines Then
                returnvalue = availablelines
            End If


            Return returnvalue

        ElseIf pattern.ToLower = "custom" Then
            Return availablelines - currentlines

        Else
            MsgBox("error - unrecongized pattern sent to get_defaultlinesforpattern" + Constants.vbCrLf + "please report this bug")
        End If



    End Function

    Private Function get_maxlinesforpattern(ByVal pattern As String, ByVal keyword As String, Optional ByVal currentlines As Int16 = -1) As Int16
        keyword = jpstringsfunctions.truncateright(keyword, get_maxlinelengthforpattern(pattern)) 'if already short enough, no change

        refresh_available_lines()

        'If pattern.ToLower = "(none)" Then
        'Return 0
        If pattern.ToLower = "still" Then
            Return totallines
        ElseIf pattern.ToLower = "scroll left" Then
            'maximum value is moving one letter at a time
            'otherwise the current routine does some line doubling but is buggy in doing this
            Dim returnvalue As Int16 = settings(settingsindex.linelength) - keyword.TrimEnd.Length + 1
            If currentlines <> -1 And returnvalue > currentlines + availablelines Then
                returnvalue = currentlines + availablelines
            End If
            Return returnvalue
        ElseIf pattern.ToLower = "scroll right" Then

            Dim returnvalue As Int16 = settings(settingsindex.linelength) - keyword.TrimEnd.Length + 1
            If currentlines <> -1 And returnvalue > currentlines + availablelines Then
                returnvalue = currentlines + availablelines
            End If
            Return returnvalue
        ElseIf pattern.ToLower = "join in" Then
            Dim returnvalue As Int16 = settings(settingsindex.linelength) / 2

            If returnvalue * 2 > settings(settingsindex.linelength) Then
                'if rounded up then round down
                returnvalue -= 1
            End If

            If currentlines <> -1 And returnvalue > currentlines + availablelines Then
                returnvalue = currentlines + availablelines
            End If

            Return returnvalue

        ElseIf pattern.ToLower = "split out" Then
            Dim returnvalue As Int16 = settings(settingsindex.linelength) / 2

            If returnvalue * 2 > settings(settingsindex.linelength) Then
                'if rounded up then round down
                returnvalue -= 1
            End If
            If currentlines <> -1 And returnvalue > currentlines + availablelines Then
                returnvalue = currentlines + availablelines
            End If
            Return returnvalue

        ElseIf pattern.ToLower = "zoom in and out" Then
            Dim returnvalue As Int16 = settings(settingsindex.linelength)

            If currentlines <> -1 And returnvalue > currentlines + availablelines Then
                returnvalue = currentlines + availablelines
            End If

            If returnvalue Mod 2 = 1 Then
                'this pattern must have even number of lines
                returnvalue -= 1
            End If

            Return returnvalue

        ElseIf pattern.ToLower = "zoom out and in" Then
            Dim returnvalue As Int16 = settings(settingsindex.linelength)

            If currentlines <> -1 And returnvalue > currentlines + availablelines Then
                returnvalue = currentlines + availablelines
            End If

            If returnvalue Mod 2 = 1 Then
                'this pattern must have even number of lines
                returnvalue -= 1
            End If

            Return returnvalue

        ElseIf pattern.ToLower = "add on" Then
            Dim returnvalue = keyword.Trim.Length + 1

            If currentlines <> -1 And returnvalue > currentlines + availablelines Then
                returnvalue = currentlines + availablelines
            End If
            Return returnvalue

        ElseIf pattern.ToLower = "subtract off" Then
            Dim returnvalue = settings(settingsindex.linelength) + 1


            If currentlines <> -1 And returnvalue > currentlines + availablelines Then
                returnvalue = currentlines + availablelines
            End If
            Return returnvalue

        ElseIf pattern.ToLower = "add and subtract" Then
            Dim returnvalue As Int16 = 2 * (settings(settingsindex.linelength)) + 1
            If currentlines <> -1 And returnvalue > currentlines + availablelines Then
                returnvalue = currentlines + availablelines
            End If
            Return returnvalue

        ElseIf pattern.ToLower = "subtract and add" Then

            Dim returnvalue As Int16 = 2 * (settings(settingsindex.linelength)) + 1

            If currentlines <> -1 And returnvalue > currentlines + availablelines Then
                returnvalue = currentlines + availablelines
            End If
            Return returnvalue


        ElseIf pattern.ToLower = "blink slow" Then
            Dim returnvalue = availablelines
            While returnvalue Mod 5 <> 0
                returnvalue -= 1
            End While
            If currentlines <> -1 And returnvalue > currentlines + availablelines Then
                returnvalue = currentlines + availablelines
            End If
            Return returnvalue

        ElseIf pattern.ToLower = "blink fast" Then

            Dim returnvalue = availablelines
            While returnvalue Mod 2 <> 0
                returnvalue -= 1
            End While
            If currentlines <> -1 And returnvalue > currentlines + availablelines Then
                returnvalue = currentlines + availablelines
            End If
            Return returnvalue

        ElseIf pattern.ToLower = "custom" Then
            Return currentlines + availablelines

        Else
            MsgBox("error - unrecongized pattern sent to get_maxlinesforpattern" + Constants.vbCrLf + "please report this bug")
        End If






    End Function

    Private Function get_maxlinelengthforpattern(ByVal pattern As String, Optional ByVal keyword As String = "") As Int16
        'keyword is not used and was left as optional only to avoid modifying existing funtion calls

        refresh_available_lines()

        'If pattern.ToLower = "(none)" Then
        'Return 0
        If pattern.ToLower = "still" Then
            Return settings(settingsindex.linelength)
        ElseIf pattern.ToLower = "scroll left" Then


            Return settings(settingsindex.linelength) - 1
        ElseIf pattern.ToLower = "scroll right" Then

            Return settings(settingsindex.linelength) - 1
        ElseIf pattern.ToLower = "join in" Then
            Return settings(settingsindex.linelength)
        ElseIf pattern.ToLower = "split out" Then
            Return settings(settingsindex.linelength)
        ElseIf pattern.ToLower = "zoom in and out" Then
            Return settings(settingsindex.linelength)

        ElseIf pattern.ToLower = "zoom out and in" Then
            Return settings(settingsindex.linelength)

        ElseIf pattern.ToLower = "add on" Then
            Return settings(settingsindex.linelength)

        ElseIf pattern.ToLower = "subtract off" Then
            Return settings(settingsindex.linelength)
        ElseIf pattern.ToLower = "add and subtract" Then
            Return settings(settingsindex.linelength)

        ElseIf pattern.ToLower = "subtract and add" Then
            Return settings(settingsindex.linelength)

        ElseIf pattern.ToLower = "blink fast" Then
            Return settings(settingsindex.linelength)

        ElseIf pattern.ToLower = "blink slow" Then
            Return settings(settingsindex.linelength)

        ElseIf pattern.ToLower = "custom" Then
            Return settings(settingsindex.linelength)

        Else

            MsgBox("error - unrecongized pattern sent to get_maxlinelengthforpattern" + Constants.vbCrLf + "please report this bug")
            Return settings(settingsindex.linelength)
        End If

    End Function
    Private Function get_linescountstepforpattern(ByVal pattern As String, ByVal keyword As String) As Int16



        If pattern.ToLower = "(none)" Then
            Return 1
        ElseIf pattern.ToLower = "still" Then
            Return 1
        ElseIf pattern.ToLower = "scroll left" Then

            Return 1
        ElseIf pattern.ToLower = "scroll right" Then
            Return 1
        ElseIf pattern.ToLower = "join in" Then
            Return 1
        ElseIf pattern.ToLower = "split out" Then
            Return 1
        ElseIf pattern.ToLower = "zoom in and out" Then
            Return 2
        ElseIf pattern.ToLower = "zoom out and in" Then
            Return 2
        ElseIf pattern.ToLower = "add on" Then
            Return 1

        ElseIf pattern.ToLower = "subtract off" Then
            Return 1
        ElseIf pattern.ToLower = "add and subtract" Then
            Return 2

        ElseIf pattern.ToLower = "subtract and add" Then
            Return 2

        ElseIf pattern.ToLower = "blink slow" Then
            Return 5
        ElseIf pattern.ToLower = "blink fast" Then
            Return 2
        Else
            Return 1
        End If








    End Function

    Private Sub CBpattern_common_SelectedIndexChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles CBpattern00.SelectedIndexChanged, CBpattern09.SelectedIndexChanged, CBpattern08.SelectedIndexChanged, CBpattern07.SelectedIndexChanged, CBpattern06.SelectedIndexChanged, CBpattern05.SelectedIndexChanged, CBpattern04.SelectedIndexChanged, CBpattern03.SelectedIndexChanged, CBpattern02.SelectedIndexChanged, CBpattern01.SelectedIndexChanged


        Static previousvalues As ArrayList = New ArrayList
        Dim loopcounter As Int16 = 0
        If previousvalues.Count = 0 Then
            'this condition only happens the first time this event is called (durring form load)
            'the starting value of all 10 indexes is 0
            loopcounter = 0
            While loopcounter < 10

                previousvalues.Add(0)
                loopcounter += 1
            End While

        End If

        If Not formloaded Then
            'selection index change is trigered when the controll is loaded



            Return
        End If

        If databeinginternallymanipulated Then
            Return

        End If

        databeinginternallymanipulated = True



        'step1 set min and max lines for this key word bassed on selected pattern
        'step2 if selected lines is not within range change selection
        'step3 if the selected lines has changed then available lines and all other line count ranges need changing




        'eeprom/line data
        'Const EEpromspace As Int16 = 512

        'Dim EEpromconfigbytes As Int16 = 2 'linecount and line length
        'Dim EEpromreservedbytes As Int16 = 11 'valid aplication, memory map and 9 reserved
        'Dim EEpromtrickdata As Int16 = Me.trickdata.Count

        'Dim maxlines As Int16
        'Dim availableEEprom As Int16 = EEpromspace - EEpromconfigbytes - EEpromreservedbytes - EEpromtrickdata
        'If Me.settings(settingsindex.linelength) = 0 Then
        '    MsgBox("error linelentght = 0!")
        '    maxlines = availableEEprom / 1

        'Else
        '    maxlines = availableEEprom / Me.settings(settingsindex.linelength)
        'End If

        'Dim usedlines As Int16 = textdata.Count
        'Dim availablelines As Int16 = maxlines - usedlines


        refresh_available_lines()

        'info from sender 
        Dim pattern As String = combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(sender.SelectedIndex)) 'get the name of the enum matching the index, then convert to legacy diaplay because several other functions use 
        Dim index As String = sender.name.Substring(sender.name.Length - 2)



        combotab_refresh_keywordallignment(Convert.ToInt16(index))
        Dim keyword As String
        Dim oldselectedreps As Int16
        Dim oldselectedlines As Int16
        Dim newselectedlines As Int16
        Dim newselectedreps As Int16
        If index = "00" Then
            keyword = TBkw00.Text
            oldselectedreps = 1 'NUDreps00.Value
            oldselectedlines = NUDfc00.Value
        ElseIf index = "01" Then
            keyword = TBkw01.Text
            oldselectedreps = 1 'NUDreps01.Value
            oldselectedlines = NUDfc01.Value
        ElseIf index = "02" Then
            keyword = TBkw02.Text
            oldselectedreps = 1 'NUDreps02.Value
            oldselectedlines = NUDfc02.Value
        ElseIf index = "03" Then
            keyword = TBkw03.Text
            oldselectedlines = NUDfc03.Value
            oldselectedreps = 1 'NUDreps03.Value
        ElseIf index = "04" Then
            keyword = TBkw04.Text
            oldselectedlines = NUDfc04.Value
            oldselectedreps = 1 'NUDreps04.Value
        ElseIf index = "05" Then
            keyword = TBkw05.Text
            oldselectedlines = NUDfc05.Value
            oldselectedreps = 1 'NUDreps05.Value
        ElseIf index = "06" Then
            keyword = TBkw06.Text
            oldselectedlines = NUDfc06.Value
            oldselectedreps = 1
        ElseIf index = "07" Then
            keyword = TBkw07.Text
            oldselectedlines = NUDfc07.Value
            oldselectedreps = 1 'NUDreps07.Value
        ElseIf index = "08" Then
            keyword = TBkw08.Text
            oldselectedlines = NUDfc08.Value
            oldselectedreps = 1 'NUDreps08.Value
        ElseIf index = "09" Then

            keyword = TBkw09.Text
            oldselectedlines = NUDfc09.Value
            oldselectedreps = 1 'NUDreps09.Value

        End If


        Dim maxwordlength As Int16 = get_maxlinelengthforpattern(pattern, keyword)

        keyword = jpstringsfunctions.truncateright(keyword, maxwordlength) 'keyword has to be truncated BEFORE calculating other values


        Dim minlinesinpattern As Int16 = get_minlinesforpattern(pattern, keyword)
        Dim maxlinesinpattern As Int16 = get_maxlinesforpattern(pattern, keyword, oldselectedlines)
        Dim defaultlinesinpattern As Int16 = get_defaultlinesforpattern(pattern, keyword)
        Dim linestep As Int16 = get_linescountstepforpattern(pattern, keyword)

        If minlinesinpattern > availablelines Then

            databeinginternallymanipulated = False 'prevent watchdog timmer going off
            MsgBox("sorry, there are not sufficent available lines to select this pattern")


            databeinginternallymanipulated = True
            sender.selectedindex = previousvalues(Convert.ToInt16(index))
            databeinginternallymanipulated = False
            Return
        End If

        'keyword = jpstringsfunctions.truncateright(keyword, maxwordlength) 'truncate to maximum lenght which at time comment written was either line length or the current length of the keyword

        Dim oldtotallines As Int16 = oldselectedlines * oldselectedreps

        If maxlinesinpattern < minlinesinpattern Then
            MsgBox("error maxlines is less then min lines" + Constants.vbCrLf + "please report this bug")
            maxlinesinpattern = minlinesinpattern

        End If

        'comented out because if this situation is present then reps will be set to 0 below
        'If minlinesinpattern > availablelines + oldtotallines Then
        '    Dim message As String = "sorry, there are insufficent available lines to choose this display pattern"
        '    MsgBox(message)
        '    Return
        'End If

        If legacysettings(legacysettingsindex.showreps) = 0 Then
            'this is the code normaly executed
            newselectedreps = 1 ' constant value. this value is retained in regular mode to minimize rewriting code


            newselectedlines = Me.get_defaultlinesforpattern(pattern, keyword, oldselectedlines)

            


        ElseIf legacysettings(legacysettingsindex.showreps) = 1 Or legacysettings(legacysettingsindex.showreps) = 2 Then
            'this code was copied and pasted from an olderversion of tiniwindow and is only executed when in legacy mode

            'currently legacy mode is not supported. some infrastructer has been erected for future use but has not been tested
            'this code likey will be deleted because the only released copy of the junky version using it was given to pita bite


            Dim oldlinesvalid As Boolean

            If oldselectedlines < minlinesinpattern Then
                oldlinesvalid = False
            Else
                'deterine if old value falls with in min and step
                loopcounter = minlinesinpattern
                oldlinesvalid = False
                While loopcounter <= maxlinesinpattern
                    If loopcounter = oldselectedlines Then
                        oldlinesvalid = True
                    End If
                    loopcounter += linestep
                End While

            End If

            If Not oldlinesvalid Then
                'attempt to use the same total lines (lines times reps)


                Dim loopcounter_lines As Int16 = minlinesinpattern
                Dim loopcounter_reps As Int16 = 0

                While loopcounter_lines < oldselectedlines And loopcounter_lines < maxlinesinpattern
                    loopcounter_reps = 0
                    While loopcounter_lines * loopcounter_reps < oldtotallines


                        loopcounter_reps += 1

                    End While
                    If loopcounter_lines * loopcounter_reps = oldtotallines Then
                        Exit While
                    End If

                    loopcounter_lines += linestep
                End While

                If loopcounter_lines * loopcounter_reps = oldtotallines Then
                    'use the values from the loop which will have the lowest lines that can be multipled by reps to match old total lines
                    newselectedlines = loopcounter_lines
                    newselectedreps = loopcounter_reps
                ElseIf oldtotallines <= maxlinesinpattern And oldtotallines >= minlinesinpattern Then
                    'set the number of lines to the old total lines (or the closest valid cosidirng min and step) and the reps to 1


                    'determine id oldtotallines conforms to min and step
                    loopcounter = minlinesinpattern
                    Dim addvalue As Int16 = 0
                    Dim newvalueset As Boolean = False


                    'if the exact old linecount doesnt work, subtract 1 then add1 then subtract 2 then add2 etc

                    While Not newvalueset

                        While loopcounter <= maxlinesinpattern
                            If loopcounter = oldtotallines + addvalue Then
                                newvalueset = True
                                newselectedlines = loopcounter
                            End If
                            loopcounter += linestep
                        End While

                        If addvalue = 0 Then
                            addvalue = -1
                        ElseIf addvalue < 0 Then
                            addvalue = -addvalue
                        ElseIf addvalue > 0 Then
                            addvalue = -addvalue - 1
                        Else
                            MsgBox("error in loop")
                            Exit While
                        End If

                    End While

                    If Not newvalueset Then
                        MsgBox("error new value not set in loop for setting single rep total line count in pattern selection change event")
                    End If

                    newselectedreps = 1



                Else
                    'most complicated scenario
                    'all attemps to match old total lines failed

                    'set the lines to the minimum for pattern and use the old reps
                    'however if this would cause a EEprom overflow reduce number of reps
                    'if neccesary go to 0 reps

                    newselectedlines = minlinesinpattern
                    newselectedreps = oldselectedreps
                    While (newselectedlines * newselectedreps > (availablelines - oldtotallines))


                        newselectedreps -= 1

                        If newselectedreps < 0 Then
                            MsgBox("bug - newselectedreps < 0 in loop in  patternchange function ")
                            newselectedreps = 0
                            Exit While
                        End If
                    End While



                End If
            Else



                newselectedlines = oldselectedlines
                newselectedreps = oldselectedreps
            End If




            'If maxlinesinpattern * oldselectedreps > availablelines Then
            '    maxlinesinpattern = availablelines / oldselectedreps
            'End If


        Else
            MsgBox("invalid value for legaxysettings(showreps) in patern selected index change")
        End If



        'remember in setting the minimum value for the numeric up down controlls 
        'that this value should be one line step below the actual minimum value for the pattern
        'the reson for this is that the value change event uses a hack to set the value to 0 when this value is clicked to

        If index = "00" Then

            'oldselectedlines = NUDfc00.Value
            'NUDfc00.Minimum = minlinesinpattern
            NUDfc00.Maximum = maxlinesinpattern
            NUDfc00.Increment = linestep

            NUDfc00.Minimum = minlinesinpattern - linestep
            NUDfc00.Value = newselectedlines

            'NUDreps00.Value = newselectedreps


        ElseIf index = "01" Then
            'oldselectedlines = NUDfc01.Value
            'NUDfc01.Minimum = minlinesinpattern
            NUDfc01.Maximum = maxlinesinpattern
            NUDfc01.Increment = linestep

            NUDfc01.Minimum = minlinesinpattern - linestep
            NUDfc01.Value = newselectedlines

            'NUDreps01.Value = newselectedreps

        ElseIf index = "02" Then
            'oldselectedlines = NUDfc02.Value
            'NUDfc02.Minimum = minlinesinpattern
            NUDfc02.Maximum = maxlinesinpattern
            NUDfc02.Increment = linestep
            NUDfc02.Minimum = minlinesinpattern - linestep
            NUDfc02.Value = newselectedlines

            'NUDreps02.Value = newselectedreps

        ElseIf index = "03" Then
            'oldselectedlines = NUDfc03.Value
            'NUDfc03.Minimum = minlinesinpattern
            NUDfc03.Maximum = maxlinesinpattern
            NUDfc03.Increment = linestep
            NUDfc03.Minimum = minlinesinpattern - linestep
            NUDfc03.Value = newselectedlines

            'NUDreps03.Value = newselectedreps

        ElseIf index = "04" Then
            'oldselectedlines = NUDfc04.Value
            'NUDfc04.Minimum = minlinesinpattern
            NUDfc04.Maximum = maxlinesinpattern
            NUDfc04.Increment = linestep

            NUDfc04.Minimum = minlinesinpattern - linestep
            NUDfc04.Value = newselectedlines

            'NUDreps04.Value = newselectedreps

        ElseIf index = "05" Then

            'oldselectedlines = NUDfc05.Value
            'NUDfc05.Minimum = minlinesinpattern
            NUDfc05.Maximum = maxlinesinpattern
            NUDfc05.Increment = linestep

            NUDfc05.Minimum = minlinesinpattern - linestep
            NUDfc05.Value = newselectedlines

            'NUDreps05.Value = newselectedreps

        ElseIf index = "06" Then

            'oldselectedlines = NUDfc06.Value
            'NUDfc06.Minimum = minlinesinpattern
            NUDfc06.Maximum = maxlinesinpattern
            NUDfc06.Increment = linestep

            NUDfc06.Minimum = minlinesinpattern - linestep
            NUDfc06.Value = newselectedlines

            ''NUDreps06.Value = newselectedreps

        ElseIf index = "07" Then
            'oldselectedlines = NUDfc07.Value
            'NUDfc07.Minimum = minlinesinpattern
            NUDfc07.Maximum = maxlinesinpattern
            NUDfc07.Increment = linestep

            NUDfc07.Minimum = minlinesinpattern - linestep
            NUDfc07.Value = newselectedlines

            'NUDreps07.Value = newselectedreps

        ElseIf index = "08" Then
            'oldselectedlines = NUDfc08.Value
            'NUDfc08.Minimum = minlinesinpattern
            NUDfc08.Maximum = maxlinesinpattern


            NUDfc08.Increment = linestep
            NUDfc08.Minimum = minlinesinpattern - linestep
            NUDfc08.Value = newselectedlines

            'NUDreps08.Value = newselectedreps


        ElseIf index = "09" Then
            'oldselectedlines = NUDfc09.Value
            'NUDfc09.Minimum = minlinesinpattern
            NUDfc09.Maximum = maxlinesinpattern

            NUDfc09.Minimum = minlinesinpattern - linestep
            NUDfc09.Increment = linestep
            NUDfc09.Value = newselectedlines
            'NUDreps09.Value = newselectedreps

        End If



        If combotab_generatelines() Then

            databeinginternallymanipulated = False
            combotab_refreshlinedata()
            previousvalues(Convert.ToInt16(index)) = sender.selectedindex

            Return

        Else

            databeinginternallymanipulated = False
            MsgBox("error generating lines - please report this bug")
            sender.selectedindex = previousvalues(Convert.ToInt16(index))

            Return

        End If

    End Sub










    Private Function combotab_generatepattern(ByVal pattern As String, ByVal keyword As String, ByVal lines As Int16, ByVal reps As Int16) As ArrayList

        If lines = 0 Then
            Return New ArrayList
        End If

        Dim loopcounter As Int16 = 0
        Dim onerep As ArrayList = New ArrayList
        Dim returnvalue As ArrayList = New ArrayList

        If pattern.ToLower = "(none)" Then
            Return New ArrayList

        ElseIf pattern.ToLower = "scroll left" Then
            onerep = combotab_generatepattern_scrollleft(keyword, lines)
        ElseIf pattern.ToLower = "scroll right" Then
            onerep = combotab_generatepattern_scrollright(keyword, lines)
        ElseIf pattern.ToLower = "still" Then
            onerep = combotab_generatepattern_still(keyword, lines)
        ElseIf pattern.ToLower = "add on" Then
            onerep = combotab_generatepattern_addon(keyword, lines)
        ElseIf pattern.ToLower = "subtract off" Then
            onerep = combotab_generatepattern_subtractoff(keyword, lines)
        ElseIf pattern.ToLower = "add and subtract" Then
            onerep = combotab_generatepattern_addandsubtract(keyword, lines)
        ElseIf pattern.ToLower = "subtract and add" Then
            onerep = combotab_generatepattern_subtractandadd(keyword, lines)
        ElseIf pattern.ToLower = "split out" Then
            onerep = combotab_generatepattern_splitout(keyword, lines)
        ElseIf pattern.ToLower = "join in" Then
            onerep = combotab_generatepattern_joinin(keyword, lines)
        ElseIf pattern.ToLower = "zoom in and out" Then
            onerep = combotab_generatepattern_zoom_in_and_out(keyword, lines)
        ElseIf pattern.ToLower = "zoom out and in" Then
            onerep = combotab_generatepattern_zoom_out_and_in(keyword, lines)
        ElseIf pattern.ToLower = "blink fast" Then
            onerep = combotab_generatepattern_blinkfast(keyword, lines)

        ElseIf pattern.ToLower = "blink slow" Then
            onerep = combotab_generatepattern_blinkslow(keyword, lines)

        Else
            MsgBox("pattern not yet implimented")
            'ElseIf pattern.ToLower = "(none)" Then
            'ElseIf pattern.ToLower = "(none)" Then
            'ElseIf pattern.ToLower = "(none)" Then
            'ElseIf pattern.ToLower = "(none)" Then
            'ElseIf pattern.ToLower = "(none)" Then

            Return returnvalue
        End If

        While loopcounter < reps
            returnvalue.AddRange(onerep)
            loopcounter += 1
        End While
        Return returnvalue
    End Function
    Private Function combotab_generatelines() As Boolean

        'If Not formloaded Then
        '    Return
        'End If
        Dim newtextdata As ArrayList = New ArrayList
        newtextdata.Clear()

        Dim singlepatternholder As ArrayList = New ArrayList


        Dim keyword As String
        Dim pattern As String
        Dim lines As Int16
        Dim reps As Int16


        keyword = TBkw00.Text

        '''
        pattern = combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern00.SelectedIndex))
        lines = NUDfc00.Value
        reps = 1 'NUDreps00.Value

        newtextdata.AddRange(combotab_generatepattern(pattern, keyword, lines, reps))


        keyword = TBkw01.Text
        pattern = combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern01.SelectedIndex))
        lines = NUDfc01.Value
        reps = 1 'NUDreps01.Value
        newtextdata.AddRange(combotab_generatepattern(pattern, keyword, lines, reps))


        keyword = TBkw02.Text
        pattern = combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern02.SelectedIndex))
        lines = NUDfc02.Value
        reps = 1 'NUDreps02.Value
        newtextdata.AddRange(combotab_generatepattern(pattern, keyword, lines, reps))

        keyword = TBkw03.Text
        pattern = combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern03.SelectedIndex))
        lines = NUDfc03.Value
        reps = 1 'NUDreps03.Value
        newtextdata.AddRange(combotab_generatepattern(pattern, keyword, lines, reps))

        keyword = TBkw04.Text
        pattern = combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern04.SelectedIndex))
        lines = NUDfc04.Value
        reps = 1 'NUDreps04.Value
        newtextdata.AddRange(combotab_generatepattern(pattern, keyword, lines, reps))

        keyword = TBkw05.Text
        pattern = combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern05.SelectedIndex))
        lines = NUDfc05.Value
        reps = 1 'NUDreps05.Value
        newtextdata.AddRange(combotab_generatepattern(pattern, keyword, lines, reps))

        keyword = TBkw06.Text
        pattern = combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern06.SelectedIndex))
        lines = NUDfc06.Value
        reps = 1 ''NUDreps06.Value
        newtextdata.AddRange(combotab_generatepattern(pattern, keyword, lines, reps))

        keyword = TBkw07.Text
        pattern = combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern07.SelectedIndex))
        lines = NUDfc07.Value
        reps = 1 'NUDreps07.Value
        newtextdata.AddRange(combotab_generatepattern(pattern, keyword, lines, reps))

        keyword = TBkw08.Text
        pattern = combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern08.SelectedIndex))
        lines = NUDfc08.Value
        reps = 1 'NUDreps08.Value
        newtextdata.AddRange(combotab_generatepattern(pattern, keyword, lines, reps))

        keyword = TBkw09.Text
        pattern = combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern09.SelectedIndex))
        lines = NUDfc09.Value
        reps = 1 'NUDreps09.Value
        newtextdata.AddRange(combotab_generatepattern(pattern, keyword, lines, reps))


        Const EEpromspace As Int16 = 512

        Dim EEpromconfigbytes As Int16 = 2 'linecount and line length
        Dim EEpromreservedbytes As Int16 = 11 'valid aplication, memory map and 9 reserved
        Dim EEpromtrickdata As Int16 = trickdata.Count

        Dim maxlines As Int16
        Dim availableEEprom As Int16 = EEpromspace - EEpromconfigbytes - EEpromreservedbytes - EEpromtrickdata
        If settings(settingsindex.linelength) = 0 Then
            MsgBox("error linelentght = 0!")
            maxlines = availableEEprom / 1

        Else
            maxlines = availableEEprom / settings(settingsindex.linelength)
        End If

        If newtextdata.Count > maxlines Then
            Return False

        Else

            If newtextdata.Count = 0 Then
                'tiniwindow gets out of kilter if linelineth is 0
                'therfore add a blank line
                newtextdata.Add(jpstringsfunctions.padright(" ", " ", settings(settingsindex.linelength)))

            End If
            set_linecount(newtextdata.Count, line_configuration.add_or_truncate_position._end)
            textdata = newtextdata

            
            If Not tricks_set_activetrick(1) Then
                'this trick is rotate through lines
                MsgBox("error setting trick data in combotab_generatelines" + Constants.vbCrLf + "please report this bug")


                Return False
            End If

            If Not tricks_set_parameter(1, 1, (newtextdata.Count)) Then
                'specifies to rotate through all lines
                MsgBox("error setting trick parameter in combotab_generatelines")
                Return False
            End If


            Return True

        End If

    End Function

    Private Sub NUDfc_common_ValueChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles NUDfc09.ValueChanged, NUDfc08.ValueChanged, NUDfc07.ValueChanged, NUDfc06.ValueChanged, NUDfc05.ValueChanged, NUDfc04.ValueChanged, NUDfc03.ValueChanged, NUDfc02.ValueChanged, NUDfc01.ValueChanged, NUDfc00.ValueChanged

        If Not formloaded Then
            Return
        End If

        If databeinginternallymanipulated Then
            Return
        End If





        databeinginternallymanipulated = True

        If sender.tag - sender.increment = 0 Then

            'no adjustments needed. cooincidence allows 0 because it is one increment value below actual minimum lines


        ElseIf sender.value = -sender.increment Then
            'the way we use the minimum value as a flag could allow the user to set the reps one step below 0 without this condidition

            sender.value = 0
            databeinginternallymanipulated = False



        ElseIf sender.value = Convert.ToInt16(sender.tag) - sender.increment And sender.minimum <> -sender.increment Then
            'sender.value is one step less then the minimum lines. set value to 0
            sender.minimum = 0
            sender.value = 0
            sender.minimum = -sender.increment 'used as a flag so that on the way up next condition is used instead of this condition 


        ElseIf sender.value = sender.increment Then
            sender.value = Convert.ToInt16(sender.tag)
            sender.minimum = sender.value - sender.increment


        End If


        If combotab_generatelines() Then
            combotab_refreshlinedata()
        Else
            MsgBox("error generating lines in NUDfc_common_valuechanged() " + Constants.vbCrLf + "please report this bug")

        End If
        'combotab_refreshlinedata()

        change = True
        databeinginternallymanipulated = False

    End Sub

    
    Private Function combotab_maxlinelength(ByVal index As String) As Int16
        'some functions store the index as a 2 character string of digits
        Return combotab_maxlinelength(Convert.ToInt16(index))

    End Function
    Private Function combotab_maxlinelength(ByVal index As Int16) As Int16


        Dim pattern As String
        Dim keyword As String
        If index = 0 Then
            keyword = TBkw00.Text
            pattern = combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern00.SelectedIndex)) 'CBpattern00.Text
        ElseIf index = 1 Then
            keyword = TBkw01.Text
            pattern = combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern00.SelectedIndex)) 'CBpattern01.Text
        ElseIf index = 2 Then
            pattern = combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern00.SelectedIndex)) 'CBpattern02.Text
            keyword = TBkw02.Text
        ElseIf index = 3 Then
            pattern = combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern00.SelectedIndex)) 'CBpattern03.Text
            keyword = TBkw03.Text
        ElseIf index = 4 Then
            pattern = combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern00.SelectedIndex)) ' CBpattern04.Text
            keyword = TBkw04.Text
        ElseIf index = 5 Then
            pattern = combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern00.SelectedIndex)) ' CBpattern05.Text
            keyword = TBkw05.Text
        ElseIf index = 6 Then
            pattern = combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern00.SelectedIndex)) 'CBpattern06.Text
            keyword = TBkw06.Text
        ElseIf index = 7 Then
            pattern = combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern00.SelectedIndex)) 'CBpattern07.Text
            keyword = TBkw07.Text
        ElseIf index = 8 Then
            pattern = CBpattern08.Text
            keyword = combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern00.SelectedIndex)) 'TBkw08.Text
        ElseIf index = 9 Then
            pattern = combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern00.SelectedIndex)) 'CBpattern09.Text
            keyword = TBkw09.Text
        End If
        Return Me.get_maxlinelengthforpattern(pattern, keyword)

    End Function
    Private Sub TBkw00_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles TBkw08.TextChanged, TBkw07.TextChanged, TBkw06.TextChanged, TBkw05.TextChanged, TBkw04.TextChanged, TBkw03.TextChanged, TBkw02.TextChanged, TBkw01.TextChanged, TBkw00.TextChanged, TBkw09.TextChanged
        If databeinginternallymanipulated Then
            Return
        End If

        Static Dim previous_strings As ArrayList = New ArrayList
        'Static Dim recursive As Boolean = False
        If previous_strings.Count <> 10 Then
            'the only time this condidition should exist is the first time the textchange event is called

            previous_strings = New ArrayList
            previous_strings.Add(TBkw00.Text)
            previous_strings.Add(TBkw01.Text)
            previous_strings.Add(TBkw02.Text)
            previous_strings.Add(TBkw03.Text)
            previous_strings.Add(TBkw04.Text)
            previous_strings.Add(TBkw05.Text)
            previous_strings.Add(TBkw06.Text)
            previous_strings.Add(TBkw07.Text)
            previous_strings.Add(TBkw08.Text)
            previous_strings.Add(TBkw09.Text)

        End If



        Static previoustextblank As ArrayList = New ArrayList 'of booleans
        Static returnlinecount As ArrayList = New ArrayList 'of int16 'if the user deletes text and then immediately types new text it should restore the line same count

        Dim startinglength As Int16 = sender.Text.Length 'used if change is reversed

        If previoustextblank.Count = 0 Then
            Dim loopcounter As Int16 = 0
            While loopcounter < 10
                previoustextblank.Add(True)

                loopcounter += 1
            End While

        End If

        If returnlinecount.Count = 0 Then
            Dim loopcounter As Int16 = 0
            While loopcounter < 10
                returnlinecount.Add(1)
                loopcounter += 1
            End While

        End If

        If Not formloaded Then
            Return
        End If
        Static recursive As Boolean = False

        If recursive Then
            Return

        End If
        recursive = True

        Dim str As String = ""
        'str.ToUpper()

        Dim cursor_pos As Integer = sender.SelectionStart


        sender.text = sender.text.ToUpper()

        Dim sendername As String = sender.name
        Dim senderindex As Int16 = Convert.ToInt16(sendername.Substring(sendername.Length - 2))






        sender.SelectionStart = cursor_pos 'the allignment function require the cursor start out correct in order to reset it correctly
        combotab_refresh_keywordallignment(senderindex)
        cursor_pos = sender.SelectionStart 'the cursor postition changes with allignment
        If keywordexceedlinelength(senderindex) = False Then 'arraylist not function

            If sender.text.trim.length > Me.combotab_maxlinelength(senderindex) Then

                sender.text = previous_strings(senderindex)
                sender.SelectionStart = cursor_pos - (startinglength - sender.Text.Length)
                Beep()
                recursive = False
                Return
            End If
        End If




        'make reps 0 if blank or 1 otherwise
        If sender.text = "" And Not previoustextblank(senderindex) Then

            If senderindex >= 10 Then

                'should not happen in this version of tiniwindow
                MsgBox("index error in text change event")
            ElseIf senderindex = 0 Then

                returnlinecount(0) = NUDfc00.Value
                NUDfc00.Value = NUDfc00.Minimum 'this is a hack. the minimumvalue is one increment less then the min lines for pattern
                'the valuechange event will change the value to 0

                previoustextblank(senderindex) = True

            ElseIf senderindex = 1 Then

                returnlinecount(senderindex) = NUDfc01.Value
                NUDfc01.Value = NUDfc01.Minimum 'this is a hack. the minimumvalue is one increment less then the min lines for pattern
                'the valuechange event will change the value to 0

                previoustextblank(senderindex) = True
            ElseIf senderindex = 2 Then

                returnlinecount(senderindex) = NUDfc02.Value
                NUDfc02.Value = NUDfc02.Minimum 'this is a hack. the minimumvalue is one increment less then the min lines for pattern
                'the valuechange event will change the value to 0

                previoustextblank(senderindex) = True
            ElseIf senderindex = 3 Then

                returnlinecount(senderindex) = NUDfc03.Value
                NUDfc03.Value = NUDfc03.Minimum 'this is a hack. the minimumvalue is one increment less then the min lines for pattern
                'the valuechange event will change the value to 0

                previoustextblank(senderindex) = True
            ElseIf senderindex = 4 Then

                returnlinecount(senderindex) = NUDfc04.Value
                NUDfc04.Value = NUDfc04.Minimum 'this is a hack. the minimumvalue is one increment less then the min lines for pattern
                'the valuechange event will change the value to 0

                previoustextblank(senderindex) = True
            ElseIf senderindex = 5 Then

                returnlinecount(senderindex) = NUDfc05.Value
                NUDfc05.Value = NUDfc05.Minimum 'this is a hack. the minimumvalue is one increment less then the min lines for pattern
                'the valuechange event will change the value to 0

                previoustextblank(senderindex) = True
            ElseIf senderindex = 6 Then

                returnlinecount(senderindex) = NUDfc06.Value
                NUDfc06.Value = NUDfc06.Minimum 'this is a hack. the minimumvalue is one increment less then the min lines for pattern
                'the valuechange event will change the value to 0

                previoustextblank(senderindex) = True
            ElseIf senderindex = 7 Then

                returnlinecount(senderindex) = NUDfc07.Value
                NUDfc07.Value = NUDfc07.Minimum 'this is a hack. the minimumvalue is one increment less then the min lines for pattern
                'the valuechange event will change the value to 0

                previoustextblank(senderindex) = True
            ElseIf senderindex = 8 Then

                returnlinecount(senderindex) = NUDfc08.Value
                NUDfc08.Value = NUDfc08.Minimum 'this is a hack. the minimumvalue is one increment less then the min lines for pattern
                'the valuechange event will change the value to 0

                previoustextblank(senderindex) = True
            ElseIf senderindex = 9 Then

                returnlinecount(senderindex) = NUDfc09.Value
                NUDfc09.Value = NUDfc09.Minimum 'this is a hack. the minimumvalue is one increment less then the min lines for pattern
                'the valuechange event will change the value to 0

                previoustextblank(senderindex) = True




            End If

        ElseIf previoustextblank(senderindex) Then
            If senderindex >= 10 Then
                'should not happen in this version of tiniwindow
            ElseIf senderindex = 0 Then

                If NUDfc00.Value = 0 Then

                    If returnlinecount(senderindex) - NUDfc00.Value > availablelines Then
                        NUDfc00.Value += availablelines
                    Else
                        NUDfc00.Value = returnlinecount(senderindex)
                    End If

                End If
                previoustextblank(senderindex) = False

            ElseIf senderindex = 1 Then


                If NUDfc01.Value = 0 Then
                    If returnlinecount(senderindex) - NUDfc01.Value > availablelines Then
                        NUDfc01.Value += availablelines
                    Else
                        NUDfc01.Value = returnlinecount(senderindex)
                    End If
                End If
                previoustextblank(senderindex) = False
            ElseIf senderindex = 2 Then


                If NUDfc02.Value = 0 Then
                    If returnlinecount(senderindex) - NUDfc02.Value > availablelines Then
                        NUDfc02.Value += availablelines
                    Else
                        NUDfc02.Value = returnlinecount(senderindex)
                    End If

                End If
                previoustextblank(senderindex) = False
            ElseIf senderindex = 3 Then


                If NUDfc03.Value = 0 Then
                    If returnlinecount(senderindex) - NUDfc03.Value > availablelines Then
                        NUDfc03.Value += availablelines
                    Else
                        NUDfc03.Value = returnlinecount(senderindex)
                    End If

                End If
                previoustextblank(senderindex) = False
            ElseIf senderindex = 4 Then


                If NUDfc04.Value = 0 Then
                    If returnlinecount(senderindex) - NUDfc04.Value > availablelines Then
                        NUDfc04.Value += availablelines
                    Else
                        NUDfc04.Value = returnlinecount(senderindex)
                    End If

                End If
                previoustextblank(senderindex) = False
            ElseIf senderindex = 5 Then


                If NUDfc05.Value = 0 Then
                    If returnlinecount(senderindex) - NUDfc05.Value > availablelines Then
                        NUDfc05.Value += availablelines
                    Else
                        NUDfc05.Value = returnlinecount(senderindex)
                    End If

                End If
                previoustextblank(senderindex) = False
            ElseIf senderindex = 6 Then


                If NUDfc06.Value = 0 Then

                    If returnlinecount(senderindex) - NUDfc06.Value > availablelines Then
                        NUDfc06.Value += availablelines
                    Else
                        NUDfc06.Value = returnlinecount(senderindex)
                    End If


                End If
                previoustextblank(senderindex) = False
            ElseIf senderindex = 7 Then


                If NUDfc07.Value = 0 Then
                    If returnlinecount(senderindex) - NUDfc07.Value > availablelines Then
                        NUDfc07.Value += availablelines
                    Else
                        NUDfc07.Value = returnlinecount(senderindex)
                    End If

                End If
                previoustextblank(senderindex) = False
            ElseIf senderindex = 8 Then


                If NUDfc08.Value = 0 Then
                    If returnlinecount(senderindex) - NUDfc08.Value > availablelines Then
                        NUDfc08.Value += availablelines
                    Else
                        NUDfc08.Value = returnlinecount(senderindex)
                    End If

                End If
                previoustextblank(senderindex) = False
            ElseIf senderindex = 9 Then


                If NUDfc09.Value = 0 Then
                    If returnlinecount(senderindex) - NUDfc09.Value > availablelines Then
                        NUDfc09.Value += availablelines
                    Else
                        NUDfc09.Value = returnlinecount(senderindex)
                    End If
                End If
                previoustextblank(senderindex) = False

            End If



        End If



        combotab_generatelines()
        sender.SelectionStart = cursor_pos

        combotab_refreshlinedata()

        previous_strings(senderindex) = sender.text
        change = True
        recursive = False


    End Sub



    Private Function combotabpatterns_indexvaluetoindexname(ByVal indexvalue) As String
        Dim returnvalue As String = System.Enum.GetName(GetType(combotab_patterns), indexvalue)


        Return returnvalue
    End Function



    Private Function combotabpatterns_indexnametoindexvalue(ByVal indexname As String) As Int16

        Dim convertedindexname As String = combotabpatterns_indexname_anyformattodataformat(indexname)
        Dim returnvalue As Int16 = System.Enum.Parse(GetType(combotab_patterns), convertedindexname)
        Return returnvalue


    End Function

    Private Function combotabpatterns_indexname_anyformattodataformat(ByVal indexname As String) As String
        'returnvalue has  all letters lowercase and spaces replaced by underscore
        'no leading or trailing doublescores
        'no repeating doublescores

        'the format passed most likey represents format appearing in the combobox and may very depending on TiniWindow version but format used internaly and in files must remain constant for compatibility

        Dim returnvalue As String = indexname
        'replace spaces and make lowercase

        returnvalue = returnvalue.Trim  'remove any leading or trailing spaces
        returnvalue = returnvalue.Replace(" & ", " and ")
        returnvalue = returnvalue.Replace(" ", "_") ' replace spaces with undersocres

        returnvalue = returnvalue.ToLower() 'make lowercase
        returnvalue = (jpstringsfunctions.removeduplicatechars(returnvalue, "_")) 'remove any duplicare underscores




        Return returnvalue
    End Function
    '''''''''''''''''''''''''''''''''''''current display patterms
    Private Function combotab_generatepattern_still(ByVal keyword As String, ByVal lines As Int16) As ArrayList
        Dim returnvalue As ArrayList = New ArrayList
        Dim loopcounter As Int16 = 0
        'If keyword.Length > settings(settingsindex.linelength) Then
        '    MsgBox("error keyword for still pattern can not exceed the length of the sign")
        '    Return returnvalue
        'End If

        If keyword.Length > settings(settingsindex.linelength) Then
            keyword = keyword.Remove(settings(settingsindex.linelength)) 'truncate to linelength
        End If

        While loopcounter < lines
            returnvalue.Add(keyword.PadRight(settings(settingsindex.linelength)))
            loopcounter += 1
        End While
        Return returnvalue
    End Function

    'zoom_in_and_out
    Private Function combotab_generatepattern_zoom_out_and_in(ByVal keyword As String, ByVal lines As Int16) As ArrayList

        'This numer of lines must be an even number for this function to work
        'should be enforced on the user

        Dim returnvalue As ArrayList

        returnvalue = combotab_generatepattern_joinin(keyword, lines / 2)

        returnvalue.AddRange(combotab_generatepattern_splitout(keyword, lines / 2))
        Return returnvalue

    End Function
    Private Function combotab_generatepattern_zoom_in_and_out(ByVal keyword As String, ByVal lines As Int16) As ArrayList

        'This numer of lines must be an even number for this function to work
        'should be enforced on the user

        Dim returnvalue As ArrayList

        returnvalue = combotab_generatepattern_joinin(keyword, lines / 2)

        returnvalue.AddRange(combotab_generatepattern_splitout(keyword, lines / 2))
        Return returnvalue

    End Function
    Private Function combotab_generatepattern_addon(ByVal keyword As String, ByVal lines As Int16) As ArrayList

        Dim returnvalue As ArrayList = New ArrayList
        Dim loopcounter As Int16 = 0


        If keyword.Trim = "" Then
            'specail condition to prevent errors
            While loopcounter < lines
                returnvalue.Add(Me.jpstringsfunctions.padright(" ", " ", settings(settingsindex.linelength)))
                loopcounter += 1
            End While

            Return returnvalue

        End If



        Dim leadingspacecount As Int16 = jpstringsfunctions.leftcharatercount(keyword, " ")
        keyword = keyword.Trim
        Dim nonblanklinecount = lines 'since I removed blank lines this is identicle to lines

        'Dim letteradd As Int16 = keyword.Length / nonblanklinecount


        Dim segmentlength_allbutlast As Int16
        Dim segmentlength_last


        'the rule for adding on chars is that the count of number of chars to add on starts with the first nonspace character

        'determine the length of each add on segment
        'I want to as close as posible to an even division

        'the rule for adding chars makes things complicated.

        Dim ratios As ArrayList = New ArrayList 'of singles. this stores the ratio of most segments to the last segment
        Dim lengthdoesntwork As Boolean = False

        'segmentlength_allbutlast = Math.Truncate(Convert.ToSingle(keyword.Length) / Convert.ToSingle((nonblanklinecount - 1)))

        segmentlength_allbutlast = keyword.Length 'start with a rediculously high value that usually doesnt work (and will be weeded out below)  but saves figuring out why calculation above is wrong


        While segmentlength_allbutlast - loopcounter > 0
            Dim tempword As String = keyword
            Dim linecounter As Int16 = 0
            While linecounter < nonblanklinecount - 1
                Dim lettercounter As Int16 = 0
                While lettercounter < segmentlength_allbutlast - loopcounter

                    If tempword = "" Then
                        lengthdoesntwork = True
                        Exit While
                    End If
                    tempword = tempword.TrimStart()
                    If tempword = "" Then
                        lengthdoesntwork = True
                        Exit While
                    End If
                    tempword = tempword.Substring(1)

                    lettercounter += 1

                End While

                If lengthdoesntwork Or tempword.TrimStart.Length = 0 Then

                    lengthdoesntwork = True 'has to be specified here in case second half of codition is trigger

                    Exit While
                End If

                linecounter += 1

                If lengthdoesntwork Then

                    Exit While

                End If
            End While



            If lengthdoesntwork Then
                ratios.Add(100) ' a really high ratio that will be rejected 
                lengthdoesntwork = False

            ElseIf linecounter = nonblanklinecount - 1 Then 'nature of looping makes this one less

                segmentlength_last = tempword.TrimStart.Length

                If (segmentlength_allbutlast - loopcounter) > segmentlength_last Then

                    ratios.Add((segmentlength_allbutlast - loopcounter) - segmentlength_last)

                Else

                    ratios.Add(segmentlength_last - (segmentlength_allbutlast - loopcounter))

                End If

            Else
                MsgBox("error linecounter = " & linecounter & " and should = " & nonblanklinecount)

            End If

            loopcounter += 1

        End While

        If ratios.Count <> segmentlength_allbutlast Then
            MsgBox("error with ratio count in generate addon function: " & ratios.Count)
            Return New ArrayList

        End If
        Dim selected_ratio_index As Int16 = 0
        Dim selected_ratio = 100
        loopcounter = 0

        ratios.Reverse()
        While loopcounter < ratios.Count

            If ratios(loopcounter) < selected_ratio Then
                selected_ratio_index = loopcounter
                selected_ratio = ratios(loopcounter)
            End If

            loopcounter += 1

        End While

        segmentlength_allbutlast = selected_ratio_index + 1 'index 0 refers to segment length 1 etc


        loopcounter = 0



        'returnvalue.Add(" ".PadRight(settings(settingsindex.linelength))) ' (used to) start with 1 blank line

        loopcounter = 0

        Dim keywordcopy As String = keyword
        Dim thisline As String = jpstringsfunctions.padleft(" ", " ", leadingspacecount) 'start out with leading spaces and add letters each time 


        While loopcounter < nonblanklinecount - 1
            thisline = thisline.Trim
            'has to be written this way because first time through loop trims to null string
            thisline = jpstringsfunctions.padleft(thisline, " ", thisline.Length + leadingspacecount)

            Dim firstnonspaceencountered As Boolean = False

            Dim lettercounter As Int16 = 0
            While lettercounter < segmentlength_allbutlast
                If (keywordcopy = "") Then
                    'this happens if the funtion is passed a keyword / linecount combo that doesnt work
                    'the previous iterations of the loop added one char at a time

                    lengthdoesntwork = True

                    Exit While
                End If

                'keywordcopy = keywordcopy.TrimStart
                thisline &= keywordcopy(0)

                If keywordcopy(0) <> " " Or firstnonspaceencountered Then
                    'leading spaces do not count towards letter count but subsequent spaces do
                    lettercounter += 1
                    firstnonspaceencountered = True

                End If


                keywordcopy = keywordcopy.Substring(1)


            End While
            If lengthdoesntwork Then
                Exit While
            End If
            thisline = jpstringsfunctions.padright(thisline, " ", settings(settingsindex.linelength))
            returnvalue.Add(thisline)
            loopcounter += 1
        End While



        'create last line
        thisline = thisline.TrimEnd
        thisline &= keywordcopy
        thisline = jpstringsfunctions.padright(thisline, " ", settings(settingsindex.linelength))
        returnvalue.Add(thisline)

        loopcounter = returnvalue.Count - 1
        While returnvalue.Count <> lines
            'this loop is encounterd in the specail case that the function is passed a keyword/linecount combo that doesnt work
            'lines are duplicated in order to fill in

            returnvalue.Insert(loopcounter, returnvalue(loopcounter)) 'duplicate the line

            loopcounter -= 1
            If loopcounter < 0 Then
                loopcounter = returnvalue.Count - 1
            End If

        End While

        Return returnvalue

    End Function

    Private Function combotab_generatepattern_subtractoff(ByVal keyword As String, ByVal lines As Int16) As ArrayList



        Dim returnvalue As ArrayList = New ArrayList
        Dim loopcounter As Int16 = 0


        If keyword.Trim = "" Then
            'specail condition to prevent errors
            While loopcounter < lines
                returnvalue.Add(Me.jpstringsfunctions.padright(" ", " ", settings(settingsindex.linelength)))
                loopcounter += 1
            End While

            Return returnvalue

        End If



        Dim leadingspacecount As Int16 = jpstringsfunctions.leftcharatercount(keyword, " ")
        keyword = keyword.Trim
        Dim nonblanklinecount = lines 'since blank lines removed, this is the same value as lines
        'Dim letteradd As Int16 = keyword.Length / nonblanklinecount


        Dim segmentlength_allbutlast As Int16
        Dim segmentlength_last


        'the rule for adding on chars is that the count of number of chars to add on starts with the first nonspace character

        'determine the length of each add on segment
        'I want to as close as posible to an even division

        'the rule for adding chars makes things complicated.

        Dim ratios As ArrayList = New ArrayList 'of singles. this stores the ratio of most segments to the last segment
        Dim lengthdoesntwork As Boolean = False

        'segmentlength_allbutlast = Math.Truncate(Convert.ToSingle(keyword.Length) / Convert.ToSingle((nonblanklinecount - 1)))

        segmentlength_allbutlast = keyword.Length 'start with a rediculously high value that usually doesnt work (and will be weeded out below)  but saves figuring out why calculation above is wrong


        While segmentlength_allbutlast - loopcounter > 0
            Dim tempword As String = keyword
            Dim linecounter As Int16 = 0
            While linecounter < nonblanklinecount - 1
                Dim lettercounter As Int16 = segmentlength_allbutlast - loopcounter - 1
                While lettercounter >= 0

                    If tempword = "" Then
                        lengthdoesntwork = True
                        Exit While
                    End If
                    tempword = tempword.TrimEnd
                    If tempword = "" Then
                        lengthdoesntwork = True
                        Exit While
                    End If
                    tempword = tempword.Substring(0, tempword.Length - 1)

                    lettercounter -= 1

                End While

                If lengthdoesntwork Or tempword.TrimEnd.Length = 0 Then

                    lengthdoesntwork = True 'has to be specified here in case second half of codition is trigger

                    Exit While
                End If

                linecounter += 1

                If lengthdoesntwork Then

                    Exit While

                End If
            End While



            If lengthdoesntwork Then
                ratios.Add(100) ' a really high ratio that will be rejected 
                lengthdoesntwork = False

            ElseIf linecounter = nonblanklinecount - 1 Then 'nature of looping makes this one less

                segmentlength_last = tempword.TrimStart.Length

                If (segmentlength_allbutlast - loopcounter) > segmentlength_last Then

                    ratios.Add((segmentlength_allbutlast - loopcounter) - segmentlength_last)

                Else

                    ratios.Add(segmentlength_last - (segmentlength_allbutlast - loopcounter))

                End If

            Else
                MsgBox("error linecounter = " & linecounter & " and should = " & nonblanklinecount)

            End If

            loopcounter += 1

        End While

        If ratios.Count <> segmentlength_allbutlast Then
            MsgBox("error with ratio count in generate addon function: " & ratios.Count)
            Return New ArrayList

        End If
        Dim selected_ratio_index As Int16 = 0
        Dim selected_ratio = 100
        loopcounter = 0

        ratios.Reverse()
        While loopcounter < ratios.Count

            If ratios(loopcounter) < selected_ratio Then
                selected_ratio_index = loopcounter
                selected_ratio = ratios(loopcounter)
            End If

            loopcounter += 1

        End While

        segmentlength_allbutlast = selected_ratio_index + 1 'index 0 refers to segment length 1 etc


        loopcounter = 0



        'returnvalue.Add(" ".PadRight(settings(settingsindex.linelength))) 'start with 1 blank line

        loopcounter = 0

        'Dim keywordcopy As String = keyword

        Dim thisline As String = jpstringsfunctions.padleft(keyword, " ", keyword.Length + leadingspacecount) 'add leadin space
        thisline = jpstringsfunctions.padright(thisline, " ", settings(settingsindex.linelength)) 'add trailing space

        returnvalue.Add(thisline) 'entire word

        While loopcounter < nonblanklinecount - 1


            Dim firstnonspaceencountered As Boolean = False

            Dim lettercounter As Int16 = 0
            While lettercounter < segmentlength_allbutlast
                If (thisline = "") Then
                    'this happens if the funtion is passed a keyword / linecount combo that doesnt work
                    'the previous iterations of the loop added one char at a time

                    lengthdoesntwork = True

                    Exit While
                End If


                If Not thisline.EndsWith(" ") Or firstnonspaceencountered Then
                    'leading spaces do not count towards letter count but subsequent spaces do

                    lettercounter += 1
                    firstnonspaceencountered = True

                End If


                thisline = jpstringsfunctions.sizeexactlyright(thisline, " ", thisline.Length - 1) 'discard one letter from end 

            End While
            If lengthdoesntwork Then
                Exit While
            End If
            thisline = jpstringsfunctions.padright(thisline, " ", settings(settingsindex.linelength)) 'append trailing spaces to linelength
            returnvalue.Add(thisline)
            loopcounter += 1
        End While

        'returnvalue.Add(jpstringsfunctions.padright(" ", " ", settings(settingsindex.linelength))) ' (used to) end with empty line


        loopcounter = 0
        While returnvalue.Count <> lines
            'this loop is encounterd in the special case that the function is passed a keyword/linecount combo that doesnt work
            'lines are duplicated in order to fill in

            returnvalue.Insert(loopcounter, returnvalue(loopcounter)) 'duplicate the line

            loopcounter += 2 'advance skipping over line just added
            If loopcounter > returnvalue.Count Then
                loopcounter = 0
            End If

        End While

        Return returnvalue
















        ''''''''''''''''''''''''''''''''''''''''''''''''''''
        ''If keyword.Length > Me.settings(settingsindex.linelength) Then
        ''    keyword = jpstringsfunctions.trimtolength(keyword, " ", settings(settingsindex.linelength))

        ''    If keyword.Length > Me.settings(settingsindex.linelength) Then
        ''        'if unable to make it fit by trimming space then give error
        ''        MsgBox("error - keyword for 'subtract off' can not exceed sign size")
        ''        Return New ArrayList
        ''    End If

        ''End If

        'If keyword.Length > settings(settingsindex.linelength) Then
        '    keyword = keyword.Remove(settings(settingsindex.linelength)) 'truncate to linelength
        'End If

        'If lines < 3 Then
        '    MsgBox("error pattern 'subtract off' must have at least 3 lines")
        '    Return New ArrayList
        'End If

        'Dim leadingspacecount As Int16 = jpstringsfunctions.leftcharatercount(keyword, " ")
        'keyword = keyword.Trim
        'Dim nonblanklinecount = lines - 1

        'Dim segmentlength_allbutlast As Int16
        'Dim segmentlength_last


        ''determine the length of each add on segment
        ''I want to as close as posible to an even division 
        ''there are 2 posible ways to divide
        ''  -divide the word length by the number of non blank lines and tack the remaider on to the last line
        ''  -devide the word length by one less then the number of nonblank lines and use the remainder as last line
        ''in order to decide which to use, I will calculate which results in the closest to even

        'Dim allbutlast_usingnonblankline As Int16 = Math.Truncate(Convert.ToSingle(keyword.Length) / Convert.ToSingle(nonblanklinecount))
        'Dim last_usingnonblankline As Int16 = allbutlast_usingnonblankline + keyword.Length Mod nonblanklinecount

        'Dim allbutlast_usingoneless As Int16 = Math.Truncate(Convert.ToSingle(keyword.Length) / Convert.ToSingle((nonblanklinecount - 1)))
        'Dim last_usingoneless As Int16 = keyword.Length Mod (nonblanklinecount - 1)

        'Dim ratio_usingnonblankline As Single
        'Dim ratio_usingoneless As Single

        'If allbutlast_usingnonblankline > last_usingnonblankline Then
        '    ratio_usingnonblankline = last_usingnonblankline / allbutlast_usingnonblankline
        'Else
        '    ratio_usingnonblankline = allbutlast_usingnonblankline / last_usingnonblankline
        'End If

        'If allbutlast_usingoneless > last_usingoneless Then
        '    ratio_usingoneless = last_usingoneless / allbutlast_usingoneless
        'Else
        '    ratio_usingoneless = allbutlast_usingoneless / last_usingoneless
        'End If

        'If ratio_usingnonblankline > ratio_usingoneless Then

        '    segmentlength_allbutlast = allbutlast_usingnonblankline
        '    segmentlength_last = last_usingnonblankline
        'Else

        '    segmentlength_allbutlast = allbutlast_usingoneless
        '    segmentlength_last = last_usingoneless

        'End If

        ''Dim returnvalue As ArrayList = New ArrayList

        'Dim returnvalue As ArrayList = New ArrayList
        'Dim loopcounter As Int16 = 0



        ''


        'returnvalue.Add(" ".PadRight(settings(settingsindex.linelength)))

        'loopcounter = nonblanklinecount
        'While loopcounter >= 1

        '    Dim thisline As String
        '    If loopcounter <> nonblanklinecount Then
        '        thisline = keyword.Substring(0, segmentlength_allbutlast * loopcounter)

        '    Else
        '        thisline = keyword.Substring(0, segmentlength_allbutlast * (loopcounter - 1) + segmentlength_last)
        '    End If


        '    thisline = jpstringsfunctions.padleft(thisline, " ", thisline.Length + leadingspacecount) 'return the space that was trimmed from begining

        '    thisline = jpstringsfunctions.padright(thisline, " ", settings(settingsindex.linelength)) 'pad to end to make an intireline. it should not be neccesary to truncate because long keywords generate error prior to this point
        '    returnvalue.Add(thisline)
        '    loopcounter -= 1
        'End While


        'Return returnvalue
    End Function


    Private Function combotab_generatepattern_blinkfast(ByVal keyword As String, ByVal lines As Int16) As ArrayList
        'lines must be an even number

        Dim reps As Int16 = lines / 2
        Dim returnvalue As ArrayList = New ArrayList
        Dim blancline As String = jpstringsfunctions.padright(" ", " ", settings(settingsindex.linelength))

        Dim loopcounter As Int16 = 0
        While loopcounter < reps
            returnvalue.Add(keyword)
            returnvalue.Add(blancline)
            loopcounter += 1
        End While
        Return returnvalue

    End Function
    Private Function combotab_generatepattern_blinkslow(ByVal keyword As String, ByVal lines As Int16) As ArrayList
        'lines must be multiple of 5
        '3 on 2 off

        Dim reps As Int16 = lines / 5
        Dim returnvalue As ArrayList = New ArrayList
        Dim blancline As String = jpstringsfunctions.padright(" ", " ", settings(settingsindex.linelength))

        Dim loopcounter As Int16 = 0
        While loopcounter < reps
            returnvalue.Add(keyword)
            returnvalue.Add(keyword)
            returnvalue.Add(keyword)
            returnvalue.Add(blancline)
            returnvalue.Add(blancline)
            loopcounter += 1
        End While
        Return returnvalue
    End Function

    Private Function combotab_generatepattern_addandsubtract(ByVal keyword As String, ByVal lines As Int16) As ArrayList
        Dim returnvalue As ArrayList = New ArrayList
        returnvalue.AddRange(combotab_generatepattern_addon(keyword, (lines + 1) / 2))
        returnvalue.RemoveAt(returnvalue.Count - 1) 'so that the whole word only shows once
        returnvalue.AddRange(combotab_generatepattern_subtractoff(keyword, (lines + 1) / 2))
        Return returnvalue
    End Function

    Private Function combotab_generatepattern_subtractandadd(ByVal keyword As String, ByVal lines As Int16) As ArrayList

        Dim returnvalue As ArrayList = New ArrayList
        returnvalue.AddRange(combotab_generatepattern_subtractoff(keyword, lines / 2))
        returnvalue.RemoveAt(returnvalue.Count - 1) 'so that the first letter only shows once
        returnvalue.AddRange(combotab_generatepattern_addon(keyword, lines / 2))
        Return returnvalue

    End Function

    Private Function combotab_generatepattern_scrollright(ByVal keyword As String, ByVal lines As Int16) As ArrayList


        Dim returnvalue As ArrayList = New ArrayList
        Dim repcounter As Int16 = 0
        Dim loopcounter As Int16 = 0

        'Dim nonblanklinecount = lines

        Dim letterjump As Int16 = (settings(settingsindex.linelength) - keyword.TrimEnd.Length) / lines

        'padd the end with space up to line length. normally auto allignment measn no beginning spaces otherwise assume they want space
        keyword = jpstringsfunctions.sizeexactlyright(keyword, " ", settings(settingsindex.linelength))


        'add first line
        returnvalue.Add(keyword)

        'use loop to add remaining non blank lines


        loopcounter = 1


        While loopcounter < lines

            keyword = jpstringsfunctions.padleft(keyword, " ", keyword.Length + letterjump) 'append space to beginning to scroll
            keyword = jpstringsfunctions.truncateright(keyword, settings(settingsindex.linelength)) 'truncate letters from end so as to remain proper linelength
            returnvalue.Add(keyword)
            loopcounter += 1

        End While
        'returnvalue.Add(jpstringsfunctions.padright(" ", " ", settings(settingsindex.linelength)))

        Return returnvalue

    End Function


    Private Function combotab_generatepattern_scrollleft(ByVal keyword As String, ByVal lines As Int16) As ArrayList

        Dim returnvalue As ArrayList = New ArrayList
        'Dim repcounter As Int16 = 0
        Dim loopcounter As Int16 = 0

        'Dim nonblanklinecount = lines 'since blanc lines removed this is sames as lines

        Dim oldletterjump As Int16 = (settings(settingsindex.linelength) - keyword.TrimEnd.Length) / (lines - 1)
        Dim letterjump As ArrayList = New ArrayList

        'previously some keyword / line combinations resulted in the last line several spaces from left. 
        'to fix this we calculate the number of extra spaces and try to insert them as evenly as possible
        Dim oldspacesused = oldletterjump * (lines - 1)
        Dim totalspacesneeded As Int16 = settings(settingsindex.linelength) - keyword.TrimEnd.Length
        Dim spacestoadd As Int16 = totalspacesneeded - oldspacesused
        If spacestoadd > lines Then
            'this should not happen
            MsgBox("error spaces to add should not exceed lines in scroll left" & Constants.vbCrLf & "please report this bug")


        ElseIf spacestoadd = 0 Then
            loopcounter = 1 'starts with 1 because first line (index 0) is entire word
            While loopcounter < lines
                letterjump.Add(oldletterjump)
                loopcounter += 1
            End While
        Else
            Dim addtoeveryNTHline As Int16

            If spacestoadd > 0 Then
                addtoeveryNTHline = lines / (spacestoadd + 1) '1 space is inserted @ 1/2 mark, 2 @ 1/3 and 2/3 etc
            ElseIf spacestoadd < 0 Then
                addtoeveryNTHline = lines / (-spacestoadd + 1) '1 space is inserted @ 1/2 mark, 2 @ 1/3 and 2/3 etc
            End If
            'lines / (spacestoadd + 1) '1 space is inserted @ 1/2 mark, 2 @ 1/3 and 2/3 etc
            loopcounter = 1 'starts with 1 because first line (index 0) is entire word
            While loopcounter < lines
                If (loopcounter) Mod addtoeveryNTHline = 0 And loopcounter <> lines - 1 Then
                    'without second half of condition above algorithm would always incorrectly add to last line

                    If spacestoadd > 0 Then
                        letterjump.Add(oldletterjump + 1)
                    Else
                        letterjump.Add(oldletterjump - 1)
                    End If
                Else
                    letterjump.Add(oldletterjump)
                End If
                loopcounter += 1
            End While
        End If


        'trim space from end and padd the beginning with space up to line length
        keyword = jpstringsfunctions.sizeexactlyleft(keyword.TrimEnd, " ", settings(settingsindex.linelength))


        'add first line
        returnvalue.Add(keyword)

        'use loop to add remaining non blank lines


        loopcounter = 0


        While loopcounter < lines - 1

            keyword = jpstringsfunctions.padright(keyword, " ", keyword.Length + letterjump(loopcounter)) 'append space to beginning to scroll
            keyword = jpstringsfunctions.truncateleft(keyword, settings(settingsindex.linelength)) 'truncate letters from end so as to remain proper linelength
            returnvalue.Add(keyword)
            loopcounter += 1

        End While
        'returnvalue.Add(jpstringsfunctions.padright(" ", " ", settings(settingsindex.linelength))) '(used to) end with blank line

        Return returnvalue

    End Function

    Private Function combotab_generatepattern_joinin(ByVal keyword As String, ByVal lines As Int16) As ArrayList
        Dim returnvalue As ArrayList = combotab_generatepattern_splitout(keyword, lines)
        returnvalue.Reverse()
        Return returnvalue
    End Function
    Private Function combotab_generatepattern_splitout(ByVal keyword As String, ByVal lines As Int16) As ArrayList

        If lines < 3 Then
            MsgBox("error pattern 'split out' must have at least 3 lines")
            Return New ArrayList
        End If

        Dim returnvalue As ArrayList = New ArrayList

        Dim loopcounter As Int16 = 0

        If keyword.Length > settings(settingsindex.linelength) Then


            keyword = keyword.Remove(settings(settingsindex.linelength)) 'truncate to linelength

        End If


        keyword = jpstringsfunctions.padright(keyword, " ", settings(settingsindex.linelength))




        'step 1 properly split the key word

        '
        keyword = keyword.Trim




        Dim lefthalf As String = keyword.Substring(0, (keyword.Length / 2))
        Dim righthalf As String = keyword.Substring(lefthalf.Length)


        'If lefthalf.EndsWith(" ") Or righthalf.StartsWith(" ") Then
        '    MsgBox("have not yet implimented dealing with space typed on the split")
        '    Return returnvalue
        'End If

        While lefthalf.Length - righthalf.Length >= 2
            'move one char from left to right
            righthalf = lefthalf(lefthalf.Length - 1) & righthalf
            lefthalf = lefthalf.Substring(0, lefthalf.Length - 1)
        End While

        While righthalf.Length - lefthalf.Length >= 2
            'move 1 char from right to left

            lefthalf &= righthalf(0)
            righthalf = righthalf.Substring(1)

        End While



        Dim addpadtoright As Boolean = True


        If righthalf.Length - lefthalf.Length >= 1 Then
            'start with shorter half so that if linelength is odd the shorter half gets extra pad.
            'later on an extra space will be inserted in center to truncated this pad
            addpadtoright = False


        End If

        While (lefthalf & righthalf).Length < settings(settingsindex.linelength)
            'pad spaces to the outside of each half untill they conbine to form a line of linelength characters

            If addpadtoright Then
                righthalf &= " "

            Else
                lefthalf = " " & lefthalf

            End If
            addpadtoright = Not addpadtoright
        End While






        'step 2 calculate the space that must be insetered in center for each line

        Dim spaceinsertedperline As Int16 = settings(settingsindex.linelength) / lines



        'step 3 generate lines


        'insert first line before loop otherwise the extra added space per line messes it up

        Dim truncateextrafromright As Boolean = True
        If lefthalf.TrimStart.Length > righthalf.TrimEnd.Length Then
            truncateextrafromright = False
        End If


        'flags for tryingthing
        Dim spacestoadd = 4
        Dim truncatefromrightreversed = False
        Dim outsidepaddingreversed As Int16 = False
        While True



            returnvalue.Clear()
            returnvalue.Add(lefthalf & righthalf)
            loopcounter = 1

            While loopcounter < lines
                Dim spacetoinsertthiseline As Int16 = spaceinsertedperline * loopcounter

                'If lefthalf.TrimStart.Length <> righthalf.Trim.Length Then
                'commnet out condition so as to try it everytime
                'subsequent times through outer loop it does not add or subtracts 1
                spacetoinsertthiseline += spacestoadd

                If spacetoinsertthiseline < 0 Then
                    spacetoinsertthiseline = 0
                End If
                'End If

                'If lefthalf.TrimStart.Length <> righthalf.Trim.Length Then
                '    If Not reverseaddingspace Then
                '        spacetoinsertthiseline += 1
                '    End If


                'End If


                Dim thisline = lefthalf & jpstringsfunctions.sizeexactlyright(" ", " ", spacetoinsertthiseline) & righthalf
                If spacetoinsertthiseline Mod 2 = 0 Then
                    'even
                    'truncate half of the spaces inserted from either end

                    thisline = jpstringsfunctions.truncateleft(thisline, thisline.length - spacetoinsertthiseline / 2)
                    thisline = jpstringsfunctions.truncateright(thisline, thisline.length - spacetoinsertthiseline / 2)
                Else
                    'odd
                    Dim smallerhalf As Int16 = (spacetoinsertthiseline) / 2
                    Dim largerhalf As Int16 = spacetoinsertthiseline - smallerhalf

                    If smallerhalf > largerhalf Then

                        largerhalf = smallerhalf
                        smallerhalf = spacetoinsertthiseline - largerhalf

                    End If

                    If truncateextrafromright Then
                        thisline = jpstringsfunctions.truncateleft(thisline, thisline.length - smallerhalf)
                        thisline = jpstringsfunctions.truncateright(thisline, thisline.length - largerhalf)
                    Else
                        thisline = jpstringsfunctions.truncateleft(thisline, thisline.length - largerhalf)
                        thisline = jpstringsfunctions.truncateright(thisline, thisline.length - smallerhalf)

                    End If

                    'truncateextrafromright = Not truncateextrafromright

                End If


                loopcounter += 1

                returnvalue.Add(thisline)
            End While

            'step 4 validate lines
            If splitoutlastlinecorrect(returnvalue(returnvalue.Count - 1)) Then
                Exit While
            ElseIf spacestoadd > -4 Then
                spacestoadd -= 1
                Continue While

            ElseIf Not truncatefromrightreversed Then
                truncateextrafromright = Not truncateextrafromright
                spacestoadd = 1 'repeat all possibilities of this again
                truncatefromrightreversed = True
                Continue While

            ElseIf Not outsidepaddingreversed Then
                Dim oldleftpadding As Int16 = jpstringsfunctions.getleadingspace(lefthalf)
                Dim oldrightpadding As Int16 = jpstringsfunctions.gettrailingspace(righthalf)

                lefthalf = lefthalf.TrimStart
                righthalf = righthalf.TrimEnd

                lefthalf = jpstringsfunctions.padleft(lefthalf, " ", lefthalf.Length + oldrightpadding)
                righthalf = jpstringsfunctions.padright(righthalf, " ", righthalf.Length + oldleftpadding)



                'reverse the flag for this condition
                outsidepaddingreversed = True

                'reset these flags to go through all of the above combinations again
                spacestoadd = 2
                truncatefromrightreversed = False






            Else



                'not correct but giving up
                'MsgBox("pattern not correct")
                'only get here with multiple spaces on the split

                Exit While

            End If


        End While

        'step 5 return lines 
        Return returnvalue

    End Function

    Private Function splitoutlastlinecorrect(ByVal lastline As String) As Boolean
        If lastline.EndsWith(" ") Or lastline.StartsWith(" ") Then
            Return False
        End If

        If jpstringsfunctions.getLettersFromBeginningTo(lastline.Trim, " ").Length <> jpstringsfunctions.getLettersFromendTo(lastline.Trim, " ").Length Then

            Return False

        End If

        Return True

    End Function




    ''''''''''''''''''''''''''''''''''''''''''''''''''''''
    '''''''''''''legacy display patterns''''''''''''''''''''
    ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
    Private Sub initialize_legacysettings(Optional ByVal forcereinitialize As Boolean = False)

        Static alreadyinitialized As Boolean = False
        Static functionbusy As Boolean = False


        If alreadyinitialized And Not forcereinitialize Then
            Return
        End If


        While functionbusy
            'wait for another function call (in another thread?) to finish
        End While

        functionbusy = True

        Dim legacypatternames As String() = System.Enum.GetNames(GetType(combotab_patterns_legacy))
        Dim legacypatterncount As Int16 = legacypatternames.Length
        Dim loopcounter As Int16 = 0

        Dim legacysettingnames As String() = System.Enum.GetNames(GetType(legacysettingsindex))
        Dim legacysettingscount As Int16 = legacysettingnames.Length

        While loopcounter < legacypatterncount



            legacypatternsettings.Add(0)

            loopcounter += 1

        End While

        loopcounter = 0
        While loopcounter < legacysettingscount

            'set all to 0 meaning no
            'these may be set to 
            ' 1 - yes for curent file (will be unset when file close 
            ' 2 = always yes  if and only it the user choses this setting



            legacysettings.Add(0)
            loopcounter += 1


        End While

        functionbusy = False
        alreadyinitialized = True
    End Sub



    'the convention is to 
    Private Function combotab_generatepattern__zlegacy_still_108001(ByVal keyword As String, ByVal lines As Int16) As ArrayList
        Dim returnvalue As ArrayList = New ArrayList
        Dim loopcounter As Int16 = 0
        'If keyword.Length > settings(settingsindex.linelength) Then
        '    MsgBox("error keyword for still pattern can not exceed the length of the sign")
        '    Return returnvalue
        'End If

        If keyword.Length > settings(settingsindex.linelength) Then
            keyword = keyword.Remove(settings(settingsindex.linelength)) 'truncate to linelength
        End If

        While loopcounter < lines
            returnvalue.Add(keyword.PadRight(settings(settingsindex.linelength)))
            loopcounter += 1
        End While
        Return returnvalue
    End Function

    Private Function combotab_generatepattern__zlegacy_addon_108001(ByVal keyword As String, ByVal lines As Int16) As ArrayList
        'If keyword.Length > Me.settings(settingsindex.linelength) Then
        '    keyword = jpstringsfunctions.trimtolength(keyword, " ", settings(settingsindex.linelength))

        '    If keyword.Length > Me.settings(settingsindex.linelength) Then
        '        'if unable to make it fit by trimming space then give error
        '        MsgBox("error - keyword for 'add on' can not exceed sign size")
        '        Return New ArrayList
        '    End If

        'End If

        If keyword.Length > settings(settingsindex.linelength) Then
            keyword = keyword.Remove(settings(settingsindex.linelength)) 'truncate to linelength
        End If

        If lines < 3 Then
            MsgBox("error pattern 'add on' must have at least 3 lines")
            Return New ArrayList
        End If

        Dim leadingspacecount As Int16 = jpstringsfunctions.leftcharatercount(keyword, " ")
        keyword = keyword.Trim
        Dim nonblanklinecount = lines - 1

        Dim segmentlength_allbutlast As Int16
        Dim segmentlength_last


        'determine the length of each add on segment
        'I want to as close as posible to an even division 
        'there are 2 posible ways to divide
        '  -divide the word length by the number of non blank lines and tack the remaider on to the last line
        '  -devide the word length by one less then the number of nonblank lines and use the remainder as last line
        'in order to decide which to use, I will calculate which results in the closest to even

        Dim allbutlast_usingnonblankline As Int16 = Math.Truncate(Convert.ToSingle(keyword.Length) / Convert.ToSingle(nonblanklinecount))
        Dim last_usingnonblankline As Int16 = allbutlast_usingnonblankline + keyword.Length Mod nonblanklinecount

        Dim allbutlast_usingoneless As Int16 = Math.Truncate(Convert.ToSingle(keyword.Length) / Convert.ToSingle((nonblanklinecount - 1)))
        Dim last_usingoneless As Int16 = keyword.Length Mod (nonblanklinecount - 1)

        Dim ratio_usingnonblankline As Single
        Dim ratio_usingoneless As Single

        If allbutlast_usingnonblankline > last_usingnonblankline Then
            ratio_usingnonblankline = last_usingnonblankline / allbutlast_usingnonblankline
        Else
            ratio_usingnonblankline = allbutlast_usingnonblankline / last_usingnonblankline
        End If

        If allbutlast_usingoneless > last_usingoneless Then
            ratio_usingoneless = last_usingoneless / allbutlast_usingoneless
        Else
            ratio_usingoneless = allbutlast_usingoneless / last_usingoneless
        End If

        If ratio_usingnonblankline > ratio_usingoneless Then

            segmentlength_allbutlast = allbutlast_usingnonblankline
            segmentlength_last = last_usingnonblankline
        Else

            segmentlength_allbutlast = allbutlast_usingoneless
            segmentlength_last = last_usingoneless

        End If

        'Dim returnvalue As ArrayList = New ArrayList

        Dim returnvalue As ArrayList = New ArrayList
        Dim loopcounter As Int16 = 0



        '


        returnvalue.Add(" ".PadRight(settings(settingsindex.linelength)))

        loopcounter = 1
        While loopcounter <= nonblanklinecount

            Dim thisline As String
            If loopcounter <> nonblanklinecount Then
                thisline = keyword.Substring(0, segmentlength_allbutlast * loopcounter)

            Else
                thisline = keyword.Substring(0, segmentlength_allbutlast * (loopcounter - 1) + segmentlength_last)
            End If


            thisline = jpstringsfunctions.padleft(thisline, " ", thisline.Length + leadingspacecount) 'return the space that was trimmed from begining

            thisline = jpstringsfunctions.padright(thisline, " ", settings(settingsindex.linelength)) 'pad to end to make an intireline. it should not be neccesary to truncate because long keywords generate error prior to this point
            returnvalue.Add(thisline)
            loopcounter += 1
        End While


        Return returnvalue
    End Function

    Private Function combotab_generatepattern__zlegacy_subtractoff_108001(ByVal keyword As String, ByVal lines As Int16) As ArrayList
        'If keyword.Length > Me.settings(settingsindex.linelength) Then
        '    keyword = jpstringsfunctions.trimtolength(keyword, " ", settings(settingsindex.linelength))

        '    If keyword.Length > Me.settings(settingsindex.linelength) Then
        '        'if unable to make it fit by trimming space then give error
        '        MsgBox("error - keyword for 'subtract off' can not exceed sign size")
        '        Return New ArrayList
        '    End If

        'End If

        If keyword.Length > settings(settingsindex.linelength) Then
            keyword = keyword.Remove(settings(settingsindex.linelength)) 'truncate to linelength
        End If

        If lines < 3 Then
            MsgBox("error pattern 'subtract off' must have at least 3 lines")
            Return New ArrayList
        End If

        Dim leadingspacecount As Int16 = jpstringsfunctions.leftcharatercount(keyword, " ")
        keyword = keyword.Trim
        Dim nonblanklinecount = lines - 1

        Dim segmentlength_allbutlast As Int16
        Dim segmentlength_last


        'determine the length of each add on segment
        'I want to as close as posible to an even division 
        'there are 2 posible ways to divide
        '  -divide the word length by the number of non blank lines and tack the remaider on to the last line
        '  -devide the word length by one less then the number of nonblank lines and use the remainder as last line
        'in order to decide which to use, I will calculate which results in the closest to even

        Dim allbutlast_usingnonblankline As Int16 = Math.Truncate(Convert.ToSingle(keyword.Length) / Convert.ToSingle(nonblanklinecount))
        Dim last_usingnonblankline As Int16 = allbutlast_usingnonblankline + keyword.Length Mod nonblanklinecount

        Dim allbutlast_usingoneless As Int16 = Math.Truncate(Convert.ToSingle(keyword.Length) / Convert.ToSingle((nonblanklinecount - 1)))
        Dim last_usingoneless As Int16 = keyword.Length Mod (nonblanklinecount - 1)

        Dim ratio_usingnonblankline As Single
        Dim ratio_usingoneless As Single

        If allbutlast_usingnonblankline > last_usingnonblankline Then
            ratio_usingnonblankline = last_usingnonblankline / allbutlast_usingnonblankline
        Else
            ratio_usingnonblankline = allbutlast_usingnonblankline / last_usingnonblankline
        End If

        If allbutlast_usingoneless > last_usingoneless Then
            ratio_usingoneless = last_usingoneless / allbutlast_usingoneless
        Else
            ratio_usingoneless = allbutlast_usingoneless / last_usingoneless
        End If

        If ratio_usingnonblankline > ratio_usingoneless Then

            segmentlength_allbutlast = allbutlast_usingnonblankline
            segmentlength_last = last_usingnonblankline
        Else

            segmentlength_allbutlast = allbutlast_usingoneless
            segmentlength_last = last_usingoneless

        End If

        'Dim returnvalue As ArrayList = New ArrayList

        Dim returnvalue As ArrayList = New ArrayList
        Dim loopcounter As Int16 = 0



        '


        returnvalue.Add(" ".PadRight(settings(settingsindex.linelength)))

        loopcounter = nonblanklinecount
        While loopcounter >= 1

            Dim thisline As String
            If loopcounter <> nonblanklinecount Then
                thisline = keyword.Substring(0, segmentlength_allbutlast * loopcounter)

            Else
                thisline = keyword.Substring(0, segmentlength_allbutlast * (loopcounter - 1) + segmentlength_last)
            End If


            thisline = jpstringsfunctions.padleft(thisline, " ", thisline.Length + leadingspacecount) 'return the space that was trimmed from begining

            thisline = jpstringsfunctions.padright(thisline, " ", settings(settingsindex.linelength)) 'pad to end to make an intireline. it should not be neccesary to truncate because long keywords generate error prior to this point
            returnvalue.Add(thisline)
            loopcounter -= 1
        End While


        Return returnvalue
    End Function


    Private Function combotab_generatepattern_zlegacy_addandsubtract_108001(ByVal keyword As String, ByVal lines As Int16) As ArrayList
        'If keyword.Length > Me.settings(settingsindex.linelength) Then
        '    keyword = jpstringsfunctions.trimtolength(keyword, " ", settings(settingsindex.linelength))

        '    If keyword.Length > Me.settings(settingsindex.linelength) Then
        '        'if unable to make it fit by trimming space then give error
        '        MsgBox("error - keyword for 'add & subtract' can not exceed sign size")
        '        Return New ArrayList
        '    End If

        'End If

        If keyword.Length > settings(settingsindex.linelength) Then
            keyword = keyword.Remove(settings(settingsindex.linelength)) 'truncate to linelength
        End If

        If lines < 5 Then
            MsgBox("error pattern 'add and subtract' must have at least 5 lines")
            Return New ArrayList
        End If


        Dim leadingspacecount As Int16 = jpstringsfunctions.leftcharatercount(keyword, " ")
        keyword = keyword.Trim

        Dim doublemiddleline As Boolean = False 'if an evan number of lines selected the middle line is doubled

        Dim nonblanklinecount As Int16

        If lines Mod 2 = 1 Then
            'odd number of lines
            nonblanklinecount = (lines - 1) / 2
            doublemiddleline = True
        ElseIf lines Mod 2 = 0 Then
            nonblanklinecount = (lines) / 2
            doublemiddleline = False

        End If
        Dim segmentlength_allbutlast As Int16
        Dim segmentlength_last


        'determine the length of each add on segment
        'I want to as close as posible to an even division 
        'there are 2 posible ways to divide
        '  -divide the word length by the number of non blank lines and tack the remaider on to the last line
        '  -devide the word length by one less then the number of nonblank lines and use the remainder as last line
        'in order to decide which to use, I will calculate which results in the closest to even


        Dim allbutlast_usingnonblankline As Int16 = Math.Truncate(Convert.ToSingle(keyword.Length) / Convert.ToSingle(nonblanklinecount))
        Dim last_usingnonblankline As Int16 = allbutlast_usingnonblankline + keyword.Length Mod nonblanklinecount

        Dim allbutlast_usingoneless As Int16 = Math.Truncate(Convert.ToSingle(keyword.Length) / Convert.ToSingle((nonblanklinecount - 1)))
        Dim last_usingoneless As Int16 = keyword.Length Mod (nonblanklinecount - 1)

        Dim ratio_usingnonblankline As Single
        Dim ratio_usingoneless As Single

        If allbutlast_usingnonblankline > last_usingnonblankline Then
            ratio_usingnonblankline = last_usingnonblankline / allbutlast_usingnonblankline
        Else
            ratio_usingnonblankline = allbutlast_usingnonblankline / last_usingnonblankline
        End If

        If allbutlast_usingoneless > last_usingoneless Then
            ratio_usingoneless = last_usingoneless / allbutlast_usingoneless
        Else
            ratio_usingoneless = allbutlast_usingoneless / last_usingoneless
        End If

        If ratio_usingnonblankline > ratio_usingoneless Then

            segmentlength_allbutlast = allbutlast_usingnonblankline
            segmentlength_last = last_usingnonblankline
        Else

            segmentlength_allbutlast = allbutlast_usingoneless
            segmentlength_last = last_usingoneless

        End If

        'Dim returnvalue As ArrayList = New ArrayList

        Dim returnvalue As ArrayList = New ArrayList
        Dim loopcounter As Int16 = 0



        '


        returnvalue.Add(" ".PadRight(settings(settingsindex.linelength)))
        'goingup and loopcounter <= nonblanklinecount
        Dim goingup As Boolean = True
        loopcounter = 1 'nonblanklinecount
        While True 'loopcounter >= 1

            Dim thisline As String
            If loopcounter <> nonblanklinecount Then
                thisline = keyword.Substring(0, segmentlength_allbutlast * loopcounter)

            Else
                thisline = keyword.Substring(0, segmentlength_allbutlast * (loopcounter - 1) + segmentlength_last)
            End If


            thisline = jpstringsfunctions.padleft(thisline, " ", thisline.Length + leadingspacecount) 'return the space that was trimmed from begining

            thisline = jpstringsfunctions.padright(thisline, " ", settings(settingsindex.linelength)) 'pad to end to make an intireline. it should not be neccesary to truncate because long keywords generate error prior to this point
            returnvalue.Add(thisline)

            If goingup And loopcounter < nonblanklinecount Then
                loopcounter += 1
            ElseIf goingup And loopcounter = nonblanklinecount Then
                goingup = False
                If Not doublemiddleline Then
                    loopcounter -= 1
                End If
            ElseIf Not goingup And loopcounter > 1 Then
                loopcounter -= 1
            ElseIf Not goingup And loopcounter = 1 Then
                Exit While
            Else
                MsgBox("error loop is out of kilter in combotab_generatepattern_addandsubtract()")
                Exit While
            End If

        End While


        Return returnvalue
    End Function



    Private Function combotab_generatepattern__zlegacy_scrollright_108001(ByVal keyword As String, ByVal lines As Int16) As ArrayList
        If lines Mod 2 = 1 Then
            MsgBox("error scroll patterns must have even number of lines")
            Return New ArrayList
        End If
        'Dim returnvalue As ArrayList = New ArrayList
        Dim returnvalue As ArrayList = New ArrayList
        Dim repcounter As Int16 = 0
        Dim loopcounter As Int16 = 0

        Dim nonblanklinecount = lines - 1

        Dim worddivisor As Int16 = (nonblanklinecount + 1) / 2

        While keyword.Length < settings(settingsindex.linelength)
            keyword += " "
        End While

        While keyword.Length Mod worddivisor <> 0

            keyword = " " + keyword
            If keyword.Length Mod worddivisor <> 0 Then
                keyword += " "
            End If

        End While
        Dim newkeyword As String = keyword 'used to call function recursively to try to eliminate empty lines
        Dim substringfactor As Int16 = keyword.Length / worddivisor
        'build a rep

        While keyword.Length < substringfactor * nonblanklinecount
            keyword += " "
        End While

        returnvalue.Add(" ".PadRight(settings(settingsindex.linelength)))

        loopcounter = 0
        While loopcounter < nonblanklinecount

            Dim thisline As String
            If loopcounter < worddivisor Then


                thisline = keyword.Substring((worddivisor - loopcounter - 1) * (substringfactor))

            Else
                thisline = jpstringsfunctions.padleft(keyword, " ", keyword.Length + (loopcounter - worddivisor + 1) * substringfactor)

            End If


            'make the line exactly the legth of a line by added or truncating from right
            thisline = jpstringsfunctions.sizeexactlyright(thisline, " ", settings(settingsindex.linelength))

            returnvalue.Add(thisline)
            loopcounter += 1
        End While
        If (returnvalue(lines - 1).trim = "" Or returnvalue(1).trim = "") And keyword.Trim <> "" Then

            'the function will be called recursively untill either the 2nd and last lines are not blanc or the keyword no longer end with space
            'if the process is terminated because of runing out of space then we will use the original return value

            Dim newreturnvalue As ArrayList
            'Dim spaceshiftlength As Int16 = returnvalue(1).trim.length / 2
            'Dim newkeyword
            If newkeyword.StartsWith(" ") Then



                newkeyword = newkeyword.Substring(1) 'remove spaces at begining
                newkeyword += " " 'add spaces to end, the new newkeyword should be same length as old newkeyword
                'the length is important so that the recursive function call does not pad addition space 


                newreturnvalue = combotab_generatepattern__zlegacy_scrollright_108001(newkeyword, lines)

                If newreturnvalue(lines - 1).trim <> "" And newreturnvalue(1).trim <> "" Then
                    returnvalue = newreturnvalue
                End If

            End If
        End If

        Return returnvalue
    End Function
    Private Function combotab_generatepattern__zlegacy_scrollleft_108001(ByVal keyword As String, ByVal lines As Int16) As ArrayList

        If lines Mod 2 = 1 Then
            MsgBox("error scroll patterns must have even number of lines")
            Return New ArrayList
        End If
        'Dim returnvalue As ArrayList = New ArrayList
        Dim returnvalue As ArrayList = New ArrayList
        Dim repcounter As Int16 = 0
        Dim loopcounter As Int16 = 0

        Dim nonblanklinecount = lines - 1

        Dim worddivisor As Int16 = (nonblanklinecount + 1) / 2

        While keyword.Length < settings(settingsindex.linelength)
            keyword += " "
        End While

        While keyword.Length Mod worddivisor <> 0

            keyword = " " + keyword
            If keyword.Length Mod worddivisor <> 0 Then
                keyword += " "
            End If

        End While

        Dim newkeyword = keyword ' used if we need to call the function recursivly to eliminate blank lines
        Dim substringfactor As Int16 = keyword.Length / worddivisor
        'build a rep

        While keyword.Length < substringfactor * nonblanklinecount
            keyword += " "
        End While

        returnvalue.Add(" ".PadRight(settings(settingsindex.linelength)))

        Dim rightpadfactor As Int16 = worddivisor - 1 'determined by playing around on notepad and seeing how word needs to be padded 
        loopcounter = 0
        While loopcounter < nonblanklinecount

            Dim thisline As String
            If loopcounter < worddivisor Then
                'substring starts from 0 and we padleft to make word fragment appear on right

                thisline = keyword.Substring(0, (loopcounter + 1) * (substringfactor))
                thisline = jpstringsfunctions.padleft(thisline, " ", thisline.Length + (rightpadfactor * substringfactor))

                rightpadfactor -= 1
                If rightpadfactor < 0 Then
                    rightpadfactor = 0
                End If
            Else
                thisline = keyword.Substring((loopcounter - worddivisor + 1) * (substringfactor))

            End If


            'make the line exactly the legth of a line by added or truncating from right
            thisline = jpstringsfunctions.sizeexactlyright(thisline, " ", settings(settingsindex.linelength))

            returnvalue.Add(thisline)
            loopcounter += 1
        End While

        If (returnvalue(lines - 1).trim = "" Or returnvalue(1).trim = "") And keyword.Trim <> "" Then

            'the function will be called recursively untill either the 2nd and last lines are not blanc or the keyword no longer end with space
            'if the process is terminated because of runing out of space then we will use the original return value

            Dim newreturnvalue As ArrayList
            'Dim spaceshiftlength As Int16 = returnvalue(1).trim.length / 2
            'Dim newkeyword
            If newkeyword.EndsWith(" ") Then



                newkeyword = newkeyword.Remove(newkeyword.Length - 1) 'remove spaces at end
                newkeyword = " " + newkeyword 'add spaces to beginning, the new newkeyword should be same length as old newkeyword
                'the length is important so that the recursive function call does not pad addition space 


                newreturnvalue = combotab_generatepattern__zlegacy_scrollleft_108001(newkeyword, lines)

                If newreturnvalue(lines - 1).trim <> "" And newreturnvalue(1).trim <> "" Then
                    returnvalue = newreturnvalue
                End If

            End If
        End If


        Return returnvalue
    End Function

    Private Function combotab_generatepattern_zlegacy108001_splitout(ByVal keyword As String, ByVal lines As Int16) As ArrayList
        'If keyword.Length > Me.settings(settingsindex.linelength) Then
        '    keyword = keyword.TrimEnd

        '    If keyword.Length > Me.settings(settingsindex.linelength) Then
        '        keyword = jpstringsfunctions.trimtolength(keyword, " ", settings(settingsindex.linelength))
        '    End If


        '    If keyword.Length > Me.settings(settingsindex.linelength) Then
        '        'if unable to make it fit by trimming space then give error
        '        MsgBox("error - keyword for 'subtract off' can not exceed sign size")
        '        Return New ArrayList
        '    End If

        'End If

        If keyword.Length > settings(settingsindex.linelength) Then
            keyword = keyword.Remove(settings(settingsindex.linelength)) 'truncate to linelength
        End If

        keyword = jpstringsfunctions.padright(keyword, " ", settings(settingsindex.linelength))

        If lines < 3 Then
            MsgBox("error pattern 'subtract off' must have at least 3 lines")
            Return New ArrayList
        End If


        Dim nonblanklinecount = lines - 1

        Dim divisorfordiscard = nonblanklinecount * 2
        'divide the length of the word by this number, discard this many cards from either end then fill space in center


        Dim returnvalue As ArrayList = New ArrayList
        returnvalue.Add(keyword) 'print the word once at begining before messing with

        While keyword.Length Mod divisorfordiscard <> 0
            keyword = keyword.Substring(0, keyword.Length - 1)
            If keyword.Length Mod divisorfordiscard <> 0 Then
                keyword = keyword.Substring(1)
            End If

        End While
        Dim truncatefromeitherend As Int16 = keyword.Length / divisorfordiscard



        Dim loopcounter = 1
        While loopcounter < nonblanklinecount
            'intentionaly starting with index 1 and then doing one rep less then nonblanklinecount
            'the first nonblank line has already been added

            Dim thisline As String = keyword

            thisline = jpstringsfunctions.sizeexactlyleft(thisline, " ", thisline.Length - (truncatefromeitherend * loopcounter))
            thisline = jpstringsfunctions.sizeexactlyright(thisline, " ", thisline.Length - (truncatefromeitherend * loopcounter))

            Dim lefthalf As String = thisline.Substring(0, thisline.Length / 2)
            Dim righthalf As String = thisline.Substring(lefthalf.Length)

            lefthalf = jpstringsfunctions.padright(lefthalf, " ", settings(settingsindex.linelength) / 2)
            righthalf = jpstringsfunctions.padleft(righthalf, " ", settings(settingsindex.linelength) - (settings(settingsindex.linelength) / 2))

            thisline = lefthalf & righthalf

            returnvalue.Add(thisline)
            loopcounter += 1
        End While
        returnvalue.Add(jpstringsfunctions.padright(" ", " ", settings(settingsindex.linelength))) 'empty line


        Return returnvalue
    End Function

    Private Sub combotab_initialize_keywordallignment(Optional ByVal forcereinitialize As Boolean = False)

        Static alreadyinitialized As Boolean = False
        If alreadyinitialized And Not forcereinitialize Then
            Return
        End If

        keywordallignment.Clear()
        keywordexceedlinelength.Clear()
        Dim loopcounter As Int16 = 0
        While loopcounter < 10
            keywordallignment.Add(Mod_textboxfunctions.txtbox_alignment_type._none)
            keywordexceedlinelength.Add(False)
            loopcounter += 1
        End While
    End Sub

    Private Sub TBkw_common_MouseDown(ByVal sender As System.Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles TBkw09.MouseDown, TBkw08.MouseDown, TBkw07.MouseDown, TBkw06.MouseDown, TBkw05.MouseDown, TBkw04.MouseDown, TBkw03.MouseDown, TBkw02.MouseDown, TBkw01.MouseDown, TBkw00.MouseDown

        If e.Button = Windows.Forms.MouseButtons.Right Then
            Dim sendername As String = sender.name
            Dim senderindex As String = sendername.Substring(sendername.Length - 2)


            ContextMenu_combokeywords.Tag = senderindex
            sender.ContextMenuStrip = ContextMenu_combokeywords
            sender.ContextMenuStrip.show()


        End If


    End Sub

    Private Sub ContextMenu_combokeywords_Opening(ByVal sender As System.Object, ByVal e As System.ComponentModel.CancelEventArgs) Handles ContextMenu_combokeywords.Opening
        Dim index As Int16 = Convert.ToInt16(sender.tag)

        Dim currentallignment As Int16 = keywordallignment(index)


        Men_combokeywordallign_left.Checked = False
        Men_combokeywordallign_center.Checked = False
        Men_combokeywordallign_right.Checked = False
        Men_combokeywordallign_none.Checked = False
        'Men_combo_center.Checked = False



        If currentallignment = Mod_textboxfunctions.txtbox_alignment_type._left Then
            Men_combokeywordallign_left.Checked = True
        ElseIf currentallignment = Mod_textboxfunctions.txtbox_alignment_type._center Then
            Men_combokeywordallign_center.Checked = True

        ElseIf currentallignment = Mod_textboxfunctions.txtbox_alignment_type._right Then
            Men_combokeywordallign_right.Checked = True
        ElseIf currentallignment = Mod_textboxfunctions.txtbox_alignment_type._none Then
            Men_combokeywordallign_none.Checked = True

            'ElseIf currentallignment = Mod_textboxfunctions.txtbox_alignment_type._none Then

        End If

        Men_combo_allowexceedwordlength.Text = "Allow keyword to exceed " & settings(settingsindex.linelength) & " letters"

        If keywordexceedlinelength(index) Then

            Men_combo_allowexceedwordlength.Checked = True

            Men_combokeywordallign_center.Enabled = False
            Men_combokeywordallign_right.Enabled = False
        Else
            Men_combo_allowexceedwordlength.Checked = False
            Men_combokeywordallign_center.Enabled = True
            Men_combokeywordallign_right.Enabled = True
        End If

        'Men_combo_allowexceedwordlength





    End Sub

    Private Sub combotab_refresh_keywordallignment(ByVal index As Int16)


        Dim thisallignment As Int16 = keywordallignment(index)


        If keywordexceedlinelength(index) = True Then

            If thisallignment <> Mod_textboxfunctions.txtbox_alignment_type._left Then

                thisallignment = Mod_textboxfunctions.txtbox_alignment_type._none

            End If

        ElseIf thisallignment = Mod_textboxfunctions.txtbox_alignment_type._auto Then

            If index = 0 Then
                thisallignment = Me.get_keywordallignmentforpattern(Me.CBpattern00.Text)
            ElseIf index = 1 Then
                thisallignment = Me.get_keywordallignmentforpattern(Me.CBpattern01.Text)
            ElseIf index = 2 Then
                thisallignment = Me.get_keywordallignmentforpattern(Me.CBpattern02.Text)
            ElseIf index = 3 Then
                thisallignment = Me.get_keywordallignmentforpattern(Me.CBpattern03.Text)
            ElseIf index = 4 Then
                thisallignment = Me.get_keywordallignmentforpattern(Me.CBpattern04.Text)
            ElseIf index = 5 Then
                thisallignment = Me.get_keywordallignmentforpattern(Me.CBpattern05.Text)
            ElseIf index = 6 Then
                thisallignment = Me.get_keywordallignmentforpattern(Me.CBpattern06.Text)
            ElseIf index = 7 Then
                thisallignment = Me.get_keywordallignmentforpattern(Me.CBpattern07.Text)
            ElseIf index = 8 Then
                thisallignment = Me.get_keywordallignmentforpattern(Me.CBpattern08.Text)
            ElseIf index = 9 Then
                thisallignment = Me.get_keywordallignmentforpattern(Me.CBpattern09.Text)

            End If


        End If

        If index = 0 Then



            Mod_textboxfunctions.txtbox_aligntext(TBkw00, thisallignment, get_maxlinelengthforpattern(combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern00.SelectedIndex)), TBkw00.Text))

        ElseIf index = 1 Then
            Mod_textboxfunctions.txtbox_aligntext(TBkw01, thisallignment, get_maxlinelengthforpattern(combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern01.SelectedIndex)), TBkw01.Text))
        ElseIf index = 2 Then
            Mod_textboxfunctions.txtbox_aligntext(TBkw02, thisallignment, get_maxlinelengthforpattern(combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern02.SelectedIndex)), TBkw02.Text))
        ElseIf index = 3 Then
            Mod_textboxfunctions.txtbox_aligntext(TBkw03, thisallignment, get_maxlinelengthforpattern(combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern03.SelectedIndex)), TBkw03.Text))
        ElseIf index = 4 Then
            Mod_textboxfunctions.txtbox_aligntext(TBkw04, thisallignment, get_maxlinelengthforpattern(combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern04.SelectedIndex)), TBkw04.Text))
        ElseIf index = 5 Then
            Mod_textboxfunctions.txtbox_aligntext(TBkw05, thisallignment, get_maxlinelengthforpattern(combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern05.SelectedIndex)), TBkw05.Text))
        ElseIf index = 6 Then
            Mod_textboxfunctions.txtbox_aligntext(TBkw06, thisallignment, get_maxlinelengthforpattern(combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern06.SelectedIndex)), TBkw06.Text))
        ElseIf index = 7 Then
            Mod_textboxfunctions.txtbox_aligntext(TBkw07, thisallignment, get_maxlinelengthforpattern(combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern07.SelectedIndex)), TBkw07.Text))
        ElseIf index = 8 Then
            Mod_textboxfunctions.txtbox_aligntext(TBkw08, thisallignment, get_maxlinelengthforpattern(combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern08.SelectedIndex)), TBkw08.Text))
        ElseIf index = 9 Then
            Mod_textboxfunctions.txtbox_aligntext(TBkw09, thisallignment, get_maxlinelengthforpattern(combotabpatterns_dataname_to_legaydisplayname(combotabpatterns_indexvaluetoindexname(CBpattern09.SelectedIndex)), TBkw09.Text))
        End If

    End Sub

    Private Sub ContextMenu_combokeywords_ItemClicked(ByVal sender As System.Object, ByVal e As System.Windows.Forms.ToolStripItemClickedEventArgs) Handles ContextMenu_combokeywords.ItemClicked, Menu_comboallignment.DropDownItemClicked
        Dim index As Int16 = Convert.ToInt16(ContextMenu_combokeywords.Tag) 'can not be sender.tag because sender is some times a submenu of ContextMenu_combokeywords 


        If e.ClickedItem Is Men_combokeywordallign_left Then
            keywordallignment(index) = Mod_textboxfunctions.txtbox_alignment_type._left
            combotab_refresh_keywordallignment(index)

        ElseIf e.ClickedItem Is Men_combokeywordallign_center Then
            keywordallignment(index) = Mod_textboxfunctions.txtbox_alignment_type._center
            combotab_refresh_keywordallignment(index)

        ElseIf e.ClickedItem Is Men_combokeywordallign_right Then
            keywordallignment(index) = Mod_textboxfunctions.txtbox_alignment_type._right
            combotab_refresh_keywordallignment(index)

        ElseIf e.ClickedItem Is Men_combokeywordallign_none Then
            keywordallignment(index) = Mod_textboxfunctions.txtbox_alignment_type._none
            combotab_refresh_keywordallignment(index)


        ElseIf e.ClickedItem Is Men_combo_allowexceedwordlength Then

            Me.keywordexceedlinelength(index) = Not Men_combo_allowexceedwordlength.Checked
        End If

    End Sub

    
    Private Sub Timer_flagwatchdog_Tick(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Timer_flagwatchdog.Tick

        Timer_flagwatchdog.Stop()
        'If disabledataflagtimeout Then
        '    Timer_flagwatchdog.Start()
        '    Return
        'End If

        If Me.BGW_read_device.IsBusy Or Me.BGW_write_device.IsBusy Then
            _timedataflagset = DateAndTime.Timer()
        End If

        If _databeinginternallymanipulated Then

            If DateAndTime.Timer() - _timedataflagset > _dataflagtimeout Or (86400 - _timedataflagset) + DateAndTime.Timer() > _dataflagtimeout Then 'second half of condition refers to special case of close to midnight
                'Dim response As DialogResult
                Dim message = "the watch dog timer has reset an internal flag" + Constants.vbCrLf
                message += "if this happend repeatedly, please report the bug"

                MsgBox(message)
                _databeinginternallymanipulated = False
                'leave timer off because no longer need to watch
            Else
                Timer_flagwatchdog.Start()
            End If
        End If
        
    End Sub

    Private Sub topmenu_common_DropDownchange(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles men_file.DropDownOpened, ToolStripMenuItem2.DropDownOpened, ToolStripMenuItem1.DropDownOpened, men_tools.DropDownOpened, men_help_strip.DropDownOpened, men_device.DropDownOpened, ToolStripMenuItem2.DropDownClosed, ToolStripMenuItem1.DropDownClosed, men_tools.DropDownClosed, men_help_strip.DropDownClosed, men_file.DropDownClosed, men_device.DropDownClosed

        Static restart_timermonitorpanmorelines As Boolean = False

        If sender.DropDown.Visible Then
            'opened

            restart_timermonitorpanmorelines = timer_monitor_ifdoubleclickmanuel.Enabled

            timer_monitor_ifdoubleclickmanuel.Stop()


            'MsgBox("open")
        Else
            'closed
            timer_monitor_ifdoubleclickmanuel.Enabled = restart_timermonitorpanmorelines



            'MsgBox("close")
        End If
    End Sub


    Public Sub pause(ByVal time As Double)


        Dim starttime As Double = DateAndTime.Timer() 'returns seconds since midnight
        While DateAndTime.Timer() - starttime < time
            'wait

        End While


    End Sub


    Private Sub Lbl_oneline_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)

    End Sub


    Sub connectionbuttons_markinactive(ByVal but As Control)
        font_functions.changestyle(but.Font, FontStyle.Italic)

    End Sub

    Sub connectionbuttons_markavailable(ByVal but As Control)
        'font_functions.changestyle(but.Font, FontStyle.Italic)
        font_functions.changestyle(but.Font, FontStyle.Bold)
    End Sub
    Function connectionbuttons_isavailable(ByVal but As Control) As Boolean

        Return (but.Font.Style = FontStyle.Bold)

    End Function



    'Private Sub Timer_refreshSignMenue_Tick(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Timer_refreshSignMenue.Tick

    Enum availableconnectionstatus
        none
        USBonly
        Wirelessonly
        USBandWireless
    End Enum
    Private m_availableconnectionstatus As availableconnectionstatus
    Property current_availableconnectionstatus() As availableconnectionstatus
        Get
            Return m_availableconnectionstatus

        End Get
        Set(ByVal value As availableconnectionstatus)
            m_availableconnectionstatus = value
            If value = availableconnectionstatus.none Then
                connectionbuttons_markinactive(But_connect)
                connectionbuttons_markinactive(But_get)
                connectionbuttons_markinactive(But_send)
            Else

                connectionbuttons_markavailable(But_connect)
                'font_functions.changestyle(But_connect.Font, FontStyle.Bold)

            End If


            If value = availableconnectionstatus.none Then


            ElseIf value = availableconnectionstatus.none Then
                USBToolStripMenuItem.Enabled = False

                font_functions.changestyle(USBToolStripMenuItem, FontStyle.Italic)
                WirelessToolStripMenuItem.Enabled = False
                font_functions.changestyle(WirelessToolStripMenuItem, FontStyle.Italic)

            ElseIf value = availableconnectionstatus.USBandWireless Then
                USBToolStripMenuItem.Enabled = True

                font_functions.changestyle(USBToolStripMenuItem, FontStyle.Bold)
                WirelessToolStripMenuItem.Enabled = True
                font_functions.changestyle(WirelessToolStripMenuItem, FontStyle.Bold)



            ElseIf value = availableconnectionstatus.USBonly Then
                USBToolStripMenuItem.Enabled = True

                font_functions.changestyle(USBToolStripMenuItem, FontStyle.Bold)
                WirelessToolStripMenuItem.Enabled = False
                font_functions.changestyle(WirelessToolStripMenuItem, FontStyle.Italic)

            ElseIf value = availableconnectionstatus.Wirelessonly Then
                USBToolStripMenuItem.Enabled = False

                font_functions.changestyle(USBToolStripMenuItem, FontStyle.Italic)
                WirelessToolStripMenuItem.Enabled = True
                font_functions.changestyle(WirelessToolStripMenuItem, FontStyle.Bold)

            Else
                MsgBox("bug setting property availableconnections")

            End If


        End Set
    End Property

    'jp jan7/2011 this panel no longer exists
    'Private Sub refresh_pan_USBDialog()

    '    Static buttons As ArrayList = New ArrayList



    '    Dim loopcounter As Int16 = 0

    '    'modify connection line and message

    '    If mysignconnections(signconnectionindex.USB).connected Then
    '        'connected to a sign
    '        If Lbl_USBConnectLine.Text <> "--------" Then
    '            Lbl_USBConnectLine.Text = "--------"

    '        End If
    '        If Lbl_USBConnectMsg.Text <> "Connected" Then
    '            Lbl_USBConnectMsg.Text = "Connected"
    '        End If

    '    ElseIf mysignconnections(signconnectionindex.USB).allSigns_working.Count = 1 Then
    '        'one sign available but not connected
    '        If Lbl_USBConnectLine.Text <> "?????" Then
    '            Lbl_USBConnectLine.Text = "?????"
    '        End If
    '        If Lbl_USBConnectMsg.Text <> "Do you wish" & Constants.vbCrLf & "to connect?" Then
    '            Lbl_USBConnectMsg.Text = "Do you wish" & Constants.vbCrLf & "to connect?"
    '        End If

    '    ElseIf mysignconnections(signconnectionindex.USB).allSigns_working.Count > 1 Then
    '        'multiple signs available
    '        If Lbl_USBConnectLine.Text <> "?????" Then
    '            Lbl_USBConnectLine.Text = "?????"
    '        End If
    '        If Lbl_USBConnectMsg.Text <> "Which Sign?" Then
    '            Lbl_USBConnectMsg.Text = "Which Sign?"
    '        End If


    '    End If



    '        Dim buttonlocation As Point = New Point(120, 5)


    '        loopcounter = 0
    '        While loopcounter < mysignconnections(signconnectionindex.USB).allSigns_working.Count
    '            'Dim splitsignidentifyer As String() = mysignconnections(signconnectionindex.wireless).allSigns_working(loopcounter).split(".")
    '            Dim newbutton As RadioButton '= New RadioButton()

    '            If loopcounter < buttons.Count Then
    '                newbutton = buttons(loopcounter)
    '            Else
    '                newbutton = New RadioButton

    '            End If
    '            newbutton.AutoSize = True


    '        If mysignconnections(signconnectionindex.USB).allSigns_working.Count = 1 Then
    '            'There is only one USB detected


    '            If newbutton.Text <> "USB" Then
    '                newbutton.Text = "USB"
    '            End If


    '        ElseIf mysignconnections(signconnectionindex.USB).allSigns_working.Count > 1 Then

    '            If newbutton.Text <> mysignconnections(signconnectionindex.USB).allSigns_working(loopcounter) Then
    '                newbutton.Text = mysignconnections(signconnectionindex.USB).allSigns_working(loopcounter)
    '            End If
    '        Else


    '            MsgBox("bug")
    '        End If



    '            newbutton.Tag = mysignconnections(signconnectionindex.USB).allSigns_working(loopcounter)
    '            If newbutton.Tag = mysignconnections(signconnectionindex.USB).selectedsign And mysignconnections(signconnectionindex.USB).connected Then
    '                If Not newbutton.Checked Then
    '                    newbutton.Checked = True
    '                End If

    '            Else
    '                If newbutton.Checked Then
    '                    newbutton.Checked = False
    '                End If

    '            End If
    '        If newbutton.Location <> buttonlocation Then
    '            newbutton.Location = buttonlocation
    '        End If

    '        If Not newbutton.Parent Is Pan_USBDialog Then
    '            newbutton.Parent = Pan_USBDialog
    '        End If
    '        If loopcounter >= buttons.Count Then
    '            buttons.Add(newbutton)
    '        End If


    '        'buttonlocation.X += newbutton.Width
    '        ' buttonlocation.X += 104



    '        AddHandler newbutton.CheckedChanged, AddressOf USB_buttons_common_CheckedChanged
    '        buttonlocation.X += newbutton.Width
    '        loopcounter += 1



    '    End While

    '        While loopcounter < buttons.Count

    '            buttons(loopcounter).dispose()
    '            buttons.RemoveAt(loopcounter)
    '            loopcounter += 1
    '        End While

    'End Sub
    Private Sub USB_buttons_common_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs)
        If sender.checked Then

            Dim signidentifier As String = sender.tag

            Dim tempusb As SignConnection_OneSign_USB = DirectCast(mysignconnections(signconnectionindex.USB), SignConnection_OneSign_USB)

            If tempusb.selectedsign <> signidentifier Then

                'for some reason the check change event is called multiple times every time the user clicks the radio button
                connect(tempusb, signidentifier)
                'refresh_pan_wirelessDialog()

            End If

            
        End If



    End Sub

    'jp jan/7/2011 this panel no longer exist
    'Private Sub refresh_pan_wirelessDialog()

    '    Static buttons As ArrayList = New ArrayList



    '    Dim loopcounter As Int16 = 0

    '    'modify connection line and message
    '    If mysignconnections(signconnectionindex.wireless).connected Then
    '        'connected to a sign
    '        If Lbl_wirelessConnectLine.Text <> "--------" Then
    '            Lbl_wirelessConnectLine.Text = "--------"
    '        End If
    '        If Lbl_WirelessConnectMsg.Text <> "Connected" Then
    '            Lbl_WirelessConnectMsg.Text = "Connected"
    '        End If
    '    ElseIf mysignconnections(signconnectionindex.wireless).allSigns_working.Count = 1 Then
    '        'one sign available but not connected
    '        If Lbl_wirelessConnectLine.Text <> "?????" Then
    '            Lbl_wirelessConnectLine.Text = "?????"
    '        End If
    '        If Lbl_WirelessConnectMsg.Text <> "Do you wish" & Constants.vbCrLf & "to connect" Then
    '            Lbl_WirelessConnectMsg.Text = "Do you wish" & Constants.vbCrLf & "to connect"
    '        End If
    '        ElseIf mysignconnections(signconnectionindex.wireless).allSigns_working.Count > 1 Then
    '            'multiple signs available
    '        If Lbl_wirelessConnectLine.Text <> "?????" Then
    '            Lbl_wirelessConnectLine.Text = "?????"
    '        End If
    '        If Lbl_WirelessConnectMsg.Text <> "Which" & Constants.vbCrLf & "Sign" Then
    '            Lbl_WirelessConnectMsg.Text = "Which" & Constants.vbCrLf & "Sign"
    '        End If
    '    ElseIf DirectCast(mysignconnections(signconnectionindex.wireless), SignConnection_OneSign_Wireless_Atmel).allportswithTranceiverunits.Count > 0 Then
    '        'tranceiver found but no signs
    '        If Lbl_wirelessConnectLine.Text <> "XXXXX" Then
    '            Lbl_wirelessConnectLine.Text = "XXXXX"
    '        End If
    '        If Lbl_WirelessConnectMsg.Text <> "No signs" & Constants.vbCrLf & "in range" Then
    '            Lbl_WirelessConnectMsg.Text = "No signs" & Constants.vbCrLf & "in range"
    '        End If
    '        End If

    '        ''dispose old checkboxes
    '        'While loopcounter < buttons.Count
    '        '    buttons(loopcounter).dispose()
    '        '    loopcounter += 1
    '        'End While


    '        Dim buttonlocation As Point = New Point(115, 5)
    '        loopcounter = 0
    '        While loopcounter < mysignconnections(signconnectionindex.wireless).allSigns_working.Count
    '            Dim splitsignidentifyer As String() = mysignconnections(signconnectionindex.wireless).allSigns_working(loopcounter).split(".")
    '            Dim newbutton As RadioButton '= New RadioButton()

    '            If loopcounter < buttons.Count Then
    '                newbutton = buttons(loopcounter)
    '            Else
    '                newbutton = New RadioButton

    '            End If
    '            newbutton.AutoSize = True
    '            newbutton.Text = splitsignidentifyer(1)
    '            'MsgBox("[" & newbutton.Text & "]")

    '            newbutton.Tag = mysignconnections(signconnectionindex.wireless).allSigns_working(loopcounter)
    '            If newbutton.Tag = mysignconnections(signconnectionindex.wireless).selectedsign And mysignconnections(signconnectionindex.wireless).connected Then
    '                newbutton.Checked = True

    '            Else
    '                newbutton.Checked = False
    '        End If

    '        If newbutton.Location <> buttonlocation Then
    '            newbutton.Location = buttonlocation
    '        End If
    '        If Not newbutton.Parent Is Pan_wirelessDialog Then
    '            newbutton.Parent = Pan_wirelessDialog
    '        End If
    '        If loopcounter >= buttons.Count Then
    '            buttons.Add(newbutton)
    '        End If

    '        'buttonlocation.X += newbutton.Width
    '        ' buttonlocation.X += 104



    '        AddHandler newbutton.CheckedChanged, AddressOf Wireless_Connectbuttons_common_CheckedChanged
    '        buttonlocation.X += newbutton.Width
    '        loopcounter += 1



    '    End While

    '        While loopcounter < buttons.Count

    '            buttons(loopcounter).dispose()
    '            buttons.RemoveAt(loopcounter)
    '            loopcounter += 1
    '        End While

    'End Sub
    Private Sub Wireless_Connectbuttons_common_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs)
        If sender.checked Then

            Dim signidentifier As String = sender.tag

            Dim tempsign As SignConnection_OneSign_Wireless_Atmel = DirectCast(mysignconnections(signconnectionindex.wireless), SignConnection_OneSign_Wireless_Atmel)


            If tempsign.selectedsign <> signidentifier Then

                'for some reason the check change event is
                connect(tempsign, signidentifier)
                'refresh_pan_USBDialog()
            End If
        End If



    End Sub
    Public ReadOnly Property connectedtoasign() As Boolean
        Get

            'Dim returnvalue As Boolean = False

            If selectedConnectionindex <> signconnectionindex.none Then

                If mysignconnections(selectedConnectionindex).connected Then
                    'connected to a sign

                    If Not mysignconnections(selectedConnectionindex).TestSignConnection Then

                        'test of sign connection failed 
                        'remove sign from list of available signs now instead of waiting for next scan

                        Dim currentlyselectedsign As String = mysignconnections(selectedConnectionindex).selectedsign

                        mysignconnections(selectedConnectionindex).disconnect()
                        mysignconnections(selectedConnectionindex).allSigns_working.Remove(currentlyselectedsign)

                        selectedConnectionindex = signconnectionindex.none


                        connectionbuttons_markinactive(But_connect)
                        connectionbuttons_markinactive(But_send)
                        Return False
                    End If

                End If

                Return True

            Else

                Return False

            End If


        End Get
    End Property
    Private ReadOnly Property firstComportScanComplete()
        Get
            Return mysignconnections(signconnectionindex.USB).firstComportScanComplete And mysignconnections(signconnectionindex.wireless).firstComportScanComplete


        End Get
    End Property

    Sub refresh_Pan_wirelessNodes()
        Node_wireless1.Visible = False
        Node_wireless2.Visible = False
        Node_wireless3.Visible = False

        Node_wireless4.Visible = False




        Node_wireless1.state = node.nodestate.unselected
        Node_wireless2.state = node.nodestate.unselected
        Node_wireless3.state = node.nodestate.unselected
        Node_wireless4.state = node.nodestate.unselected


        Node_wireless5.state = node.nodestate.unselected
        
        If mysignconnections(signconnectionindex.wireless).allSigns_working.Count = 0 Then
            'no wireless signs 

            If DirectCast(mysignconnections(signconnectionindex.wireless), SignConnection_OneSign_Wireless_Atmel).allportswithTranceiverunits.Count > 0 Then
                'tranceiver found
                Pan_wirelessBaseNoSigns.Visible = True
                Pan_noWireless.Visible = False
            Else
                'no tranceiver
                'Pan_wirelessBaseNoSigns.Visible = False
                Pan_noWireless.Visible = True
            End If

            Return
        Else

            'signs have been found
            Pan_wirelessBaseNoSigns.Visible = False
            Pan_noWireless.Visible = False

        End If

        If mysignconnections(signconnectionindex.wireless).allSigns_working.Count >= 1 Then
            '
            Node_wireless1.Visible = True

            Dim signidentifyer As String = mysignconnections(signconnectionindex.wireless).allSigns_working(0)
            Dim splitsignidentfyer As String() = signidentifyer.Split(".")


            Node_wireless1.text = splitsignidentfyer(1)


            Node_wireless1.Tag = signidentifyer
            If mysignconnections(signconnectionindex.wireless).connected And mysignconnections(signconnectionindex.wireless).selectedsign = Node_wireless1.Tag Then
                Node_wireless1.state = node.nodestate.selected
            Else
                Node_wireless1.state = node.nodestate.unselected

            End If

        Else
            Node_wireless1.Visible = False
            Node_wireless2.Visible = False
            Node_wireless3.Visible = False
            Node_wireless4.Visible = False
            Node_wireless5.Visible = False
            
            Return
        End If



        If mysignconnections(signconnectionindex.wireless).allSigns_working.Count >= 2 Then
            '
            Node_wireless2.Visible = True

            Dim signidentifyer As String = mysignconnections(signconnectionindex.wireless).allSigns_working(1)
            Dim splitsignidentfyer As String() = signidentifyer.Split(".")


            Node_wireless2.text = splitsignidentfyer(1)


            Node_wireless2.Tag = signidentifyer
            If mysignconnections(signconnectionindex.wireless).connected And mysignconnections(signconnectionindex.wireless).selectedsign = Node_wireless2.Tag Then
                Node_wireless2.state = node.nodestate.selected
            Else
                Node_wireless2.state = node.nodestate.unselected

            End If

        Else

            Node_wireless2.Visible = False
            Node_wireless3.Visible = False
            Node_wireless4.Visible = False
            Node_wireless5.Visible = False
            
            Return
        End If


        If mysignconnections(signconnectionindex.wireless).allSigns_working.Count >= 3 Then

            Node_wireless3.Visible = True

            Dim signidentifyer As String = mysignconnections(signconnectionindex.wireless).allSigns_working(2)
            Dim splitsignidentfyer As String() = signidentifyer.Split(".")


            Node_wireless3.text = splitsignidentfyer(1)


            Node_wireless3.Tag = signidentifyer
            If mysignconnections(signconnectionindex.wireless).connected And mysignconnections(signconnectionindex.wireless).selectedsign = signidentifyer Then
                Node_wireless3.state = node.nodestate.selected
            Else
                Node_wireless3.state = node.nodestate.unselected

            End If

        Else
            Node_wireless3.Visible = False
            Node_wireless4.Visible = False
            Node_wireless5.Visible = False

            Return
        End If

        If mysignconnections(signconnectionindex.wireless).allSigns_working.Count >= 4 Then
            '
            Node_wireless4.Visible = True

            Dim signidentifyer As String = mysignconnections(signconnectionindex.wireless).allSigns_working(3)
            Dim splitsignidentfyer As String() = signidentifyer.Split(".")


            Node_wireless4.text = splitsignidentfyer(1)


            Node_wireless4.Tag = signidentifyer
            If mysignconnections(signconnectionindex.wireless).connected And mysignconnections(signconnectionindex.wireless).selectedsign = signidentifyer Then
                Node_wireless4.state = node.nodestate.selected
            Else
                Node_wireless4.state = node.nodestate.unselected

            End If

        Else
            Node_wireless4.Visible = False
            Node_wireless5.Visible = False
            

            Return
        End If



        If mysignconnections(signconnectionindex.wireless).allSigns_working.Count >= 5 Then
            '
            Node_wireless5.Visible = True

            Dim signidentifyer As String = mysignconnections(signconnectionindex.wireless).allSigns_working(4)
            Dim splitsignidentfyer As String() = signidentifyer.Split(".")


            Node_wireless5.text = splitsignidentfyer(1)


            Node_wireless5.Tag = signidentifyer
            If mysignconnections(signconnectionindex.wireless).connected And mysignconnections(signconnectionindex.wireless).selectedsign = signidentifyer Then
                Node_wireless5.state = node.nodestate.selected
            Else
                Node_wireless5.state = node.nodestate.unselected

            End If

        Else
            Node_wireless5.Visible = False
            
            Return
        End If

        
    End Sub





    Sub refresh_Pan_internetNodes()
        Node_internet1.Visible = False
        Node_internet2.Visible = False
        Node_internet3.Visible = False

        'Node_internet4.Visible = False
        'Node_internet5.Visible = False




        Node_internet1.state = node.nodestate.unselected
        Node_internet2.state = node.nodestate.unselected
        Node_internet3.state = node.nodestate.unselected
        'Node_internet4.state = node.nodestate.unselected


        'Node_internet5.state = node.nodestate.unselected




        'show TCP socket signs first



        If (mysignconnections(signconnectionindex.TCPsocket_via_server).allSigns_working.Count + mysignconnections(signconnectionindex.FTP).allSigns_working.Count = 0) Then
            'no internet signs 

            If DirectCast(mysignconnections(signconnectionindex.TCPsocket_via_server), SignConnection_Internet_Via_Server).serverConncetionCount > 0 Then
                'connected to server
                Pan_server_no_signs.Visible = True
                Pan_noServer.Visible = False
            Else

                Pan_server_no_signs.Visible = False
                Pan_noServer.Visible = True

            End If

            'Return
        Else

            'signs have been found
            Pan_server_no_signs.Visible = False
            Pan_noServer.Visible = False

        End If


        If mysignconnections(signconnectionindex.TCPsocket_via_server).allSigns_working.Count >= 1 Then
            '
            Node_internet1.Visible = True

            Dim signidentifyer As String = mysignconnections(signconnectionindex.TCPsocket_via_server).allSigns_working(0)
            Dim splitsignidentfyer As String() = signidentifyer.Split(".")


            Node_internet1.text = splitsignidentfyer(1)


            Node_internet1.Tag = signidentifyer
            If mysignconnections(signconnectionindex.TCPsocket_via_server).connected And mysignconnections(signconnectionindex.TCPsocket_via_server).selectedsign = Node_internet1.Tag Then
                Node_internet1.state = node.nodestate.selected
            Else
                Node_internet1.state = node.nodestate.unselected

            End If

        
        End If



        If mysignconnections(signconnectionindex.TCPsocket_via_server).allSigns_working.Count >= 2 Then
            '
            Node_internet2.Visible = True

            Dim signidentifyer As String = mysignconnections(signconnectionindex.TCPsocket_via_server).allSigns_working(1)
            Dim splitsignidentfyer As String() = signidentifyer.Split(".")


            Node_internet2.text = splitsignidentfyer(1)


            Node_internet2.Tag = signidentifyer
            If mysignconnections(signconnectionindex.TCPsocket_via_server).connected And mysignconnections(signconnectionindex.TCPsocket_via_server).selectedsign = Node_internet2.Tag Then
                Node_internet2.state = node.nodestate.selected
            Else
                Node_internet2.state = node.nodestate.unselected

            End If

        
        End If


        If mysignconnections(signconnectionindex.TCPsocket_via_server).allSigns_working.Count >= 3 Then

            Node_internet3.Visible = True

            Dim signidentifyer As String = mysignconnections(signconnectionindex.TCPsocket_via_server).allSigns_working(2)
            Dim splitsignidentfyer As String() = signidentifyer.Split(".")


            Node_internet3.text = splitsignidentfyer(1)


            Node_internet3.Tag = signidentifyer
            If mysignconnections(signconnectionindex.TCPsocket_via_server).connected And mysignconnections(signconnectionindex.TCPsocket_via_server).selectedsign = signidentifyer Then
                Node_internet3.state = node.nodestate.selected
            Else
                Node_internet3.state = node.nodestate.unselected

            End If

        
        End If

        'If mysignconnections(signconnectionindex.internet_via_server).allSigns_working.Count >= 4 Then
        '    '
        '    Node_internet4.Visible = True

        '    Dim signidentifyer As String = mysignconnections(signconnectionindex.internet_via_server).allSigns_working(3)
        '    Dim splitsignidentfyer As String() = signidentifyer.Split(".")


        '    Node_internet4.text = splitsignidentfyer(1)


        '    'Node_internet4.Tag = signidentifyer
        '    If mysignconnections(signconnectionindex.internet_via_server).connected And mysignconnections(signconnectionindex.internet_via_server).selectedsign = signidentifyer Then
        '        Node_internet4.state = node.nodestate.selected
        '    Else
        '        'Node_internet4.state = node.nodestate.unselected

        '    End If

        'Else
        '    Node_internet4.Visible = False
        '    Node_internet5.Visible = False


        '    Return
        'End If



        'If mysignconnections(signconnectionindex.internet_via_server).allSigns_working.Count >= 5 Then
        '    '
        '    Node_internet5.Visible = True

        '    Dim signidentifyer As String = mysignconnections(signconnectionindex.internet_via_server).allSigns_working(4)
        '    Dim splitsignidentfyer As String() = signidentifyer.Split(".")


        '    Node_internet5.text = splitsignidentfyer(1)


        '    Node_internet5.Tag = signidentifyer
        '    If mysignconnections(signconnectionindex.internet_via_server).connected And mysignconnections(signconnectionindex.internet_via_server).selectedsign = signidentifyer Then
        '        Node_internet5.state = node.nodestate.selected
        '    Else
        '        Node_internet5.state = node.nodestate.unselected

        '    End If

        'Else
        '    Node_internet5.Visible = False

        '    Return
        'End If
        If mysignconnections(signconnectionindex.FTP).allSigns_working.Count >= 1 Then
            If mysignconnections(signconnectionindex.TCPsocket_via_server).allSigns_working.Count = 0 Then
                Node_internet1.Visible = True

                Dim signidentifyer As String = mysignconnections(signconnectionindex.FTP).allSigns_working(0)



                Node_internet1.text = signidentifyer


                Node_internet1.Tag = "ftp"
                If mysignconnections(signconnectionindex.FTP).connected And mysignconnections(signconnectionindex.FTP).selectedsign = Node_internet1.selected_text Then
                    Node_internet1.state = node.nodestate.selected
                Else
                    Node_internet1.state = node.nodestate.unselected

                End If

            End If
        ElseIf mysignconnections(signconnectionindex.TCPsocket_via_server).allSigns_working.Count = 1 Then
            Node_internet2.Visible = True

            Dim signidentifyer As String = mysignconnections(signconnectionindex.FTP).allSigns_working(0)



            Node_internet2.text = signidentifyer


            Node_internet2.Tag = "ftp"
            If mysignconnections(signconnectionindex.FTP).connected And mysignconnections(signconnectionindex.FTP).selectedsign = Node_internet2.selected_text Then
                Node_internet2.state = node.nodestate.selected
            Else
                Node_internet2.state = node.nodestate.unselected

            End If
        ElseIf mysignconnections(signconnectionindex.TCPsocket_via_server).allSigns_working.Count = 2 Then
            Node_internet3.Visible = True

            Dim signidentifyer As String = mysignconnections(signconnectionindex.FTP).allSigns_working(0)



            Node_internet3.text = signidentifyer


            Node_internet3.Tag = "ftp"
            If mysignconnections(signconnectionindex.FTP).connected And mysignconnections(signconnectionindex.FTP).selectedsign = Node_internet3.selected_text Then
                Node_internet3.state = node.nodestate.selected
            Else
                Node_internet3.state = node.nodestate.unselected

            End If
        End If
       

        '''''''''''''''

        If mysignconnections(signconnectionindex.FTP).allSigns_working.Count >= 2 Then
            If mysignconnections(signconnectionindex.TCPsocket_via_server).allSigns_working.Count = 0 Then
                Node_internet2.Visible = True

                Dim signidentifyer As String = mysignconnections(signconnectionindex.FTP).allSigns_working(1)



                Node_internet2.text = signidentifyer


                Node_internet2.Tag = "ftp"
                If mysignconnections(signconnectionindex.FTP).connected And mysignconnections(signconnectionindex.FTP).selectedsign = Node_internet2.selected_text Then
                    Node_internet2.state = node.nodestate.selected
                Else
                    Node_internet2.state = node.nodestate.unselected

                End If

            End If
        ElseIf mysignconnections(signconnectionindex.TCPsocket_via_server).allSigns_working.Count = 1 Then
            Node_internet3.Visible = True

            Dim signidentifyer As String = mysignconnections(signconnectionindex.FTP).allSigns_working(1)



            Node_internet3.text = signidentifyer


            Node_internet3.Tag = "ftp"
            If mysignconnections(signconnectionindex.FTP).connected And mysignconnections(signconnectionindex.FTP).selectedsign = Node_internet3.selected_text Then
                Node_internet3.state = node.nodestate.selected
            Else
                Node_internet3.state = node.nodestate.unselected

            End If
         End If

        ''''''''''''
        If mysignconnections(signconnectionindex.FTP).allSigns_working.Count >= 3 Then
            If mysignconnections(signconnectionindex.TCPsocket_via_server).allSigns_working.Count = 0 Then
                Node_internet3.Visible = True

                Dim signidentifyer As String = mysignconnections(signconnectionindex.FTP).allSigns_working(2)



                Node_internet3.text = signidentifyer


                Node_internet3.Tag = "ftp"
                If mysignconnections(signconnectionindex.FTP).connected And mysignconnections(signconnectionindex.FTP).selectedsign = Node_internet3.selected_text Then
                    Node_internet3.state = node.nodestate.selected
                Else
                    Node_internet3.state = node.nodestate.unselected

                End If

            End If
        End If
    End Sub


    Sub refresh_Pan_USBnodes()


        Node_usb1.Visible = False
        Node_usb2.Visible = False



        Node_usb1.state = node.nodestate.unselected
        Node_usb2.state = node.nodestate.unselected




        If mysignconnections(signconnectionindex.USB).allSigns_working.Count = 0 Then

            Pan_noUSBFound.Visible = True
            Return
        Else
            Pan_noUSBFound.Visible = False
        End If


        If mysignconnections(signconnectionindex.USB).allSigns_working.Count = 1 Then

            
            Node_usb1.Visible = True
            Node_usb2.Visible = False
            Node_usb3.Visible = False
            Node_usb4.Visible = False
            Node_usb5.Visible = False


            'Return 
            Node_usb1.picture_percent = 0  '041413
            Node_usb1.Tag = mysignconnections(signconnectionindex.USB).allSigns_working(0)
            If mysignconnections(signconnectionindex.USB).connected Then
                Node_usb1.state = node.nodestate.selected
                Node_usb1.text = "USB Is Connected!"

            Else
                Node_usb1.state = node.nodestate.unselected
                Node_usb1.text = "USB - Click to Connect"


            End If
            Return


        End If


        If mysignconnections(signconnectionindex.USB).allSigns_working.Count >= 1 Then
            Node_usb1.Visible = True


            Node_usb1.text = mysignconnections(signconnectionindex.USB).allSigns_working(0)
            Node_usb1.Tag = mysignconnections(signconnectionindex.USB).allSigns_working(0)

            If mysignconnections(signconnectionindex.USB).connected And mysignconnections(signconnectionindex.USB).selectedsign = Node_usb1.Tag Then

                Node_usb1.state = node.nodestate.selected




            Else
                Node_usb1.state = node.nodestate.unselected

            End If

        Else

            Node_usb1.Visible = False
            Node_usb2.Visible = False
            Node_usb3.Visible = False
            Node_usb4.Visible = False
            Node_usb5.Visible = False
            Return
        End If


        If mysignconnections(signconnectionindex.USB).allSigns_working.Count >= 2 Then
            Node_usb2.Visible = True


            Node_usb2.text = mysignconnections(signconnectionindex.USB).allSigns_working(1)
            Node_usb2.Tag = mysignconnections(signconnectionindex.USB).allSigns_working(1)

            If mysignconnections(signconnectionindex.USB).connected And mysignconnections(signconnectionindex.USB).selectedsign = Node_usb2.Tag Then

                Node_usb2.state = node.nodestate.selected




            Else
                Node_usb2.state = node.nodestate.unselected

            End If

        Else

            'Node_usb1.Visible = False
            Node_usb2.Visible = False
            Node_usb3.Visible = False
            Node_usb4.Visible = False
            Node_usb5.Visible = False
            Return
        End If

        If mysignconnections(signconnectionindex.USB).allSigns_working.Count >= 3 Then
            Node_usb3.Visible = True


            Node_usb3.text = mysignconnections(signconnectionindex.USB).allSigns_working(2)
            Node_usb3.Tag = mysignconnections(signconnectionindex.USB).allSigns_working(2)

            If mysignconnections(signconnectionindex.USB).connected And mysignconnections(signconnectionindex.USB).selectedsign = Node_usb3.Tag Then

                Node_usb3.state = node.nodestate.selected




            Else
                Node_usb3.state = node.nodestate.unselected

            End If

        Else

            'Node_usb1.Visible = False
            'Node_usb2.Visible = False
            Node_usb3.Visible = False
            Node_usb4.Visible = False
            Node_usb5.Visible = False
            Return
        End If

        If mysignconnections(signconnectionindex.USB).allSigns_working.Count >= 4 Then
            Node_usb4.Visible = True


            Node_usb4.text = mysignconnections(signconnectionindex.USB).allSigns_working(3)
            Node_usb4.Tag = mysignconnections(signconnectionindex.USB).allSigns_working(3)

            If mysignconnections(signconnectionindex.USB).connected And mysignconnections(signconnectionindex.USB).selectedsign = Node_usb4.Tag Then

                Node_usb4.state = node.nodestate.selected




            Else
                Node_usb4.state = node.nodestate.unselected

            End If

        Else

            Node_usb4.Visible = False
            Node_usb5.Visible = False
            Return
        End If



        If mysignconnections(signconnectionindex.USB).allSigns_working.Count >= 5 Then
            Node_usb5.Visible = True


            Node_usb5.text = mysignconnections(signconnectionindex.USB).allSigns_working(4)
            Node_usb5.Tag = mysignconnections(signconnectionindex.USB).allSigns_working(4)

            If mysignconnections(signconnectionindex.USB).connected And mysignconnections(signconnectionindex.USB).selectedsign = Node_usb5.Tag Then

                Node_usb5.state = node.nodestate.selected




            Else
                Node_usb5.state = node.nodestate.unselected

            End If

        Else

            Node_usb5.Visible = False
        End If




    End Sub


    Public Sub refreshSignMenue()

        If Not formloaded Then
            Return
        End If


        Static busy As Boolean = False




        If Not busy Then

            busy = True






            'comented out section auto connected to first internet sign on list   

            'If Me.mysignconnections(Me.signconnectionindex.internet_via_server).allSigns_working.Count > 0 Then
            '    'temporarily we will auto connect to the fist sign on the list and disable all other connections

            '    If Not Me.mysignconnections(Me.signconnectionindex.internet_via_server).connected Then

            '        Pan_sever_filebuttons.Visible = False
            '        Lbl_internet_sign.Text = mysignconnections(Me.signconnectionindex.internet_via_server).allSigns_working(0)

            '        Me.connect(DirectCast(mysignconnections(Me.signconnectionindex.internet_via_server), SignConnection_Internet_Via_Server), mysignconnections(Me.signconnectionindex.internet_via_server).allSigns_working(0))
            '        If Me.mysignconnections(Me.signconnectionindex.internet_via_server).connected Then
            '            'the ability to save and retreive files is not supported by current version of server script


            '            'Pan_sever_filebuttons.Visible = True
            '        End If




            '    End If

            '    Pan_internet_connection.Visible = True
            '    busy = False


            '    Return


            'End If



            Pan_internet_connection.Visible = False

            'the first section creates the dialog on the combo (and other?) tab
            'below that populate the member of the connect drop down menu





            'these are old outdated notes

            'sign connection situations



            '-Currently connected

            '    -test of connection fails
            '           ->disconnect + drop down to not connected
            '    -Connected to only USB (reguardless of wireless)
            '          ->dialog says connected via USB (no identifying info other then "USB")
            '          ->if wireless available give dialog + option to change connection 
            '    -any other connection
            '          ->diolog stating which sign connected to (sign # for wireless [or comport + sign if multiple transceivers], comport for USB)
            '      (if still scanning for wireless say so + give option to connect to ones found so far)    
            '-not connected currently connected to a sign
            '    -one USB availble (reguardless of wireless)
            '         -> auto connect
            '         -> dialog + options depend of wireless state

            '    -no USB + still scanning wireles
            '         ->dialog stating no USB + scanning for wireles + option to connect to any found so far

            '    -Multiple USB + still scanning Wireless
            '          ->dialog stating situation + option to connect to any signs found so far
            '    -one Wireless (and no USB)
            '          -> auto connect
            '          ->dialog states connection
            '    -no signs found
            '          ->dialog so states
            '    -multiple USB or no USB + multiple wireless
            '          ->dialog + options




            'remember this is called everytime the scan process completes a scan
            'there for it is ok to auto connect at this point


            'refresh_pan_USBDialog()
            Dim removedialog As Boolean = False 'used for debugging - in normal operation should be false
            If Not removedialog Then

                'jp jan/7/2011 these panels no longer exist
                'Pan_wirelessDialog.Visible = False

                'Pan_USBDialog.Visible = True


                '''''''''auto connect''''''''''''''''''''''
                If Not connectedtoasign() Then
                    If mysignconnections(signconnectionindex.USB).allSigns_working.Count = 1 And firstComportScanComplete() Then

                        'one USB sign found
                        'and first comport scan is complete

                        'auto connect

                        'before separating signidentifier out of the long expression,the compiler was calling the bass connect function
                        Dim signidentifier As String = mysignconnections(signconnectionindex.USB).allSigns_working(0)
                        If mysignconnections(signconnectionindex.USB).connect(signidentifier, True) Then

                            connectionbuttons_markavailable(But_send)
                            connectionbuttons_markavailable(But_get)

                            selectedConnectionindex = signconnectionindex.USB

                        Else
                            'connection failed
                            'remove from list of available signs then leave dialog as is

                            mysignconnections(signconnectionindex.USB).allSigns_working.Remove(signidentifier)
                            busy = False
                            Return
                        End If



                    ElseIf mysignconnections(signconnectionindex.USB).allSigns_working.Count >= 1 Then
                        'multiple USB (or 1 USB the first comport scan not finished)

                        'do not auto connect

                    ElseIf mysignconnections(signconnectionindex.wireless).allSigns_working.Count >= 1 Then
                        'at least one wireless detected

                        'auto connect to first wireless sign on list sign
                        Dim tempwirecon As SignConnection_OneSign_Wireless_Atmel = mysignconnections(signconnectionindex.wireless)
                        If tempwirecon.connect(tempwirecon.allSigns_working(0), True) Then

                            connectionbuttons_markavailable(But_send)
                            connectionbuttons_markavailable(But_get)

                            selectedConnectionindex = signconnectionindex.wireless


                        Else

                            'connection failed
                            'remove form list of available signs
                            'it is especailly important to remove wire less signs from list 
                            'because it takes a long time for scan process to realize no longer available
                            'and we would repeatedly try to auto connect

                            tempwirecon.allSigns_working.RemoveAt(0)
                            busy = False
                            Return
                        End If


                    ElseIf mysignconnections(signconnectionindex.TCPsocket_via_server).allSigns_working.Count >= 1 Then

                        'at least one internet detected

                        'auto connect to first wireless sign on list sign
                        Dim tempwirecon As SignConnection_Internet_Via_Server = mysignconnections(signconnectionindex.TCPsocket_via_server)
                        If tempwirecon.connect(tempwirecon.allSigns_working(0), True) Then

                            connectionbuttons_markavailable(But_send)
                            connectionbuttons_markavailable(But_get)

                            selectedConnectionindex = signconnectionindex.TCPsocket_via_server


                        Else

                            'connection failed
                            'remove form list of available signs
                            'it is especailly important to remove wire less signs from list 
                            'because it takes a long time for scan process to realize no longer available
                            'and we would repeatedly try to auto connect

                            tempwirecon.allSigns_working.RemoveAt(0)
                            busy = False
                            Return
                        End If

                    ElseIf mysignconnections(signconnectionindex.FTP).allSigns_working.Count >= 1 Then
                        Dim tempFTPcon As SignConnection_FTP = mysignconnections(signconnectionindex.FTP)
                        If tempFTPcon.connect(tempFTPcon.allSigns_working(0), True) Then

                            connectionbuttons_markavailable(But_send)
                            connectionbuttons_markavailable(But_get)

                            selectedConnectionindex = signconnectionindex.FTP

                        End If

                    End If






                End If


                ''''''''''''''''left side images
                If mysignconnections(signconnectionindex.USB).allSigns_working.Count >= 1 Then
                    ' USB(found)
                    Lbl_USB_text.Visible = False

                    If IO.File.Exists(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\USB.gif") Then

                        AIV_USB.imagefile = IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\USB.gif"

                        AIV_USB.Visible = True

                    ElseIf IO.File.Exists(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\USB.jpg") Then

                        AIV_USB.imagefile = IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\USB.jpg"

                        AIV_USB.Visible = True

                        'Pan_comBase.BackgroundImage = System.Drawing.Image.FromFile(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\USB.jpg")
                        'Pan_comBase.Visible = True
                    ElseIf IO.File.Exists(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\USB.png") Then


                        AIV_USB.imagefile = IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\USB.png"

                        AIV_USB.Visible = True



                        'Pan_comBase.BackgroundImage = System.Drawing.Image.FromFile(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\USB.png")
                        'Pan_comBase.Visible = True


                    Else


                        AIV_USB.imagefile = ""
                        Lbl_USB_text.Text = "USB signs found" & Constants.vbCrLf & "icon image missing"
                        'Pan_comBase.Visible = True
                        Lbl_USB_text.Visible = True

                    End If
                    'Pan_wirelessDialog.Visible = True
                    'refresh_pan_wirelessDialog()


                Else

                    'USB NOT  found
                    Lbl_USB_text.Visible = False

                    If IO.File.Exists(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\noUSB.gif") Then

                        AIV_USB.imagefile = IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\noUSB.gif"

                        AIV_USB.Visible = True

                    ElseIf IO.File.Exists(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\noUSB.jpg") Then


                        AIV_USB.imagefile = IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\noUSB.jpg"

                        AIV_USB.Visible = True

                        'Pan_comBase.BackgroundImage = System.Drawing.Image.FromFile(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\noUSB.jpg")
                        'Pan_comBase.Visible = True
                    ElseIf IO.File.Exists(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\USB.png") Then


                        AIV_USB.imagefile = IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\noUSB.png"

                        AIV_USB.Visible = True

                        'Pan_comBase.BackgroundImage = System.Drawing.Image.FromFile(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\noUSB.png")
                        'Pan_comBase.Visible = True


                    Else


                        AIV_USB.imagefile = ""

                        Lbl_USB_text.Text = "no USB signs" & Constants.vbCrLf & "icon image missing!"
                        'Pan_comBase.Visible = True
                        Lbl_USB_text.Visible = True

                    End If
                    'Pan_wirelessDialog.Visible = True
                    'refresh_pan_wirelessDialog()



                End If



                If DirectCast(mysignconnections(signconnectionindex.wireless), SignConnection_OneSign_Wireless_Atmel).allportswithTranceiverunits.Count >= 1 Then
                    ' zigbee coordinator found
                    Lbl_zigbee_text.Visible = False

                    If IO.File.Exists(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\ZigbeeRouter.gif") Then

                        AIV_Zigbee.imagefile = IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\ZigbeeRouter.gif"

                        AIV_Zigbee.Visible = True

                    ElseIf IO.File.Exists(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\ZigbeeRouter.jpg") Then

                        AIV_Zigbee.imagefile = IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\ZigbeeRouter.jpg"

                        AIV_Zigbee.Visible = True

                        'Pan_comBase.BackgroundImage = System.Drawing.Image.FromFile(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\USB.jpg")
                        'Pan_comBase.Visible = True
                    ElseIf IO.File.Exists(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\ZigbeeRouter.png") Then


                        AIV_Zigbee.imagefile = IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\ZigbeeRouter.png"

                        AIV_Zigbee.Visible = True



                        'Pan_comBase.BackgroundImage = System.Drawing.Image.FromFile(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\USB.png")
                        'Pan_comBase.Visible = True


                    Else


                        AIV_Zigbee.imagefile = ""
                        Lbl_zigbee_text.Text = "Zigbee base found" & Constants.vbCrLf & "icon image missing"
                        'Pan_comBase.Visible = True
                        Lbl_zigbee_text.Visible = True

                    End If
                    'Pan_wirelessDialog.Visible = True
                    'refresh_pan_wirelessDialog()


                Else

                    'coordinator NOT  found
                    Lbl_zigbee_text.Visible = False

                    If IO.File.Exists(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\noZigbeeRouter.gif") Then

                        AIV_Zigbee.imagefile = IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\noZigbeeRouter.gif"

                        AIV_Zigbee.Visible = True

                    ElseIf IO.File.Exists(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\noZigbeeRouter.jpg") Then


                        AIV_Zigbee.imagefile = IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\noZigbeeRouter.jpg"

                        AIV_Zigbee.Visible = True

                        'Pan_comBase.BackgroundImage = System.Drawing.Image.FromFile(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\noUSB.jpg")
                        'Pan_comBase.Visible = True
                    ElseIf IO.File.Exists(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\noZigbeeRouter.png") Then


                        AIV_Zigbee.imagefile = IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\noZigbeeRouter.png"

                        AIV_Zigbee.Visible = True

                        'Pan_comBase.BackgroundImage = System.Drawing.Image.FromFile(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\noUSB.png")
                        'Pan_comBase.Visible = True


                    Else


                        AIV_Zigbee.imagefile = ""

                        Lbl_zigbee_text.Text = "no wireless base" & Constants.vbCrLf & "icon image missing!"
                        'Pan_comBase.Visible = True
                        Lbl_zigbee_text.Visible = True

                    End If
                    'Pan_wirelessDialog.Visible = True
                    'refresh_pan_wirelessDialog()



                End If





                If DirectCast(mysignconnections(signconnectionindex.TCPsocket_via_server), SignConnection_Internet_Via_Server).serverConncetionCount + DirectCast(mysignconnections(signconnectionindex.FTP), SignConnection_FTP).allSigns_working.Count >= 1 Then
                    ' connected to server
                    lbl_internet_text.Visible = False

                    If IO.File.Exists(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\ServerConnection.gif") Then

                        AIV_Internet.imagefile = IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\ServerConnection.gif"

                        AIV_Internet.Visible = True

                    ElseIf IO.File.Exists(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\ServerConnection.jpg") Then

                        AIV_Internet.imagefile = IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\ServerConnection.jpg"

                        AIV_Internet.Visible = True

                        'AIV_Internet.Invalidate()

                        'Pan_comBase.BackgroundImage = System.Drawing.Image.FromFile(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\USB.jpg")
                        'Pan_comBase.Visible = True
                    ElseIf IO.File.Exists(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\ServerConnection.png") Then


                        AIV_Internet.imagefile = IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\ServerConnection.png"

                        AIV_Internet.Visible = True


                        'AIV_Internet.Invalidate()
                        'Pan_comBase.BackgroundImage = System.Drawing.Image.FromFile(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\USB.png")
                        'Pan_comBase.Visible = True


                    Else


                        AIV_Internet.imagefile = ""
                        lbl_internet_text.Text = "connected to server" & Constants.vbCrLf & "icon image missing"
                        'Pan_comBase.Visible = True
                        lbl_internet_text.Visible = True

                    End If
                    'Pan_wirelessDialog.Visible = True
                    'refresh_pan_wirelessDialog()


                Else

                    'coordinator NOT  found
                    lbl_internet_text.Visible = False

                    If IO.File.Exists(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\noServerConnection.gif") Then

                        AIV_Internet.imagefile = IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\noServerConnection.gif"

                        AIV_Internet.Visible = True

                    ElseIf IO.File.Exists(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\noServerConnection.jpg") Then


                        AIV_Internet.imagefile = IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\noServerConnection.jpg"

                        AIV_Internet.Visible = True

                        'Pan_comBase.BackgroundImage = System.Drawing.Image.FromFile(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\noUSB.jpg")
                        'Pan_comBase.Visible = True
                    ElseIf IO.File.Exists(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\noServerConnection.png") Then


                        AIV_Internet.imagefile = IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\noServerConnection.png"

                        AIV_Internet.Visible = True

                        'Pan_comBase.BackgroundImage = System.Drawing.Image.FromFile(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\noUSB.png")
                        'Pan_comBase.Visible = True


                    Else


                        AIV_Internet.imagefile = ""

                        lbl_internet_text.Text = "not connected to server" & Constants.vbCrLf & "icon image missing!"
                        'Pan_comBase.Visible = True
                        lbl_internet_text.Visible = True

                    End If
                    'Pan_wirelessDialog.Visible = True
                    'refresh_pan_wirelessDialog()



                End If


                'If mysignconnections(signconnectionindex.wireless).allSigns_working.Count >= 1 Then



                '    ' zigbee router found



                '    If IO.File.Exists(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\ZigbeeRouter.gif") Then

                '        AIV_USB.imagefile = IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\ZigbeeRouter.gif"

                '        AIV_USB.Visible = True
                '        Lbl_USB_text.Visible = False
                '    ElseIf IO.File.Exists(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\ZigbeeRouter.jpg") Then

                '        Pan_comBase.BackgroundImage = System.Drawing.Image.FromFile(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\ZigbeeRouter.png")
                '        Pan_comBase.Visible = True
                '        AIV_USB.Visible = False
                '        Me.Lbl_uabnotfound.Visible = False
                '    ElseIf IO.File.Exists(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\ZigbeeRouter.png") Then
                '        Pan_comBase.BackgroundImage = System.Drawing.Image.FromFile(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\ZigbeeRouter.png")
                '        Pan_comBase.Visible = True
                '        AIV_USB.Visible = False
                '        Lbl_USB_text.Visible = False
                '    Else

                '        Lbl_uabnotfound.Text = "zigbee base found" & Constants.vbCrLf & "icon image missing!"
                '        AIV_USB.Visible = False
                '        Pan_comBase.Visible = True
                '        Lbl_USB_text.Visible = True

                '    End If
                '    'Pan_wirelessDialog.Visible = True
                '    'refresh_pan_wirelessDialog()


                'ElseIf mysignconnections(signconnectionindex.wireless).allSigns_working.Count >= 1 Then
                '    ' only wireless base has been detected, show wireless base icon



                '    If IO.File.Exists(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\only_Wirell_on.gif") Then

                '        AIV_USB.imagefile = IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\only_Wirell_on.gif"

                '        AIV_USB.Visible = True
                '        Lbl_USB_text.Visible = False
                '    ElseIf IO.File.Exists(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\only_Wirell_on.jpg") Then

                '        Pan_comBase.BackgroundImage = System.Drawing.Image.FromFile(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\only_Wirell_on.png")
                '        Pan_comBase.Visible = True
                '        AIV_USB.Visible = False
                '        Me.Lbl_uabnotfound.Visible = False
                '    ElseIf IO.File.Exists(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\only_Wirell_on.png") Then
                '        Pan_comBase.BackgroundImage = System.Drawing.Image.FromFile(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\only_Wirell_on.png")
                '        Pan_comBase.Visible = True
                '        AIV_USB.Visible = False
                '        Lbl_USB_text.Visible = False
                '    Else

                '        Lbl_uabnotfound.Text = "coordinator found" & Constants.vbCrLf & "image icon missing"
                '        AIV_USB.Visible = False
                '        Pan_comBase.Visible = True
                '        Lbl_USB_text.Visible = True

                '    End If
                '    'Pan_wirelessDialog.Visible = True
                '    'refresh_pan_wirelessDialog()

                'Else
                '    'no signs found

                '    If IO.File.Exists(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\all_gray.gif") Then

                '        AIV_USB.imagefile = IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\all_gray.gif"

                '        AIV_USB.Visible = True
                '        Lbl_USB_text.Visible = False
                '    ElseIf IO.File.Exists(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\all_gray.jpg") Then

                '        Pan_comBase.BackgroundImage = System.Drawing.Image.FromFile(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\all_gray.png")
                '        Pan_comBase.Visible = True
                '        AIV_USB.Visible = False
                '        Me.Lbl_uabnotfound.Visible = False
                '    ElseIf IO.File.Exists(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\all_gray.png") Then
                '        Pan_comBase.BackgroundImage = System.Drawing.Image.FromFile(IO.Directory.GetCurrentDirectory & "\Internal resources\connection images\all_gray.png")
                '        Pan_comBase.Visible = True
                '        AIV_USB.Visible = False
                '        Lbl_USB_text.Visible = False
                '    Else

                '        Lbl_uabnotfound.Text = "no signs found" & Constants.vbCrLf & "image icon missing"
                '        AIV_USB.Visible = False
                '        Pan_comBase.Visible = True
                '        Lbl_USB_text.Visible = True

                '    End If


                'End If









                ''''''''''''''''right side images

                refresh_Pan_USBnodes()
                refresh_Pan_wirelessNodes()
                refresh_Pan_internetNodes()



            End If

            'we want to minimize changes such as clearing and recreating menu list 
            'because doing so messes up the experience of users hovering over menu items

            'this section add USB signs found to drop down menu
            Dim workingsignswalker As Int16 = 0
            Dim menuitemswalker As Int16 = 0

            If (mysignconnections(signconnectionindex.USB).allSigns_working.Count > 0) Then
                USBToolStripMenuItem.Visible = True

            Else

                'no usb signs currently found
                USBToolStripMenuItem.Visible = False


            End If

            mysignconnections(signconnectionindex.USB).allSigns_working.Sort()
            While workingsignswalker < mysignconnections(signconnectionindex.USB).allSigns_working.Count
                If (menuitemswalker >= USBToolStripMenuItem.DropDownItems.Count) Then
                    'need to add sign at end of menue list. 
                    'seperate condition becuase can not compare worrking signs item to 
                    'nonexisting "item" coming one after last menue item



                    Dim thisMenuItem As System.Windows.Forms.ToolStripMenuItem = New System.Windows.Forms.ToolStripMenuItem(mysignconnections(signconnectionindex.USB).allSigns_working(workingsignswalker).ToString)
                    AddHandler thisMenuItem.Click, AddressOf USBconnection_common_Click

                    USBToolStripMenuItem.DropDownItems.Add(thisMenuItem)
                    workingsignswalker += 1
                    menuitemswalker += 1

                ElseIf mysignconnections(signconnectionindex.USB).allSigns_working(workingsignswalker) = USBToolStripMenuItem.DropDownItems.Item(menuitemswalker).Text Then
                    'sign in both list mach
                    'simpliest situation
                    workingsignswalker += 1
                    menuitemswalker += 1
                ElseIf USBToolStripMenuItem.DropDownItems.IndexOfKey(mysignconnections(signconnectionindex.USB).allSigns_working(workingsignswalker)) = -1 Then
                    'sign in working signs list needs to be inserted because it does not appear in menu list

                    Dim thisMenuItem As System.Windows.Forms.ToolStripMenuItem = New System.Windows.Forms.ToolStripMenuItem(mysignconnections(signconnectionindex.USB).allSigns_working(workingsignswalker).ToString)
                    AddHandler thisMenuItem.Click, AddressOf USBconnection_common_Click

                    USBToolStripMenuItem.DropDownItems.Insert(menuitemswalker, thisMenuItem)



                    workingsignswalker += 1
                    menuitemswalker += 1

                ElseIf mysignconnections(signconnectionindex.USB).allSigns_working.IndexOf(USBToolStripMenuItem.DropDownItems.Item(menuitemswalker).Text) = -1 Then
                    'sign currently in menue needs to be removed because it is not in working signs list

                    USBToolStripMenuItem.DropDownItems.RemoveAt(menuitemswalker)
                    'do not increment walkers

                Else
                    'should not reach here
                    MsgBox("bug while regenerating USB dropdown menue")
                End If



            End While


            While USBToolStripMenuItem.DropDownItems.Count > mysignconnections(signconnectionindex.USB).allSigns_working.Count

                'in some cases the above inserts new items pushing old items to the end
                USBToolStripMenuItem.DropDownItems.RemoveAt(USBToolStripMenuItem.DropDownItems.Count - 1)


            End While






            'this section add wireless signs found to dropdown menu

            If (mysignconnections(signconnectionindex.wireless).allSigns_working.Count > 0) Then
                WirelessToolStripMenuItem.Visible = True

            Else

                'no wireless signs currently found
                WirelessToolStripMenuItem.Visible = False


            End If




            workingsignswalker = 0
            menuitemswalker = 0

            mysignconnections(signconnectionindex.wireless).allSigns_working.Sort()
            While workingsignswalker < mysignconnections(signconnectionindex.wireless).allSigns_working.Count
                If (menuitemswalker >= WirelessToolStripMenuItem.DropDownItems.Count) Then
                    'need to add sign at end of menue list. 
                    'seperate condition becuase can not compare worrking signs item to 
                    'nonexisting "item" coming one after last menue item

                    Dim thisSignIdentifier As String = mysignconnections(signconnectionindex.wireless).allSigns_working(workingsignswalker).ToString
                    Dim split_thisSignIdentifier As String() = thisSignIdentifier.Split(".")
                    Dim thisSignComport As String = split_thisSignIdentifier(0)
                    Dim thisSignName As String = split_thisSignIdentifier(1)

                    Dim thisMenuItem As System.Windows.Forms.ToolStripMenuItem = New System.Windows.Forms.ToolStripMenuItem(thisSignName)
                    thisMenuItem.Tag = thisSignComport
                    AddHandler thisMenuItem.Click, AddressOf Wirelesconnection_common_Click

                    WirelessToolStripMenuItem.DropDownItems.Add(thisMenuItem)

                    workingsignswalker += 1
                    menuitemswalker += 1

                ElseIf mysignconnections(signconnectionindex.wireless).allSigns_working(workingsignswalker) = (WirelessToolStripMenuItem.DropDownItems.Item(menuitemswalker).Tag & "." & WirelessToolStripMenuItem.DropDownItems.Item(menuitemswalker).Text) Then
                    'sign in both list mach
                    'simpliest situation
                    workingsignswalker += 1
                    menuitemswalker += 1
                ElseIf WirelessToolStripMenuItem.DropDownItems.IndexOfKey(mysignconnections(signconnectionindex.wireless).allSigns_working(workingsignswalker).ToString.Split(".")(1)) = -1 Then
                    'sign in working signs list needs to be inserted because it does not appear in menu list

                    Dim thisSignIdentifier As String = mysignconnections(signconnectionindex.wireless).allSigns_working(workingsignswalker).ToString
                    Dim split_thisSignIdentifier As String() = thisSignIdentifier.Split(".")
                    Dim thisSignComport As String = split_thisSignIdentifier(0)
                    Dim thisSignName As String = split_thisSignIdentifier(1)

                    Dim thisMenuItem As System.Windows.Forms.ToolStripMenuItem = New System.Windows.Forms.ToolStripMenuItem(thisSignName)
                    thisMenuItem.Tag = thisSignComport
                    AddHandler thisMenuItem.Click, AddressOf Wirelesconnection_common_Click
                    WirelessToolStripMenuItem.DropDownItems.Insert(menuitemswalker, thisMenuItem)



                    workingsignswalker += 1
                    menuitemswalker += 1



                    'else if a sign of the same name is connected to a different coordinator
                    '       add another entry to dropdown menue 

                ElseIf mysignconnections(signconnectionindex.wireless).allSigns_working.IndexOf(WirelessToolStripMenuItem.DropDownItems.Item(menuitemswalker).Tag & "." & WirelessToolStripMenuItem.DropDownItems.Item(menuitemswalker).Text) = -1 Then
                    'sign currently in menue needs to be removed because it is not in working signs list

                    WirelessToolStripMenuItem.DropDownItems.RemoveAt(menuitemswalker)
                    'do not increment walkers

                Else
                    'should not reach here
                    MsgBox("bug while regenerating USB dropdown menue")
                End If



            End While


            While WirelessToolStripMenuItem.DropDownItems.Count > mysignconnections(signconnectionindex.wireless).allSigns_working.Count

                'in some cases the above inserts new items pushing old items to the end
                WirelessToolStripMenuItem.DropDownItems.RemoveAt(WirelessToolStripMenuItem.DropDownItems.Count - 1)


            End While


            '''''vvvvvvvvvvvvvv





            'this section add internet signs found to dropdown menu

            'make menu viviable if either TCP signs or FTP signs
            If (mysignconnections(signconnectionindex.TCPsocket_via_server).allSigns_working.Count > 0 + mysignconnections(signconnectionindex.FTP).allSigns_working.Count > 0) Then
                InternetToolStripMenuItem.Visible = True

            Else

                'no remote signs currently found
                InternetToolStripMenuItem.Visible = False


            End If



            'add TCP socket signs
            workingsignswalker = 0
            menuitemswalker = 0

            mysignconnections(signconnectionindex.TCPsocket_via_server).allSigns_working.Sort()
            While workingsignswalker < mysignconnections(signconnectionindex.TCPsocket_via_server).allSigns_working.Count
                If (menuitemswalker >= InternetToolStripMenuItem.DropDownItems.Count) Then
                    'need to add sign at end of menue list. 
                    'seperate condition becuase can not compare worrking signs item to 
                    'nonexisting "item" coming one after last menue item

                    Dim thisSignIdentifier As String = mysignconnections(signconnectionindex.TCPsocket_via_server).allSigns_working(workingsignswalker).ToString
                    Dim split_thisSignIdentifier As String() = thisSignIdentifier.Split(".")
                    Dim thisSignServerConnection As String = split_thisSignIdentifier(0)
                    Dim thisSignName As String = split_thisSignIdentifier(1)

                    Dim thisMenuItem As System.Windows.Forms.ToolStripMenuItem = New System.Windows.Forms.ToolStripMenuItem(thisSignName)
                    thisMenuItem.Tag = thisSignServerConnection
                    AddHandler thisMenuItem.Click, AddressOf Internetconnection_common_Click

                    InternetToolStripMenuItem.DropDownItems.Add(thisMenuItem)

                    workingsignswalker += 1
                    menuitemswalker += 1

                ElseIf mysignconnections(signconnectionindex.TCPsocket_via_server).allSigns_working(workingsignswalker) = (InternetToolStripMenuItem.DropDownItems.Item(menuitemswalker).Tag & "." & InternetToolStripMenuItem.DropDownItems.Item(menuitemswalker).Text) Then
                    'sign in both list mach
                    'simpliest situation
                    workingsignswalker += 1
                    menuitemswalker += 1
                ElseIf InternetToolStripMenuItem.DropDownItems.IndexOfKey(mysignconnections(signconnectionindex.TCPsocket_via_server).allSigns_working(workingsignswalker).ToString.Split(".")(1)) = -1 Then
                    'sign in working signs list needs to be inserted because it does not appear in menu list

                    Dim thisSignIdentifier As String = mysignconnections(signconnectionindex.wireless).allSigns_working(workingsignswalker).ToString
                    Dim split_thisSignIdentifier As String() = thisSignIdentifier.Split(".")
                    Dim thisSignServerCOnnection As String = split_thisSignIdentifier(0)
                    Dim thisSignName As String = split_thisSignIdentifier(1)

                    Dim thisMenuItem As System.Windows.Forms.ToolStripMenuItem = New System.Windows.Forms.ToolStripMenuItem(thisSignName)
                    thisMenuItem.Tag = thisSignServerCOnnection
                    AddHandler thisMenuItem.Click, AddressOf internetconnection_common_Click
                    InternetToolStripMenuItem.DropDownItems.Insert(menuitemswalker, thisMenuItem)



                    workingsignswalker += 1
                    menuitemswalker += 1



                    'else if a sign of the same name is connected to a different coordinator
                    '       add another entry to dropdown menue 

                ElseIf mysignconnections(signconnectionindex.TCPsocket_via_server).allSigns_working.IndexOf(InternetToolStripMenuItem.DropDownItems.Item(menuitemswalker).Tag & "." & InternetToolStripMenuItem.DropDownItems.Item(menuitemswalker).Text) = -1 Then
                    'sign currently in menue needs to be removed because it is not in working signs list

                    InternetToolStripMenuItem.DropDownItems.RemoveAt(menuitemswalker)
                    'do not increment walkers

                Else
                    'should not reach here
                    MsgBox("bug while regenerating internet dropdown menue")
                End If



            End While


            While InternetToolStripMenuItem.DropDownItems.Count > mysignconnections(signconnectionindex.TCPsocket_via_server).allSigns_working.Count

                'in some cases the above inserts new items pushing old items to the end
                InternetToolStripMenuItem.DropDownItems.RemoveAt(InternetToolStripMenuItem.DropDownItems.Count - 1)


            End While








            ''''vvvvvvvvvvvvvvv

            'add FTP signs to internet dropdown menu
            workingsignswalker = 0
            menuitemswalker = 0

            'mysignconnections(signconnectionindex.TCPsocket_via_serve).allSigns_working.Sort()
            While workingsignswalker < mysignconnections(signconnectionindex.FTP).allSigns_working.Count
                If (menuitemswalker >= InternetToolStripMenuItem.DropDownItems.Count) Then
                    'need to add sign at end of menue list. 
                    'seperate condition becuase can not compare worrking signs item to 
                    'nonexisting "item" coming one after last menue item

                    Dim thisSignName As String = mysignconnections(signconnectionindex.FTP).allSigns_working(workingsignswalker).ToString
                    
                    Dim thisMenuItem As System.Windows.Forms.ToolStripMenuItem = New System.Windows.Forms.ToolStripMenuItem(thisSignName)
                    thisMenuItem.Tag = "ftp"
                    AddHandler thisMenuItem.Click, AddressOf internetconnection_common_Click

                    InternetToolStripMenuItem.DropDownItems.Add(thisMenuItem)

                    workingsignswalker += 1
                    menuitemswalker += 1

                ElseIf mysignconnections(signconnectionindex.TCPsocket_via_server).allSigns_working(workingsignswalker) = (InternetToolStripMenuItem.DropDownItems.Item(menuitemswalker).Tag & "." & InternetToolStripMenuItem.DropDownItems.Item(menuitemswalker).Text) Then
                    'sign in both list mach
                    'simpliest situation
                    workingsignswalker += 1
                    menuitemswalker += 1
                ElseIf InternetToolStripMenuItem.DropDownItems.IndexOfKey(mysignconnections(signconnectionindex.TCPsocket_via_server).allSigns_working(workingsignswalker).ToString.Split(".")(1)) = -1 Then
                    'sign in working signs list needs to be inserted because it does not appear in menu list

                    Dim thisSignIdentifier As String = mysignconnections(signconnectionindex.wireless).allSigns_working(workingsignswalker).ToString
                    Dim split_thisSignIdentifier As String() = thisSignIdentifier.Split(".")
                    Dim thisSignServerCOnnection As String = split_thisSignIdentifier(0)
                    Dim thisSignName As String = split_thisSignIdentifier(1)

                    Dim thisMenuItem As System.Windows.Forms.ToolStripMenuItem = New System.Windows.Forms.ToolStripMenuItem(thisSignName)
                    thisMenuItem.Tag = thisSignServerCOnnection
                    AddHandler thisMenuItem.Click, AddressOf internetconnection_common_Click
                    InternetToolStripMenuItem.DropDownItems.Insert(menuitemswalker, thisMenuItem)



                    workingsignswalker += 1
                    menuitemswalker += 1



                    'else if a sign of the same name is connected to a different coordinator
                    '       add another entry to dropdown menue 

                ElseIf mysignconnections(signconnectionindex.TCPsocket_via_server).allSigns_working.IndexOf(InternetToolStripMenuItem.DropDownItems.Item(menuitemswalker).Tag & "." & InternetToolStripMenuItem.DropDownItems.Item(menuitemswalker).Text) = -1 Then
                    'sign currently in menue needs to be removed because it is not in working signs list

                    InternetToolStripMenuItem.DropDownItems.RemoveAt(menuitemswalker)
                    'do not increment walkers

                Else
                    'should not reach here
                    MsgBox("bug while regenerating internet dropdown menue")
                End If



            End While


            While InternetToolStripMenuItem.DropDownItems.Count > mysignconnections(signconnectionindex.TCPsocket_via_server).allSigns_working.Count

                'in some cases the above inserts new items pushing old items to the end
                InternetToolStripMenuItem.DropDownItems.RemoveAt(InternetToolStripMenuItem.DropDownItems.Count - 1)


            End While




            busy = False

        End If


    End Sub

    Private Sub internet_node_CommonClick(ByVal sender As System.Object) Handles Node_internet3.click, Node_internet2.click, Node_internet1.click
        'MsgBox("click")

        If sender.tag.ToString.ToLower = "ftp" Then
            If mysignconnections(signconnectionindex.FTP).selectedsign <> sender.selected_text Then
                'we are mot currently connected to the FTP sign reperesented by the node
                connect(DirectCast(mysignconnections(signconnectionindex.FTP), SignConnection_FTP), sender.selected_text)
            End If

        ElseIf mysignconnections(signconnectionindex.TCPsocket_via_server).selectedsign <> sender.tag Then
            'we are mot currently connected to the TCP socket sign reperesented by the node
            connect(DirectCast(mysignconnections(signconnectionindex.TCPsocket_via_server), SignConnection_Internet_Via_Server), sender.tag)

        End If

        refreshSignMenue()
    End Sub

    Private Sub usb_node_CommonClick(ByVal sender As System.Object) Handles Node_usb1.click, Node_usb2.click, Node_usb5.click, Node_usb4.click, Node_usb3.click
        'MsgBox("click")

        If mysignconnections(signconnectionindex.USB).selectedsign <> sender.tag Then
            'we are mot currently connected to the sign reperesented by the node
            connect(DirectCast(mysignconnections(signconnectionindex.USB), SignConnection_OneSign_USB), sender.tag)

        End If

    End Sub



    Private Sub wireless_node_CommonClick(ByVal sender As System.Object) Handles Node_wireless1.click, Node_wireless2.click, Node_wireless3.click, Node_wireless4.click, Node_wireless5.click
        'MsgBox("click")

        If mysignconnections(signconnectionindex.wireless).selectedsign <> sender.tag Then
            'we are mot currently connected to the sign reperesented by the node
            connect(DirectCast(mysignconnections(signconnectionindex.wireless), SignConnection_OneSign_Wireless_Atmel), sender.tag)

        End If

    End Sub


    'Public Sub refreshSignMenue()




    '    'the first section creates the dialog on the combo (and other?) tab
    '    'below that populate the member of the connect drop down menu







    '    'sign connection situations



    '    '-Currently connected

    '    '    -test of connection fails
    '    '           ->disconnect + drop down to not connected
    '    '    -Connected to only USB (reguardless of wireless)
    '    '          ->dialog says connected via USB (no identifying info other then "USB")
    '    '          ->if wireless available give dialog + option to change connection 
    '    '    -any other connection
    '    '          ->diolog stating which sign connected to (sign # for wireless [or comport + sign if multiple transceivers], comport for USB)
    '    '      (if still scanning for wireless say so + give option to connect to ones found so far)    
    '    '-not connected currently connected to a sign
    '    '    -one USB availble (reguardless of wireless)
    '    '         -> auto connect
    '    '         -> dialog + options depend of wireless state

    '    '    -no USB + still scanning wireles
    '    '         ->dialog stating no USB + scanning for wireles + option to connect to any found so far

    '    '    -Multiple USB + still scanning Wireless
    '    '          ->dialog stating situation + option to connect to any signs found so far
    '    '    -one Wireless (and no USB)
    '    '          -> auto connect
    '    '          ->dialog states connection
    '    '    -no signs found
    '    '          ->dialog so states
    '    '    -multiple USB or no USB + multiple wireless
    '    '          ->dialog + options




    '    'remember this is called everytime the scan process completes a scan
    '    'there for it is ok to auto connect at this point


    '    'refresh_pan_USBDialog()
    '    Dim removedialog As Boolean = False 'used for debugging - in normal operation should be false


    '    'set available connections flag 
    '    If mysignconnections(signconnectionindex.USB).allSigns_working.Count >= 1 And mysignconnections(signconnectionindex.USB).allSigns_working.Count >= 1 Then
    '        current_availableconnectionstatus = availableconnectionstatus.USBandWireless
    '    ElseIf mysignconnections(signconnectionindex.USB).allSigns_working.Count >= 1 And mysignconnections(signconnectionindex.USB).allSigns_working.Count >= 1 Then
    '        current_availableconnectionstatus = availableconnectionstatus.USBandWireless
    '    ElseIf mysignconnections(signconnectionindex.USB).allSigns_working.Count >= 1 Then
    '        current_availableconnectionstatus = availableconnectionstatus.USBonly
    '    ElseIf mysignconnections(signconnectionindex.wireless).allSigns_working.Count >= 1 Then
    '        current_availableconnectionstatus = availableconnectionstatus.Wirelessonly
    '    Else
    '        current_availableconnectionstatus = availableconnectionstatus.none
    '    End If


    '    If Not removedialog Then

    '        Pan_wirelessDialog.Visible = False

    '        Pan_USBDialog.Visible = True


    '        If Not connectedtoasign() Then
    '            If mysignconnections(signconnectionindex.USB).allSigns_working.Count = 1 And firstComportScanComplete() Then

    '                'one USB sign found
    '                'and first comport scan is complete

    '                'auto connect

    '                'before separating signidentifier out of the long expression,the compiler was calling the bass connect function
    '                Dim signidentifier As String = mysignconnections(signconnectionindex.USB).allSigns_working(0)
    '                If mysignconnections(signconnectionindex.USB).connect(signidentifier, True) Then

    '                    connectionbuttons_markavailable(But_send)
    '                    connectionbuttons_markavailable(But_get)

    '                    selectedConnectionindex = signconnectionindex.USB

    '                Else
    '                    'connection failed
    '                    'remove from list of available signs then leave dialog as is

    '                    mysignconnections(signconnectionindex.USB).allSigns_working.Remove(signidentifier)
    '                    Return
    '                End If



    '            ElseIf mysignconnections(signconnectionindex.USB).allSigns_working.Count >= 1 Then
    '                'multiple USB (or 1 USB the first comport scan not finished)

    '                'do not auto connect

    '            ElseIf mysignconnections(signconnectionindex.wireless).allSigns_working.Count >= 1 Then
    '                'at least one wireless detected

    '                'auto connect to lowest number sign
    '                Dim tempwirecon As SignConnection_OneSign_Wireless_XB = mysignconnections(signconnectionindex.wireless)
    '                If tempwirecon.connect(tempwirecon.allSigns_working(0), True) Then

    '                    connectionbuttons_markavailable(But_send)
    '                    connectionbuttons_markavailable(But_get)

    '                    selectedConnectionindex = signconnectionindex.wireless


    '                Else

    '                    'connection failed
    '                    'remove form list of available signs
    '                    'it is especailly important to remove wire less signs from list 
    '                    'because it takes a long time for scan process to realize no longer available
    '                    'and we would repeatedly try to auto connect

    '                    tempwirecon.allSigns_working.RemoveAt(0)
    '                    Return
    '                End If



    '            End If






    '        End If 'not connected



    '        If DirectCast(mysignconnections(signconnectionindex.wireless), SignConnection_OneSign_Wireless_XB).allportswithTranceiverunits.Count >= 1 Then

    '            Pan_wirelessDialog.Visible = True
    '            refresh_pan_wirelessDialog()


    '        Else
    '            Pan_wirelessDialog.Visible = False

    '        End If


    '        If mysignconnections(signconnectionindex.USB).allSigns_working.Count >= 1 Then

    '            Pan_USBDialog.Visible = True
    '            refresh_pan_USBDialog()


    '        Else
    '            Pan_USBDialog.Visible = False


    '        End If

    '        If Pan_USBDialog.Visible Or Pan_wirelessDialog.Visible Then
    '            Lbl_connectionstatus.Text = ""

    '        ElseIf firstComportScanComplete Then

    '            Lbl_connectionstatus.Text = "No signs found!" & Constants.vbCrLf
    '            Lbl_connectionstatus.Text &= "continuing to search..."

    '        Else
    '            Lbl_connectionstatus.Text = "Searching for signs..."
    '        End If

    '    End If


    '    'we want to minimize changes such as clearing and recreating menu list 
    '    'because doing so messes up the experience of users hovering over menu items

    '    'this section add USB signs found to drop down menu
    '    Dim workingsignswalker As Int16 = 0
    '    Dim menuitemswalker As Int16 = 0

    '    mysignconnections(signconnectionindex.USB).allSigns_working.Sort()
    '    While workingsignswalker < mysignconnections(signconnectionindex.USB).allSigns_working.Count
    '        If (menuitemswalker >= USBToolStripMenuItem.DropDownItems.Count) Then
    '            'need to add sign at end of menue list. 
    '            'seperate condition becuase can not compare worrking signs item to 
    '            'nonexisting "item" coming one after last menue item



    '            Dim thisMenuItem As System.Windows.Forms.ToolStripMenuItem = New System.Windows.Forms.ToolStripMenuItem(mysignconnections(signconnectionindex.USB).allSigns_working(workingsignswalker).ToString)
    '            AddHandler thisMenuItem.Click, AddressOf USBconnection_common_Click

    '            USBToolStripMenuItem.DropDownItems.Add(thisMenuItem)
    '            workingsignswalker += 1
    '            menuitemswalker += 1

    '        ElseIf mysignconnections(signconnectionindex.USB).allSigns_working(workingsignswalker) = USBToolStripMenuItem.DropDownItems.Item(menuitemswalker).Text Then
    '            'sign in both list mach
    '            'simpliest situation
    '            workingsignswalker += 1
    '            menuitemswalker += 1
    '        ElseIf USBToolStripMenuItem.DropDownItems.IndexOfKey(mysignconnections(signconnectionindex.USB).allSigns_working(workingsignswalker)) = -1 Then
    '            'sign in working signs list needs to be inserted because it does not appear in menu list

    '            Dim thisMenuItem As System.Windows.Forms.ToolStripMenuItem = New System.Windows.Forms.ToolStripMenuItem(mysignconnections(signconnectionindex.USB).allSigns_working(workingsignswalker).ToString)
    '            AddHandler thisMenuItem.Click, AddressOf USBconnection_common_Click

    '            USBToolStripMenuItem.DropDownItems.Insert(menuitemswalker, thisMenuItem)



    '            workingsignswalker += 1
    '            menuitemswalker += 1

    '        ElseIf mysignconnections(signconnectionindex.USB).allSigns_working.IndexOf(USBToolStripMenuItem.DropDownItems.Item(menuitemswalker).Text) = -1 Then
    '            'sign currently in menue needs to be removed because it is not in working signs list

    '            USBToolStripMenuItem.DropDownItems.RemoveAt(menuitemswalker)
    '            'do not increment walkers

    '        Else
    '            'should not reach here
    '            MsgBox("bug while regenerating USB dropdown menue")
    '        End If



    '    End While


    '    While USBToolStripMenuItem.DropDownItems.Count > mysignconnections(signconnectionindex.USB).allSigns_working.Count

    '        'in some cases the above inserts new items pushing old items to the end
    '        USBToolStripMenuItem.DropDownItems.RemoveAt(USBToolStripMenuItem.DropDownItems.Count - 1)


    '    End While

    '    'eddie I sugest putting the fucntionality to create menu list of wireless signs found here


    '    'this section add wireless signs found to dropdown menu
    '    workingsignswalker = 0
    '    menuitemswalker = 0

    '    mysignconnections(signconnectionindex.wireless).allSigns_working.Sort()
    '    While workingsignswalker < mysignconnections(signconnectionindex.wireless).allSigns_working.Count
    '        If (menuitemswalker >= WirelessToolStripMenuItem.DropDownItems.Count) Then
    '            'need to add sign at end of menue list. 
    '            'seperate condition becuase can not compare worrking signs item to 
    '            'nonexisting "item" coming one after last menue item



    '            Dim thisMenuItem As System.Windows.Forms.ToolStripMenuItem = New System.Windows.Forms.ToolStripMenuItem(mysignconnections(signconnectionindex.wireless).allSigns_working(workingsignswalker).ToString)
    '            AddHandler thisMenuItem.Click, AddressOf Wirelesconnection_common_Click

    '            WirelessToolStripMenuItem.DropDownItems.Add(thisMenuItem)
    '            workingsignswalker += 1
    '            menuitemswalker += 1

    '        ElseIf mysignconnections(signconnectionindex.wireless).allSigns_working(workingsignswalker) = WirelessToolStripMenuItem.DropDownItems.Item(menuitemswalker).Text Then
    '            'sign in both list mach
    '            'simpliest situation
    '            workingsignswalker += 1
    '            menuitemswalker += 1
    '        ElseIf WirelessToolStripMenuItem.DropDownItems.IndexOfKey(mysignconnections(signconnectionindex.wireless).allSigns_working(workingsignswalker)) = -1 Then
    '            'sign in working signs list needs to be inserted because it does not appear in menu list

    '            Dim thisMenuItem As System.Windows.Forms.ToolStripMenuItem = New System.Windows.Forms.ToolStripMenuItem(mysignconnections(signconnectionindex.wireless).allSigns_working(workingsignswalker).ToString)
    '            AddHandler thisMenuItem.Click, AddressOf Wirelesconnection_common_Click

    '            WirelessToolStripMenuItem.DropDownItems.Insert(menuitemswalker, thisMenuItem)



    '            workingsignswalker += 1
    '            menuitemswalker += 1

    '        ElseIf mysignconnections(signconnectionindex.wireless).allSigns_working.IndexOf(WirelessToolStripMenuItem.DropDownItems.Item(menuitemswalker).Text) = -1 Then
    '            'sign currently in menue needs to be removed because it is not in working signs list

    '            WirelessToolStripMenuItem.DropDownItems.RemoveAt(menuitemswalker)
    '            'do not increment walkers

    '        Else
    '            'should not reach here
    '            MsgBox("bug while regenerating USB dropdown menue")
    '        End If



    '    End While


    '    While WirelessToolStripMenuItem.DropDownItems.Count > mysignconnections(signconnectionindex.wireless).allSigns_working.Count

    '        'in some cases the above inserts new items pushing old items to the end
    '        WirelessToolStripMenuItem.DropDownItems.RemoveAt(WirelessToolStripMenuItem.DropDownItems.Count - 1)


    '    End While



    'End Sub
    Public Sub connect(ByRef type As SignConnection_Internet_Via_Server, ByVal signidentifyer As String)
        'function has to by public so it is accesable from a menu item click event

        type.connect(signidentifyer, True)


        If type.connected Then

            mysignconnections(signconnectionindex.wireless).disconnect()
            mysignconnections(signconnectionindex.USB).disconnect()
            mysignconnections(signconnectionindex.FTP).disconnect()

            selectedConnectionindex = signconnectionindex.TCPsocket_via_server
            ' Me.refresh_pan_wirelessDialog()
            'Me.refresh_pan_USBDialog()
            connectionbuttons_markavailable(But_send)
            connectionbuttons_markavailable(But_get)


        End If



    End Sub

    Public Sub connect(ByRef type As SignConnection_FTP, ByVal signidentifyer As String)
        'function has to by public so it is accesable from a menu item click event

        type.connect(signidentifyer, True)


        If type.connected Then

            mysignconnections(signconnectionindex.wireless).disconnect()
            mysignconnections(signconnectionindex.USB).disconnect()
            mysignconnections(signconnectionindex.TCPsocket_via_server).disconnect()

            selectedConnectionindex = signconnectionindex.FTP
            ' Me.refresh_pan_wirelessDialog()
            'Me.refresh_pan_USBDialog()
            connectionbuttons_markavailable(But_send)
            connectionbuttons_markavailable(But_get)


        End If



    End Sub

    Public Sub connect(ByRef type As SignConnection_OneSign_internet, ByVal signidentifyer As String)
        'function has to by public so it is accesable from a menu item click event

        type.connect(signidentifyer, True)


        If type.connected Then

            mysignconnections(signconnectionindex.wireless).disconnect()
            mysignconnections(signconnectionindex.USB).disconnect()
            mysignconnections(signconnectionindex.FTP).disconnect()


            selectedConnectionindex = signconnectionindex.TCPsocket_via_server
            ' Me.refresh_pan_wirelessDialog()
            'Me.refresh_pan_USBDialog()
            connectionbuttons_markavailable(But_send)
            connectionbuttons_markavailable(But_get)


        End If



    End Sub

    Public Sub connect(ByRef type As SignConnection_OneSign_USB, ByVal signidentifyer As String)
        'function has to by public so it is accesable from a menu item click event

        type.connect(signidentifyer, True)


        If type.connected Then

            mysignconnections(signconnectionindex.wireless).disconnect()
            mysignconnections(signconnectionindex.TCPsocket_via_server).disconnect()
            mysignconnections(signconnectionindex.FTP).disconnect()


            selectedConnectionindex = signconnectionindex.USB
            ' Me.refresh_pan_wirelessDialog()
            'Me.refresh_pan_USBDialog()
            connectionbuttons_markavailable(But_send)
            connectionbuttons_markavailable(But_get)


        End If



    End Sub
    Public Sub connect(ByRef type As SignConnection_OneSign_Wireless_Atmel, ByVal signidentifyer As String)

        'jp jan/3/2011 copied from xb function - modification needed\

        'function has to by public so it is accesable from a menu item click event

        type.connect(signidentifyer, True)

        If type.connected Then





            mysignconnections(signconnectionindex.USB).disconnect()
            mysignconnections(signconnectionindex.TCPsocket_via_server).disconnect()
            mysignconnections(signconnectionindex.FTP).disconnect()

            selectedConnectionindex = signconnectionindex.wireless
            'Me.refresh_pan_wirelessDialog()
            'Me.refresh_pan_USBDialog()

            connectionbuttons_markavailable(But_send)
            connectionbuttons_markavailable(But_get)

        End If
    End Sub


    'Public Sub connect(ByRef type As SignConnection_OneSign_Wireless_XB, ByVal signidentifyer As String)
    '    'function has to by public so it is accesable from a menu item click event

    '    type.connect(signidentifyer, True)

    '    If type.connected Then





    '        mysignconnections(signconnectionindex.USB).disconnect()

    '        selectedConnectionindex = 1
    '        Me.refresh_pan_wirelessDialog()
    '        Me.refresh_pan_USBDialog()

    '        connectionbuttons_markavailable(But_send)
    '        connectionbuttons_markavailable(But_get)

    '    End If
    'End Sub

    Private Sub USBconnection_common_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)

        Dim signidentifier As String = sender.text
        'for some reason it was calling the base connect function

        Dim tempusb As SignConnection_OneSign_USB = DirectCast(mysignconnections(signconnectionindex.USB), SignConnection_OneSign_USB)
        connect(tempusb, signidentifier)



        If Pan_coonnect_menu.Visible Then
            While men_connect.Items.Count > 0           'men_select_comport.DropDownItems.Count
                men_connect.Items(0).TextAlign = ContentAlignment.MiddleCenter
                men_select_comport.DropDownItems.Add(men_connect.Items(0))
            End While
            Pan_coonnect_menu.Visible = False
        End If

    End Sub
    Private Sub Wirelesconnection_common_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)




        Dim signidentifier As String = sender.tag & "." & sender.text

        Dim tempusb As SignConnection_OneSign_Wireless_Atmel = DirectCast(mysignconnections(signconnectionindex.wireless), SignConnection_OneSign_Wireless_Atmel)



        connect(tempusb, signidentifier)
        '        Me.mysignconnections(signconnectionindex.wireless).connect(signidentifier)

        If Pan_coonnect_menu.Visible Then
            While men_connect.Items.Count > 0           'men_select_comport.DropDownItems.Count
                men_connect.Items(0).TextAlign = ContentAlignment.MiddleCenter
                men_select_comport.DropDownItems.Add(men_connect.Items(0))
            End While
            Pan_coonnect_menu.Visible = False
        End If
    End Sub
    Private Sub internetconnection_common_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)




        Dim signidentifier As String = sender.tag & "." & sender.text

        Dim tempusb As SignConnection_Internet_Via_Server = DirectCast(mysignconnections(signconnectionindex.TCPsocket_via_server), SignConnection_Internet_Via_Server)



        connect(tempusb, signidentifier)
        '        Me.mysignconnections(signconnectionindex.wireless).connect(signidentifier)



        '20110506 I forget what this panel is. code was copied from wirelessconnection_common_click event handler
        If Pan_coonnect_menu.Visible Then
            While men_connect.Items.Count > 0           'men_select_comport.DropDownItems.Count
                men_connect.Items(0).TextAlign = ContentAlignment.MiddleCenter
                men_select_comport.DropDownItems.Add(men_connect.Items(0))
            End While
            Pan_coonnect_menu.Visible = False
        End If
    End Sub
    Private Sub FTP_common_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)




        Dim signidentifier As String = sender.text

        Dim tempusb As SignConnection_FTP = DirectCast(mysignconnections(signconnectionindex.FTP), SignConnection_FTP)



        connect(tempusb, signidentifier)
        '        Me.mysignconnections(signconnectionindex.wireless).connect(signidentifier)


        '20130723 cpied this code from internetconnection_common_Click
        '20110506 I forget what this panel is. code was copied from wirelessconnection_common_click event handler
        If Pan_coonnect_menu.Visible Then
            While men_connect.Items.Count > 0           'men_select_comport.DropDownItems.Count
                men_connect.Items(0).TextAlign = ContentAlignment.MiddleCenter
                men_select_comport.DropDownItems.Add(men_connect.Items(0))
            End While
            Pan_coonnect_menu.Visible = False
        End If
    End Sub






    'Wirelesconnection_common_Click



    ''these functions are intented to be marshaled (called by delegates) in the background worker of the connection class
    Public Function getfilename() As String
        Return FileName

    End Function
    Public Function getlinecount() As Integer
        Return Me.linecount

    End Function

    Public Function getlinelength() As Integer
        Return settings(settingsindex.linelength)

    End Function
    Public Function gettextdata() As ArrayList
        Return textdata

    End Function
    Public Function gettrickdata() As ArrayList
        Return trickdata

    End Function


    Public Sub setlinecount(ByVal value As Integer)

        Me.set_linecount(value, line_configuration.add_or_truncate_position._end)
        'linecount = value

    End Sub

    Public Sub setlinelength(ByVal value As Integer)

        'set_linelenth(value, line_configuration.add_or_truncate_position._end)
        'settings(settingsindex.linelength) = value
        sincronizelinelength(value)
    End Sub
    Public Sub settextdata(ByVal value As ArrayList)
        textdata = value

    End Sub
    Public Sub settrickdata(ByVal value As ArrayList)


        'linecount = value.Count
        trickdata = value

        'display the text on the form in lines view befoer the get process completes
        'textdata_top()
    End Sub
    'Form1.settings(Form1.settingsindex.linelength)




    Private Sub TiniliteWorldcontact_commonClick(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles TiniliteWorldToolStripMenuItem.Click, ReportAProblemToolStripMenuItem.Click
        If My.Computer.Network.IsAvailable = True Then
            Dim websiteProcess As System.Diagnostics.Process = System.Diagnostics.Process.Start("http://www.tinilite.net/index.php/contact-us")


        Else
            Dim message As String = "No internet connection detected " + Constants.vbCrLf
            message += "Please try again later or email TiniLiteWorld@Gmail.com " + Constants.vbCrLf

            MsgBox(message)
        End If
        'http://www.tinilite.net/index.php/contact-us
    End Sub

    Private Sub numupdown_commonkeypress(ByVal sender As System.Object, ByVal e As System.Windows.Forms.KeyPressEventArgs) Handles NUD_cardcount_easytab.KeyPress
        Dim thisnumupdown As NumericUpDown = sender
        ' MsgBox(sender.value)

        'thisnumupdown()
    End Sub

    Private Sub DomainUpDown1_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs)
        If formloaded Then
            MsgBox("dddd")
        End If

    End Sub

    Private Sub TB_common_enter(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles TB9.Enter, TB8.Enter, TB7.Enter, TB6.Enter, TB5.Enter, TB4.Enter, TB3.Enter, TB2.Enter, TB1.Enter, TB0.Click, TB0.Enter, TB9.Click, TB8.Click, TB7.Click, TB6.Click, TB5.Click, TB4.Click, TB3.Click, TB2.Click, TB1.Click
        'Dim txt As TextBox
        'txt.SelectionLength = 0
        If sender.text.trim = "" Then
            sender.SelectionStart = 0
            sender.SelectionLength = 0
        End If
    End Sub


    Private Sub TBKEYWORD_Common_Enter(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles TBkw09.Click, TBkw08.Click, TBkw07.Click, TBkw06.Click, TBkw05.Click, TBkw04.Click, TBkw03.Click, TBkw02.Click, TBkw01.Click, TBkw00.Click
        Dim sendername As String = sender.name
        Dim senderindex As Int16 = Convert.ToInt16(sendername.Substring(sendername.Length - 2))
        If keywordallignment(senderindex) = Mod_textboxfunctions.txtbox_alignment_type._none Or keywordallignment(senderindex) = Mod_textboxfunctions.txtbox_alignment_type._left Then

            If sender.text.trim = "" Then

                sender.SelectionStart = 0

                sender.SelectionLength = 0

            End If
        End If
    End Sub


    Private Sub Label71_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)

    End Sub

    Private Sub Pan_bluetabs_Paint_1(ByVal sender As System.Object, ByVal e As System.Windows.Forms.PaintEventArgs) Handles Pan_bluetabs.Paint

    End Sub


    Private Sub TextBox24_MouseDown(ByVal sender As System.Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles But_connect.MouseDown

        If current_availableconnectionstatus = availableconnectionstatus.none Then




            Timer_showhide_connectcablemessage.Start()

        Else

            'AddHandler men_select_comport.DropDownOpened, AddressOf men_connect_MouseEnter
            AddHandler men_select_comport.MouseEnter, AddressOf men_connect_MouseEnter
            AddHandler men_select_comport.MouseHover, AddressOf men_connect_MouseEnter
            AddHandler men_select_comport.MouseLeave, AddressOf men_connect_MouseLeave

            'AddHandler men_select_comport.DropDownClosed, AddressOf men_connect_MouseLeave
            While men_select_comport.DropDownItems.Count > 0


                men_select_comport.DropDownItems(0).TextAlign = ContentAlignment.MiddleLeft

                'AddHandler men_select_comport.DropDownItems(0).MouseEnter, AddressOf men_connect_MouseEnter
                'AddHandler men_select_comport.DropDownItems(0).MouseLeave, AddressOf men_connect_MouseLeave



                men_connect.Items.Add(men_select_comport.DropDownItems(0))


                'ContextMenu_connect.Items.Add(men_select_comport.DropDownItems(0))

            End While
            Pan_coonnect_menu.Visible = True








        End If


    End Sub

    Private Sub But_send_MouseHover(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles But_send.MouseHover, But_get.MouseHover
        If current_availableconnectionstatus = availableconnectionstatus.none Then




            Timer_showhide_connectcablemessage.Start()

        ElseIf Not connectionbuttons_isavailable(sender) Then
            'connection are available but no connection has been made


            Timer_showhide_mustselectconnectionmessage.Start()

        End If

    End Sub

    Private Sub TextBox24_Mousehover(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles But_connect.MouseHover
        If current_availableconnectionstatus = availableconnectionstatus.none Then




            Timer_showhide_connectcablemessage.Start()

        Else





            While men_select_comport.DropDownItems.Count > 0
                men_select_comport.DropDownItems(0).TextAlign = ContentAlignment.MiddleLeft
                men_connect.Items.Add(men_select_comport.DropDownItems(0))

                'ContextMenu_connect.Items.Add(men_select_comport.DropDownItems(0))

            End While
            Pan_coonnect_menu.Visible = True


        End If

    End Sub


    Private Sub Pan_coonnect_menu_MouseLeave(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Pan_coonnect_menu.MouseLeave
        'no longer used
        Return


        If Pan_coonnect_menu.Visible Then
            While men_connect.Items.Count > 0           'men_select_comport.DropDownItems.Count
                men_connect.Items(0).TextAlign = ContentAlignment.MiddleCenter
                men_select_comport.DropDownItems.Add(men_connect.Items(0))
            End While
            Pan_coonnect_menu.Visible = False
        End If
    End Sub


    Private Sub Timer_closeconnectdropdown_Tick(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Timer_closeconnectdropdown.Tick




        Static recursive = False

        If Not recursive Then
            recursive = True

            If Pan_coonnect_menu.Visible Then
                While men_connect.Items.Count > 0           'men_select_comport.DropDownItems.Count
                    men_connect.Items(0).TextAlign = ContentAlignment.MiddleCenter
                    men_select_comport.DropDownItems.Add(men_connect.Items(0))
                End While
                Pan_coonnect_menu.Visible = False
            End If

            recursive = False
        End If

        Timer_closeconnectdropdown.Stop()

    End Sub

    Private Sub men_connect_MouseEnter(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles men_connect.MouseEnter, men_connect.MouseHover
        Timer_closeconnectdropdown.Stop()
    End Sub

    Private Sub men_connect_MouseLeave(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles men_connect.MouseLeave
        Timer_closeconnectdropdown.Start()
    End Sub

    Private Sub Pan_coonnect_menu_VisibleChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Pan_coonnect_menu.VisibleChanged
        men_connect.Visible = Pan_coonnect_menu.Visible

        'men_connect.d
    End Sub

    Private Sub Timer_showhide_connectcablemessage_Tick(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Timer_showhide_connectcablemessage.Tick

        'the convention is that each time this timmer is started it ticks twice
        'once to show the message and once to turn it off

        Static dialogshowing As Boolean = False
        If dialogshowing Then

            'jan/7/2010 this control no longer exists
            ' Animatedimageviewer1.Visible = False
            dialogshowing = False

            Timer_showhide_connectcablemessage.Interval = 100
            Timer_showhide_connectcablemessage.Stop()

        Else
            'jan/7/2010 this control no longer exists
            ' Animatedimageviewer1.Visible = True
            dialogshowing = True

            Timer_showhide_connectcablemessage.Interval = 4000
        End If


    End Sub


    Private Sub Lbl_morelines_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)

    End Sub

    Private Sub Pan_bluetabs_ParentChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Pan_bluetabs.ParentChanged
        Pan_dialog.Parent = Pan_bluetabs.Parent
        Pan_Control.Parent = Pan_bluetabs.Parent


    End Sub

    Private Sub pan_dialog_ParentChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles pan_chalkboard.ParentChanged
        If pan_chalkboard.Parent Is Me.Tab_Easy Then
            Me.LBL_linecount.Visible = False
            Me.Lbl_availablelines.Visible = False
        Else
            Me.LBL_linecount.Visible = True
            Me.Lbl_availablelines.Visible = True
        End If
    End Sub


    Private Sub Pan_beginners_help_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Pan_beginners_help.Click
        UserManuelViewer.Show()
    End Sub

    Private Sub Pan_beginners_help_MouseClick(ByVal sender As System.Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles Pan_beginners_help.MouseClick
        UserManuelViewer.Show()
    End Sub


    Private Sub But_listchildren_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles But_listchildren.Click


        MsgBox(PDFview_usermanuel_small.OcxState.ToString)
        Return
        Dim children As Control.ControlCollection = PDFview_usermanuel_small.Controls
        Dim loopcounter As Int16 = 0
        Dim list As String = ""
        MsgBox(children.Count)
        While loopcounter < children.Count
            list &= children(loopcounter).ToString & Constants.vbCrLf

            loopcounter += 1

        End While

        MsgBox(list)
    End Sub





    Private Sub Pan_Usermanuel_small_MouseDoubleClick(ByVal sender As System.Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles Pan_Usermanuel_small.MouseDoubleClick, Panel33.MouseDoubleClick, Lbl_UserManual.MouseDoubleClick, Label10.MouseDoubleClick
        UserManuelViewer.Show()
    End Sub



    Private Sub Timer_showhide_mustselectconnectionmessage_Tick(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Timer_showhide_mustselectconnectionmessage.Tick
        'the convention is that each time this timmer is started it ticks twice
        'once to show the message and once to turn it off

        Static dialogshowing As Boolean = False
        If dialogshowing Then

            'jan/7/2010 this control no longer exists
            'Lbl_pleaseselectconnection.Visible = False
            dialogshowing = False

            Timer_showhide_mustselectconnectionmessage.Interval = 100
            Timer_showhide_mustselectconnectionmessage.Stop()

        Else
            'jan/7/2010 this control no longer exists
            'Lbl_pleaseselectconnection.Visible = True
            dialogshowing = True

            Timer_showhide_mustselectconnectionmessage.Interval = 4000
        End If





    End Sub



    Private Sub But_debug_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles But_debug.Click
        'refresh_pan_USBDialog()
    End Sub


    Private Sub TxtFreeStyle_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles TxtFreeStyle.TextChanged
        If Not formloaded Then
            Return
        End If

        Static Dim previous_text As String = TxtFreeStyle.Text
        'Static Dim previous_selection_start As Int16 = TxtFreeStyle.SelectionStart
        'Static Dim previous_selection_length As Int16 = TxtFreeStyle.SelectionLength

        Static Dim recursive As Boolean = False





        If databeinginternallymanipulated Then
            Return
        End If



        If (Not recursive) Then

            recursive = True
            'MsgBox(sender.SelectionStart)

            Dim newtextdata As ArrayList = New ArrayList


            Timer_demo.Stop()

            Dim spacesinserted As Int16 = 0
            Dim crlfinseterd = 0


            Dim cursor_pos As Integer = sender.SelectionStart
            Dim change_to_cursor_pos = 0

            'float stuff is to avoid rounding up
            Dim cursor_line_f As Single = (cursor_pos) / (Me.linelength + 2.0)
            Dim cursor_line As Int16 = cursor_pos / (Me.linelength + 2)

            If (cursor_line > cursor_line_f) Then
                'in this case the stupid system rounded up and we need to subtract 1 to make it be rounded down
                cursor_line -= 1
            End If



            TxtFreeStyle.Text = TxtFreeStyle.Text.ToUpper



            'jp jan/1/2010: for now leave these warning prompts same as for lines tab
            'jp march 19 2011: modifications to handle new file format
            If currenttrickcodingversion = TRICKCODINGVERSION_COMBOKEYWORDS_PRE_20110310 Or currenttrickcodingversion = TRICKCODINGVERSION_COMBOKEYWORDS_CURRENT Then
                If promptbeforedisablingstandadtab Then


                    Dim message As String = "If you proceed with editing data in this tab you will not be able to return to combo tab!" + Constants.vbCrLf

                    message += "Are you sure you want to proceed"

                    Dim result As DialogResult = MsgBox(message, MsgBoxStyle.OkCancel)

                    If result = Windows.Forms.DialogResult.Cancel Then

                        sender.text = previous_text

                        recursive = False
                        Return
                    Else

                        If currenttrickcodingversion = TRICKCODINGVERSION_COMBOKEYWORDS_PRE_20110310 Then

                            ''assume they want to stick with old file format
                            currenttrickcodingversion = TRICKCODINGVERSION_LINESONLY_PRE_20110310
                        Else
                            currenttrickcodingversion = TRICKCODINGVERSION_LINESONLY_CURRENT
                        End If



                    End If
                Else


                    If currenttrickcodingversion = TRICKCODINGVERSION_COMBOKEYWORDS_PRE_20110310 Then
                        ''assume they want to stick with old file format
                        currenttrickcodingversion = TRICKCODINGVERSION_LINESONLY_PRE_20110310
                    Else
                        currenttrickcodingversion = TRICKCODINGVERSION_LINESONLY_CURRENT
                    End If

                End If
            End If


            deviceandmemorymatch = False 'this variable was used for monitor mode. many changes since this functionality removed
            hidetooltip()


            'go through text make sure line breaks are correct
            Dim theselines As String() = TxtFreeStyle.Text.Split(Constants.vbCrLf)
            Dim newlineworkingon = 0
            Dim oldlineworkingon = 0
            'If TxtFreeStyle.Text.Contains(Constants.vbCr) Then
            '    MsgBox("cr " & TxtFreeStyle.SelectionStart)

            'End If

            'If TxtFreeStyle.Text.Contains(Constants.vbCrLf) Then
            '    MsgBox("lf" & TxtFreeStyle.SelectionStart)

            'End If


            For Each line As String In theselines



                If line.Contains(Constants.vbCr) Then
                    MsgBox("cr")

                End If

                'If line.Contains(Constants.vbLf) Then
                '    MsgBox("lf")

                'End If

                'remove spaces at end of line
                line = line.TrimEnd

                'remove the lf which is left because vb designed stupidly
                line = String.Join("", line.Split(Constants.vbLf))

                If line.Contains(Constants.vbLf) Then
                    MsgBox("lf")

                End If


                If (line.Length = Me.linelength) Then
                    newtextdata.Add(line)
                ElseIf (line.Length < Me.linelength) Then
                    'line is to short, pad
                    While (line.Length < Me.linelength)

                        'most of the time the space put back is the same as space trimmed
                        'more work could be done in this reguard

                        'If (line.Length + lineworkingon * (Me.linelength + 2) < cursor_pos + change_to_cursor_pos) Then
                        '    change_to_cursor_pos += 1

                        'End If

                        If (cursor_pos >= 2) Then


                            If (TxtFreeStyle.Text(cursor_pos - 2) = Constants.vbCr And TxtFreeStyle.Text(cursor_pos - 1) = Constants.vbLf And oldlineworkingon = cursor_line) Then

                                If cursor_pos Mod (Me.linelength + 2) <> 0 Then

                                    'the user hit enter key resulting crlf being in middle of old line
                                    'this is one case where the cursor must be moved to reflect spaces being inserted
                                    change_to_cursor_pos += 1
                                End If

                            End If
                        End If
                        line &= " "

                        spacesinserted += 1


                    End While
                    newtextdata.Add(line)
                ElseIf (line.Length > Me.linelength) Then
                    'line is too long 
                    'split into multiple lines
                    'Dim newline As String = ""



                    If ((cursor_pos + change_to_cursor_pos) Mod (Me.linelength + 2) = Me.linelength) Then

                        'deal with special case when user deletes a crlf
                        'in this case we want the last letter of the previous line deleted and replaced with the first line of the next line

                        newtextdata.Add(line.Substring(0, Me.linelength - 1) & line.Substring(Me.linelength, 1))

                        line = line.Substring(Me.linelength + 1)
                        change_to_cursor_pos -= 1

                    End If

                    While (line.Length > Me.linelength)

                        If (Me.linelength + newlineworkingon * (Me.linelength + 2) < cursor_pos + change_to_cursor_pos) Then
                            change_to_cursor_pos += 2

                        End If
                        newlineworkingon += 1
                        newtextdata.Add(line.Substring(0, Me.linelength))
                        line = line.Substring(Me.linelength)
                        crlfinseterd += 1

                    End While

                    If line.Length > 0 Then

                        'If (Me.linelength + lineworkingon * (Me.linelength + 2) < cursor_pos + change_to_cursor_pos) Then
                        '    change_to_cursor_pos += 3

                        'End If
                        newlineworkingon += 1
                        newtextdata.Add(line.PadRight(Me.linelength))
                    End If

                Else
                    MsgBox("bug in frestyle text change function")


                End If

                newlineworkingon += 1
                oldlineworkingon += 1
            Next


            'if there are too many lines and there are blank lines at end remove them
            While (newtextdata.Count > Form1.MAXLINES And newtextdata(newtextdata.Count - 1).trim = "")

                'remove the last line which is all space   
                newtextdata.RemoveAt(newtextdata.Count - 1)


            End While


            'if there are still too many lines after removing all blanc lines bail out
            If (newtextdata.Count > Me.MAXLINES) Then
                'undo the user's typing

                TxtFreeStyle.Text = previous_text
                TxtFreeStyle.SelectionStart = cursor_pos

                Beep()
                recursive = False

                Return
            End If



            'change linecount stored in memory
            'due to design flaw this variable must be set using this function BEFORE modifying arraylist in next line 
            Me.set_linecount(newtextdata.Count, line_configuration.add_or_truncate_position._end)


            'change lines stored in memory
            Me.textdata = newtextdata



            'change textbox to reflect changes to space padding and linebreaks
            TxtFreeStyle.Text = ""
            For Each line As String In newtextdata
                TxtFreeStyle.Text &= line & Constants.vbCrLf
            Next
            'remove last 2 characters becuase for loop leave and extra crlf
            TxtFreeStyle.Text = TxtFreeStyle.Text.Substring(0, TxtFreeStyle.Text.Length - 2)


            'position cursor correctly
            TxtFreeStyle.SelectionStart = cursor_pos + change_to_cursor_pos

            TxtFreeStyle.ScrollToCaret()


            previous_text = sender.text

            change_Lbl_pattern_type()

            Me.refresh_demo()


            change = True

            'for debugging output textbox
            Dim loopcounter As Int16 = 0
            Dim msg As String = ""
            While loopcounter < TxtFreeStyle.Text.Length
                msg &= Asc(TxtFreeStyle.Text(loopcounter))
                msg &= Constants.vbCrLf
                loopcounter += 1
            End While
            'MsgBox(msg)
            recursive = False
        End If
    End Sub




    Private Sub TxtFreeStyle_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles TxtFreeStyle.Click
        Dim cursor_pos As Int16 = TxtFreeStyle.SelectionStart


        If cursor_pos = 0 Then
            Exit Sub
        End If

        While (cursor_pos > 0 And TxtFreeStyle.Text(cursor_pos - 1) = " ")
            cursor_pos -= 1
            If cursor_pos = 0 Then
                Exit While
            End If
        End While

        TxtFreeStyle.SelectionStart = cursor_pos
    End Sub

    Private Sub men_configure_internet_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles men_configure_internet.Click

        configure_internet.ShowDialog()
        'wait for form to close


        If configure_internet.DialogResult = Windows.Forms.DialogResult.Cancel Then
            Return
        End If

        'for now only one internet connection
        'shortcuts taken. more work needed latter to handle multiple connections


        'jp april3,2011 more shortcuts taken - disable TCP coonections other then through server

        Static oldport As Int16
        Static oldenabled As configure_internet.enabled_state
        Static oldconnectiontype As configure_internet.connectiontype
        Static oldip As String
        Static oldcompany As String
        Static oldusername As String
        Static oldpassword As String

        Dim newport As Int16 = configure_internet.myconnections(0).port
        Dim newenabled As configure_internet.enabled_state = configure_internet.myconnections(0).enabled
        Dim newconnectiontype As configure_internet.connectiontype = configure_internet.myconnections(0).type
        Dim newip As String = configure_internet.myconnections(0).ip
        Dim newcompany As String = configure_internet.myconnections(0).company
        Dim newusername As String = configure_internet.myconnections(0).username
        Dim newpassword As String = configure_internet.myconnections(0).password

        ' 


        If (newport = oldport And newenabled = oldenabled And newconnectiontype = oldconnectiontype And newip = oldip And newcompany = oldcompany And newusername = oldusername And newpassword = oldpassword) Then
            'no change - nothing to do
            Return
        End If


        If Not newenabled And oldenabled Then

            'currently the connection is disabled, however it previously was enabled

            ''to do close old connection


            oldport = newport
            oldenabled = newenabled

            oldconnectiontype = newconnectiontype
            oldip = newip

            Return



        End If

        If oldconnectiontype <> Nothing And newconnectiontype <> oldconnectiontype Then
            'to do close old connection

        End If

        If (oldport <> Nothing And newport <> oldport) Then
            'close old port
            'to do ......

        End If


        If newconnectiontype = configure_internet.connectiontype.TiniWindow_is_TCPserver Then
            'add this server connection
            'DirectCast(Me.mysignconnections(Me.signconnectionindex.internet_via_server), SignConnection_OneSign_internet).addserver(newport)

            MsgBox("This type of TCP connection not supportec by this version of TiniWindow")
            Return
        ElseIf newconnectiontype = configure_internet.connectiontype.TiniWindow_is_TCPclient Then
            'DirectCast(Me.mysignconnections(Me.signconnectionindex.internet_via_server), SignConnection_OneSign_internet).addclient(newip, newport, , "exit")
            'DirectCast(Me.mysignconnections(Me.signconnectionindex.internet), SignConnection_OneSign_internet).logon()
            MsgBox("This type of TCP connection not supportec by this version of TiniWindow")
            Return
        ElseIf newconnectiontype = configure_internet.connectiontype.Use_TiniLite_Server Then

            DirectCast(Me.mysignconnections(Me.signconnectionindex.TCPsocket_via_server), SignConnection_Internet_Via_Server).addServer(newip, newport, newcompany, newusername, newpassword)
            'DirectCast(Me.mysignconnections(Me.signconnectionindex.internet), SignConnection_OneSign_internet).logon()



        End If

        oldport = newport
        oldenabled = newenabled
        oldconnectiontype = newconnectiontype
        oldip = newip
        oldcompany = newcompany
        oldusername = newusername
        oldpassword = newpassword

    End Sub

    Private Sub But_server_savefile_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles But_server_savefile.Click
        If Me.FileName = "" Then
            MsgBox("in this vesion of TiniWindow you must save to computer before saving to server")
            Return

        End If
        Dim truncatedfilename As String = FileName

        If truncatedfilename.IndexOf("/") <> -1 Then
            truncatedfilename = truncatedfilename.Substring(truncatedfilename.LastIndexOf("/") + 1)
        End If

        If truncatedfilename.IndexOf("\") <> -1 Then
            truncatedfilename = truncatedfilename.Substring(truncatedfilename.LastIndexOf("\") + 1)
        End If

        DirectCast(mysignconnections(signconnectionindex.TCPsocket_via_server), SignConnection_OneSign_internet).savefiletoserver(truncatedfilename)

    End Sub

    Private Sub But_server_openfile_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles But_server_openfile.Click


        entertextform.prompt = "enter file name"
        entertextform.ShowDialog()

        DirectCast(mysignconnections(signconnectionindex.TCPsocket_via_server), SignConnection_OneSign_internet).getfilefromserver(entertextform.input)
        'getfilefromserver()

    End Sub

    Private Sub AddEditRemoteSignsToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        RemoteSignsForm.ShowDialog()
    End Sub


    
   





    Private Sub ConfigureRemoteSignsToolStripMenuItem_Click(sender As System.Object, e As System.EventArgs) Handles ConfigureRemoteSignsToolStripMenuItem.Click
        RemoteSignsForm.ShowDialog()

    End Sub
End Class